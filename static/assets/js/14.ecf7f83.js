(window.webpackJsonp=window.webpackJsonp||[]).push([[14],{"1hyh":function(t,e,s){"use strict";s.r(e);var n=s("hk5r"),i=s.n(n);for(var a in n)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(a);e.default=i.a},Uz2k:function(t,e,s){},Whvt:function(t,e,s){"use strict";s.r(e);var n=s("tQff"),i=s("1hyh");for(var a in i)["default"].indexOf(a)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(a);s("rAnn");var o=s("KHd+"),r=Object(o.a)(i.default,n.a,n.b,!1,null,"8d810cfa",null);e.default=r.exports},"b1K/":function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t,e,s,n,i){var a=sessionStorage.getItem("cursorIndex"),o=a&&JSON.parse(a);if(!t||!t.selectionStart&&0!==t.selectionStart||o.name!==e)return s+n;var r=o.start,l=o.end,c=t.scrollTop;return i.$nextTick((function(){t.selectionStart=r+n.length,t.selectionEnd=r+n.length,t.scrollTop=c,t.focus()})),s.substr(0,r)+n+s.substr(l)}},hk5r:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=l(s("PaSM")),i=l(s("b1K/")),a=s("CeR/"),o=l(s("0hVY")),r=s("ygAv");function l(t){return t&&t.__esModule?t:{default:t}}e.default={name:"editorNotice",mixins:[n.default,o.default],props:{checkId:{type:String,default:""},noticeInfo:{type:Object,default:function(){return{}}},isShowFooter:{type:Boolean,default:!0},isShowTitle:{type:Boolean,default:!1},customRow:Number},data:function(){return{secondClick:!1,formInfo:{title:"",message:""},variableList:[],searchable:!0,insertVariable:{id:"",content:{},titleId:"",titleContent:{}},checkInfo:{title:!1,message:!1},rules:{},initFromData:{}}},mounted:function(){this.initData(),this.rules.message=this.checkCommonRules("select").select,this.rules.title=this.checkCommonRules("select").select},methods:{initData:function(){this.formInfo.title=this.noticeInfo.title_template,this.formInfo.message=this.noticeInfo.content_template,this.getVariableList(),this.initFromData=(0,r.deepClone)(this.formInfo)},getVariableList:function(){var t=this;this.$store.dispatch("noticeConfigure/getVariableList").then((function(e){t.variableList=e.data})).catch((function(e){(0,a.errorHandler)(e,t)}))},submitNotice:function(){var t=this;if(this.hasPermission(["ticket_state_manage"])){if(this.$refs.wechatForm.validate().then((function(){}),(function(){})),!this.checkNotice()){var e={content_template:this.formInfo.message};"EMAIL"===this.checkId&&(e.title_template=this.formInfo.title);var s=this.noticeInfo.id;this.secondClick||(this.secondClick=!0,this.$store.dispatch("noticeConfigure/changeNotice",{params:e,id:s}).then((function(){t.$bkMessage({message:t.$t('m.deployPage["保存成功"]'),theme:"success"}),t.$parent.$parent.getNoticeList(),t.closeNotice()})).catch((function(e){(0,a.errorHandler)(e,t)})).finally((function(){t.secondClick=!1})))}}else this.applyForPermission(["ticket_state_manage"],this.$store.state.project.projectAuthActions,{})},closeNotice:function(){this.$emit("closeEditor")},checkNotice:function(){return this.checkInfo.title=!this.formInfo.title,this.checkInfo.message=!this.formInfo.message,this.checkInfo.title||this.checkInfo.message},changeInsert:function(){"message"===(arguments.length<=2?void 0:arguments[2])?this.formInfo.message=(0,i.default)(document.querySelector(".bk-editor-notice .bk-remindway-form .bk-form-textarea"),"editorNotice",this.formInfo.message,"${"+(arguments.length<=0?void 0:arguments[0])+"}",this):this.formInfo.title+="${"+(arguments.length<=0?void 0:arguments[0])+"}"}}}},rAnn:function(t,e,s){"use strict";s("Uz2k")},tQff:function(t,e,s){"use strict";s.d(e,"a",(function(){return n})),s.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bk-editor-notice"},[e("bk-form",{key:t.checkId,ref:"wechatForm",attrs:{"label-width":150,model:t.formInfo,"form-type":"vertical",rules:t.rules}},["WEIXIN"===t.checkId?[t.isShowTitle?e("bk-form-item",{attrs:{label:t.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[e("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:t.formInfo.title,callback:function(e){t.$set(t.formInfo,"title",e)},expression:"formInfo.title"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"title")}},model:{value:t.insertVariable.titleId,callback:function(e){t.$set(t.insertVariable,"titleId",e)},expression:"insertVariable.titleId"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1):t._e(),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("m.slaContent['提醒内容']"),required:!0,property:"message","icon-offset":240}},[e("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:t.customRow||5},model:{value:t.formInfo.message,callback:function(e){t.$set(t.formInfo,"message",e)},expression:"formInfo.message"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"message")}},model:{value:t.insertVariable.id,callback:function(e){t.$set(t.insertVariable,"id",e)},expression:"insertVariable.id"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1)]:"EMAIL"===t.checkId?[e("bk-form-item",{attrs:{label:t.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[e("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:t.formInfo.title,callback:function(e){t.$set(t.formInfo,"title",e)},expression:"formInfo.title"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"title")}},model:{value:t.insertVariable.titleId,callback:function(e){t.$set(t.insertVariable,"titleId",e)},expression:"insertVariable.titleId"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("m.slaContent['邮件内容']"),required:!0,property:"message","icon-offset":240}},[e("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:t.customRow||22},model:{value:t.formInfo.message,callback:function(e){t.$set(t.formInfo,"message",e)},expression:"formInfo.message"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"message")}},model:{value:t.insertVariable.id,callback:function(e){t.$set(t.insertVariable,"id",e)},expression:"insertVariable.id"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1)]:"SMS"===t.checkId?[t.isShowTitle?e("bk-form-item",{attrs:{label:t.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[e("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:t.formInfo.title,callback:function(e){t.$set(t.formInfo,"title",e)},expression:"formInfo.title"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"title")}},model:{value:t.insertVariable.titleId,callback:function(e){t.$set(t.insertVariable,"titleId",e)},expression:"insertVariable.titleId"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1):t._e(),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("m.slaContent['短信内容']"),required:!0,property:"message","icon-offset":240}},[e("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:t.customRow||15},model:{value:t.formInfo.message,callback:function(e){t.$set(t.formInfo,"message",e)},expression:"formInfo.message"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"message")}},model:{value:t.insertVariable.id,callback:function(e){t.$set(t.insertVariable,"id",e)},expression:"insertVariable.id"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1)]:[t.isShowTitle?e("bk-form-item",{attrs:{label:t.$t("m.slaContent['标题']"),required:!0,property:"title","icon-offset":240}},[e("bk-input",{attrs:{type:"text","ext-cls":"bk-remindway-form"},model:{value:t.formInfo.title,callback:function(e){t.$set(t.formInfo,"title",e)},expression:"formInfo.title"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"title")}},model:{value:t.insertVariable.titleId,callback:function(e){t.$set(t.insertVariable,"titleId",e)},expression:"insertVariable.titleId"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1):t._e(),t._v(" "),e("bk-form-item",{attrs:{label:t.$t("m['内容']"),required:!0,property:"message","icon-offset":240}},[e("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"editorNotice",expression:"'editorNotice'"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:t.customRow||15},model:{value:t.formInfo.message,callback:function(e){t.$set(t.formInfo,"message",e)},expression:"formInfo.message"}}),t._v(" "),e("div",{staticClass:"bk-select-btn"},[e("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:t.$t("m.slaContent['插入变量']"),icon:"plus"}},[t._v("\n            "+t._s(t.$t('m.slaContent["插入变量"]'))+"\n          ")]),t._v(" "),e("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:"","font-size":"medium"},on:{selected:function(e){return t.changeInsert(...arguments,"message")}},model:{value:t.insertVariable.id,callback:function(e){t.$set(t.insertVariable,"id",e)},expression:"insertVariable.id"}},t._l(t.variableList,(function(t){return e("bk-option",{key:t.key,attrs:{id:t.key,name:t.name}})})),1)],1)],1)]],2),t._v(" "),t.isShowFooter?e("div",{staticClass:"bk-add-btn"},[e("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["ticket_state_manage"])},expression:"{ active: !hasPermission(['ticket_state_manage']) }"}],class:{"btn-permission-disable":!t.hasPermission(["ticket_state_manage"])},attrs:{theme:"primary",title:t.$t("m.serviceConfig['确认']"),loading:t.secondClick},on:{click:t.submitNotice}},[t._v("\n      "+t._s(t.$t('m.serviceConfig["确认"]'))+"\n    ")]),t._v(" "),e("bk-button",{attrs:{theme:"default",title:t.$t("m.serviceConfig['取消']"),loading:t.secondClick},on:{click:t.closeNotice}},[t._v("\n      "+t._s(t.$t('m.serviceConfig["取消"]'))+"\n    ")])],1):t._e()],1)},i=[];n._withStripped=!0}}]);