(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{"2NyU":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=m(a("4d7F")),i=m(a("14Xm")),n=m(a("D3Ub")),o=m(a("Wgwc")),s=m(a("DzJC")),c=m(a("cVji")),d=m(a("M6jI")),u=m(a("lcZY")),l=m(a("VnjG")),f=m(a("EstQ"));function m(t){return t&&t.__esModule?t:{default:t}}var v="YYYY-MM-DD",h=[{key:"order",name:"No",colorMark:!0,width:60},{key:"creator",name:f.default.t("m['用户ID']")},{key:"organization",name:f.default.t("m['所在组织']")},{key:"count",name:f.default.t("m['提单量']"),colorMark:!0,align:"right",width:120}];e.default={name:"OperationService",components:{SummaryCard:c.default,ChartCard:d.default,TableChart:u.default,LineChart:l.default},data:function(){var t=(0,o.default)().format("YYYY-MM-DD"),e=(0,o.default)().subtract(1,"month").format("YYYY-MM-DD");return{serviceId:Number(this.$route.params.id),serviceList:[],isServicePanelShow:!1,dateRange:[e,t],isDateSelectorFixed:!1,summaryData:{total:{count:0,biz_count:0,user_count:0},week:{ticket:{this_week_count:0,last_week_count:0,ratio:"--"},biz:{this_week_count:0,last_week_count:0,ratio:"--"},user:{this_week_count:0,last_week_count:0,ratio:"--"}}},top10CreateTicketUserData:[],addedTicketData:{},bizData:{},creatorTableColumns:h,addedTicketChartDismension:"days",bizChartDismension:"days",datePickerOptions:{disabledDate:function(t){return(0,o.default)(t).isAfter((0,o.default)(),"day")}},shortcuts:[{text:this.$t("m['今天']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().format(v),t]}},{text:this.$t("m['昨天']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(1,"day").format(v),t]}},{text:this.$t("m['前天']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(2,"day").format(v),t]}},{text:this.$t("m['一周前']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(1,"week").format(v),t]}},{text:this.$t("m['一个月前']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(1,"month").format(v),t]}},{text:this.$t("m['三个月前']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(3,"month").format(v),t]}},{text:this.$t("m['半年前']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(6,"month").format(v),t]}},{text:this.$t("m['一年前']"),value:function(){var t=(0,o.default)().format(v);return[(0,o.default)().subtract(1,"year").format(v),t]}}],loading:{serviceList:!1,summary:!1,addedTicket:!1,top10CreateTicketUser:!1,biz:!1},toggle:{top10:{error:!1}}}},computed:{serviceName:function(){var t=this,e=this.serviceList.find((function(e){return e.id===t.serviceId}));return e?e.name:"--"}},created:function(){this.getServiceList(),this.getSummaryData(),this.getDetailData(),this.handleDateSelectorPosition=(0,s.default)(this.scrollHandler,300)},mounted:function(){document.querySelector(".section-content").addEventListener("scroll",this.handleDateSelectorPosition,!1)},beforeDestroy:function(){document.querySelector(".section-content").removeEventListener("scroll",this.handleDateSelectorPosition,!1)},methods:{getServiceList:function(){var t=this;return(0,n.default)(i.default.mark((function e(){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading.serviceList=!0,e.prev=1,e.next=4,t.$store.dispatch("service/getServiceList");case 4:a=e.sent,t.serviceList=a.data,e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:return e.prev=11,t.loading.serviceList=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,t,[[1,8,11,14]])})))()},getDetailData:function(){this.getTop10CreateTicketUserData(),this.getAddedTicketData(),this.getBizData()},getSummaryData:function(){var t=this;return(0,n.default)(i.default.mark((function e(){var a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading.summary=!0,e.prev=1,e.next=4,r.default.all([t.$store.dispatch("operation/getSummaryTotalData",{service_id:t.serviceId}),t.$store.dispatch("operation/getSummaryWeekData",{service_id:t.serviceId})]);case 4:a=e.sent,t.summaryData={total:a[0].data,week:a[1].data},e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.error(e.t0);case 11:return e.prev=11,t.loading.summary=!1,e.finish(11);case 14:case"end":return e.stop()}}),e,t,[[1,8,11,14]])})))()},getAddedTicketData:function(){var t=this;return(0,n.default)(i.default.mark((function e(){var a,r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading.addedTicket=!0,e.prev=1,a={create_at__gte:t.dateRange[0],create_at__lte:t.dateRange[1],timedelta:t.addedTicketChartDismension,resource_type:"ticket",service_id:t.serviceId},e.next=5,t.$store.dispatch("operation/getResourceCountData",a);case 5:r=e.sent,n={x:[],y:[]},r.data.forEach((function(t){var e=t.count,a=t.date;n.x.push(a),n.y.push(e)})),t.addedTicketData=n,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error(e.t0);case 14:return e.prev=14,t.loading.addedTicket=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,t,[[1,11,14,17]])})))()},getTop10CreateTicketUserData:function(){var t=this;return(0,n.default)(i.default.mark((function e(){var a,r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading.top10CreateTicketUser=!0,e.prev=1,a={create_at__gte:t.dateRange[0],create_at__lte:t.dateRange[1],service_id:t.serviceId},t.toggle.top10.error=!1,e.next=6,t.$store.dispatch("operation/getTop10CreateTicketUserData",a);case 6:r=e.sent,n=r.data.map((function(e){if(e.organization.length>0){var a=t.getFullOrganization(e.organization);e.organization_full=a.reverse().join("/"),e.organization=e.organization[0].name}else e.organization="--";return e})),t.top10CreateTicketUserData=n,e.next=15;break;case 11:e.prev=11,e.t0=e.catch(1),t.toggle.top10.error=!0,console.error(e.t0);case 15:return e.prev=15,t.loading.top10CreateTicketUser=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,t,[[1,11,15,18]])})))()},getBizData:function(){var t=this;return(0,n.default)(i.default.mark((function e(){var a,r,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.loading.biz=!0,e.prev=1,a={create_at__gte:t.dateRange[0],create_at__lte:t.dateRange[1],timedelta:t.bizChartDismension,resource_type:"biz",service_id:t.serviceId},e.next=5,t.$store.dispatch("operation/getServiceCountData",a);case 5:r=e.sent,n={x:[],y:[]},r.data.forEach((function(t){var e=t.count,a=t.date;n.x.push(a),n.y.push(e)})),t.bizData=n,e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),console.error(e.t0);case 14:return e.prev=14,t.loading.biz=!1,e.finish(14);case 17:case"end":return e.stop()}}),e,t,[[1,11,14,17]])})))()},getFullOrganization:function(t){var e=t[0],a=[e.name];if(e.family&&e.family.length>0){var r=this.getFullOrganization(e.family);a=a.concat(r)}return a},onServicePanelToggle:function(t){this.isServicePanelShow=t},onServiceChange:function(t){this.serviceId=t,this.getDetailData(),this.$router.push({name:"OperationService",params:{id:t}})},onSelectDate:function(t){this.dateRange=t,this.getDetailData()},scrollHandler:function(t){this.isDateSelectorFixed=t.target.scrollTop>150},onAddedTicketDimensionChange:function(t){this.addedTicketChartDismension=t,this.getAddedTicketData()},onAddedServiceDimensionChange:function(t){this.bizChartDismension=t,this.getBizData()}}}},"B7o/":function(t,e,a){"use strict";a.r(e);var r=a("2NyU"),i=a.n(r);for(var n in r)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return r[t]}))}(n);e.default=i.a},T6ZW:function(t,e,a){},VN2h:function(t,e,a){"use strict";a.d(e,"a",(function(){return r})),a.d(e,"b",(function(){return i}));var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"operation-service"},[e("div",{staticClass:"section-nav"},[e("div",{staticClass:"service-wrap"},[e("i",{staticClass:"bk-icon icon-arrows-left back-icon",on:{click:function(e){return t.$router.push({name:t.$route.query.project_id?"projectOperationHome":"OperationHome",query:t.$route.query.project_id?{project_id:t.$route.query.project_id}:""})}}}),t._v(" "),e("bk-select",{staticClass:"service-selector",attrs:{value:t.serviceId,searchable:!0,clearable:!1},on:{toggle:t.onServicePanelToggle,selected:t.onServiceChange}},[e("div",{staticClass:"selected-service",class:{"panel-open":t.isServicePanelShow},attrs:{slot:"trigger"},slot:"trigger"},[e("span",{staticClass:"service-name"},[t._v(t._s(t.serviceName))]),t._v(" "),e("i",{staticClass:"bk-icon icon-down-shape trigger-icon"})]),t._v(" "),t._l(t.serviceList,(function(t){return e("bk-option",{key:t.id,attrs:{id:t.id,name:t.name}})}))],2)],1)]),t._v(" "),e("div",{staticClass:"section-content"},[e("div",{staticClass:"date-selector",class:{"selector-fixed":t.isDateSelectorFixed}},[e("bk-date-picker",{attrs:{type:"daterange",clearable:!1,shortcuts:t.shortcuts,options:t.datePickerOptions,value:t.dateRange},on:{change:t.onSelectDate}})],1),t._v(" "),e("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.loading.summary,opacity:1},expression:"{ isLoading: loading.summary, opacity: 1 }"}],staticClass:"summary-data statistics-section"},[e("summary-card",{attrs:{title:t.$t("m.operation['单据总数']"),"card-data":{total:t.summaryData.total.count,week:t.summaryData.week.ticket}}},[e("i",{staticClass:"bk-icon icon-order-shape",attrs:{slot:"icon"},slot:"icon"})]),t._v(" "),e("summary-card",{attrs:{title:t.$t("m.operation['业务总数']"),"card-data":{total:t.summaryData.total.biz_count,week:t.summaryData.week.biz}}},[e("i",{staticClass:"bk-icon icon-folder-open-shape",attrs:{slot:"icon"},slot:"icon"})]),t._v(" "),e("summary-card",{attrs:{title:t.$t("m.operation['用户总数']"),"card-data":{total:t.summaryData.total.user_count,week:t.summaryData.week.user}}},[e("i",{staticClass:"bk-icon icon-user-shape",attrs:{slot:"icon"},slot:"icon"})])],1),t._v(" "),e("div",{staticClass:"service-statistics statistics-section"},[e("h4",[t._v(t._s(t.$t("m.operation['统计指标']")))]),t._v(" "),e("div",{staticClass:"charts-wrap"},[e("chart-card",{staticStyle:{width:"100%"},attrs:{title:t.$t("m.operation['新增单量']"),loading:t.loading.addedTicket}},[e("line-chart",{attrs:{"gradient-color":["rgba(37, 91, 175, 0)","rgba(37, 91, 175, 0.3)"],loading:t.loading.addedTicket,"y-axis-name":t.$t("m.operation['单量（条）']"),"chart-data":t.addedTicketData,dimension:t.addedTicketChartDismension},on:{onDimensionChange:t.onAddedTicketDimensionChange}})],1),t._v(" "),e("chart-card",{staticStyle:{width:"31%",height:"410px"},attrs:{title:t.$t("m.operation['Top 10 提单用户']"),loading:t.loading.top10CreateTicketUser},on:{search:t.getTop10CreateTicketUserData}},[e("table-chart",{attrs:{"list-error":t.toggle.top10.error,loading:t.loading.top10CreateTicketUser,columns:t.creatorTableColumns,"chart-data":t.top10CreateTicketUserData}})],1),t._v(" "),e("chart-card",{staticStyle:{width:"68%",height:"410px"},attrs:{title:t.$t("m.operation['业务数量']"),loading:t.loading.biz}},[e("line-chart",{attrs:{"gradient-color":["rgba(19, 143, 203, 0)","rgba(23, 142, 207, 0.3)"],loading:t.loading.biz,"y-axis-name":t.$t("m.operation['人数（人）']"),"chart-data":t.bizData,dimension:t.bizChartDismension},on:{onDimensionChange:t.onAddedServiceDimensionChange}})],1)],1)])])])},i=[];r._withStripped=!0},"i/tW":function(t,e,a){"use strict";a.r(e);var r=a("VN2h"),i=a("B7o/");for(var n in i)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(n);a("jzeg");var o=a("KHd+"),s=Object(o.a)(i.default,r.a,r.b,!1,null,"728d597d",null);e.default=s.exports},jzeg:function(t,e,a){"use strict";a("T6ZW")}}]);