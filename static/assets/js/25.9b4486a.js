(window.webpackJsonp=window.webpackJsonp||[]).push([[25,4,9],{"+CIw":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{ref:"lienHeight",staticClass:"bk-configu-line"},[t("div",{staticClass:"bk-line-graph"},[t("div",{staticClass:"bk-line-div",class:{"bk-line-small":2===e.widthStatus,"bk-line-big":1===e.widthStatus}},[t("template-node",{attrs:{node:e.customLine.nodeInfo.from_state}}),e._v(" "),t("div",{staticClass:"bk-line-style"},[e._m(0),e._v(" "),t("span",{staticClass:"bk-line-word"},[e._v(" "+e._s(e.lineInfo.name||"--")+" ")]),e._v(" "),t("span",{staticClass:"bk-line-squrea"})]),e._v(" "),t("template-node",{attrs:{node:e.customLine.nodeInfo.to_state}})],1)]),e._v(" "),t("bk-form",{ref:"lineForm",attrs:{"label-width":200,model:e.lineInfo,"form-type":"vertical",rules:e.rules}},[e.customLine.isOnly?e._e():[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['关系模板']"),desc:e.$t("m.treeinfo['（使用模版可以快速填写）']")}},[t("bk-select",{attrs:{clearable:!1,searchable:"","font-size":"medium"},on:{selected:e.changeTemplate},model:{value:e.lineInfo.template,callback:function(t){e.$set(e.lineInfo,"template",t)},expression:"lineInfo.template"}},e._l(e.templateList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"lineConfig-select-condition",label:e.$t("m.treeinfo['流转条件']"),required:!0}},[t("bk-select",{attrs:{clearable:!1,searchable:"","font-size":"medium"},on:{selected:e.changeCondition},model:{value:e.lineInfo.condition_type,callback:function(t){e.$set(e.lineInfo,"condition_type",t)},expression:"lineInfo.condition_type"}},e._l(e.globalChoise.condition_type,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1)],1)],e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"lineConfig-select-relation",label:e.$t("m.treeinfo['关系名称']"),property:"name",required:!0}},[t("bk-input",{attrs:{maxlength:"120",placeholder:e.$t("m.treeinfo['请输入关系名称']")},model:{value:e.lineInfo.name,callback:function(t){e.$set(e.lineInfo,"name","string"==typeof t?t.trim():t)},expression:"lineInfo.name"}})],1)],2),e._v(" "),"default"!==e.lineInfo.condition_type?[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}]},[t("bk-form",{ref:"conditionForm",attrs:{"label-width":200,model:e.lineInfo,"ext-cls":"bk-line-form","form-type":"vertical"}},[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['条件组间关系']"),desc:e.$t("m.treeinfo['当所有条件组都满足且/或的条件时，节点才会流转']"),"ext-cls":"mb10 mt10"}},[t("bk-radio-group",{model:{value:e.lineInfo.between,callback:function(t){e.$set(e.lineInfo,"between",t)},expression:"lineInfo.between"}},[t("bk-radio",{staticClass:"mr10",attrs:{value:"and"}},[e._v(e._s(e.$t('m.treeinfo["且"]')))]),e._v(" "),t("bk-radio",{attrs:{value:"or"}},[e._v(e._s(e.$t('m.treeinfo["或"]')))])],1)],1),e._v(" "),e._l(e.lineInfo.expressions,(function(n,i){return t("div",{key:i,staticClass:"bk-form-content"},[t("p",{staticClass:"bk-between-title"},[e._v(e._s("and"===e.lineInfo.between?e.$t("m.treeinfo['且']"):e.$t('m.treeinfo["或"]'))+e._s(e.$t('m.treeinfo["-条件组"]'))+e._s(i+1))]),e._v(" "),t("div",{staticClass:"bk-between-info"},[t("p",[t("span",{staticClass:"bk-between-span"},[e._v(e._s(e.$t('m.treeinfo["字段间关系"]')))]),e._v(" "),t("bk-radio-group",{staticStyle:{width:"auto"},model:{value:n.type,callback:function(t){e.$set(n,"type",t)},expression:"item.type"}},[t("bk-radio",{staticClass:"mr10",attrs:{value:"and"}},[e._v(e._s(e.$t('m.treeinfo["且"]')))]),e._v(" "),t("bk-radio",{attrs:{value:"or"}},[e._v(e._s(e.$t('m.treeinfo["或"]')))])],1)],1),e._v(" "),e._l(n.expressions,(function(i,a){return t("div",{key:a,staticClass:"bk-between-form",on:{click:function(e){n.checkInfo=!1}}},[t("bk-form-item",{attrs:{"data-test-id":"lineConfig-select-fieldList","ext-cls":"bk-width210 no-label"}},[t("bk-select",{attrs:{clearable:!1,searchable:"","font-size":"medium"},on:{selected:function(t){return e.changeName(...arguments,i)}},model:{value:i.key,callback:function(t){e.$set(i,"key",t)},expression:"node.key"}},e._l(e.fieldList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),i.betweenList?[t("bk-form-item",{attrs:{"data-test-id":"lineConfig-select-betweenList","ext-cls":"bk-width100 no-label"}},[t("bk-select",{attrs:{clearable:!1,searchable:"","font-size":"medium"},model:{value:i.condition,callback:function(t){e.$set(i,"condition",t)},expression:"node.condition"}},e._l(i.betweenList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1)],1)]:e._e(),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"lineConfig-select-choiceList",label:"","ext-cls":"bk-width195 no-label"}},["global"!==i.source?[e.globalTypeList.some(e=>i.type===e)?[i.choiceList.length?t("bk-select",{attrs:{multiple:i.multiSelect,searchable:"","font-size":"medium"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}},e._l(i.choiceList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1):t("bk-input",{attrs:{clearable:!0,type:"INT"===i.type?"number":"text",placeholder:e.$t("m.treeinfo['请输入条件值']")},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}})]:"DATE"===i.type||"DATETIME"===i.type?[t("bk-date-picker",{attrs:{placeholder:"选择日期时间",type:"DATETIME"===i.type?"datetime":"date"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}})]:[t("bk-input",{attrs:{clearable:!0,type:"INT"===i.type?"number":"text",placeholder:e.$t("m.treeinfo['请输入条件值']")},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}}),e._v(" "),i.meta&&i.meta.unit?t("span",{staticClass:"buttonIcon"},[e._v("%")]):e._e()]]:e._e(),e._v(" "),"global"===i.source?["BOOLEAN"===i.type?[t("bk-select",{attrs:{searchable:"","font-size":"medium"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}},e._l(e.booleanList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]:[t("bk-input",{attrs:{clearable:!0,type:"INT"===i.type?"number":"text",placeholder:e.$t("m.treeinfo['请输入比较值']")},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}})]]:e._e()],2),e._v(" "),t("div",{staticClass:"bk-between-operat"},[t("span",{staticClass:"bk-itsm-icon icon-flow-add",attrs:{"data-test-id":"lineConfig-span-addNode"},on:{click:function(t){return e.addNode(n,a)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===n.expressions.length},attrs:{"data-test-id":"lineConfig-i-deleteNode"},on:{click:function(t){return e.deleteNode(n,a)}}})])],2)})),e._v(" "),1!==e.lineInfo.expressions.length?t("i",{staticClass:"bk-icon icon-close",on:{click:function(t){return e.delteCondition(n,i)}}}):e._e()],2),e._v(" "),n.checkInfo?t("p",{staticClass:"bk-error-msg"},[e._v(e._s(e.$t('m.treeinfo["关系组内的数据不能为空"]')))]):e._e()])}))],2)],1),e._v(" "),t("p",{staticClass:"bk-add-between"},[t("span",{attrs:{"data-test-id":"lineConfig-span-addCondition"},on:{click:e.addCondition}},[t("i",{staticClass:"bk-icon icon-plus-circle"}),e._v(e._s(e.$t('m.treeinfo["添加条件组"]'))+"\n      ")])])]:e._e(),e._v(" "),e.openFunction.TRIGGER_SWITCH?t("div",{class:{"bk-line-padding":e.scrollTopStatus}},[t("common-trigger-list",{attrs:{origin:"transition","source-id":e.customLine.lineValue.workflow,sender:e.customLine.lineValue.id,table:e.flowInfo.table}})],1):e._e(),e._v(" "),t("div",{staticClass:"mt20",class:{"bk-line-btn":e.scrollTopStatus}},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"lineConfig-button-submit",title:e.$t("m.treeinfo['确认']"),loading:e.secondClick},on:{click:e.submitLine}},[e._v("\n      "+e._s(e.$t('m.treeinfo["确认"]'))+"\n    ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:e.$t("m.treeinfo['取消']"),disabled:e.secondClick},on:{click:e.closeLine}},[e._v("\n      "+e._s(e.$t('m.treeinfo["取消"]'))+"\n    ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:e.$t("m.treeinfo['删除']"),disabled:e.secondClick},on:{click:e.deleteLine}},[e._v("\n      "+e._s(e.$t('m.treeinfo["删除"]'))+"\n    ")]),e._v(" "),"by_field"===e.lineInfo.condition_type?t("bk-button",{staticStyle:{float:"right"},attrs:{theme:"default",title:e.lineInfo.template?e.$t("m.treeinfo['更新模板']"):e.$t("m.treeinfo['存为模版']"),disabled:e.secondClick},on:{click:e.submitTemplate}},[e._v("\n      "+e._s(e.lineInfo.template?e.$t("m.treeinfo['更新模板']"):e.$t("m.treeinfo['存为模版']"))+"\n    ")]):e._e()],1)],2)},a=[function(){var e=this._self._c;return e("span",{staticClass:"bk-line-line"},[e("span",{staticClass:"bk-line-info"})])}];i._withStripped=!0},"+DAV":function(e,t,n){"use strict";n.r(t);var i=n("Zi5M"),a=n("FauL");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("qk9t");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"32b81152",null);t.default=s.exports},"+KRo":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-get-param"},[t("bk-table",{attrs:{data:e.paramTableData,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['名称']"),prop:"name"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['必选']")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.is_necessary?e.$t('m.treeinfo["是"]'):e.$t('m.treeinfo["否"]'))+"\n      ")]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['备注']"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",{attrs:{title:n.row.desc}},[e._v(e._s(n.row.desc||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(n){return[e.isStatic?[e._v("\n          "+e._s(n.row.customValue||"--")+"\n        ")]:e.isCustom?[t("bk-input",{attrs:{clearable:!0,placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.customValue,callback:function(t){e.$set(n.row,"customValue",t)},expression:"props.row.customValue"}})]:[t("div",{staticStyle:{width:"120px",position:"absolute",top:"5px",left:"15px"}},[t("bk-select",{attrs:{clearable:!1,searchable:"","font-size":"medium"},model:{value:n.row.source_type,callback:function(t){e.$set(n.row,"source_type",t)},expression:"props.row.source_type"}},e._l(e.sourceTypeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),"CUSTOM"===n.row.source_type?t("div",{staticStyle:{width:"140px",position:"absolute",top:"4px",right:"15px"}},[t("bk-input",{class:{"bk-border-error":n.row.isCheck&&!n.row.value.toString()},attrs:{clearable:!0,placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}})],1):t("div",{staticStyle:{width:"140px",position:"absolute",top:"4px",right:"15px"}},[t("bk-select",{class:{"bk-border-error":n.row.isCheck&&!n.row.value.toString()},attrs:{clearable:!1,searchable:"","font-size":"medium"},model:{value:n.row.value_key,callback:function(t){e.$set(n.row,"value_key",t)},expression:"props.row.value_key"}},[e._l(e.stateList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),e._v(" "),"addField"!==e.entry?[t("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(t){return e.addNewItem(n.row)}},slot:"extension"},[t("i",{staticClass:"bk-icon icon-plus-circle mr10"}),e._v(e._s(e.$t('m.treeinfo["添加变量"]'))+"\n                ")])]:e._e()],2)],1)]]}}])})],1)],1)},a=[];i._withStripped=!0},"+LW1":function(e,t,n){},"+QRE":function(e,t,n){"use strict";n.r(t);var i=n("gEzK"),a=n("h1eg");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("LaJ4");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"18c81a71",null);t.default=s.exports},"+fOZ":function(e,t,n){"use strict";n.r(t);var i=n("N3dC"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"+iia":function(e,t,n){"use strict";n("zGLV")},"/5i8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("ukIK")),a=s(n("xl+m")),r=s(n("T3vI")),o=s(n("/ojM"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"responseContent",components:{changeConductor:i.default,sendMessage:a.default,apiCall:r.default,modifyField:o.default},props:{item:{type:Object,default:function(){return{}}},signal:String},data:function(){return{}},computed:{onlyBackendSignals:function(){return this.$store.state.common.configurInfo.only_backend_signals||[]},isShowFrontendTrigger:function(){return!this.onlyBackendSignals.includes(this.signal)},disableRepeat:function(){return"GLOBAL_LEAVE_STATE"===this.signal||"GLOBAL_ENTER_STATE"===this.signal}},watch:{isShowFrontendTrigger:{handler:function(e){e||(this.item.performData.runMode="BACKEND")},immediate:!0},signal:{handler:function(e){"GLOBAL_LEAVE_STATE"!==e&&"GLOBAL_ENTER_STATE"!==e||(this.item.performData.repeat="more")},immediate:!0}},created:function(){this.initData()},methods:{initData:function(){var e=this;this.$set(this.item,"contentStatus",!1),"api"===this.item.wayInfo.key?this.item.wayInfo.field_schema.forEach((function(t){"api_source"===t.key?(e.$set(t,"systemId",""),e.$set(t,"apiId","")):e.$set(t,"apiContent",{})})):this.item.wayInfo.field_schema.forEach((function(t){var n=t.value||"";if("MEMBERS"===t.type||"MULTI_MEMBERS"===t.type)if(n=[],t.value)t.value.forEach((function(e){if(e.value){var t={key:e.value.member_type,value:e.value.members,secondLevelList:[],isLoading:!1};n.push(t)}}));else{n.push({key:"",value:"",secondLevelList:[],isLoading:!1})}e.$set(t,"value",n),"SUBCOMPONENT"===t.type&&t.sub_components&&t.sub_components.length&&t.sub_components.forEach((function(t){t.field_schema.length&&t.field_schema.forEach((function(t){var n=t.value||"";"MEMBERS"!==t.type&&"MULTI_MEMBERS"!==t.type||(n=[],Array.isArray(t.value)?t.value.forEach((function(e){if(e.value){var t={key:e.value.member_type,value:e.value.members,secondLevelList:[],isLoading:!1};n.push(t)}})):n=[{key:"",value:"",secondLevelList:[],isLoading:!1}]),e.$set(t,"value",n)}))}))}))}}}},"/6kH":function(e,t,n){"use strict";n("pRDg")},"/7De":function(e,t,n){},"/7qM":function(e,t,n){},"/9eO":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("CeR/"),r=n("2Mt+"),o=(i=r)&&i.__esModule?i:{default:i};t.default={name:"apiCall",components:{inputParams:o.default},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{apiSysList:[],apiList:[],apiId:"",isLoading:!1}},mounted:function(){this.getRemoteSystemData(),this.initData()},methods:{initData:function(){var e=this;this.item.wayInfo.field_schema.forEach((function(t){"api_source"===t.key&&t.value&&e.getApiContent(t.value)}))},getRemoteSystemData:function(){var e=this,t={project_key:this.$route.query.project_id};this.$store.dispatch("apiRemote/get_all_remote_system",t).then((function(t){e.apiSysList=t.data.filter((function(e){return e.is_activated}))})).catch((function(t){(0,a.errorHandler)(t,e)})).finally((function(){}))},changeCode:function(){this.getApiTableList(arguments[2].systemId),arguments[2].apiId="",this.apiId=""},getApiTableList:function(e){var t=this;console.log(e);var n={remote_system:e||""};this.$store.dispatch("apiRemote/get_remote_api",n).then((function(e){t.apiList=e.data.filter((function(e){return e.is_activated}))})).catch((function(e){(0,a.errorHandler)(e,t)})).finally((function(){}))},changeApi:function(e){var t=arguments,n=this;this.isLoading=!0;var i=this.apiList.filter((function(e){return e.id===t[0]}))[0];this.item.wayInfo.field_schema.forEach((function(e){e.apiContent=i,n.$set(e.apiContent,"bodyTableData",[])})),this.apiId=e,setTimeout((function(){n.isLoading=!1}),1e3)},getApiContent:function(e){var t=this;this.isLoading=!0;var n={id:e};this.$store.dispatch("apiRemote/get_remote_api_detail",n).then((function(n){var i=n.data;t.item.wayInfo.field_schema.forEach((function(n){"api_source"===n.key&&n.value?(n.apiId=e,n.systemId=i.remote_system):(n.apiContent=i,t.$set(n.apiContent,"bodyTableData",[]))})),t.getApiTableList(i.remote_system),t.apiId=e,setTimeout((function(){t.isLoading=!1}),1e3)})).catch((function(e){(0,a.errorHandler)(e,t)})).finally((function(){}))}}}},"/BG8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("Jwqd"),r=n("WSG0"),o=(i=r)&&i.__esModule?i:{default:i};var s={styles:{type:Object,default:function(){return{}}},value:{type:[String,Array],default:""}};t.default={name:"TagText",mixins:[(0,a.getFormMixins)(s)],data:function(){return{}},computed:{hasChildren:function(){return this.form.children&&Array.isArray(this.form.children)&&!!this.form.children.length}},methods:{onClick:function(){if(this.hasChildren){var e="";e=Array.isArray(this.value)?this.value.map((function(e){return(e.label||"")+e.value})).join(","):(this.label||"")+this.value;var t=this.getContext();if(t.config&&"combine"===t.config.mode)this.getTopViewItem().appendCrumbsItem(e,this.form.children);else(0,o.default)({title:e,formData:this.form.children,context:t})}}}}},"/Hw/":function(e,t,n){"use strict";n.r(t);var i=n("Ncax"),a=n("HOWN");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("5f0d");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"8cd94c38",null);t.default=s.exports},"/JtJ":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"basic-card-wrap"},[e.showFoldTitle?t("div",{staticClass:"more-configuration mb20",on:{click:function(t){e.showMore=!e.showMore}}},[e.showMore?t("i",{staticClass:"bk-icon icon-up-shape"}):t("i",{staticClass:"bk-icon icon-down-shape"}),e._v(" "),t("span",[e._v(e._s(e.foldTitle))])]):e._e(),e._v(" "),t("collapse-transition",[e.showMore?t("div",{staticClass:"common-section-card-block"},[t("label",{staticClass:"common-section-card-label"},[e._v("\n        "+e._s(e.cardLabel)+"\n        "),e.cardDesc?t("p",{staticClass:"common-section-card-desc"},[e._v(e._s(e.cardDesc))]):e._e()]),e._v(" "),t("div",{staticClass:"common-section-card-body"},[e._t("default")],2)]):e._e()])],1)},a=[];i._withStripped=!0},"/KdC":function(e,t,n){"use strict";n.r(t);var i=n("in5P"),a=n("13wB");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},"/Xc1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("QbLZ"),r=(i=a)&&i.__esModule?i:{default:i},o=n("CeR/");t.default={name:"ChooseServiceTemplateDialog",components:{},props:{isShow:Boolean,createInfo:Object,serviceId:[String,Number]},data:function(){return{loading:!1,searchModel:!1,searchResultList:[],recomTemplateList:[],createdTemplateList:[]}},computed:{createWay:function(){return this.createInfo.key},templateList:function(){return this.searchModel?this.searchResultList:"recom"===this.createWay?this.recomTemplateList:this.createdTemplateList}},watch:{isShow:function(e){if(!e)return!1;"recom"===this.createWay?this.getRecomService():this.getAllService()}},methods:{getAllService:function(){var e=this;this.loading=!0,this.$store.dispatch("service/getServiceList",{no_page:!0}).then((function(t){t.result&&(e.createdTemplateList=t.data)})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.loading=!1}))},getRecomService:function(){var e=this;this.loading=!0,this.$store.dispatch("basicModule/get_tables",{no_page:!0}).then((function(t){e.recomTemplateList=t.data}),(function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.loading=!1}))},searchHandler:function(e){this.searchModel=""!==e;var t=new RegExp("("+e+")","ig");this.searchResultList=this.createdTemplateList.filter((function(e){return t.test(e.name)})).map((function(e){return(0,r.default)({},e,{name:e.name.replace(t,'<span style="color: #3a84ff;">$1</span>')})}))},onTemplateClick:function(e){var t=void 0,n=void 0;"recom"===this.createWay?(t={id:this.serviceId,table_id:e.id},n="importFromTemplate"):(t={id:this.serviceId,service_id:e.id},n="importFromService"),this.updateCurrServiceForm(t,n)},updateCurrServiceForm:function(e,t){var n=this;this.loading=!0,this.$store.dispatch("service/"+t,e).then((function(){n.$bkMessage({message:n.$t('m.systemConfig["更新成功"]'),theme:"success"}),n.$emit("update:isShow",!1),n.$emit("updateServiceSource","importFromTemplate"===t?"template":"service")})).catch((function(e){(0,o.errorHandler)(e,n)})).finally((function(){n.loading=!1}))},onDialogClose:function(e){this.$emit("update:isShow",e)}}}},"/inP":function(e,t,n){"use strict";n.r(t);var i=n("Bzqh"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"/m8X":function(e,t,n){"use strict";n("BST3")},"/nBP":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticStyle:{width:"100%"}},[t("full-screen",{attrs:{"is-full":e.isFull,title:e.fullTitle},on:{onClose:e.closeFullSreen}},[e.isPreview?t("viewer",{attrs:{"initial-value":e.value,height:e.height+"px"}}):t("editor",{ref:"toastuiEditor",attrs:{height:e.height+"px","initial-edit-type":"wysiwyg","preview-style":"vertical","initial-value":e.value,options:e.editorOptions},on:{load:e.onEditorLoad,blur:e.onEditorBlur}}),e._v(" "),e.isFull?e._e():t("i",{staticClass:"bk-itsm-icon icon-order-open",on:{click:function(t){return t.stopPropagation(),e.openFullScreen.apply(null,arguments)}}})],1)],1)},a=[];i._withStripped=!0},"/ojM":function(e,t,n){"use strict";n.r(t);var i=n("jUNn"),a=n("aDD8");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("20vx");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"b4f443ec",null);t.default=s.exports},"/xVU":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("m1cH")),a=s(n("GQeE")),r=n("1R/T"),o=s(n("9ume"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={key:"requestConfig",components:{paramsTable:o.default},props:{type:{type:String,default:function(){return"GET"}},configur:{type:Object,default:function(){return{}}},isStatus:{type:Boolean,default:function(){return!0}},disable:{type:Boolean,default:function(){return!1}},stateList:Array},data:function(){return{left:20,top:72,acticeTab:"queryParams",panels:[{key:"queryParams",label:this.$t("m['参数']"),count:0},{key:"auth",label:this.$t("m['认证']"),count:0},{key:"headers",label:this.$t("m['头信息']"),count:0},{key:"body",label:this.$t("m['主体']"),count:0},{key:"settings",label:this.$t("m['设置']"),count:0}],list:[{check:!1,key:"",value:"",desc:"",select:!1}],rawList:["JSON","HTML","XML","Text"],rawVarList:[],filterParams:"",config:{auth_config:{Token:"",username:"",password:""},authRadio:"none",queryParams:[{check:!1,key:"",value:"",desc:"",select:!1}],headers:[{check:!1,key:"",value:"",desc:"",select:!1}],bodyWwwForm:[{check:!1,key:"",value:"",desc:"",select:!1}],bodyFormData:[{check:!1,key:"",value:"",desc:"",select:!1}],bodyRadio:"none",bodyValue:"",rawType:"Text",settings:{timeout:10}}}},computed:{count:function(){return{queryParams:this.config.queryParams.filter((function(e){return e.select})).length}},radioDisabled:function(){return"GET"===this.type}},watch:{type:function(e){"GET"===e&&(this.config.bodyRadio="none")},"config.bodyValue":function(e){if(this.$refs.textarea){var t=this.$refs.textarea,n=(0,r.position)(t);if(this.left=n.left+10,this.top=n.top+40+24+2-t.scrollTop,!e)return void(this.rawVarList=[]);var i=e.lastIndexOf("{{");if(-1!==i){var a=e.substring(i+2,e.length)||"";this.filterParams=a,this.rawVarList=this.stateList.filter((function(e){return-1!==e.name.indexOf(a)||-1!==e.key.indexOf(a)})),0!==this.rawVarList.length&&this.$refs.textarea.focus()}}}},created:function(){},mounted:function(){if(this.isStatus){if(0!==(0,a.default)(this.configur.extras).length){var e=this.configur.extras.webhook_info,t=e.auth,n=e.settings,r=e.query_params,o=e.body,s=e.headers;this.config.queryParams=[].concat((0,i.default)(r),(0,i.default)(this.config.queryParams)),this.config.headers=[].concat((0,i.default)(s),(0,i.default)(this.config.headers)),this.config.settings.timeout=n.timeout,this.config.authRadio=t.auth_type||"none","bearer_token"===t.auth_type?this.config.auth_config.Token=t.auth_config.token:"basic_auth"===t.auth_type&&(this.config.auth_config.username=t.auth_config.username,this.config.auth_config.password=t.auth_config.password),this.config.bodyRadio=o.type||"none","form-data"===o.type?this.config.bodyFormData=[].concat((0,i.default)(o.content),(0,i.default)(this.config.bodyFormData)):"x-www-form-urlencoded"===o.type?this.config.bodyWwwForm=[].concat((0,i.default)(o.content),(0,i.default)(this.config.bodyWwwForm)):"raw"===o.type&&(this.config.rawType=o.raw_type,this.config.bodyValue=o.content)}}else if(0!==(0,a.default)(this.configur.api_info).length){var c=this.configur.api_info.webhook_info,l=c.body,u=c.settings,d=c.auth,f=c.query_params;this.config.settings.timeout=u.timeout;var p=[];for(var m in f)p.push({key:m,value:f[m],select:!0});if(this.config.queryParams=[].concat(p,(0,i.default)(this.config.queryParams)),this.config.bodyRadio=l.type||"none","x-www-form-urlencoded"===l.type){var h=[];l.content.split("&").map((function(e){var t=e.split("=");h.push({key:t[0],value:t[1],select:!0})})),this.config.bodyWwwForm=[].concat(h,(0,i.default)(this.config.bodyWwwForm))}else"form-data"===l.type||"raw"===l.type&&(this.config.rawType=l.raw_type,this.config.bodyValue=l.content);"auth_type"in d?(this.config.authRadio=d.auth_type,"bearer_token"===d.auth_type?this.config.auth_config.Token=d.auth_config.token:"basic_auth"===d.auth_type&&(this.config.auth_config.username=d.auth_config.username,this.config.auth_config.password=d.auth_config.password)):this.config.authRadio="none"}},methods:{handleSelectContent:function(e){this.config.bodyValue=this.config.bodyValue.slice(0,-(this.filterParams.length+2))+"{{ "+e.key+"}}",this.$refs.textarea.focus()},changeTab:function(e){this.acticeTab=e.key},handleDelete:function(e){var t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1)},changeFormStatus:function(e){this.$emit("changeFormStatus",e)},changeInput:function(e){e.check?[e.key,e.value,e.desc].every((function(e){return""===e}))&&(this.list.pop(),e.check=!1,e.select=!1):(e.check=!0,e.select=!0,this.list.push({check:!1,key:"",value:"",desc:"",select:!1}))}}}},"070I":function(e,t,n){"use strict";n.r(t);var i=n("nCLG"),a=n("hAcJ");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("e07s");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"532d79ca",null);t.default=s.exports},"0Aq+":function(e,t,n){"use strict";n.r(t);var i=n("aQoq"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"0Oxo":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-select",{class:{"bk-border-error":e.item.checkValue},attrs:{disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,searchable:"",multiple:"","font-size":"medium",placeholder:e.item.desc},on:{selected:e.selected,toggle:function(t){e.item.checkValue=!1}},model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}},e._l(e.options,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},"0T5/":function(e,t,n){},"0aIx":function(e,t,n){},"0kDG":function(e,t,n){},"0nTK":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n("P2sY")),a=f(n("gDS+")),r=f(n("jWXv")),o=f(n("FyfS")),s=f(n("JO7F")),c=f(n("nLf9")),l=f(n("GQeE")),u=f(n("SEkw")),d=n("4ZMo");function f(e){return e&&e.__esModule?e:{default:e}}function p(e,t,n){return t in e?(0,u.default)(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=(0,l.default)(n);"function"==typeof c.default&&(i=i.concat((0,c.default)(n).filter((function(e){return(0,s.default)(n,e).enumerable})))),i.forEach((function(t){p(e,t,n[t])}))}return e}var h=function(e,t,n,i,a,r,o,s,c,l){"boolean"!=typeof o&&(c=s,s=o,o=!1);var u,d="function"==typeof n?n.options:n;if(e&&e.render&&(d.render=e.render,d.staticRenderFns=e.staticRenderFns,d._compiled=!0,a&&(d.functional=!0)),i&&(d._scopeId=i),r?(u=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),t&&t.call(this,c(e)),e&&e._registeredComponents&&e._registeredComponents.add(r)},d._ssrRegister=u):t&&(u=o?function(){t.call(this,l(this.$root.$options.shadowRoot))}:function(e){t.call(this,s(e))}),u)if(d.functional){var f=d.render;d.render=function(e,t){return u.call(t),f(e,t)}}else{var p=d.beforeCreate;d.beforeCreate=p?[].concat(p,u):[u]}return n},v="undefined"!=typeof navigator&&/msie [6-9]\\b/.test(navigator.userAgent.toLowerCase()),g=document.head||document.getElementsByTagName("head")[0],y={},b=function(e){return function(e,t){return function(e,t){var n=v?t.media||"default":e,i=y[n]||(y[n]={ids:new r.default,styles:[]});if(!i.ids.has(e)){i.ids.add(e);var o=t.source;if(t.map&&(o+="\n/*# sourceURL="+t.map.sources[0]+" */",o+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent((0,a.default)(t.map))))+" */"),i.element||(i.element=document.createElement("style"),i.element.type="text/css",t.media&&i.element.setAttribute("media",t.media),g.appendChild(i.element)),"styleSheet"in i.element)i.styles.push(o),i.element.styleSheet.cssText=i.styles.filter(Boolean).join("\n");else{var s=i.ids.size-1,c=document.createTextNode(o),l=i.element.childNodes;l[s]&&i.element.removeChild(l[s]),l.length?i.element.insertBefore(c,l[s]):i.element.appendChild(c)}}}(e,t)}},_=h({render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"palette-panel"},[this._t("palette",[this._m(0)])],2)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("ul",{staticClass:"palette-group"},[t("li",[t("div",{staticClass:"palette-default-item type-a",attrs:{"data-type":"type-a"}},[this._v("A")])]),t("li",[t("div",{staticClass:"palette-default-item type-b",attrs:{"data-type":"type-b"}},[this._v("B")])]),t("li",[t("div",{staticClass:"palette-default-item type-c",attrs:{"data-type":"type-c"}},[this._v("C")])]),t("li",[t("div",{staticClass:"palette-default-item type-d",attrs:{"data-type":"type-d"}},[this._v("D")])])])}]},(function(e){e&&e("data-v-6c6ee110_0",{source:".palette-group{margin:0;padding:0;background:#fcfcfc;text-align:center;list-style:none}.palette-group>li{padding:14px 0}.palette-default-item{display:inline-block;width:40px;height:40px;line-height:40px;font-size:12px;color:#888;border:1px solid #999;border-radius:2px;cursor:pointer;user-select:none}.palette-default-item:hover{box-shadow:0 0 8px rgba(50,50,50,.3)}.type-a{border-radius:50%}.type-b{border-radius:50%;border:4px solid #333}.type-c,.type-d{height:30px;line-height:30px;border:1px solid #999}.type-d{position:relative}.type-d:after{content:'';position:absolute;top:0;right:0;width:5px;height:5px;border-radius:50%;background:#ccc}",map:void 0,media:void 0})}),{name:"PalettePanel",props:["selector"],data:function(){return{}},mounted:function(){this.$emit("registerPaletteEvent")}},void 0,!1,void 0,b,void 0),k=h({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"tool-panel"},e._l(e.tools,(function(t,i){return n("div",{key:i,class:["tool-item",t.cls,{actived:"frameSelect"===t.type&&e.isFrameSelecting}],attrs:{title:t.title},on:{click:function(n){return e.onToolClick(t)}}},[e._v("\n        "+e._s(t.name)+"\n    ")])})),0)},staticRenderFns:[]},(function(e){e&&e("data-v-20cba315_0",{source:".tool-item{display:inline-block;margin-right:10px;user-select:none;cursor:pointer}.tool-item:last-child{margin-right:0}.tool-item.actived{color:#3a84ff}",map:void 0,media:void 0})}),{name:"ToolPanel",props:["tools","isFrameSelecting"],data:function(){return{}},methods:{onToolClick:function(e){this.$emit("onToolClick",e)}}},void 0,!1,void 0,b,void 0),w=h({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"bk-flow-location",on:{mousedown:function(t){e.moveFlag=!1},mousemove:function(t){e.moveFlag=!0},mouseup:function(t){return e.onNodeClick(e.node,t)}}},["type-a"===e.node.type?n("div",{staticClass:"type-a"},[e._v("start")]):"type-b"===e.node.type?n("div",{staticClass:"type-b"},[e._v("end")]):"type-c"===e.node.type?n("div",{staticClass:"type-c"},[e._v("taskNode")]):"type-d"===e.node.type?n("div",{staticClass:"type-d"},[e._v("subFlow")]):n("div",{staticClass:"node-default"})])},staticRenderFns:[]},(function(e){e&&e("data-v-2d0e3090_0",{source:".bk-flow-location .type-c,.bk-flow-location .type-d{width:120px;height:60px;line-height:60px;border:1px solid #ccc;text-align:center;cursor:pointer}.bk-flow-location .type-c:hover,.bk-flow-location .type-d:hover{border-color:#348aff}.bk-flow-location .type-d{position:relative}.bk-flow-location .type-d:after{content:'';position:absolute;top:0;right:0;width:10px;height:10px;border-radius:50%;background:#ccc}.bk-flow-location .type-a,.bk-flow-location .type-b{width:60px;height:60px;line-height:60px;border-radius:50%;border:1px solid #ccc;text-align:center}.bk-flow-location .type-b{border:4px solid #333}.bk-flow-location .node-default{width:120px;height:80px;line-height:80px;border:1px solid #ccc;border-radius:2px;text-align:center}.bk-flow-location .node-default.selected{border:1px solid #3a84ff}",map:void 0,media:void 0})}),{name:"NodeTemplate",props:{node:{type:Object,default:function(){return{}}}},data:function(){return{moveFlag:!1}},methods:{onNodeClick:function(e,t){this.moveFlag||console.log(e.x,e.y)}}},void 0,!1,void 0,b,void 0);function I(e){return"touches"in e?e.touches[0]:e}function $(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="",n=0;n<7;n++)t+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e+t}var S={showPalette:{type:Boolean,default:!0},showTool:{type:Boolean,default:!0},tools:{type:Array,default:function(){return[{type:"zoomIn",name:"放大",cls:"tool-item"},{type:"zoomOut",name:"缩小",cls:"tool-item"},{type:"resetPosition",name:"重置",cls:"tool-item"},{type:"frameSelect",name:"框选",cls:"tool-item"}]}},editable:{type:Boolean,default:!0},selector:{type:String,default:"palette-default-item"},quickConnect:{type:Boolean,default:!0},data:{type:Object,default:function(){return{nodes:[],lines:[]}}},nodeOptions:{type:Object,default:function(){return{grid:[5,5]}}},connectorOptions:{type:Object,default:function(){return{paintStyle:{fill:"transparent",stroke:"#a9adb6",strokeWidth:2},hoverPaintStyle:{fill:"transparent",stroke:"#3a84ff"}}}},endpointOptions:{type:Object,default:function(){return{endpoint:"Dot",connector:["Flowchart",{stub:[1,6],alwaysRespectStub:!0,gap:8,cornerRadius:2}],connectorOverlays:[["PlainArrow",{width:8,length:6,location:1,id:"arrow"}]],anchor:["Left","Right","Top","Bottom"],isSource:!0,isTarget:!0}}}},C={mousedown:"ontouchstart"in document.documentElement?"touchstart":"mousedown",mousemove:"ontouchmove"in document.documentElement?"touchmove":"mousemove",mouseup:"ontouchend"in document.documentElement?"touchend":"mouseup"},x=h({render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"jsflow"},[n("div",{staticClass:"canvas-area"},[e.showTool?n("div",{staticClass:"tool-panel-wrap"},[e._t("toolPanel",[n("tool-panel",{attrs:{tools:e.tools,"is-frame-selecting":e.isFrameSelecting},on:{onToolClick:e.onToolClick}})])],2):e._e(),e.showPalette?n("div",{ref:"palettePanel",staticClass:"palette-panel-wrap"},[e._t("palettePanel",[n("palette-panel",{attrs:{selector:e.selector}})])],2):e._e(),n("div",{ref:"canvasFlowWrap",staticClass:"canvas-flow-wrap",style:e.canvasWrapStyle,on:e._d({},[e.mousedown,e.onCanvasMouseDown,e.mouseup,e.onCanvasMouseUp])},[n("div",{ref:"canvasFlow",staticClass:"canvas-flow",style:e.canvasStyle,attrs:{id:"canvas-flow"}},e._l(e.nodes,(function(t){return n("div",{key:t.id,staticClass:"jsflow-node canvas-node",attrs:{id:t.id},on:{mouseover:function(n){return e.toggleHighLight(t,!0)},mouseout:function(n){return e.toggleHighLight(t,!1)}}},[e._t("nodeTemplate",[n("node-template",{attrs:{node:t}})],{node:t})],2)})),0),e.isFrameSelecting?n("div",{staticClass:"canvas-frame-selector",style:e.frameSelectorStyle}):e._e()]),e.showAddingNode?n("div",{staticClass:"jsflow-node adding-node",style:e.setNodeInitialPos(e.addingNodeConfig)},[e._t("nodeTemplate",[n("node-template",{attrs:{node:e.addingNodeConfig}})],{node:e.addingNodeConfig})],2):e._e()])])},staticRenderFns:[]},(function(e){e&&e("data-v-e853be96_0",{source:".jsflow{height:100%;border:1px solid #ccc}.jsflow .canvas-area{position:relative;height:100%}.jsflow .tool-panel-wrap{position:absolute;top:20px;left:70px;padding:10px 20px;background:#c4c6cc;opacity:.65;border-radius:4px;z-index:4}.jsflow .palette-panel-wrap{float:left;width:60px;height:100%;border-right:1px solid #ccc}.jsflow .canvas-flow-wrap{position:relative;height:100%;overflow:hidden}.jsflow .canvas-flow{position:relative;min-width:100%;min-height:100%}.jsflow .canvas-frame-selector{position:absolute;border:1px solid #3a84ff;background:rgba(58,132,255,.15)}.jsflow .jsflow-node{position:absolute;z-index:1}.jsflow .jtk-endpoint{z-index:1}.jsflow .adding-node{opacity:.8}.jsflow .jtk-endpoint.jtk-dragging{z-index:0}",map:void 0,media:void 0})}),{name:"JsFlow",components:{PalettePanel:_,ToolPanel:k,NodeTemplate:w},model:{prop:"data",event:"change"},props:S,data:function(){var e=this.data;return m({nodes:e.nodes,lines:e.lines,canvasGrabbing:!1,isFrameSelecting:!1,mouseDownPos:{},canvasPos:{x:0,y:0},canvasOffset:{x:0,y:0},frameSelectorPos:{x:0,y:0},frameSelectorRect:{width:0,height:0},selectedNodes:[],showAddingNode:!1,addingNodeConfig:{},addingNodeRect:{},canvasRect:{},paletteRect:{},zoom:1},C)},computed:{canvasWrapStyle:function(){return{cursor:this.isFrameSelecting?"crosshair":this.canvasGrabbing?"-webkit-grabbing":"-webkit-grab"}},canvasStyle:function(){return{left:"".concat(this.canvasOffset.x,"px"),top:"".concat(this.canvasOffset.y,"px")}},frameSelectorStyle:function(){return{left:"".concat(this.frameSelectorPos.x,"px"),top:"".concat(this.frameSelectorPos.y,"px"),width:"".concat(this.frameSelectorRect.width,"px"),height:"".concat(this.frameSelectorRect.height,"px")}}},watch:{data:{handler:function(e){var t=e.nodes,n=e.lines;this.nodes=t,this.lines=n},deep:!0},editable:function(e){var t=this.$el.querySelectorAll(".canvas-node");this.toggleNodeDraggable(t,e)}},mounted:function(){this.initCanvas(),this.registerEvent(),this.renderData(),this.canvasRect=this.$refs.canvasFlow.getBoundingClientRect(),this.$refs.palettePanel&&(this.paletteRect=this.$refs.palettePanel.getBoundingClientRect(),this.registerPaletteEvent())},beforeDestroy:function(){this.$refs.palettePanel&&this.$refs.palettePanel.removeEventListener(this.mousedown,this.nodeCreateHandler),this.$el.removeEventListener(this.mousemove,this.nodeMovingHandler),document.removeEventListener(this.mouseup,this.nodeMoveEndHandler)},methods:{initCanvas:function(){var e={},t=m({},this.endpointOptions,this.connectorOptions);for(var n in t){var i=n[0].toUpperCase();e["".concat(i).concat(n.slice(1))]=t[n]}this.instance=d.jsPlumb.getInstance(m({container:"canvas-flow"},e))},registerEvent:function(){var e=this;this.instance.bind("beforeDrag",(function(t){return!!e.editable&&("function"!=typeof e.$listeners.onBeforeDrag||e.$listeners.onBeforeDrag(t))})),this.instance.bind("beforeDrop",(function(t){return!!e.editable&&("function"!=typeof e.$listeners.onBeforeDrop||e.$listeners.onBeforeDrop(t))})),this.instance.bind("connectionDrag",(function(t){"function"==typeof e.$listeners.connectionDrag&&e.$emit("connectionDrag",t)})),this.instance.bind("connection",(function(t){if("function"==typeof e.$listeners.onConnection)return e.$listeners.onConnection(t)})),this.instance.bind("connectionDragStop",(function(t,n){if(!t.target||!t.target.classList.contains("jsflow-node")){var i=e.getNodeWithEndpoint(n.target);if(i){var a=e.nodes.find((function(e){return i.id===e.id}));if("function"==typeof e.$listeners.onConnectionDragStop){var r={id:t.source.id,arrow:t.endpoints[0].anchor.type};e.$emit("onConnectionDragStop",r,a.id,n)}}}})),this.instance.bind("beforeDetach",(function(t){return"function"!=typeof e.$listeners.onBeforeDetach||e.$listeners.onBeforeDetach(t)})),this.instance.bind("connectionDetached",(function(t,n){var i=e.lines.filter((function(e){return e.source.id!==t.sourceId&&e.target.id!==t.targetId}));e.lines=i,"function"==typeof e.$listeners.onConnectionDetached&&e.$emit("onConnectionDetached",i)})),this.instance.bind("connectionMoved",(function(t,n){"function"==typeof e.$listeners.onConnectionMoved&&e.$emit("onConnectionMoved",lines)})),this.instance.bind("click",(function(t,n){"function"==typeof e.$listeners.onConnectionClick&&e.$emit("onConnectionClick",t,n)})),this.instance.bind("dblclick",(function(t,n){"function"==typeof e.$listeners.onConnectionDbClick&&e.$emit("onConnectionDbClick",t,n)}))},renderData:function(){var e=this;this.instance.batch((function(){e.nodes.forEach((function(t){e.initNode(t)})),e.lines.forEach((function(t){e.createConnector(t,e.connectorOptions)}))}))},createNode:function(e){var t=this;("function"!=typeof this.$listeners.onCreateNodeBefore||this.$listeners.onCreateNodeBefore(e))&&(this.nodes.push(e),this.$nextTick((function(){t.initNode(e)})))},initNode:function(e){var t=document.getElementById(e.id);t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px"),this.setNodeDraggable(e,this.nodeOptions),this.setNodeEndPoint(e,this.endpointOptions),"function"==typeof this.$listeners.onCreateNodeAfter&&this.$emit("onCreateNodeAfter",e)},removeNode:function(e){var t=this.nodes.findIndex((function(t){return t.id===e.id}));this.nodes.splice(t,1),this.instance.remove(e.id)},setNodeEndPoint:function(e,t){var n=this;(e.endpoints||["Top","Right","Bottom","Left"]).forEach((function(i){n.instance.addEndpoint(e.id,m({anchor:i,uuid:i+e.id},t))}))},setNodeDraggable:function(e,t){if(this.editable){var n=this;this.instance.draggable(e.id,m({grid:[20,20],drag:function(t){var a=(0,i.default)({},e);n.$emit("onNodeMoving",a,t)},stop:function(t){var a=n.nodes.findIndex((function(t){return t.id===e.id})),r=(0,i.default)({},e),s=function(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var s,c=(0,o.default)(e);!(i=(s=c.next()).done)&&(n.push(s.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{i||null==c.return||c.return()}finally{if(a)throw r}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}(t.pos,2),c=s[0],l=s[1];r.x=c,r.y=l,n.nodes.splice(a,1,r),n.$emit("onNodeMoveStop",r,t)}},t))}},setNodePosition:function(e){var t=document.getElementById(e.id);t.style.left="".concat(e.x,"px"),t.style.top="".concat(e.y,"px"),this.instance.revalidate(t)},toggleNodeDraggable:function(e,t){this.instance.setDraggable(e,t)},setNodeInitialPos:function(e){return{left:"".concat(e.x,"px"),top:"".concat(e.y,"px")}},createConnector:function(e,t){var n=e.options||{};return this.instance.connect({source:e.source.id,target:e.target.id,uuids:[e.source.arrow+e.source.id,e.target.arrow+e.target.id]},m({},t,n))},getConnectorsByNodeId:function(e){return this.instance.getAllConnections().filter((function(t){return t.sourceId===e||t.targetId===e}))},getNodeWithEndpoint:function(e){var t=e.parentNode;return!(!t||"HTML"===t.nodeName)&&(t.classList.contains("jsflow-node")?t:this.getNodeWithEndpoint(t))},removeConnector:function(e){var t=this;this.instance.getConnections({source:e.source.id,target:e.target.id}).forEach((function(e){t.instance.deleteConnection(e)}))},addLineOverlay:function(e,t){var n=this;this.instance.getConnections({source:e.source.id,target:e.target.id}).forEach((function(e){e.addOverlay([t.type,{label:t.name,location:t.location,cssClass:t.cls,id:t.id,events:{click:function(e,t){n.$emit("onOverlayClick",e,t)}}}])}))},removeLineOverlay:function(e,t){this.instance.getConnections({source:e.source.id,target:e.target.id}).forEach((function(e){e.removeOverlay(t)}))},onCanvasMouseDown:function(e){e=I(e),this.isFrameSelecting?this.frameSelectHandler(e):(this.canvasGrabbing=!0,this.mouseDownPos={x:e.pageX,y:e.pageY},this.$refs.canvasFlowWrap.addEventListener(this.mousemove,this.canvasFlowMoveHandler,!1))},canvasFlowMoveHandler:function(e){e=I(e),this.canvasOffset={x:this.canvasPos.x+e.pageX-this.mouseDownPos.x,y:this.canvasPos.y+e.pageY-this.mouseDownPos.y}},onCanvasMouseUp:function(e){this.isFrameSelecting?this.frameSelectEndHandler(e):(this.canvasGrabbing=!1,this.$refs.canvasFlowWrap.removeEventListener(this.mousemove,this.canvasFlowMoveHandler),this.canvasPos={x:this.canvasOffset.x,y:this.canvasOffset.y})},registerPaletteEvent:function(){this.$refs.palettePanel.addEventListener(this.mousedown,this.nodeCreateHandler,!1)},nodeCreateHandler:function(e){var t=this,n=function e(t,n){return 1===t.nodeType&&t.classList.contains(n)?t:"HTML"!==t.parentNode.nodeName?e(t.parentNode,n):null}(e.target,this.selector);if(!n)return!1;var i=n.dataset.type?n.dataset.type:"",a=n.dataset?n.dataset.config:{};this.showAddingNode=!0,this.addingNodeConfig.id=$("node"),this.addingNodeConfig.type=i,this.$nextTick((function(){var n=t.$el.querySelector(".adding-node");t.addingNodeRect=n.getBoundingClientRect();var r=t.getAddingNodePos(e);t.addingNodeConfig=m({id:$("node"),type:i,x:r.x,y:r.y},a),t.$el.addEventListener(t.mousemove,t.nodeMovingHandler,!1),document.addEventListener(t.mouseup,t.nodeMoveEndHandler,!1)}))},nodeMovingHandler:function(e){var t=this.getAddingNodePos(e);this.$set(this.addingNodeConfig,"x",t.x),this.$set(this.addingNodeConfig,"y",t.y)},nodeMoveEndHandler:function(e){if(this.$el.removeEventListener(this.mousemove,this.nodeMovingHandler),document.removeEventListener(this.mouseup,this.nodeMoveEndHandler),this.showAddingNode=!1,e.pageX>this.paletteRect.left+this.paletteRect.width){var t=this.addingNodeConfig.x-this.paletteRect.width-this.canvasOffset.x,n=this.addingNodeConfig.y-this.canvasOffset.y;this.$set(this.addingNodeConfig,"x",t),this.$set(this.addingNodeConfig,"y",n),this.createNode(this.addingNodeConfig)}this.addingNodeConfig={},this.addingNodeRect={}},getAddingNodePos:function(e){return{x:e.pageX-this.paletteRect.left-this.addingNodeRect.width/2,y:e.pageY-this.paletteRect.top-this.addingNodeRect.height/2}},toggleHighLight:function(e){var t=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=(this.instance.getEndpoints(e.id),document.getElementById(e.id));this.instance.selectEndpoints({source:i}).each((function(e){var i=n?t.endpointOptions.hoverPaintStyle:t.endpointOptions.paintStyle;e.setStyle(i)}))},onToolClick:function(e){"function"==typeof this[e.type]&&this[e.type](),this.$emit("onToolClick",e)},setZoom:function(e){this.instance.setContainer("canvas-flow"),this.$refs.canvasFlow.style.transform="matrix("+e+",0,0,"+e+",0,0)",this.$refs.canvasFlow.style.transformOrigin="0 0",this.$refs.canvasFlow.zoom=e,this.zoom=e,this.instance.setZoom(e)},zoomIn:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1.1;this.setZoom(this.zoom*e)},zoomOut:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.9;this.setZoom(this.zoom*e)},resetPosition:function(){this.setZoom(1),this.setCanvasPosition(0,0)},setCanvasPosition:function(e,t){this.canvasOffset={x:e,y:t},this.canvasPos={x:e,y:t}},frameSelect:function(){this.isFrameSelecting=!0},frameSelectHandler:function(e){this.mouseDownPos={x:e.pageX-this.canvasRect.left,y:e.pageY-this.canvasRect.top},this.$refs.canvasFlowWrap.addEventListener(this.mousemove,this.frameSelectMovingHandler,!1)},frameSelectMovingHandler:function(e){var t=e.pageX-this.mouseDownPos.x-this.canvasRect.left,n=e.pageY-this.mouseDownPos.y-this.canvasRect.top;this.frameSelectorRect={width:Math.abs(t),height:Math.abs(n)},this.frameSelectorPos={x:t>0?this.mouseDownPos.x:this.mouseDownPos.x+t,y:n>0?this.mouseDownPos.y:this.mouseDownPos.y+n}},frameSelectEndHandler:function(e){this.$refs.canvasFlowWrap.removeEventListener(this.mousemove,this.frameSelectMovingHandler),this.$refs.canvasFlowWrap.removeEventListener(this.mouseup,this.frameSelectEndHandler),document.addEventListener("keydown",this.nodeLineCopyhandler,!1),document.addEventListener("keydown",this.nodeLinePastehandler,!1),document.addEventListener("keydown",this.nodeLineDeletehandler,!1),document.addEventListener(this.mousedown,this.cancelFrameSelectorHandler,{capture:!1,once:!0});var t=this.getSelectedNodes(),n=t.map((function(e){return e.id}));this.isFrameSelecting=!1,this.frameSelectorPos={x:0,y:0},this.frameSelectorRect={width:0,height:0},this.selectedNodes=t,this.clearNodesDragSelection(),this.addNodesToDragSelection(n),this.$emit("frameSelectNodes",t.slice(0))},getSelectedNodes:function(){var e=this,t=this.frameSelectorPos,n=t.x,i=t.y,a=this.frameSelectorRect,r=a.width,o=a.height;return this.nodes.filter((function(t){var a=document.querySelector("#".concat(t.id)),s=a.getBoundingClientRect(),c=s.left-e.canvasRect.left,l=s.top-e.canvasRect.top;if(n<c&&n+r>c&&i<l&&i+o>l)return a.classList.add("selected"),!0}))},cancelFrameSelectorHandler:function(e){this.selectedNodes.forEach((function(e){var t=document.querySelector("#".concat(e.id));t&&t.classList.remove("selected")})),this.selectedNodes=[],this.clearNodesDragSelection()},nodeLineCopyhandler:function(e){(e.ctrlKey||e.metaKey)&&67===e.keyCode&&this.$emit("onNodeCopy",this.selectedNodes)},nodeLinePastehandler:function(e){(e.ctrlKey||e.metaKey)&&86===e.keyCode&&this.$emit("onNodePaste")},nodeLineDeletehandler:function(e){var t=this;46!==e.keyCode&&8!==e.keyCode||(this.selectedNodes.forEach((function(e){t.removeNode(e)})),this.cancelFrameSelectorHandler())},addNodesToDragSelection:function(e){this.instance.addToDragSelection(e)},clearNodesDragSelection:function(){this.instance.clearDragSelection()}}},void 0,!1,void 0,b,void 0);"undefined"!=typeof window&&"Vue"in window&&window.Vue.component("js-flow",x),t.default=x},"0njq":function(e,t,n){"use strict";n.r(t);var i=n("UL6+"),a=n("Mf0c");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("lSBQ");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"65ef1e14",null);t.default=s.exports},"0nzv":function(e,t,n){"use strict";n("Dx75")},"0rd9":function(e,t,n){"use strict";n.r(t);var i=n("3ncw"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"0uNP":function(e,t,n){"use strict";n.r(t);var i=n("DoRf"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"0vGa":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("QbLZ")),a=s(n("KW1/")),r=n("L2JU"),o=n("CeR/");function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"triggerCondition",components:{triggerField:a.default},props:{triggerRules:{type:Object,default:function(){return{}}}},data:function(){return{keyList:[]}},computed:(0,i.default)({globalChoise:function(){return this.$store.state.common.configurInfo}},(0,r.mapState)("trigger",{triggerVariables:function(e){return e.triggerVariables}})),mounted:function(){this.keyList=this.triggerVariables,this.$set(this.triggerRules,"checkStatus",!1)},methods:{addLine:function(e,t,n){e.itemList.splice(n+1,0,{condition:"",key:"",value:"",conditionList:[],type:"STRING"})},deleteLine:function(e,t,n){1!==e.itemList.length&&e.itemList.splice(n,1)},changeBetween:function(e){e.type="all"===e.type?"any":"all"},handleBetween:function(){this.triggerRules.type="all"===this.triggerRules.type?"any":"all"},addGroup:function(){this.triggerRules.list.push({type:"all",itemList:[{key:"",condition:"",value:"",conditionList:[],type:"STRING"}]})},deleteGroup:function(e,t){1!==this.triggerRules.list.length&&this.triggerRules.list.splice(t,1)},changeContent:function(e){var t=this.keyList.filter((function(t){return t.key===e.key}))[0],n=t.type.toLowerCase();e.conditionList=this.globalChoise.trigger_methods[n],this.getConditionList(t,e),e.condition="",this.$set(e,"conditionType",""),e.type=t.type;e.value=["MEMBERS","MEMBER","MULTI_MEMBERS","MULTISELECT","CHECKBOX"].some((function(t){return t===e.type}))?[]:""},changeCondition:function(e){var t=e.conditionList.filter((function(t){return t.name===e.condition}))[0];this.$set(e,"conditionType",t.input_type)},getConditionList:function(e,t){var n=this;["SELECT","RADIO","MULTISELECT","CHECKBOX"].some((function(t){return t===e.type}))&&(this.$set(t,"loading",!0),this.$set(t,"options",[]),"DATADICT"===e.source_type?this.$store.dispatch("datadict/get_data_by_key",{key:e.source_uri,field_key:e.key}).then((function(e){t.options=e.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(e){(0,o.errorHandler)(e,n)})).finally((function(){t.loading=!1})):"API"===e.source_type?this.$store.dispatch("apiRemote/get_data_workflow",{kv_relation:e.kv_relation,api_instance_id:e.api_instance_id}).then((function(e){t.options=e.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(e){(0,o.errorHandler)(e,n)})).finally((function(){t.loading=!1})):"RPC"===e.source_type?this.$store.dispatch("apiRemote/getRpcData",{meta:e.meta,source_uri:e.source_uri}).then((function(e){t.options=e.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(e){(0,o.errorHandler)(e,n)})).finally((function(){t.loading=!1})):(t.options=e.choice.map((function(e){return{key:e.key,name:e.name}})),t.loading=!1))}}}},"11QV":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=k(n("jWXv")),a=k(n("rfXi")),r=k(n("P2sY")),o=k(n("QbLZ")),s=k(n("gDS+")),c=k(n("14Xm")),l=k(n("D3Ub")),u=k(n("GQeE")),d=k(n("PaSM")),f=k(n("Y6/M")),p=k(n("JGQq")),m=k(n("lAAG")),h=k(n("qVGl")),v=k(n("XDfz")),g=k(n("2Vgw")),y=n("ughI"),b=n("CeR/"),_=n("ygAv");function k(e){return e&&e.__esModule?e:{default:e}}t.default={name:"addField",components:{dataSource:f.default,dataContent:p.default,customTableData:m.default,defaultValue:h.default,hiddenConditions:v.default},mixins:[d.default],props:{formAlign:{type:String,default:"vertical"},changeInfo:{type:Object,default:function(){return{}}},workflow:{type:[String,Number],default:function(){return""}},state:{type:[String,Number],default:function(){return""}},sospInfo:{type:Object,default:function(){return{}}},addOrigin:{type:Object,default:function(){return{isOther:!1,addOriginInfo:{}}}},isEditPublic:{type:Boolean,default:!1},templateStage:{type:String,default:""},templateInfo:{type:Object,default:function(){return{}}},autoSelectedType:{type:Boolean,default:!0},nodesList:Array},data:function(){return{isShowDataSource:!1,isDataLoading:!1,trueStatus:!0,falseStatus:!1,secondClick:!1,isPublicField:!1,formInfo:{prevId:"",name:"",key:"",type:"",regex:"",regex_config:{rule:{expressions:[],type:"and"}},customRegex:"",source_type:"",source_uri:"",default_value:"",layout:"",validate:"",desc:"",is_tips:!1,tips:"",show_type:!1,show_conditions:{}},regexFieldList:[],allBetweenList:[{id:1,available:"INT",name:this.$t("m.common['大于']"),typeName:">"},{id:2,available:"INT",name:this.$t("m.common['小于']"),typeName:"<"},{id:3,available:"INT",name:this.$t("m.common['不大于']"),typeName:"<="},{id:4,available:"INT",name:this.$t("m.common['不小于']"),typeName:">="},{id:5,available:"DATE",name:this.$t("m.common['早于']"),typeName:"<"},{id:6,available:"DATE",name:this.$t("m.common['晚于']"),typeName:">"},{id:7,available:"DATE",name:this.$t("m.common['不早于']"),typeName:">="},{id:8,available:"DATE",name:this.$t("m.common['不晚于']"),typeName:"<="}],betweenList:[],customTableInfo:{list:[{name:"",display:"input",choice:"",required:!1,nameCheck:!1,check:!1}]},prevNodeList:[],frontNodesList:[],regexList:[],showType:{sourceList:["SELECT","MULTISELECT","CHECKBOX","RADIO","TABLE","TREESELECT","INPUTSELECT"],belongDefaultList:["STRING","TEXT","INT","DATE","DATETIME","DATETIMERANGE","SELECT","MULTISELECT","CHECKBOX","RADIO","MEMBER","MEMBERS","INPUTSELECT","RICHTEXT","CUSTOM-FORM"],multipleList:["MULTISELECT","CHECKBOX","MEMBERS","MEMBER"],layoutList:["TABLE","CUSTOMTABLE","RICHTEXT","CUSTOM-FORM"]},rules:{},assignValue:{},fieldInfo:{list:[{name:"",key:"",required:!1}]},apiDetail:{},apiInfo:{api_info:{remote_system_id:"",remote_api_id:"",req_params:{},req_body:{},rsp_data:""},kv_relation:{key:"",name:""}},dictionaryData:{list:[],check:""},prcData:{list:[],check:""},prcTable:[],fileList:[],fileVal:"",checkStatus:{customStatus:!1,customTableStatus:!1,customFormStatus:!1},fieldTypeList:[],hiddenConditionStatus:!0,initFormData:{}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo},isShowDataSourcebtn:function(){return!("API"!==this.formInfo.source_type&&"CUSTOM"!==this.formInfo.source_type||0===(0,u.default)(this.apiDetail).length&&0===this.fieldInfo.list.length)},isDisabled:function(){return"API"===this.formInfo.source_type&&!this.apiInfo.api_info.remote_api_id}},watch:{formInfo:{handler:function(e){this.$emit("getAddFieldStatus",""!==e.name)},deep:!0},isShowDataSource:function(e){e&&(this.initFormData.bodyTableData=(0,_.deepClone)(this.$refs.dataContent[0].$refs.postParam.bodyTableData),this.initFormData.selectInfo=(0,_.deepClone)(this.$refs.dataContent[0].$refs.responseData.selectInfo))}},mounted:function(){var e=this;return(0,l.default)(c.default.mark((function t(){return c.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isDataLoading=!0,t.next=3,e.initData();case 3:e.rules.name=e.checkCommonRules("name").name,e.rules.key=e.checkCommonRules("key").key,e.rules.type=e.checkCommonRules("select").select,e.rules.tips=e.checkCommonRules("select").select,e.rules.prevId=e.checkCommonRules("select").select,e.isDataLoading=!1,"add"===e.changeInfo.id&&e.autoSelectedType&&e.changeType();case 10:case"end":return t.stop()}}),t,e)})))()},methods:{validateContent:function(){this.checkField()?this.openDataSource():this.isShowDataSource=!1,this.$emit("change")},openDataSource:function(){this.isShowDataSource=!0},fieldNameChange:function(){var e=this.$refs.fieldForm.$data.formItems.find((function(e){return"key"===e.property}));e.fieldValue&&(e.validator.content="",e.validator.state=""),this.$emit("change")},initData:function(){var e=this;this.fieldTypeList=this.globalChoise.field_type.filter((function(e){return"DATETIMERANGE"!==e.typeName})),"COMPLEX-MEMBERS"!==this.changeInfo.type&&"SOPS_TEMPLATE"!==this.changeInfo.type||"templateField"!==this.addOrigin.addOriginInfo.type||(this.fieldTypeList=this.fieldTypeList.concat([{name:this.$t("m.common['复杂人员选择']"),typeName:"COMPLEX-MEMBERS"},{name:this.$t("m.common['标准运维模板']"),typeName:"SOPS_TEMPLATE"}])),this.globalChoise.source_type.forEach((function(t){var n="CUSTOM"===t.typeName?e.$t("m.treeinfo['自定义数据每行的name和key都不能相同。']"):e.$t("m.treeinfo['接口中的数据详情']");e.$set(t,"desc",n)})),this.nodesList?this.frontNodesList=this.nodesList:this.getFrontNodesList(),this.changeRegex("ASSOCIATED_FIELD_VALIDATION"),this.assignmentData(),this.getRegexList(),this.getRpcList(),this.getSysDictList(),this.getPreStates()},assignmentData:function(e){var t=this,n=e||this.changeInfo;if(this.formInfo.name=n.name,this.formInfo.key=n.key,this.formInfo.type=n.type,this.formInfo.regex=n.regex,n.regex_config&&n.regex_config.rule&&(this.changeRegex("ASSOCIATED_FIELD_VALIDATION"),this.formInfo.regex_config.rule.type=n.regex_config.rule.type,this.formInfo.regex_config=n.regex_config),"CUSTOM"===this.formInfo.regex&&(this.formInfo.customRegex=n.custom_regex||""),this.formInfo.layout=n.layout,this.formInfo.validate=n.validate_type,this.formInfo.desc=n.desc,this.formInfo.is_tips=n.is_tips,this.formInfo.tips=n.tips,this.formInfo.default_value=this.showType.multipleList.some((function(e){return e===n.type}))&&""!==n.default?n.default.split(","):n.default||"",this.formInfo.source_type=n.source_type,"CUSTOM"===n.source_type)if("FILE"===n.type)for(var i in n.choice)this.fileList.push(n.choice[i]);else 0!==n.choice.length&&(this.fieldInfo.list=[],n.choice.forEach((function(e){t.fieldInfo.list.push({name:e.name,key:e.key,required:!!e.required,nameCheck:!1,keyCheck:!1})})));else"API"===this.formInfo.source_type?this.apiInfo.api_info=n.api_info:"DATADICT"===this.formInfo.source_type?(this.formInfo.source_uri=n.source_uri,this.dictionaryData.check=this.formInfo.source_uri):"RPC"===this.formInfo.source_type&&(this.formInfo.source_uri=n.source_uri,this.prcData.check=n.source_uri);this.formInfo.show_type=0===n.show_type,this.formInfo.show_conditions=n.show_conditions||{},"CUSTOMTABLE"===this.formInfo.type&&(this.customTableInfo.list=[],Object.prototype.hasOwnProperty.call(n.meta,"columns")?n.meta.columns.forEach((function(e){var n=[];e.choice.forEach((function(e){n.push(e.name)})),t.customTableInfo.list.push({name:e.name,display:e.display,choice:n.join("\n"),required:e.required,nameCheck:!1,check:!1})})):this.customTableInfo.list.push({name:"",display:"input",choice:"",required:!1,nameCheck:!1,check:!1})),(0,u.default)(this.sospInfo).length&&(this.formInfo.name=this.sospInfo.name||"",this.formInfo.validate="REQUIRE"),this.initFormData.formInfo=(0,_.deepClone)(this.formInfo),this.assignValue=JSON.parse((0,s.default)(n))},getFrontNodesList:function(){var e=this;return(0,l.default)(c.default.mark((function t(){var n,i;return c.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.state||e.templateInfo.id){t.next=2;break}return t.abrupt("return");case 2:return n="",i={},e.state&&(n="apiRemote/get_related_fields",i.workflow=e.workflow,i.state=e.state),e.templateInfo.id&&(n="taskTemplate/getFrontFieldsList",i.id=e.templateInfo.id,i.stage=e.templateStage),t.next=8,e.$store.dispatch(n,i).then((function(t){e.frontNodesList=t.data})).catch((function(t){(0,b.errorHandler)(t,e)}));case 8:case"end":return t.stop()}}),t,e)})))()},addExpression:function(){this.formInfo.regex_config.rule.expressions.push({condition:"",key:"",source:"field",type:this.formInfo.type,value:""})},deleteExpression:function(e){1!==this.formInfo.regex_config.rule.expressions.length&&this.formInfo.regex_config.rule.expressions.splice(e,1)},changeType:function(){var e=this;return(0,l.default)(c.default.mark((function t(){return c.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$emit("change"),e.formInfo.regex="EMPTY",e.formInfo.customRegex="",e.showType.layoutList.includes(e.formInfo.type)&&(e.formInfo.layout="COL_12"),e.formInfo.field="",e.dictionaryData.check="","TREESELECT"===e.formInfo.type?e.formInfo.source_type="DATADICT":e.formInfo.source_type="CUSTOM",e.fieldInfo.list.length||(e.fieldInfo.list=[{name:"",key:"",required:!1,nameCheck:!1,keyCheck:!1}]),"CUSTOM-FORM"===e.formInfo.type&&(e.formInfo.default_value=y.CUSTOM_FORM_DEFAULT_VALUE),t.next=11,e.getRegexList();case 11:e.formInfo.regex_config.rule.expressions=[];case 12:case"end":return t.stop()}}),t,e)})))()},changeRegex:function(e){var t=this;this.formInfo.customRegex="","ASSOCIATED_FIELD_VALIDATION"===e&&(this.regexFieldList=this.frontNodesList.filter((function(e){return"INT"===t.formInfo.type?e.type===t.formInfo.type:"DATE"===e.type||"DATETIME"===e.type})).filter((function(e){return e.id!==t.changeInfo.id})),["DATE","DATETIME"].includes(this.formInfo.type)&&this.regexFieldList.push({name:"系统时间",id:"system_time",key:"system_time",source:"system"}),this.betweenList=this.allBetweenList.filter((function(e){return"INT"===t.formInfo.type?"INT"===e.available:"DATE"===e.available})),this.betweenList.push({name:"等于",typeName:"=="}),this.formInfo.regex_config.rule.expressions.length||this.addExpression())},getRegexList:function(){var e=this,t=this.formInfo.type;this.$store.dispatch("cdeploy/regexList",t).then((function(t){e.regexList=t.data.regex_choice.map((function(t){return{name:t[1]?t[1]:e.$t('m.treeinfo["无"]'),typeName:t[0]}}))})).catch((function(t){(0,b.errorHandler)(t,e)}))},onRegexFieldChange:function(e,t){this.$emit("change");t.source=["system_time"].includes(e)?"system":"field"},relateSelected:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t[2].type=t[1].type,t[2].source=t[1].source},putKey:function(){var e=this;"number"!=typeof this.changeInfo.id&&(this.formInfo.key="",(0,g.default)(this.formInfo.name,{style:g.default.STYLE_NORMAL,heteronym:!1}).forEach((function(t){e.formInfo.key=""+e.formInfo.key+t})),this.formInfo.key=this.formInfo.key.toUpperCase(),this.formInfo.key=this.formInfo.key.replace(/\ /g,"_"),this.formInfo.key.length>=32&&(this.formInfo.key=this.formInfo.key.substr(0,32)))},changeApiInfo:function(e){this.$emit("change"),this.apiDetail=e},getRpcData:function(e){this.prcTable=e},handleFile:function(e){var t=this;this.$emit("change");for(var n=e.target.files[0],i=n.size/1024,a=n.name,r=0;r<this.fileList.length;r++)if(a===this.fileList[r].name)return void this.$bkMessage({message:this.$t('m.treeinfo["此文件已经上传"]'),theme:"error"});if(i<=1e5){var s=new FormData;s.append("field_file",n),this.$store.dispatch("cdeploy/fileUpload",{data:s}).then((function(e){for(var n in e.data.succeed_files)t.fileList.push((0,o.default)({},e.data.succeed_files[n],{key:n}));t.fileVal="",t.$bkMessage({message:t.$t('m.treeinfo["上传成功"]'),theme:"success"})})).catch((function(e){(0,b.errorHandler)(e,t)}))}else this.fileVal="",this.$bkMessage({message:this.$t('m.treeinfo["该文件大小超过100MB！"]'),theme:"error"})},deleteFile:function(e,t){this.fileList.splice(t,1)},addField:function(){var e=this;return(0,l.default)(c.default.mark((function t(){var n,i,a,o;return c.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getDataContent();case 2:if(n=t.sent){t.next=5;break}return t.abrupt("return");case 5:if(!e.secondClick){t.next=7;break}return t.abrupt("return");case 7:e.secondClick=!0,"number"==typeof e.changeInfo.id?(i=e.changeInfo.id,a="TABLE"===e.changeInfo.source?"cdeploy/changeNewModuleField":"cdeploy/changeNewField",e.addOrigin.isOther&&e.addOrigin.addOriginInfo.updateUrl&&(a=e.addOrigin.addOriginInfo.updateUrl,"templateField"===e.addOrigin.addOriginInfo.type&&(n.task_schema_id=e.templateInfo.id,n.stage=e.templateStage,"COMPLEX-MEMBERS"!==n.type&&"SOPS_TEMPLATE"!==n.type||delete n.type)),e.changeInfo.project_key&&(n.project_key=e.changeInfo.project_key),e.$store.dispatch(a,{params:n,id:i}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["修改成功"]'),theme:"success"}),e.$emit("closeShade"),e.addOrigin.isOther&&e.addOrigin.addOriginInfo.updateUrl&&"templateField"!==e.addOrigin.addOriginInfo.type&&e.$parent.$parent.getList?e.$parent.$parent.getList():e.$parent.$parent.getTableList?e.$parent.$parent.getTableList():e.$emit("getRelatedFields"),e.$emit("onConfirm",(0,r.default)({},e.changeInfo,n))})).catch((function(t){(0,b.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))):(n.state=e.state,(0,u.default)(e.sospInfo).length&&(n.state=e.formInfo.prevId),o="cdeploy/addNewField",e.addOrigin.isOther&&e.addOrigin.addOriginInfo.addUrl&&(o=e.addOrigin.addOriginInfo.addUrl,"templateField"===e.addOrigin.addOriginInfo.type&&(n.task_schema_id=e.templateInfo.id,n.stage=e.templateStage)),e.changeInfo.project_key&&(n.project_key=e.changeInfo.project_key),e.$store.dispatch(o,{params:n}).then((function(t){e.addNew=t.data,e.$bkMessage({message:e.$t('m.treeinfo["新增成功"]'),theme:"success"}),e.$emit("closeShade"),e.addOrigin.isOther&&e.addOrigin.addOriginInfo.addUrl?"templateField"===e.addOrigin.addOriginInfo.type&&e.$parent.$parent.getTableList?e.$parent.$parent.getTableList():e.$parent.$parent.getList&&e.$parent.$parent.getList():e.$parent.$parent.getTableList?e.$parent.$parent.getTableList():(e.$emit("getRelatedFields"),e.$parent.$parent.showNew&&e.$parent.$parent.showNew(e.sospInfo,t)),e.$emit("onConfirm",t.data)})).catch((function(t){(0,b.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})));case 9:case"end":return t.stop()}}),t,e)})))()},onCancelClick:function(){this.$emit("closeShade"),this.$emit("onCancel")},checkInfo:function(){var e=this;this.$refs.fieldForm.validate().then((function(){e.$refs.dataSource&&e.$refs.dataSource.checkSouce()||e.checkField()||(!e.formInfo.is_tips||e.formInfo.tips?e.addField():e.$bkMessage({theme:"warning",message:e.$t('m.treeinfo["字段释疑为必填项"]')}))}),(function(e){console.error(e)}))},getDataContent:function(){var e=this;return(0,l.default)(c.default.mark((function t(){var n,r,o,s,l,u;return c.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n={}).layout=e.formInfo.layout,n.validate_type=e.formInfo.validate,n.regex=e.formInfo.regex,n.regex_config=e.formInfo.regex_config,n.desc=e.formInfo.desc,n.is_tips=e.formInfo.is_tips,n.tips=e.formInfo.tips,n.default="",e.showType.belongDefaultList.some((function(t){return t===e.formInfo.type}))&&(o=[],(r=["MULTISELECT","CHECKBOX","MEMBERS","MEMBER"]).some((function(t){return t===e.formInfo.type}))&&e.formInfo.default_value&&(o=e.formInfo.default_value.filter((function(e){return""!==e}))),n.default=r.some((function(t){return t===e.formInfo.type}))?o.join(","):e.formInfo.default_value),!e.$refs.hiddenConditions){t.next=20;break}if(!e.$refs.hiddenConditions.checkList()){t.next=14;break}return e.hiddenConditionStatus=!1,t.abrupt("return",!1);case 14:s=e.$refs.hiddenConditions.listInfo,n.show_conditions={type:e.$refs.hiddenConditions.conditionType,expressions:[]},s.forEach((function(e){n.show_conditions.expressions.push({key:e.key,condition:e.condition,value:Array.isArray(e.value)?e.value.join(","):e.value,type:e.type})})),n.show_type=0,t.next=22;break;case 20:n.show_type=1,n.show_conditions={};case 22:if("TABLE"===e.changeInfo.source){t.next=65;break}if(n.workflow=e.workflow,n.name=e.formInfo.name,n.key=e.formInfo.key,n.type=e.formInfo.type,n.desc=e.formInfo.desc,n.source_type=e.formInfo.source_type||"CUSTOM",n.custom_regex=e.formInfo.customRegex,n.is_tips=e.formInfo.is_tips,n.tips=e.formInfo.tips,"FILE"!==e.formInfo.type){t.next=37;break}n.choice={},e.fileList.forEach((function(t){e.$set(n.choice,t.key,t)})),t.next=54;break;case 37:if("CUSTOM"!==e.formInfo.source_type){t.next=42;break}n.choice=[],"SELECT"===e.formInfo.type||"MULTISELECT"===e.formInfo.type||"CHECKBOX"===e.formInfo.type||"RADIO"===e.formInfo.type||"INPUTSELECT"===e.formInfo.type?e.fieldInfo.list.forEach((function(e){n.choice.push({key:e.key,name:e.name})})):"TABLE"===e.formInfo.type&&e.fieldInfo.list.forEach((function(e){n.choice.push({key:e.key,name:e.name,required:e.required})})),t.next=54;break;case 42:if("API"!==e.formInfo.source_type){t.next=53;break}if("API"!==e.formInfo.source_type){t.next=49;break}return t.next=46,e.$refs.dataContent[0].apiFz();case 46:if(t.sent){t.next=49;break}return t.abrupt("return",!1);case 49:n.api_info=e.apiInfo.api_info,n.kv_relation=e.apiInfo.kv_relation,t.next=54;break;case 53:"DATADICT"===e.formInfo.source_type&&(n.choice=[],n.source_uri=e.dictionaryData.check);case 54:if("CUSTOMTABLE"!==e.formInfo.type){t.next=64;break}if(e.customTableInfo.list.forEach((function(e){var t=[];!e.choice||"select"!==e.display&&"multiselect"!==e.display||(t=e.choice.split("\n").filter((function(e){return e.length>0}))),e.nameCheck=0===e.name.length||e.name.length>120,e.check=!t.length&&("select"===e.display||"multiselect"===e.display)})),l=e.customTableInfo.list.some((function(e){return e.nameCheck})),u=e.customTableInfo.list.some((function(e){return e.check})),!l&&!u){t.next=61;break}return e.$bkMessage({theme:"warning",message:e.$t('m.treeinfo["请填写正确格式的自定义数据"]')}),t.abrupt("return",!1);case 61:n.meta={},n.meta.columns=[],e.customTableInfo.list.forEach((function(e){var t=e.choice.split("\n").filter((function(e){return e.length>0}));t=(0,a.default)(new i.default(t)),n.meta.columns.push({name:e.name,display:e.display,choice:e.choice.length?t:[],required:e.required})}));case 64:"RPC"===e.formInfo.source_type&&(n.source_uri=e.prcData.check,n.meta={},e.prcTable.forEach((function(e){var t="CUSTOM"===e.source_type?e.value:"${params_"+e.value_key+"}";n.meta[e.name]=t})));case 65:return t.abrupt("return",e.timeConversion(n));case 66:case"end":return t.stop()}}),t,e)})))()},timeConversion:function(e){var t=this;return""!==e.default&&("DATE"!==e.type&&"DATETIME"!==e.type||(e.default="DATE"===e.type?this.standardDayTime(e.default):this.standardTime(e.default))),e.show_conditions&&e.show_conditions.expressions&&e.show_conditions.expressions.length&&e.show_conditions.expressions.forEach((function(e){"DATE"!==e.type&&"DATETIME"!==e.type||(e.value="DATE"===e.type?t.standardDayTime(e.value):t.standardTime(e.value))})),e},checkField:function(){var e=this;this.checkStatus.customStatus=!1,this.checkStatus.customTableStatus=!1,this.checkStatus.customFormStatus=!1;if(["SELECT","MULTISELECT","CHECKBOX","RADIO","TABLE"].some((function(t){return e.formInfo.type===t}))&&"CUSTOM"===this.formInfo.source_type&&(this.fieldInfo.list.forEach((function(e){e.nameCheck=e.name.length>120||0===e.name.length,e.keyCheck=!/[a-zA-Z0-9]+$/.test(e.key)})),this.fieldInfo.list.forEach((function(t,n){e.fieldInfo.list.forEach((function(e,i){n!==i&&(e.key===t.key&&(t.keyCheck=!0),e.name===t.name&&(t.nameCheck=!0))}))})),this.checkStatus.customStatus=this.fieldInfo.list.some((function(e){return e.nameCheck||e.keyCheck}))),"CUSTOMTABLE"===this.formInfo.type){var t=[];this.customTableInfo.list.forEach((function(e){var n=[];!e.choice||"select"!==e.display&&"multiselect"!==e.display||(n=e.choice.split("\n").filter((function(e){return e.length>0}))),e.nameCheck=0===e.name.length||e.name.length>120,e.check=!n.length&&("select"===e.display||"multiselect"===e.display),t.includes(e.name)?e.nameCheck=!0:t.push(e.name)})),this.checkStatus.customTableStatus=this.customTableInfo.list.some((function(e){return e.nameCheck||e.check}))}if("CUSTOM-FORM"===this.formInfo.type)try{var n=JSON.parse(this.formInfo.default_value);n&&(this.checkStatus.customFormStatus=!n.schemes||!n.form_data)}catch(e){this.checkStatus.customFormStatus=!0}return this.checkStatus.customStatus||this.checkStatus.customTableStatus||this.checkStatus.customFormStatus},getRpcList:function(){var e=this;this.$store.dispatch("datadict/getPrcData").then((function(t){var n=["table_fields","flow_states"];e.prcData.list=t.data.filter((function(e){return-1===n.indexOf(e.key)})),e.prcData.list.filter((function(t){return t.key===e.prcData.check})).length&&(e.prcTable=e.prcData.list.filter((function(t){return t.key===e.prcData.check}))[0].req_params)})).catch((function(t){(0,b.errorHandler)(t,e)}))},getSysDictList:function(){var e=this;this.$store.dispatch("datadict/list",{}).then((function(t){e.dictionaryData.list=t.data.filter((function(e){return e.is_enabled}))})).catch((function(t){(0,b.errorHandler)(t,e)}))},getPreStates:function(){var e=this;this.state&&this.$store.dispatch("deployCommon/getPreStates",{id:this.state}).then((function(t){e.prevNodeList=t.data})).catch((function(t){(0,b.errorHandler)(t,e)}))}}}},"11RT":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mt20 mb20"},[e.openFunction.TRIGGER_SWITCH&&"workflow"!==e.origin&&"transition"!==e.origin?t("div",{staticClass:"more-configuration",attrs:{"data-test-id":"trigger-div-showMoreConfig"},on:{click:function(t){e.showMoreConfig=!e.showMoreConfig}}},[e.showMoreConfig?t("i",{staticClass:"bk-icon icon-up-shape"}):t("i",{staticClass:"bk-icon icon-down-shape"}),e._v(" "),t("span",[e._v(e._s(e.$t("m.taskTemplate['高级配置']")))])]):e._e(),e._v(" "),e.showMoreConfig?t("div",{staticClass:"common-section-card-block mt20",class:[{"inner-mode":"workflow"===e.origin||"transition"===e.origin}]},[t("label",{staticClass:"common-section-card-label"},[e._v("\n      "+e._s(e.$t("m.newCommon['触发器']"))+"\n    ")]),e._v(" "),t("div",{staticClass:"common-section-card-body"},[e.showMoreConfig?[t("collapse-transition",[t("div",[t("div",[t("ul",{staticClass:"bk-trigger-content"},[e._l(e.boundTriggerList,(function(n,i){return t("li",{key:i,class:{"li-transition":"transition"===e.origin},on:{click:function(t){return t.stopPropagation(),e.openNew("add",n)}}},[t("span",{staticClass:"bk-trigger-icon"},[t("i",{staticClass:"bk-itsm-icon icon-info-circle icon-slide",staticStyle:{"font-size":"24px"}})]),e._v(" "),t("span",{staticClass:"bk-trigger-name",attrs:{title:n.name}},[e._v(e._s(n.name||"--")+"\n                    "),n.is_draft?t("span",{staticStyle:{color:"#3A84FF"}},[e._v(e._s(e.$t('m.taskTemplate["(草稿)"]')))]):e._e()]),e._v(" "),t("span",{staticClass:"bk-trigger-delete"},[t("i",{staticClass:"bk-icon icon-delete",on:{click:function(t){return t.stopPropagation(),e.delTrigger(n)}}})])])})),e._v(" "),t("bk-dropdown-menu",{staticStyle:{float:"left"},attrs:{trigger:"click"}},[t("div",{staticClass:"bk-trigger-add",attrs:{slot:"dropdown-trigger",title:e.$t("m.taskTemplate['添加触发器']")},slot:"dropdown-trigger"},[t("i",{staticClass:"bk-icon icon-plus"})]),e._v(" "),t("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},[t("li",[t("a",{attrs:{href:"javascript:;","data-test-id":"taskTemplate-li-addTrigger"},on:{click:function(t){return e.openNew("add")}}},[e._v(e._s(e.$t("m.taskTemplate['新建']")))])]),e._v(" "),t("li",[t("a",{attrs:{href:"javascript:;","data-test-id":"taskTemplate-li-quoteCommonTrigger"},on:{click:function(t){return e.openNew("cite")}}},[e._v(e._s(e.$t("m.taskTemplate['引用公共触发器']")))])])])])],2)])])])]:e._e()],2),e._v(" "),[t("bk-dialog",{attrs:{theme:"primary",width:"660","mask-close":!1},model:{value:e.triggerDialogInfo.isShow,callback:function(t){e.$set(e.triggerDialogInfo,"isShow",t)},expression:"triggerDialogInfo.isShow"}},[t("div",{staticClass:"trigger-dialog-header",attrs:{slot:"header"},slot:"header"},[t("span",[e._v(e._s(e.$t("m.taskTemplate['引用公共触发器']")))]),e._v(" "),t("div",{staticClass:"bk-search-key"},[t("bk-input",{attrs:{clearable:!0,"right-icon":"bk-icon icon-search"},on:{enter:e.searchInfo,clear:e.clearSearch},model:{value:e.triggerDialogInfo.searchKey,callback:function(t){e.$set(e.triggerDialogInfo,"searchKey",t)},expression:"triggerDialogInfo.searchKey"}})],1)]),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.triggerDialogInfo.listLoading},expression:"{ isLoading: triggerDialogInfo.listLoading }"}],staticClass:"trigger-dialog-box"},[0===e.triggerDialogInfo.list.length?t("p",{staticClass:"dialog-none-content"},[t("i",{staticClass:"bk-icon icon-info-circle"}),e._v(" "),t("span",[e._v(e._s(e.$t("m.taskTemplate['暂无匹配的公共触发器，']")))]),e._v(" "),t("span",{staticClass:"bk-primary",on:{click:e.newTrigger}},[e._v(e._s(e.$t("m.taskTemplate['跳转创建']")))])]):[t("span",[e._v(e._s(e.$t("m.taskTemplate['根据您当前的引用位置，系统已筛选出适用的公共触发器。']")))]),e._v(" "),t("ul",{staticClass:"bk-trigger-content"},e._l(e.triggerDialogInfo.list,(function(n,i){return t("li",{key:i,class:{"li-checked":n.checked},on:{click:function(e){n.checked=!n.checked}}},[t("span",{staticClass:"bk-trigger-icon"},[t("i",{staticClass:"bk-itsm-icon icon-info-circle",class:[n.iconKey],staticStyle:{"font-size":"24px"}})]),e._v(" "),t("span",{staticClass:"bk-trigger-name",attrs:{title:n.name}},[e._v(e._s(n.name||"--"))]),e._v(" "),t("span",{staticClass:"bk-trigger-delete"},[t("bk-checkbox",{attrs:{value:n.checked}})],1)])})),0)]],2),e._v(" "),t("div",{staticClass:"trigger-dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("bk-checkbox",{attrs:{value:Boolean(e.triggerDialogInfo.list.length===e.citeList.length&&e.triggerDialogInfo.list.length),"ext-cls":"checkbox",disabled:!e.triggerDialogInfo.list.length},on:{change:e.selectAllFn}},[e._v(e._s(e.$t("m.taskTemplate['全选']")))]),e._v(" "),t("span",[e._v(e._s(e.$t("m.taskTemplate['已选']"))),t("span",[e._v(e._s(e.citeList.length))]),e._v("个")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"common-trigger-confirm",title:e.$t("m.taskTemplate['确定']")},on:{click:e.citeTrigger}},[e._v("\n            "+e._s(e.$t("m.taskTemplate['确定']"))+"\n          ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:e.$t("m.taskTemplate['取消']")},on:{click:e.initDialogInfo}},[e._v("\n            "+e._s(e.$t("m.taskTemplate['取消']"))+"\n          ")])],1)])],e._v(" "),[t("bk-sideslider",{attrs:{"is-show":e.triggerSliderInfo.isShow,title:e.triggerSliderInfo.title,width:e.triggerSliderInfo.width,"quick-close":!0,"before-close":e.handleBeforeClose},on:{"update:isShow":function(t){return e.$set(e.triggerSliderInfo,"isShow",t)},"update:is-show":function(t){return e.$set(e.triggerSliderInfo,"isShow",t)}}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.triggerSliderInfo.addLoading},expression:"{ isLoading: triggerSliderInfo.addLoading }"}],staticStyle:{"min-height":"300px"},attrs:{slot:"content"},slot:"content"},[e.triggerSliderInfo.isShow?t("add-trigger",{attrs:{"node-type":e.nodeType,"trigger-info":e.triggerSliderInfo.item,"origin-info-to-trigger":e.originInfoToTrigger},on:{closeTrigger:function(t){e.triggerSliderInfo.isShow=!1},getList:e.getBoundTriggerList,change:function(t){e.isFormChanged=!0}}}):e._e()],1)])]],2):e._e()])},a=[];i._withStripped=!0},"13wB":function(e,t,n){"use strict";n.r(t);var i=n("ohl0"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"1Eew":function(e,t,n){"use strict";n.r(t);var i=n("6DoO"),a=n("dV6M");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("CYQk");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"55aa2584",null);t.default=s.exports},"1Gpi":function(e,t,n){"use strict";n("NzFv")},"1R/T":function(e,t,n){"use strict";n.r(t),n.d(t,"getOffset",(function(){return s})),n.d(t,"offset",(function(){return d})),n.d(t,"position",(function(){return u}));var i=["borderBottomWidth","borderLeftWidth","borderRightWidth","borderTopStyle","borderRightStyle","borderBottomStyle","borderLeftStyle","borderTopWidth","boxSizing","fontFamily","fontSize","fontWeight","height","letterSpacing","lineHeight","marginBottom","marginLeft","marginRight","marginTop","outlineWidth","overflow","overflowX","overflowY","paddingBottom","paddingLeft","paddingRight","paddingTop","textAlign","textOverflow","textTransform","whiteSpace","wordBreak","wordWrap"],a=function(e,t){var n=document.createElement("div");return function(t){var a,r=(a={position:"absolute",left:-9999,top:0,zIndex:-2e3},"TEXTAREA"===e.tagName&&i.push("width"),i.forEach((function(t){a[t]=getComputedStyle(e)[t]})),a);Object.keys(r).forEach((function(e){n.style[e]=r[e]})),n.innerHTML=t,e.parentNode.insertBefore(n,e.nextSibling)}(t),{rect:function(){var e=n.ownerDocument.getElementById("caret-position-marker"),t={left:e.offsetLeft,top:e.offsetTop,height:e.offsetHeight};return n.parentNode.removeChild(n),t}}};function r(e){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.customPos,n=e.iframe,i=e.noShadowCaret;return n?{iframe:n,window:n.contentWindow,document:n.contentDocument||n.contentWindow.document,noShadowCaret:i,customPos:t}:{window:window,document:document,noShadowCaret:i,customPos:t}},s=function(e,t){var n=t&&t.window||window,i=t&&t.document||document,a=e.getBoundingClientRect(),r=i.documentElement,o=n.pageXOffset||r.scrollLeft,s=n.pageYOffset||r.scrollTop;return{top:a.top+s,left:a.left+o}},c=function(e){return"object"===r(e)&&null!==e},l=function(e,t){return function(e){return!!(e.contentEditable?"true"===e.contentEditable:"true"===e.getAttribute("contenteditable"))}(e)?function(e,t){var n=function(){var n=i(),a={height:0,left:0,right:0};if(!n)return a;var r=t.customPos||0===t.customPos;if(n.endOffset-1>0&&n.endContainer!==e||r){var o=n.cloneRange(),s=r?t.customPos:n.endOffset;o.setStart(n.endContainer,s-1<0?0:s-1),o.setEnd(n.endContainer,s);var c=o.getBoundingClientRect();a={height:c.height,left:c.left+c.width,top:c.top},o.detach()}if((!a||a&&0===a.height)&&!t.noShadowCaret){var l=n.cloneRange(),u=t.document.createTextNode("|");l.insertNode(u),l.selectNode(u);var d=l.getBoundingClientRect();a={height:d.height,left:d.left,top:d.top},u.parentNode.removeChild(u),l.detach()}if(a){var f=t.document.documentElement;a.top+=t.window.pageYOffset-(f.clientTop||0),a.left+=t.window.pageXOffset-(f.clientLeft||0)}return a},i=function(){if(t.window.getSelection){var e=t.window.getSelection();return e.rangeCount>0?e.getRangeAt(0):null}},a=function(){var t=i(),n=t.cloneRange();n.selectNodeContents(e),n.setEnd(t.endContainer,t.endOffset);var a=n.toString().length;return n.detach(),a};return{getPos:a,setPos:function(n){var i=t.window.getSelection();if(i){var a=0,r=!1;!function e(o,s){for(var c=0;c<s.childNodes.length;c++){var l=s.childNodes[c];if(r)break;if(3===l.nodeType){if(a+l.length>=o){r=!0;var u=t.document.createRange();u.setStart(l,o-a),i.removeAllRanges(),i.addRange(u);break}a+=l.length}else e(n,l)}}(n,e)}return e},getPosition:function(){var i=n(),r=a(),o=e.getBoundingClientRect(),s=o.top+t.document.body.scrollTop,c=o.left+t.document.body.scrollLeft;return i.left-=c,i.top-=s,i.pos=r,i},getOffset:n,getRange:i}}(e,t):function(e,t){var n=function(){return e.selectionStart},i=function(i){var r=function(e){return e.replace(/<|>|`|"|&/g,"?").replace(/\r\n|\r|\n/g,"<br/>")};(t.customPos||0===t.customPos)&&(i=t.customPos);var o=void 0===i?n():i,s=e.value.slice(0,o),c=e.value.slice(o),l='<span style="position: relative; display: inline;">'.concat(r(s),"</span>");l+='<span id="caret-position-marker" style="position: relative; display: inline;">|</span>',l+='<span style="position: relative; display: inline;">'.concat(r(c),"</span>");var u=a(e,l).rect();return u.pos=n(),u};return{getPos:n,setPos:function(t){return e.setSelectionRange(t,t),e},getOffset:function(n){var a=s(e),r=i(n);return{top:a.top+r.top+t.document.body.scrollTop,left:a.left+r.left+t.document.body.scrollLeft,height:r.height}},getPosition:i}}(e,t)},u=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n;c(t)&&(i=t,t=null);var a=o(i),r=l(e,a);return t||0===t?r.setPos(t):r.getPosition()},d=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n;c(t)&&(i=t,t=null);var a=o(i),r=l(e,a);return r.getOffset(t)}},"1TTJ":function(e,t,n){},"1fnQ":function(e,t,n){"use strict";n.r(t);var i=n("/Xc1"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"1h6V":function(e,t,n){"use strict";n("nDi6")},"1hFm":function(e,t,n){"use strict";n.r(t);var i=n("NFkJ"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"1lIc":function(e,t,n){"use strict";n("Gy6q")},"1lNk":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("m1cH")),a=h(n("14Xm")),r=h(n("4d7F")),o=h(n("QbLZ")),s=h(n("gDS+")),c=h(n("D3Ub")),l=h(n("vUrO")),u=h(n("PIEm")),d=h(n("PRQd")),f=h(n("bcjM")),p=h(n("s4tT")),m=n("CeR/");function h(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ApprovalNode",components:{BasicCard:p.default,dealPerson:u.default,fieldConfig:d.default,commonTriggerList:f.default,descInfo:l.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}}},data:function(){return{betweenList:[{id:1,name:">=",key:">="},{id:2,name:">",key:">"},{id:3,name:"=",key:"=="},{id:4,name:"<=",key:"<="},{id:5,name:"<",key:"<"}],finishCondition:{expressions:[{expressions:[],type:"and"}],type:"or"},finishConditionRule:{key:[{required:!0,message:this.$t("m.systemConfig['请输入']"),trigger:"blur"}],value:[{required:!0,message:this.$t("m.systemConfig['请输入']"),trigger:"blur"}]},passRateExpression:{key:"",condition:">=",value:"",source:"global",type:"INT",meta:{code:"PROCESS_COUNT",unit:"INT"},tooltipInfo:{disabled:!0,content:"",placements:["top"]}},emptyExpression:{key:"",condition:">=",value:"",source:"global",type:"INT",meta:{code:"",unit:"INT"},tooltipInfo:{disabled:!1,content:this.$t("m.treeinfo['请先选择条件']"),placements:["top"]}},isShowSignSwitch:!1,isShowSignOptions:!1,processType:"",isLoading:!1,secondClick:!1,getConditionFlag:!1,ticketKeyLoading:!1,formInfo:{name:"",desc:"",tag:"",ticket_type:"",ticket_key:"",is_sequential:!1,is_multi:!0,processors:[],is_allow_skip:!1},nodeTagList:[],allCondition:[],secondLevelList:[],excludeProcessor:[],deliversExclude:["BY_ASSIGNOR","EMPTY","STARTER","VARIABLE","API","ASSIGN_LEADER","STARTER_LEADER"],billStatusList:[{type:"keep",name:this.$t('m.treeinfo["延续上个节点"]')},{type:"custom",name:this.$t('m.treeinfo["自定义"]')}],processorsInfo:{type:"",value:""},deliversInfo:{type:"",value:""},checkStatus:{delivers:!1,processors:!1},nodeInfoRule:{name:[{required:!0,message:this.$t("m.newCommon['请输入节点名称']"),trigger:"blur"}],processors:[{validator:function(e){return e.length},message:this.$t("m.newCommon['请选择处理人']"),trigger:"blur"}]}}},watch:{"formInfo.processors":function(){this.setAllTooltip()}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n,i,c;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getAllConditions();case 2:e.isLoading=!0,n=void 0,e.processType="multi",e.formInfo.name=e.configur.name,e.formInfo.desc=e.configur.desc,e.formInfo.tag=e.configur.tag||"",e.formInfo.is_multi=!0===e.configur.is_multi,e.configur.is_multi?(e.isShowSignSwitch=!0,e.configur.is_sequential?e.processType="sequential":e.processType="random"):e.processType="multi",e.formInfo.is_sequential=e.configur.is_sequential,e.formInfo.is_allow_skip=e.configur.is_allow_skip,e.formInfo.processors=e.configur.processors?e.configur.processors.split(","):[],e.formInfo.ticket_type=e.configur.extras.ticket_status?e.configur.extras.ticket_status.type:"keep",e.formInfo.ticket_key=e.configur.extras.ticket_status?e.configur.extras.ticket_status.name:"",e.configur.finish_condition&&e.configur.finish_condition.expressions?(e.configur.finish_condition.expressions.length&&(e.isShowSignOptions=!0),e.finishCondition=JSON.parse((0,s.default)(e.configur.finish_condition)),e.finishCondition.expressions.forEach((function(e){e.expressions=e.expressions.map((function(e){return(0,o.default)({},e,{tooltipInfo:{disabled:!0,content:"",placements:["top"]}})}))}))):((i=e.allCondition.find((function(e){return"PROCESS_COUNT"===e.meta.code})))&&(e.passRateExpression.key=i.key),e.finishCondition.expressions[0].expressions.push(JSON.parse((0,s.default)(e.passRateExpression))),e.giveTooltip(e.passRateExpression)),e.$set(e.formInfo,"can_deliver",!0===e.configur.can_deliver),"custom"===e.formInfo.ticket_type&&(n=e.getSecondLevelList()),e.formInfo.can_deliver&&(e.deliversInfo={type:e.configur.delivers_type,value:e.configur.delivers}),e.processorsInfo={type:e.configur.processors_type,value:e.configur.processors},c=e.getNodeTagList(),e.getExcludeRoleTypeList(),r.default.all([n,c]).then((function(){e.isLoading=!1}));case 23:case"end":return t.stop()}}),t,e)})))()},getNodeTagList:function(){var e=this;return this.$store.dispatch("datadict/get_data_by_key",{key:"STATE_TAG_TYPE"}).then((function(t){e.nodeTagList=t.data})).catch((function(t){(0,m.errorHandler)(t,e)})).finally((function(){}))},getSecondLevelList:function(){var e=this;return this.ticketKeyLoading=!0,this.$store.dispatch("ticketStatus/getOverallTicketStatuses").then((function(t){e.secondLevelList=t.data})).catch((function(t){(0,m.errorHandler)(t,e)})).finally((function(){e.ticketKeyLoading=!1}))},getExcludeRoleTypeList:function(){var e=[];e=this.configur.is_builtin?["BY_ASSIGNOR","STARTER","VARIABLE"]:["OPEN"],"DISTRIBUTE_THEN_PROCESS"!==this.configur.distribute_type&&"DISTRIBUTE_THEN_CLAIM"!==this.configur.distribute_type&&e.push("BY_ASSIGNOR"),this.flowInfo.is_biz_needed||(e.push("CMDB"),this.deliversExclude.push("CMDB")),this.excludeProcessor=["EMPTY","API"].concat((0,i.default)(e))},submitNode:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[e.$refs.nodeInfoForm.validate()],t.next=3,r.default.all(n).then((function(){var t={is_draft:!1,workflow:e.flowInfo.id,type:e.configur.type,is_terminable:!1,processors_type:"PERSON",finish_condition:e.finishCondition,is_multi:!1,is_allow_skip:!1};if(t.name=e.formInfo.name,t.desc=e.formInfo.desc||void 0,t.is_sequential=e.formInfo.is_sequential,t.processors_type="",t.processors="",e.isShowSignOptions||(t.finish_condition={expressions:[],type:"or"}),!e.$refs.processors||e.$refs.processors.verifyValue()){if(e.$refs.processors){var n=e.$refs.processors.getValue();t.processors_type=n.type,t.processors=n.value}if(!e.$refs.delivers||e.$refs.delivers.verifyValue()){if(t.is_allow_skip=e.formInfo.is_allow_skip,e.$refs.delivers){var i=e.$refs.delivers.getValue();t.delivers_type=i.type,t.delivers=i.value}"multi"!==e.processType&&(t.is_multi=!0),t.tag=e.formInfo.tag,t.can_deliver=e.formInfo.can_deliver,t.ticket_type=e.formInfo.ticket_type,t.extras={ticket_status:{name:e.formInfo.ticket_key,type:e.formInfo.ticket_type}};var a=e.$refs.field.showTabList;t.fields=a.map((function(e){return e.id}));var r=e.configur.id;e.secondClick||(e.secondClick=!0,e.$store.dispatch("deployCommon/updateNode",{params:t,id:r}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$emit("closeConfigur",!0)})).catch((function(t){(0,m.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))}else e.checkStatus.delivers=!0}else e.checkStatus.processors=!0})).catch((function(e){console.log(e)}));case 3:case"end":return t.stop()}}),t,e)})))()},closeNode:function(){this.$emit("closeConfigur",!1)},handleChangeDispose:function(e){this.isShowSignSwitch=!1,this.formInfo.is_sequential=!1,"multi"!==e&&(this.isShowSignSwitch=!0),"sequential"===e&&(this.formInfo.is_sequential=!0)},handleTicket:function(e){this.formInfo.ticket_key="","custom"===e&&(this.secondLevelList.length||this.getSecondLevelList())},operateGroup:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add",n=arguments[1];"del"===t?1===this.finishCondition.expressions.length?this.$bkInfo({type:"warning",title:this.$t("m.treeinfo['确定删除唯一的条件组？']"),subTitle:this.$t("m.treeinfo['若删除，则必须所有人处理完成才结束']"),confirmFn:function(){e.finishCondition.expressions.splice(n,1)}}):this.finishCondition.expressions.splice(n,1):this.finishCondition.expressions.push({expressions:[JSON.parse((0,s.default)(this.emptyExpression))],type:"and"})},operateExpression:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add",n=arguments[2],i=arguments[3],a=arguments[4];if("del"===t){if(1===e.expressions.length)return;0===i&&0===n&&"PROCESS_COUNT"===a.meta.code?this.$bkInfo({type:"warning",title:this.$t("m.treeinfo['确定删除“处理人数”？']"),subTitle:this.$t("m.treeinfo['若删除该条件，则忽略处理人数，条件满足即结束']"),confirmFn:function(){e.expressions.splice(n,1)}}):e.expressions.splice(n,1)}else e.expressions.push(JSON.parse((0,s.default)(this.emptyExpression)))},getAllConditions:function(){var e=this;return(0,c.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.configur.id,e.getConditionFlag=!0,t.next=4,e.$store.dispatch("apiRemote/get_sign_conditions",n).then((function(t){var n=t.data.filter((function(e){return"NODE_APPROVE_RESULT"!==e.meta.code}));e.allCondition=n})).catch((function(t){(0,m.errorHandler)(t,e)})).finally((function(){e.getConditionFlag=!1}));case 4:case"end":return t.stop()}}),t,e)})))()},giveTooltip:function(e){return e.key?"PASS_RATE"===e.meta.code||"REJECT_RATE"===e.meta.code||this.$refs.processors.getValue().value?(e.tooltipInfo.disabled=!0,void(e.tooltipInfo.content="")):(e.tooltipInfo.disabled=!1,void(e.tooltipInfo.content=this.$t("m.treeinfo['请先选择处理人']"))):(e.tooltipInfo.disabled=!1,void(e.tooltipInfo.content=this.$t("m.treeinfo['请先选择条件']")))},setAllTooltip:function(){var e=this;this.finishCondition.expressions.forEach((function(t){t.expressions.forEach((function(t){e.giveTooltip(t)}))}))},selectCondition:function(e){this.changeCondition(e)},changeCondition:function(e){e.meta.code=this.allCondition.find((function(t){return t.key===e.key})).meta.code,e.meta.unit=this.allCondition.find((function(t){return t.key===e.key})).meta.unit||"INT",this.giveTooltip(e)}}}},"1u4o":function(e,t,n){"use strict";n("GXg3")},"1w2S":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this._self._c;return e("div",{staticClass:"no-data"},[e("img",{attrs:{src:this.imgUrl}}),this._v(" "),e("p",{style:{"font-size":this.fontSize+"px"}},[this._v("\n    "+this._s(this.text||this.$t('m.treeinfo["暂无数据"]'))+"\n  ")])])},a=[];i._withStripped=!0},"20vx":function(e,t,n){"use strict";n("8MAP")},"22hR":function(e,t,n){},"25E2":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=L(n("z1yn")),a=L(n("jub7")),r=L(n("Za/z")),o=L(n("u14n")),s=L(n("/KdC")),c=L(n("TNjk")),l=L(n("qyUP")),u=L(n("VrAx")),d=L(n("4K0D")),f=L(n("nxpg")),p=L(n("eOfU")),m=L(n("MBfY")),h=L(n("/Hw/")),v=L(n("Q3ZP")),g=L(n("Wl5c")),y=L(n("0njq")),b=L(n("+QRE")),_=L(n("070I")),k=L(n("gy7N")),w=L(n("aYIO")),I=L(n("SUIt")),$=L(n("BWJp")),S=L(n("PaSM")),C=n("ygAv"),x=n("CeR/");function L(e){return e&&e.__esModule?e:{default:e}}t.default={name:"fieldInfo",components:{"CW-STRING":i.default,"CW-LINK":a.default,"CW-INT":r.default,"CW-TEXT":o.default,"CW-CHECKBOX":s.default,"CW-RADIO":c.default,"CW-SELECT":l.default,"CW-INPUTSELECT":u.default,"CW-MULTISELECT":d.default,"CW-DATE":f.default,"CW-DATETIME":p.default,"CW-MEMBER":m.default,"CW-MEMBERS":h.default,"CW-TABLE":v.default,"CW-CUSTOMTABLE":g.default,"CW-RICHTEXT":y.default,"CW-TREESELECT":b.default,"CW-FILE":_.default,"CW-CASCADE":k.default,"CW-SOPS_TEMPLATE":w.default,"CW-DEVOPS_TEMPLATE":I.default},mixins:[$.default,S.default],props:{fields:{type:Array,required:!0,default:function(){return[]}},allFieldList:{type:Array,default:function(){return[]}},basicInfomation:{type:Object,default:function(){return{}}},origin:{type:String,default:"normal"},typeInfo:{type:String,default:function(){return""}},disabled:{type:Boolean,default:!1}},data:function(){return{rotate:!1,labelWidth:200}},created:function(){var e=this;this.fields.forEach((function(t){e.$set(t,"checkValue",!1)}))},mounted:function(){var e=this;this.$nextTick((function(){e.labelWidth=e.$refs.fieldContent.clientWidth/2||200}))},methods:{freshBtn:function(e){this.rotate=!this.rotate,"CreateTicket"===this.$route.name?this.freshApi(e,this.fields,"submit"):this.freshApi(e,this.fields,"field")},freshRpc:function(e){var t=this;this.rotate=!this.rotate,this.$store.dispatch("apiRemote/getRpcData",e).then((function(t){e.choice=t.data,e.val=""})).catch((function(e){(0,x.errorHandler)(e,t)}))},fieldChange:function(){this.fieldFormatting(this.fields)},checkBuiltInTaskTemplate:function(){var e=this,t=[];return this.fields.forEach((function(n,i){"SOPS_TEMPLATE"!==n.type&&"DEVOPS_TEMPLATE"!==n.type||t.push(e.$refs["component"+i][0].validate())})),t.every((function(e){return!!e}))},jointVerification:function(){var e=this,t=!0;return this.relatedRegex(this.fields,(0,C.isEmpty)(this.allFieldList)?this.fields:this.allFieldList).validList.forEach((function(n){n.result||(t=!1,n.validList.forEach((function(t){var n=e.fields.find((function(e){return e.key===t.key}));n&&!n.checkValue&&(n.checkValue=!0,n.checkMessage=t.tips)})))})),t},requiredVerification:function(){var e=this,t=this.fields.filter((function(e){return e.showFeild&&"REQUIRE"===e.validate_type})).filter((function(e){return"CUSTOMTABLE"===e.type?e.meta.columns.some((function(e){return e.required})):"SOPS_TEMPLATE"!==e.type&&"DEVOPS_TEMPLATE"!==e.type})).filter((function(t){var n=!1;t.checkValue=!1;var i="";switch(t.type){case"TABLE":var a=!0;t.choice.forEach((function(e){""!==t.value[0][e.key]?a=!1:i+=e.name+", "})),n=a,i&&(i+=e.$t('m.newCommon["为必填项！"]'));break;case"CUSTOMTABLE":var r=!1;t.meta.columns.forEach((function(e){return t.value.forEach((function(t){e.required&&(0,C.isEmpty)(t[e.key])&&(i+=e.name+", ",r=!0)}))})),n=r,i&&(i+=e.$t('m.newCommon["为必填项！"]'));break;default:n=(0,C.isEmpty)(t.value)}return i&&(t.checkMessage=i,n=!0),t.checkValue=n,n})),n=this.checkBuiltInTaskTemplate();return!t.length&&n},checkValue:function(){this.fieldChange();var e=this.requiredVerification(),t=this.jointVerification();return e&&t}}}},"29mx":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-date-picker",{class:{"bk-border-error":e.item.checkValue},attrs:{placeholder:e.$t("m.newCommon['选择日期']"),disabled:e.item.is_readonly&&!e.isCurrent||e.disabled},on:{"open-change":function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},"2Mt+":function(e,t,n){"use strict";n.r(t);var i=n("OV2Y"),a=n("TOmV");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("0nzv");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"89121fbe",null);t.default=s.exports},"30Fg":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading},expression:"{ isLoading: loading }"},{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeTree,expression:"closeTree"}],staticClass:"bk-search-tree",class:e.extCls},[t("div",{staticClass:"bk-search-tree-wrapper",on:{click:function(t){return t.stopPropagation(),e.showTree("view")}}},[t("span",{class:{"bk-color-tree":e.displayName}},[e._v("\n      "+e._s(e.displayName||e.$t('m.serviceConfig["请选择"]'))+"\n    ")]),e._v(" "),e.organizationLoading?t("i",{staticClass:"bk-select-angle bk-itsm-icon icon-icon-loading"}):e._e()]),e._v(" "),t("transition",{attrs:{name:"common-fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowTree,expression:"isShowTree"}],staticClass:"bk-search-tree-content"},[t("tree",{attrs:{"tree-data-list":e.displayList},on:{toggle:e.toggleInfo,toggleChildren:function(t){return e.toggleChildren(...arguments,"view")}}})],1)])],1)},a=[];i._withStripped=!0},"31H0":function(e,t,n){"use strict";n("FYiQ")},"34/K":function(e,t,n){"use strict";n.r(t);var i=n("8fx1"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"3Xpq":function(e,t,n){"use strict";n("TlPd")},"3eLr":function(e,t,n){"use strict";n.r(t);var i=n("wpaA"),a=n("g5Ts");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("GHP1");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"75907687",null);t.default=s.exports},"3jvg":function(e,t,n){"use strict";n.r(t);var i=n("j7Oh"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"3nH4":function(e,t,n){"use strict";n("wXXQ")},"3ncw":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("efIh"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"LINK",mixins:[r.default],props:{item:{type:Object,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)}},mounted:function(){this.conditionField(this.item,this.fields),this.item.value&&!this.item.val&&(this.item.val=this.item.value)}}},"429m":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("14Xm")),a=r(n("D3Ub"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"getRpcParam",components:{},props:{prcTable:{type:Array,default:function(){return[]}},changeInfo:{type:Object,default:function(){return{}}},stateList:{type:Array,default:function(){return[]}},formInfo:{type:Object,default:function(){return{}}}},data:function(){return{sourceTypeList:[{id:1,key:"CUSTOM",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"FIELDS",name:this.$t('m.treeinfo["引用变量"]')}]}},computed:{},watch:{prcTable:function(){this.initData()}},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.changeInfo;case 2:e.initData();case 3:case"end":return t.stop()}}),t,e)})))()},methods:{initData:function(){var e=this;this.prcTable.forEach((function(t){for(var n in e.$set(t,"isCheck",!1),e.$set(t,"isSatisfied",!1),e.$set(t,"el",null),e.$set(t,"source_type","CUSTOM"),e.$set(t,"value_key",""),e.changeInfo.meta)t.name===n&&(-1!==e.changeInfo.meta[n].indexOf("{params_")?(t.source_type="FIELDS",t.value_key=e.changeInfo.meta[n].split("${params_")[1].split("}")[0]):(t.source_type="CUSTOM",t.value=e.changeInfo.meta[n]))}))}}}},"45Gy":function(e,t,n){"use strict";n("tnQB")},4855:function(e,t,n){"use strict";n("KLeT")},"4K0D":function(e,t,n){"use strict";n.r(t);var i=n("0Oxo"),a=n("CyHO");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},"4Vln":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{ref:"formEditItem",staticClass:"form-edit-item"},[t("add-field",{ref:"addField",attrs:{"form-align":"horizontal","change-info":e.formData,workflow:e.workflowId,state:e.nodeId,"auto-selected-type":!1},on:{onConfirm:e.onConfirmClick,getAddFieldStatus:e.getAddFieldStatus,onCancel:function(t){return e.$emit("onEditCancel")}}})],1)},a=[];i._withStripped=!0},"4lVZ":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("m1cH")),a=d(n("14Xm")),r=d(n("gDS+")),o=d(n("GQeE")),s=d(n("D3Ub")),c=d(n("BkRI")),l=d(n("VflG")),u=d(n("9ZYk"));function d(e){return e&&e.__esModule?e:{default:e}}t.default={name:"responseData",components:{exportTree:u.default},mixins:[l.default],props:{changeInfo:{type:Object,default:function(){return{}}},apiDetail:{type:Object,default:function(){}},stateList:{type:Array,default:function(){return[]}},remoteApiIid:{type:[String,Number],default:function(){return""}},formInfo:{type:Object,default:function(){return{}}}},data:function(){return{organization:{processorPerson:[],processorTree:{},assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:[!1,!1,!1]},cascaderData:[],bodyTableData:[],responseTableData:[],paramTableData:[],checkInfo:{name:"",road:""},sourceTypeList:[{id:1,key:"CUSTOM",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"FIELDS",name:this.$t('m.treeinfo["引用变量"]')}],paramTableInfo:{value:"",placeholder:this.$t('m.treeinfo["请选择数据来源"]')},selectInfo:{selectkeylist:[],selectkey:"",selectvaluelist:[],selectvalue:""},isShow:!1,tampFormInfo:{ancestorsList_str:"",isSelectedKey:"",isSelectedValue:"",settingKeyName:"",settingValueName:""},isCheck:!1,maxLevel:1,maxLevelTree:[1,1,1],settingKeyName:"",settingValueName:""}},computed:{},watch:{"apiDetail.rsp_data":{handler:function(){this.initData()},deep:!0}},mounted:function(){this.initData()},methods:{initData:function(){this.responseTableDataChange()},responseTableDataChange:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n,i,l,u,d,f,p,m;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.selectInfo={selectkeylist:[],selectkey:"",selectvaluelist:[],selectvalue:""},e.organization={processorPerson:[],processorTree:{},assignorPerson:[],assignorTree:{}},e.maxLevel=1,e.maxLevelTree=[1,1,1],e.settingKeyName="",e.settingValueName="",t.next=8,e.changeInfo;case 8:if((0,o.default)(e.apiDetail.rsp_data).length){t.next=13;break}e.apiDetail.responseTreeDataList=[{has_children:!1,showChildren:!0,checkInfo:!1,key:"root",is_necessary:!0,type:"object",desc:e.$t('m.treeinfo["初始化数据"]'),parentInfo:"",children:[]}],e.apiDetail.responseTableData=[],t.next=19;break;case 13:return t.next=15,e.jsonschemaToList({root:JSON.parse((0,r.default)(e.apiDetail.rsp_data))});case 15:return e.apiDetail.responseTreeDataList=t.sent,t.next=18,e.treeToTableList(JSON.parse((0,r.default)(e.apiDetail.responseTreeDataList[0].children)));case 18:e.apiDetail.responseTableData=t.sent;case 19:return t.next=21,JSON.parse((0,r.default)(e.apiDetail.responseTableData));case 21:return n=t.sent,t.next=24,n.forEach((function(t){t.children=[],t.source_type="CUSTOM",t.value="",t.name=t.key,t.isSelectAbled=!1,t.isSelectedKey=!1,t.isSelectedKeyDisabled=!1,t.isSelectedValue=!1,t.isSelectedValueDisabled=!e.changeInfo.api_info}));case 24:return t.next=26,e.recordChildren(n);case 26:return t.next=28,e.recordParent(n);case 28:return t.next=30,e.showSelectAbled(n);case 30:return i=t.sent,t.next=33,i.forEach(function(){var t=(0,s.default)(a.default.mark((function t(n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.markCanUseArray(n);case 2:case"end":return t.stop()}}),t,e)})));return function(e){return t.apply(this,arguments)}}());case 33:return t.next=35,n;case 35:return e.responseTableData=t.sent,l=e.responseTableData.filter((function(e){return!e.level&&"data"===e.key})),t.next=39,e.makeArrayTree(l);case 39:if(e.cascaderData=t.sent,e.organization.assignorPerson=e.cascaderData[0]||[],!e.changeInfo.api_info||e.changeInfo.api_info.remote_api_id!==e.apiDetail.id){t.next=64;break}return t.next=44,e.changeInfo.api_info.rsp_data.split(".");case 44:return u=t.sent,t.next=47,u.map((function(e,t){return e=t+"_"+e}));case 47:return d=t.sent,f=d.length+"_items_0",d.push(f),p=d.concat(e.changeInfo.kv_relation.key.split(".").map((function(e,t){return d.length+t+"_"+e}))).join(),m=d.concat(e.changeInfo.kv_relation.name.split(".").map((function(e,t){return d.length+t+"_"+e}))).join(),e.tampFormInfo.ancestorsList_str=d.toString(),e.responseTableData.forEach((function(t){t.ancestorsList_str===p&&(t.isSelectedKey=!0,e.tampFormInfo.isSelectedKey=t.ancestorsList_str,e.tampFormInfo.settingKeyName=t.name),t.ancestorsList_str===m&&(t.isSelectedValue=!0,e.tampFormInfo.isSelectedValue=t.ancestorsList_str,e.tampFormInfo.settingValueName=t.name)})),t.next=56,e.organization.assignorPerson.forEach((function(t){e.treeData(t,"assignors")}));case 56:e.selectInfo.selectkeylist=e.responseTableData.filter((function(e){return e.ancestorsList.join()===d.join()})),e.selectInfo.selectkey=e.tampFormInfo.isSelectedKey,e.selectInfo.selectvaluelist=(0,c.default)(e.selectInfo.selectkeylist),e.selectInfo.selectvalue=e.tampFormInfo.isSelectedValue,e.settingValueName=e.tampFormInfo.settingValueName,e.settingKeyName=e.tampFormInfo.settingKeyName,e.giveFirstCheckInfo(e.selectInfo.selectkeylist,p),e.giveFirstCheckInfo(e.selectInfo.selectvaluelist,m);case 64:case"end":return t.stop()}}),t,e)})))()},giveFirstCheckInfo:function(e,t){var n=this;e.forEach((function(e){e.ancestorsList_str===t&&(e.checkInfo=!0),e.has_children&&e.children.length&&"object"===e.type&&n.giveFirstCheckInfo(e.children,t)}))},treeData:function(e,t){var n=this;e.checkInfo=!1,e.has_children=!(!e.children||!e.children.length),e.showChildren=!0,String(this.tampFormInfo.ancestorsList_str.split(",").slice(0,-1).toString())===String(e.ancestorsList_str)&&"assignors"===t&&(e.checkInfo=!0,this.organization.assignorTree=e),e.has_children&&e.children.forEach((function(e){n.treeData(e,t)}))},recordChildren:function(e,t){var n=e.map((function(e){return e.level}));this.maxLevel=Math.max.apply(Math,(0,i.default)(n));for(var a=function(t){e.filter((function(e){return e.level===t})).forEach((function(t){!function(e,t){e.filter((function(e){return e.level===t.level-1&&e.primaryKey===t.parentPrimaryKey&&e.ancestorsList.toString()===t.ancestorsList.slice(0,-1).toString()}))[0].children.push(t)}(e,t)}))},r=this.maxLevel;r>(t||0);r--)a(r)},recordParent:function(e,t){for(var n=this.maxLevel,i=function(t){e.filter((function(e){return e.level===t})).forEach((function(t){!function(e,t){t.level?t.parentInfo=e.filter((function(e){return e.level===t.level-1&&e.primaryKey===t.parentPrimaryKey&&e.ancestorsList.toString()===t.ancestorsList.slice(0,-1).toString()}))[0]:t.parentInfo=""}(e,t)}))},a=0;a<=(t||n);a++)i(a)},markCanUseArray:function(e){e.isCanUseArray=!0,e.level&&this.markCanUseArray(e.parentInfo)},makeArrayTree:function(e){var t=[];return function e(t,n){n.forEach((function(i){n.name=i.name,n.isSelect=!1,n.ancestorsList_str=i.ancestorsList_str;var a=i.children;n.children=[],t.push(n),a&&a.length&&e(n.children,a)}))}(t,e),t},changeState:function(e){e.showChildren=!e.showChildren,e.children.forEach((function(t){t.isShow=e.showChildren})),e.showChildren||this.closeChildren(e)},closeChildren:function(e){var t=this;e.children.forEach((function(e){e.isShow=!1,e.has_children&&(e.showChildren=!1,t.closeChildren(e))}))},changeType:function(){},selectOneKey:function(e){var t=e.isSelectedKey;this.responseTableData.forEach((function(e){e.isSelectedKey=!1})),e.isSelectedKey=!t,this.responseTableData.filter((function(e){return e.isSelectAbled})).forEach((function(t){t.isSelectedKeyDisabled=!1,t.isSelectedValueDisabled=t.parentInfo!==e.parentInfo})),this.responseTableData.filter((function(t){return t.isSelectAbled&&t.parentInfo!==e.parentInfo})).forEach((function(e){e.isSelectedValue=!1}))},selectOneValue:function(e){var t=e.isSelectedValue;this.responseTableData.forEach((function(e){e.isSelectedValue=!1})),e.isSelectedValue=!t},countArrayAncestors:function(e){var t=[];return function e(n){"array"===n.parentInfo.type&&(t.push(n.parentInfo),e(n.parentInfo)),"object"===n.parentInfo.type&&e(n.parentInfo)}(e),t},showSelectAbled:function(e){var t=this;return(0,s.default)(a.default.mark((function n(){var i,r;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=[],r=e.filter((function(e){return"array"!==e.type&&"object"!==e.type&&e.level&&(!e.children||!e.children.length)&&-1!==e.ancestorsList.indexOf("0_data")})),r.filter((function(e){var n=t.countArrayAncestors(e),a=1===n.length&&("array"===e.parentInfo.type||"array"===e.parentInfo.parentInfo.type);return a&&-1===i.indexOf(n[0])&&i.push(n[0]),a})).forEach((function(e){e.isSelectAbled=!0})),n.abrupt("return",i);case 5:case"end":return n.stop()}}),n,t)})))()},showTree:function(e){if(e){var t=this.selectInfo.selectkeylist.map((function(e){return e.level}));this.$set(this.maxLevelTree,1,Math.max.apply(Math,(0,i.default)(t))-1),this.$set(this.maxLevelTree,2,Math.max.apply(Math,(0,i.default)(t))-1)}else{var n=this.organization.assignorPerson.map((function(e){return e.level}));this.$set(this.maxLevelTree,0,Math.max.apply(Math,(0,i.default)(n))-1)}for(var a=this.organizaInfo.assignorShow[e],r=0;r<3;r++)this.$set(this.organizaInfo.assignorShow,r,!1);this.$set(this.organizaInfo.assignorShow,e,!a)},closeOther0:function(){this.$set(this.organizaInfo.assignorShow,0,!1)},closeOther1:function(){this.$set(this.organizaInfo.assignorShow,1,!1)},closeOther2:function(){this.$set(this.organizaInfo.assignorShow,2,!1)},recordCheckFn:function(e){var t=this;e.checkInfo=!1,null===e.children||e.children&&!e.children.length||e.children.forEach((function(e){t.recordCheckFn(e)}))},assignorToggle:function(e,t){var n=this;"object"===e.type||t&&"array"===e.type||(t?1===t?(this.selectInfo.selectkeylist.forEach((function(e){n.recordCheckFn(e)})),this.selectInfo.selectkey=e.ancestorsList_str,this.settingKeyName=e.name,this.responseTableData.forEach((function(e){e.isSelectedKey=!1})),this.responseTableData.filter((function(t){return t.ancestorsList_str===e.ancestorsList_str}))[0].isSelectedKey=!0):(this.selectInfo.selectvaluelist.forEach((function(e){n.recordCheckFn(e)})),this.selectInfo.selectvalue=e.ancestorsList_str,this.settingValueName=e.name,this.responseTableData.forEach((function(e){e.isSelectedValue=!1})),this.responseTableData.filter((function(t){return t.ancestorsList_str===e.ancestorsList_str}))[0].isSelectedValue=!0):(this.organization.assignorPerson.forEach((function(e){n.recordCheckFn(e)})),this.selectInfo.selectkeylist=e.children[0].children,this.selectInfo.selectvaluelist=(0,c.default)(this.selectInfo.selectkeylist),this.organization.assignorTree=e,this.tampFormInfo.assignors=e.id,this.checkInfo.assignors=!1),e.checkInfo=!0,this.closeTree(t))},closeTree:function(e){this.$set(this.organizaInfo.assignorShow,e,!1)},toggleChildren:function(){arguments[0].showChildren=!arguments[0].showChildren}}}},"5/Zn":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"CASCADE",props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,required:!0,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{firstShow:!1,firstInfo:this.item.val,firstList:[],secondInfo:"",firstPlace:this.$t('m.newCommon["请选择所属的厅委办"]'),secondPlace:this.$t('m.newCommon["请选择所属业务"]'),clickChange:!1}},computed:{changeFields:function(){return this.fields}},watch:{"item.val":function(){this.changeInfo()}},mounted:function(){this.changeInfo()},methods:{itemSelect:function(e){var t=this.item.choice.filter((function(t){return t.key===e}))[0];this.clickInfo=!0,this.firstShow=!!t.items,this.firstInfo=e,this.item.val=this.firstShow?"":e,this.firstList=t.items,this.secondInfo="",this.clickChange=!0},changeFrist:function(e){this.secondInfo=e,this.item.val=this.secondInfo},changeInfo:function(){if(this.clickChange)this.clickChange=!1;else if(this.item.val){this.firstShow=!1,this.firstList=[];for(var e=!0,t=0;t<this.item.choice.length;t++)if(String(this.item.choice[t].key)===String(this.item.val)){this.firstInfo=this.item.val,e=!1,this.firstShow=!!this.item.choice[t].items;break}if(e)for(var n=0;n<this.item.choice.length;n++)if(this.item.choice[n].items){var i=this.item.choice[n].items;this.firstShow=!0,this.firstInfo===this.item.choice[n].key&&(this.firstList=i);for(var a=0;a<i.length;a++)if(String(i[a].key)===String(this.item.val)){this.firstList=i,this.secondInfo=this.item.val,this.firstInfo=this.item.choice[n].key;break}}}else this.firstShow=!1,this.firstList=[],this.firstInfo=""}}}},"50No":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"service-form",class:{"hide-field-option":!e.showFieldOption}},[t("div",{class:["field-option",e.isShowField?"field-hide":""]},[t("div",{staticStyle:{overflow:"hidden",height:"100%"}},[t("div",{staticClass:"field-type"},[e._v(e._s(e.$t("m['字段类型']")))]),e._v(" "),t("div",{staticClass:"show-field",on:{click:e.handleShowField}},[t("i",{class:["bk-itsm-icon",e.isShowField?"icon-xiangyou1":"icon-xiangzuo1"]})]),e._v(" "),t("div",{staticStyle:{display:"flex",height:"calc(100% - 100px)","flex-direction":"column"}},[t("div",{staticClass:"field-content"},[t("div",{staticClass:"field-title"},[t("span",[e._v(e._s(e.$t("m['控件库']")))]),e._v(" "),t("bk-input",{staticClass:"search-field",attrs:{size:"small","right-icon":"bk-icon icon-search"},on:{enter:e.handleSearchLibrary}})],1),e._v(" "),t("ul",{staticClass:"field-list"},e._l(e.fieldsLibrary,(function(n,i){return t("li",{key:i,staticClass:"field-item",on:{click:function(t){return e.onAddFormClick(n)}}},[t("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.light",value:n.name,expression:"field.name",modifiers:{light:!0}}],staticClass:"field-name"},[e._v(e._s(n.name))])])})),0),e._v(" "),0===e.fieldsLibrary.length?t("div",{staticClass:"public-field"},[t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-four-zero",staticStyle:{"font-size":"14px"}}),e._v(" 已有字段不存在你搜索的内容")]):e._e()]),e._v(" "),t("div",{staticClass:"field-content"},[t("div",{staticClass:"field-title"},[t("span",[e._v(e._s(e.$t("m['已有字段']")))]),e._v(" "),t("bk-input",{staticClass:"search-field",attrs:{size:"small","right-icon":"bk-icon icon-search"},on:{enter:e.handleSearchField}})],1),e._v(" "),t("ul",{staticClass:"field-list"},e._l(e.publicFields,(function(n,i){return t("li",{key:i,staticClass:"field-item",on:{click:function(t){return e.addField(n)}}},[t("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.light",value:n.name,expression:"field.name",modifiers:{light:!0}}],staticClass:"field-name"},[e._v(e._s(n.name))])])})),0),e._v(" "),0===e.publicFields.length?t("div",{staticClass:"public-field"},[t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-four-zero",staticStyle:{"font-size":"14px"}}),e._v(" 已有字段不存在你搜索的内容")]):e._e()])])])]),e._v(" "),t("div",{staticClass:"basic-body"},[t("section",{staticClass:"settion-card create-info-card",attrs:{"data-test-id":"servie_section_serviceticketInformation"}},[e.showFieldOption?e._e():t("div",{staticClass:"service-template"},e._l(e.serviceFormCreateWays.slice(0,2),(function(n,i){return t("div",{key:i,staticClass:"template-type",attrs:{"data-test-id":"servie_section_QuicklyCreateForm"},on:{click:function(t){return e.onCreateFormWayCLick(n)}}},[t("i",{staticClass:"bk-itsm-icon icon-it-new-globalview"}),e._v(" "),t("span",[e._v(e._s(n.name))])])})),0),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.formLoading},expression:"{ isLoading: formLoading }"}],staticClass:"create-service-form"},[t("div",[t("ServiceForm",{ref:"serviceForm",attrs:{"add-field-status":e.addFieldStatus,"service-info":e.serviceInfo,"node-id":e.createTicketNodeId,forms:e.ticketNodeForm,"crt-form":e.crtForm},on:{"update:crtForm":function(t){e.crtForm=t},"update:crt-form":function(t){e.crtForm=t},dragUpdateList:e.dragUpdateList,onAddFormClick:e.onAddFormClick,addField:e.addField,onFormEditClick:e.onFormEditClick,cancelAdd:e.cancelAddField,fieldClone:e.fieldClone,fieldDelete:e.fieldDelete,saveField:e.saveField}})],1)])])]),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.crtForm,expression:"crtForm"}],staticClass:"drag-line",on:{mousedown:e.handleDragLine}}),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.crtForm,expression:"crtForm"}],staticClass:"edit-service-field"},[t("div",{staticClass:"edit-service-title"},[e._v(e._s(e.$t("m['字段属性']")))]),e._v(" "),t("div",{staticClass:"edit-service-forms"},[e._l(e.ticketNodeForm,(function(n){return[n.id===e.crtForm?t("form-edit-item",{key:n.id,attrs:{fields:e.ticketNodeForm,form:n,"workflow-id":e.serviceInfo.workflow_id,"node-id":e.createTicketNodeId},on:{onEditCancel:e.onEditCancel,getAddFieldStatus:e.getAddFieldStatus,onEditConfirm:e.onEditConfirm}}):e._e()]}))],2)]),e._v(" "),t("bk-dialog",{attrs:{width:"800",value:e.isCreateService,"mask-close":!1,title:e.$t("m['创建服务']"),"auto-close":!1},on:{confirm:e.onBasicFormSubmit,cancel:e.onBasicFormCancel}},[t("bk-form",{ref:"basicForm",staticClass:"basic-form",attrs:{"form-type":"vertical","label-width":300,rules:e.rules,model:e.formData}},[t("bk-form-item",{attrs:{"data-test-id":"service-input-serviceName",label:e.$t("m.newCommon['服务名称']"),required:!0,property:"name","error-display-type":"normal"}},[t("bk-input",{attrs:{maxlength:100,"show-word-limit":!0},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.serviceConfig['服务描述']"),property:"desc"}},[t("bk-input",{attrs:{type:"textarea",row:3,maxlength:255},model:{value:e.formData.desc,callback:function(t){e.$set(e.formData,"desc",t)},expression:"formData.desc"}})],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"service-select-serviceDirectory",label:e.$t("m.tickets['所属目录']"),required:!0,property:"catalog_id","error-display-type":"normal"}},[t("select-tree",{attrs:{list:e.dirList,"ext-cls":"bk-form-width"},model:{value:e.formData.catalog_id,callback:function(t){e.$set(e.formData,"catalog_id",t)},expression:"formData.catalog_id"}})],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"service-select-serviceType",label:e.$t("m.serviceConfig['服务类型']"),required:!0,property:"key","error-display-type":"normal"}},[t("bk-select",{attrs:{placeholder:e.$t("m.serviceConfig['请选择服务类型']"),clearable:!1,searchable:"","font-size":"medium"},model:{value:e.formData.key,callback:function(t){e.$set(e.formData,"key",t)},expression:"formData.key"}},e._l(e.serviceTypeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],1)],1),e._v(" "),t("choose-service-template-dialog",{attrs:{"is-show":e.isShowChooseSerTempDialog,"create-info":e.currCreateFormWay,"service-id":e.serviceId},on:{"update:isShow":function(t){e.isShowChooseSerTempDialog=t},"update:is-show":function(t){e.isShowChooseSerTempDialog=t},updateServiceSource:e.updateServiceSource}})],1)},a=[];i._withStripped=!0},"5Pf/":function(e,t,n){"use strict";n.r(t);var i=n("7yQo"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"5R1Y":function(e,t,n){"use strict";n.r(t);var i=n("lR6s"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"5WyB":function(e,t,n){"use strict";n.r(t);var i=n("9g2r"),a=n("uR5J");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("w5Ae");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"411e2dcc",null);t.default=s.exports},"5eUO":function(e,t,n){"use strict";n("qCVH")},"5f0d":function(e,t,n){"use strict";n("zcr8")},"5ghl":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-basic-node"},[t("basic-card",[t("basic-info",{ref:"basic",attrs:{"node-info":e.configur,"node-tag-list":e.nodeTagList,"is-loading":e.isLoading,"flow-info":e.flowInfo},on:{baseFormInfoChange:e.baseFormInfoChange}}),e._v(" "),t("field-config",{ref:"field",attrs:{"is-show-title":!0,"flow-info":e.flowInfo,configur:e.configur}}),e._v(" "),t("common-trigger-list",{ref:"commonTriggerList",attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"bk-node-btn mt20"},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"basicNode-button-submit",title:e.$t("m.treeinfo['确定']"),loading:e.secondClick},on:{click:e.submitNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['确定']"))+"\n      ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"basicNode-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['取消']"))+"\n      ")])],1)],1)],1)},a=[];i._withStripped=!0},"5hmv":function(e,t,n){"use strict";n.r(t);var i=n("eM+a"),a=n("kQq5");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("l3JT");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},"5xyE":function(e,t,n){"use strict";n("ZbRn")},"65Fp":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-field-info mb20"},[e.isShowTitle?t("p",{staticClass:"bk-field-title"},[e._v(e._s(e.$t("m['字段配置']")))]):e._e(),e._v(" "),t("div",{staticClass:"bk-node-btn"},["APPROVAL"!==e.configur.type?t("bk-button",{staticClass:"mr10",attrs:{"data-test-id":"fieldConfig-button-addField",theme:"default",title:e.$t("m.treeinfo['新增字段']")},on:{click:e.addField}},[e._v("\n      "+e._s(e.$t("m.treeinfo['新增字段']"))+"\n    ")]):e._e(),e._v(" "),"APPROVAL"===e.configur.type||"SIGN"===e.configur.type||e.templateStage?e._e():t("bk-button",{staticClass:"mr10",attrs:{"data-test-id":"fieldConfig-button-addModelField",theme:"default",title:e.$t("m.treeinfo['选择模型字段']")},on:{click:e.openAddModule}},[e._v("\n      "+e._s(e.$t("m.treeinfo['选择模型字段']"))+"\n    ")]),e._v(" "),t("bk-button",{staticClass:"mr10",staticStyle:{float:"right",border:"0"},attrs:{theme:"default","data-test-id":"fieldConfig-button-previewField",title:e.$t("m.treeinfo['字段预览']"),disabled:!e.showTabList.length},on:{click:e.previewField}},[t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-three",staticStyle:{"font-size":"16px"}}),e._v("\n      "+e._s(e.$t("m.treeinfo['字段预览']"))+"\n    ")])],1),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}],staticClass:"mt15 bk-draggable"},[t("table",{staticClass:"bk-draggable-table"},[t("thead",[t("tr",[t("th",[e._v(e._s(e.$t('m.treeinfo["字段名称"]')))]),e._v(" "),t("th",{staticStyle:{"max-width":"150px"}},[e._v(e._s(e.$t('m.treeinfo["唯一标识"]')))]),e._v(" "),t("th",[e._v(e._s(e.$t('m.treeinfo["字段类型"]')))]),e._v(" "),t("th",[e._v(e._s(e.$t('m.treeinfo["是否只读"]')))]),e._v(" "),t("th",{staticStyle:{"min-width":"50px"}},[e._v(e._s(e.$t('m.treeinfo["布局"]')))]),e._v(" "),t("th",{staticStyle:{"max-width":"100px"}},[e._v(e._s(e.$t('m.treeinfo["字段描述"]')))]),e._v(" "),t("th",[e._v(e._s(e.$t('m.treeinfo["是否必填"]')))]),e._v(" "),t("th",[e._v(e._s(e.$t('m.treeinfo["更新人"]')))]),e._v(" "),t("th",[e._v(e._s(e.$t('m.treeinfo["操作"]')))])])]),e._v(" "),t("draggable",{attrs:{tag:"tbody",handle:".move-handler-content"},on:{end:e.updateInfo},model:{value:e.showTabList,callback:function(t){e.showTabList=t},expression:"showTabList"}},[e.showTabList.length?e._l(e.showTabList,(function(n,i){return t("tr",{key:i},[t("td",{staticClass:"move-handler-content"},[t("span",[t("i",{staticClass:"bk-itsm-icon icon-move-new move-handler"}),e._v(e._s(n.name))])]),e._v(" "),t("td",{staticStyle:{"max-width":"150px"},attrs:{title:n.key}},[e._v("\n              "+e._s(n.key)+"\n            ")]),e._v(" "),t("td",[e._v("\n              "+e._s(n.typeName||"--")+"\n            ")]),e._v(" "),t("td",{staticStyle:{"max-width":"100px"},attrs:{title:n.is_readonly?e.$t("m.treeinfo['是']"):e.$t("m.treeinfo['否']")}},[e._v("\n              "+e._s(n.is_readonly?e.$t('m.treeinfo["是"]'):e.$t('m.treeinfo["否"]'))+"\n            ")]),e._v(" "),t("td",{staticStyle:{"min-width":"50px"}},[e._v("\n              "+e._s("COL_6"===n.layout?e.$t('m.treeinfo["半行"]'):e.$t('m.treeinfo["整行"]'))+"\n            ")]),e._v(" "),t("td",{staticStyle:{"max-width":"100px"},attrs:{title:n.desc}},[t("pre",[t("span",[e._v(e._s(n.desc||"--"))])])]),e._v(" "),t("td",[e._v("\n              "+e._s(n.is_required||"--")+"\n            ")]),e._v(" "),t("td",[e._v("\n              "+e._s(n.updated_by||"--")+"\n            ")]),e._v(" "),t("td",[t("bk-button",{staticClass:"table-opt-button",attrs:{theme:"primary",disabled:e.checkEditDisabled(n),text:""},on:{click:function(t){return e.openField(n)}}},[e._v("\n                "+e._s(e.$t('m.user["编辑"]'))+"\n              ")]),e._v(" "),t("bk-button",{staticClass:"table-opt-button",attrs:{theme:"primary",disabled:e.checkDeleteDisabled(n),text:""},on:{click:function(t){return e.deleteTable(n)}}},[e._v("\n                "+e._s(e.$t('m.user["删除"]'))+"\n              ")])],1)])})):[t("tr",{},[t("td",{staticClass:"bk-none-content",attrs:{colspan:"10"}},[t("i",{staticClass:"bk-table-empty-icon bk-icon icon-empty"}),e._v(" "),t("p",{staticClass:"bk-none-info"},[e._v(e._s(e.$t('m.treeinfo["暂无数据"]')))])])])]],2)],1)]),e._v(" "),t("bk-dialog",{attrs:{width:"760",position:e.processInfo.position,draggable:e.processInfo.draggable,title:e.processInfo.title,"render-directive":"if","ext-cls":"bk-preview-overflow"},model:{value:e.processInfo.isShow,callback:function(t){e.$set(e.processInfo,"isShow",t)},expression:"processInfo.isShow"}},[t("field-preview",{attrs:{fields:e.previewTab}}),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("bk-button",{attrs:{theme:"default"},on:{click:function(t){e.processInfo.isShow=!1}}},[e._v("\n        "+e._s(e.$t('m.home["取消"]'))+"\n      ")])],1)],1),e._v(" "),t("bk-sideslider",{attrs:{"is-show":e.sliderInfo.show,"quick-close":!0,title:e.sliderInfo.title,width:e.sliderInfo.width,"before-close":e.handleBeforeClose},on:{"update:isShow":function(t){return e.$set(e.sliderInfo,"show",t)},"update:is-show":function(t){return e.$set(e.sliderInfo,"show",t)}}},[e.sliderInfo.show?t("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},[t("add-field",{attrs:{"change-info":e.changeInfo,"template-info":e.templateInfo,"template-stage":e.templateStage,"nodes-list":e.nodesList,"add-origin":e.addOrigin,"table-list":e.showTabList,"is-edit-public":e.isEditPublic,workflow:e.flowInfo?e.flowInfo.id:0,state:e.configur.id?e.configur.id:0},on:{change:function(t){e.isFormChanged=!0},closeShade:e.closeShade}})],1):e._e()]),e._v(" "),t("bk-dialog",{attrs:{"render-directive":"if",width:e.moduleInfo.width,"header-position":e.moduleInfo.headerPosition,loading:e.secondClick,"auto-close":e.moduleInfo.autoClose,"mask-close":e.moduleInfo.autoClose},on:{confirm:e.submitModule},model:{value:e.moduleInfo.isShow,callback:function(t){e.$set(e.moduleInfo,"isShow",t)},expression:"moduleInfo.isShow"}},[t("p",{attrs:{slot:"header"},slot:"header"},[e._v(e._s(e.$t('m.treeinfo["选择模型字段"]')))]),e._v(" "),t("div",{staticClass:"bk-add-module"},[t("inherit-state",{ref:"inheritState",attrs:{workflow:e.flowInfo?e.flowInfo.id:0,state:e.configur.id?e.configur.id:0,configur:e.configur,"show-tab-list":e.showTabList}})],1)])],1)},a=[];i._withStripped=!0},"676K":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-trigger-condition"},[t("div",{staticClass:"bk-condition-name"},[t("span",[e._v(e._s(e.$t("m.trigger['触发条件']")))])]),e._v(" "),t("div",{staticClass:"bk-condition-content",on:{click:function(t){e.triggerRules.checkStatus=!1}}},[t("ul",{staticClass:"bk-content-step"},[e._l(e.triggerRules.list,(function(n,i){return t("li",{key:i,staticClass:"bk-content-li"},[t("ul",{staticClass:"bk-content-item",class:{"bk-more-margin":1!==n.itemList.length}},e._l(n.itemList,(function(i,a){return t("li",{key:a,staticClass:"bk-content-item-li",class:{"bk-none-margin":n.itemList.length-1===a}},[1!==n.itemList.length?[a!==n.itemList.length-1?t("div",{staticClass:"bk-content-type",on:{click:function(t){return e.changeBetween(n)}}},[t("span",[e._v(e._s("all"===n.type?e.$t("m.trigger['且']"):e.$t("m.trigger['或']")))]),e._v(" "),t("i",{staticClass:"bk-icon icon-down-shape"})]):e._e(),e._v(" "),t("div",{staticClass:"bk-item-line"}),e._v(" "),0===a?t("div",{staticClass:"bk-item-line-none bk-item-none"}):e._e(),e._v(" "),a===n.itemList.length-1?t("div",{staticClass:"bk-item-line-none bk-item-none-bottom"}):e._e()]:e._e(),e._v(" "),t("bk-select",{staticStyle:{width:"190px"},attrs:{"ext-cls":"bk-item-float",clearable:!1,searchable:""},on:{change:function(t){return e.changeContent(i)}},model:{value:i.key,callback:function(t){e.$set(i,"key",t)},expression:"node.key"}},e._l(e.keyList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),t("bk-select",{staticStyle:{width:"140px"},attrs:{"ext-cls":"bk-item-float",clearable:!1,searchable:""},on:{selected:function(t){return e.changeCondition(i)}},model:{value:i.condition,callback:function(t){e.$set(i,"condition",t)},expression:"node.condition"}},e._l(i.conditionList,(function(e){return t("bk-option",{key:e.name,attrs:{id:e.name,name:e.label}})})),1),e._v(" "),"none"!==i.conditionType?[t("trigger-field",{staticStyle:{width:"170px",float:"left","margin-right":"8px"},attrs:{item:i}})]:e._e(),e._v(" "),t("div",{staticClass:"bk-between-operat"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addLine(n,i,a)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===n.itemList.length},on:{click:function(t){return e.deleteLine(n,i,a)}}})])],2)})),0),e._v(" "),t("i",{staticClass:"bk-icon icon-close-circle-shape",class:{"bk-no-delete":1===e.triggerRules.list.length},on:{click:function(t){return e.deleteGroup(n,i)}}}),e._v(" "),t("div",{staticClass:"bk-content-type",on:{click:e.handleBetween}},[t("span",[e._v(e._s("all"===e.triggerRules.type?e.$t("m.trigger['且']"):e.$t("m.trigger['或']")))]),e._v(" "),t("i",{staticClass:"bk-icon icon-down-shape"})]),e._v(" "),t("div",{staticClass:"bk-item-line"}),e._v(" "),0===i?t("div",{staticClass:"bk-item-line-none bk-item-none"}):e._e(),e._v(" "),1!==n.itemList.length?t("div",{staticClass:"bk-content-line"}):e._e()])})),e._v(" "),t("li",{staticClass:"bk-content-add"},[t("span",{on:{click:e.addGroup}},[t("i",{staticClass:"bk-icon icon-plus-circle mr5"}),t("span",[e._v(e._s(e.$t("m.trigger['添加']")))])]),e._v(" "),t("div",{staticClass:"bk-item-line"}),e._v(" "),t("div",{staticClass:"bk-item-line-none",class:{"bk-item-over-line":e.triggerRules.checkStatus}})])],2),e._v(" "),t("div",{staticClass:"bk-content-line"}),e._v(" "),e.triggerRules.checkStatus?t("p",{staticClass:"bk-error-info"},[e._v(e._s(e.$t("m.trigger['请填写完整的触发条件']")))]):e._e()])])},a=[];i._withStripped=!0},"6DoO":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.formInfo.api_info&&e.lineInfo.expressions?t("div",{staticClass:"bk-polling"},[t("div",{staticClass:"bk-service-name mt20"},[t("div",{staticClass:"mt20"},[t("bk-switcher",{attrs:{size:"small"},model:{value:e.formInfo.api_info.need_poll,callback:function(t){e.$set(e.formInfo.api_info,"need_poll",t)},expression:"formInfo.api_info.need_poll"}})],1)]),e._v(" "),t("div",{staticClass:"bk-line-form"},[e.formInfo.api_info.need_poll?[t("div",{staticClass:"bk-service-name"},[t("h1",{staticStyle:{"padding-left":"10px"}},[t("span",[e._v(e._s(e.$t('m.treeinfo["条件组间关系"]')))]),e._v(" "),t("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.$t("m.treeinfo['当所有条件组都满足且/或的条件组时，轮询才会结束']"),expression:"$t(`m.treeinfo['当所有条件组都满足且/或的条件组时，轮询才会结束']`)",modifiers:{top:!0}}],staticClass:"top-middle"},[t("i",{staticClass:"bk-itsm-icon icon-icon-info"})])])]),e._v(" "),t("div",{staticClass:"bk-hidden-conditions"},[t("div",{staticClass:"bk-form-content",staticStyle:{"margin-left":"0"}},[t("bk-radio-group",{model:{value:e.lineInfo.between,callback:function(t){e.$set(e.lineInfo,"between",t)},expression:"lineInfo.between"}},[t("bk-radio",{attrs:{value:"and","ext-cls":"mr20"}},[e._v(e._s(e.$t("m.treeinfo['且']")))]),e._v(" "),t("bk-radio",{attrs:{value:"or"}},[e._v(e._s(e.$t("m.treeinfo['或']")))])],1)],1)])]:e._e(),e._v(" "),e.formInfo.api_info.need_poll&&e.lineInfo.expressions&&e.lineInfo.expressions.length?[e._l(e.lineInfo.expressions,(function(n,i){return t("div",{key:i,staticClass:"bk-form-content"},[t("p",{staticClass:"bk-between-title"},[e._v(e._s("and"===e.lineInfo.between?e.$t("m.treeinfo['且']"):e.$t('m.treeinfo["或"]'))+e._s(e.$t('m.treeinfo["-条件组"]'))+e._s(i+1))]),e._v(" "),t("div",{staticClass:"bk-between-info"},[t("p",[t("span",{staticClass:"bk-between-span"},[e._v(e._s(e.$t('m.treeinfo["字段间关系"]')))]),e._v(" "),t("bk-radio-group",{staticStyle:{width:"auto"},model:{value:n.type,callback:function(t){e.$set(n,"type",t)},expression:"item.type"}},[t("bk-radio",{staticClass:"mr10",attrs:{value:"and"}},[e._v(e._s(e.$t('m.treeinfo["且"]')))]),e._v(" "),t("bk-radio",{attrs:{value:"or"}},[e._v(e._s(e.$t('m.treeinfo["或"]')))])],1)],1),e._v(" "),e._l(n.expressions,(function(i,a){return t("div",{key:a,staticClass:"bk-between-form",on:{click:function(e){n.checkInfo=!1}}},[t("div",{staticStyle:{width:"210px",float:"left","margin-right":"10px",background:"white"}},[t("div",{directives:[{name:"click-outside",rawName:"v-click-outside",value:e.closeOther,expression:"closeOther"}],staticClass:"bk-search-tree bk-form-width"},[t("div",{staticClass:"bk-search-tree-wrapper",on:{click:function(t){return t.stopPropagation(),e.showTree(i)}}},[t("span",{class:{"bk-color-tree":i.organization&&i.organization.assignorTree.name}},[e._v("\n                    "+e._s(i.organization&&i.organization.assignorTree.name?i.organization.assignorTree.name:e.$t('m.treeinfo["请选择"]'))+"\n                  ")]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})]),e._v(" "),t("transition",{attrs:{name:"common-fade"}},[i.organizaInfo&&i.organizaInfo.assignorShow?t("div",{staticClass:"bk-search-tree-content"},[t("export-tree",{attrs:{"tree-data-list":i.organization.assignorPerson},on:{toggle:function(t){return e.assignorToggle(...arguments,i)},toggleChildren:function(t){return e.toggleChildren(...arguments,i)}}})],1):e._e()])],1)]),e._v(" "),t("bk-select",{staticStyle:{width:"100px",float:"left","margin-right":"10px"},attrs:{searchable:"","font-size":"medium"},model:{value:i.condition,callback:function(t){e.$set(i,"condition",t)},expression:"node.condition"}},e._l(e.globalChoiseFilter(e.globalChoise.methods,i.type),(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1),e._v(" "),t("div",{staticStyle:{width:"195px",float:"left","margin-right":"10px"}},["boolean"===i.type?[t("bk-select",{attrs:{searchable:"","font-size":"medium"},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}},e._l(e.booleanList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]:[t("bk-input",{attrs:{clearable:!0,type:"INT"===i.type?"number":"text",placeholder:e.$t("m.treeinfo['请输入比较值']")},model:{value:i.value,callback:function(t){e.$set(i,"value",t)},expression:"node.value"}})]],2),e._v(" "),t("div",{staticClass:"bk-between-operat"},[t("span",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addNode(n,a)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===n.expressions.length},on:{click:function(t){return e.deleteNode(n,a)}}})])],1)})),e._v(" "),1!==e.lineInfo.expressions.length?t("i",{staticClass:"bk-icon icon-close",on:{click:function(t){return e.delteCondition(n,i)}}}):e._e()],2)])})),e._v(" "),t("div",{class:{"bk-line-padding":e.scrollTopStatus}},[t("p",{staticClass:"bk-add-between"},[t("span",{on:{click:e.addCondition}},[t("i",{staticClass:"bk-icon icon-plus-circle"}),e._v(e._s(e.$t('m.treeinfo["添加条件组"]'))+"\n          ")])])])]:e._e()],2),e._v(" "),e.formInfo.api_info.need_poll?t("div",{staticClass:"bk-polling-configu",staticStyle:{width:"650px"}},[t("bk-form",{attrs:{"label-width":200,"form-type":"vertical",model:e.formInfo}},[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['轮询间隔']"),"ext-cls":"bk-polling-item"}},[t("bk-input",{attrs:{clearable:!0,type:"number",min:1,placeholder:e.$t("m.treeinfo['请输入间隔时间']")},model:{value:e.formInfo.api_info.end_conditions.poll_interval,callback:function(t){e.$set(e.formInfo.api_info.end_conditions,"poll_interval",t)},expression:"formInfo.api_info.end_conditions.poll_interval"}},[t("template",{slot:"append"},[t("div",{staticClass:"group-text"},[e._v(e._s(e.$t('m.treeinfo["秒"]')))])])],2)],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['轮询次数']"),"ext-cls":"bk-polling-item bk-polling-right"}},[t("bk-input",{attrs:{clearable:!0,type:"number",min:1,placeholder:e.$t("m.treeinfo['请输入轮询次数']")},model:{value:e.formInfo.api_info.end_conditions.poll_time,callback:function(t){e.$set(e.formInfo.api_info.end_conditions,"poll_time",t)},expression:"formInfo.api_info.end_conditions.poll_time"}})],1)],1)],1):e._e()]):e._e()},a=[];i._withStripped=!0},"6Mdl":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-deal-person",class:{"person-vertical":"vertical"===e.formType,"inline-auto-width":"inline-auto-width"===e.formType,"no-second":e.noSecondTypeList.includes(e.formData.levelOne)}},[t("div",{staticClass:"first-level"},[t("bk-select",{attrs:{"ext-cls":"bk-form-width mr10","data-test-id":"dealPerson-select-firstHandler",loading:e.initLoaing,clearable:!1,searchable:"","font-size":"medium"},on:{selected:e.onFirstLevelChange},model:{value:e.formData.levelOne,callback:function(t){e.$set(e.formData,"levelOne",t)},expression:"formData.levelOne"}},e._l(e.firstLevelList,(function(e){return t("bk-option",{key:e.id,attrs:{"data-test-id":"dealPerson-select-first-"+e.id,id:e.id,name:e.name}})})),1)],1),e._v(" "),["PERSON","GENERAL","CMDB","IAM","API","ASSIGN_LEADER","VARIABLE","ORGANIZATION"].includes(e.formData.levelOne)?t("div",{staticClass:"second-level"},["PERSON"===e.formData.levelOne&&Array.isArray(e.formData.levelSecond)?[t("member-select",{attrs:{"data-test-id":"dealPerson-select-personSecondHandler","ext-cls":"bk-form-width","specify-id-list":e.targetSpecifyIdList},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}})]:["GENERAL","CMDB","IAM","API","ASSIGN_LEADER","VARIABLE"].includes(e.formData.levelOne)?[t("bk-select",{attrs:{"ext-cls":"bk-form-width","data-test-id":"dealPerson-select-secondHandler",loading:e.isLoading,"show-select-all":"",multiple:!["ASSIGN_LEADER"].includes(e.formData.levelOne),searchable:"","font-size":"medium"},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}},e._l(e.secondLevelList,(function(e){return t("bk-option",{key:e.id,attrs:{"data-test-id":"dealPerson-select-second-"+e.id,id:e.id,name:e.name}})})),1)]:"ORGANIZATION"===e.formData.levelOne?[t("bkTree",{attrs:{list:e.organizationList,"organization-loading":e.organizationLoading,"ext-cls":"bk-form-width"},on:{toggle:e.toggleInfo},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}})]:e._e()],2):e._e(),e._v(" "),e.showError?t("p",{staticClass:"bk-error-info"},[e._v(e._s(e.requiredMsg||e.$t("m.treeinfo['处理人不能为空']")))]):e._e(),e._v(" "),t("bk-dialog",{attrs:{theme:"primary","footer-position":"center","mask-close":!1},on:{cancel:e.cancelSelect},model:{value:e.organizationTip.show,callback:function(t){e.$set(e.organizationTip,"show",t)},expression:"organizationTip.show"}},[t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-mark-eight organization-tip"}),e._v(" "),t("p",[t("span",[e._v(e._s(e.$t('m["当前组织架构下共有员工"]')))]),e._v(" "),t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.organizationTip.count))]),e._v(" "),t("span",[e._v(e._s(e.$t('m["人，如果开启了消息通知，会导致"]')))]),e._v(" "),t("span",{staticStyle:{color:"red"}},[e._v(e._s(e.organizationTip.count))]),e._v(" "),t("span",[e._v(e._s(e.$t('m["人都会收到单据代办通知，是否继续？如有疑问请咨询ITSM系统管理员。"]')))])])])],1)},a=[];i._withStripped=!0},"6jts":function(e,t,n){"use strict";n("OzIr")},"6z7N":function(e,t,n){},"7DqX":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"TABLE",props:{item:{type:Object,required:!0,default:function(){}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},watch:{"item.val":function(){if(""===this.item.val){this.item.val=[];for(var e={},t=0;t<this.item.choice.length;t++){e[this.item.choice[t].key]=""}this.item.val.push(e)}"function"==typeof this.$parent.refresh&&this.$parent.refresh()}},created:function(){if(""===this.item.val||Array.isArray(this.item.val)&&!this.item.val.length){this.item.val=[];for(var e={},t=0;t<this.item.choice.length;t++){e[this.item.choice[t].key]=""}this.item.val.push(e)}},methods:{addOne:function(){for(var e={},t=0;t<this.item.choice.length;t++){e[this.item.choice[t].key]=""}this.item.val.push(e)},deleteOne:function(e){var t=this;1===this.item.val.length?this.$bkMessage({message:"默认行不能删除",theme:"warning"}):this.$bkInfo({title:"确认要删除此条数据？",confirmFn:function(){t.item.val.splice(e.$index,1)}})}}}},"7LjQ":function(e,t,n){"use strict";n("UftK")},"7Uj4":function(e,t,n){"use strict";n.r(t);var i=n("r+Sh"),a=n("kWbx");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("HgU8");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"53e1cfba",null);t.default=s.exports},"7V2o":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-select",{class:{"bk-border-error":e.item.checkValue},attrs:{searchable:"",disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,placeholder:e.item.desc,"font-size":"medium"},on:{selected:e.selected,toggle:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}},e._l(e.options,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},"7XAC":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("2eEL"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"exportTree",components:{collapseTransition:r.default},props:{treeDataList:{type:Array,default:function(){return[]}},treeIndex:{type:Number,default:0},isKeyValue:{type:Number,default:0}},data:function(){return{pLeft:"padding-left:"+25*(this.treeIndex+1)+"px; padding-right: 10px;"}},methods:{toggleChildren:function(e){this.$emit("toggleChildren",e)},toggle:function(e){this.$emit("toggle",e,this.isKeyValue)},checkItem:function(e){this.$emit("selectItem",e)},selectItem:function(e){this.$emit("selectItem",e)}}}},"7yQo":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("QbLZ")),a=c(n("u8Ap")),r=c(n("OE89")),o=n("L2JU"),s=n("CeR/");function c(e){return e&&e.__esModule?e:{default:e}}t.default={name:"changeConductor",components:{memberSelect:a.default,exportTree:r.default},props:{itemInfo:{type:Object,default:function(){return{}}},recipientItem:{type:Object,default:function(){return{}}},recipientIndex:{type:Number,default:function(){return""}}},data:function(){return{recipientKeyList:[],roles:{viewTreeDataList:[],viewtree:{},viewTreeOpen:!1},variableList:[]}},computed:(0,i.default)({globalChoise:function(){return this.$store.state.common.configurInfo}},(0,o.mapState)("trigger",{triggerVariables:function(e){return e.triggerVariables}})),watch:{triggerVariables:function(e){this.variableList=e}},created:function(){var e=["OPEN","STARTER","BY_ASSIGNOR","EMPTY"];this.recipientKeyList=this.globalChoise.processor_type.filter((function(t){return!e.some((function(e){return e===t.typeName}))})),this.recipientItem.key&&(this.recipientItem.secondLevelList=[],"ORGANIZATION"===this.recipientItem.key?(this.getOrganization(),this.recipientItem.value&&this.setinitValue(Number(this.recipientItem.value))):"VARIABLE"===this.recipientItem.key?this.recipientItem.value=this.recipientItem.value:"PERSON"===this.recipientItem.key?(this.recipientItem.secondLevelList=[],this.recipientItem.value=Array.isArray(this.recipientItem.value)?this.recipientItem.value:this.recipientItem.value.split(",")):(this.recipientItem.value=Array.isArray(this.recipientItem.value)?this.recipientItem.value:this.recipientItem.value.split(","),this.secondListFn(this.recipientItem)))},mounted:function(){this.variableList=this.triggerVariables},methods:{setinitValue:function(e){var t=this;this.$store.dispatch("cdeploy/getTreeInfoChildren",{id:e}).then((function(e){t.roles.viewtree=e.data,t.concatName()}))},getSecondLevelList:function(){this.recipientItem.value=[],this.recipientItem.secondLevelList=[],"ORGANIZATION"===this.recipientItem.key?(this.recipientItem.value="",this.getOrganization()):"VARIABLE"===this.recipientItem.key?this.recipientItem.value="":"PERSON"===this.recipientItem.key?this.recipientItem.secondLevelList=[]:this.secondListFn(this.recipientItem)},secondListFn:function(e){var t=this;if(e.key){e.isLoading=!0;var n={role_type:e.key};"IAM"!==e.key&&(n.project_key=this.$store.state.project.id),this.$store.dispatch("deployCommon/getSecondUser",n).then((function(t){var n=t.data,i=[];"GENERAL"===e.key?n.forEach((function(e){i.push({id:String(e.id),name:e.name+"("+e.count+")",disabled:0===e.count})})):n.forEach((function(e){i.push({id:String(e.id),name:e.name})})),e.secondLevelList=i})).catch((function(e){(0,s.errorHandler)(e,t)})).finally((function(){e.isLoading=!1}))}},getOrganization:function(){var e=this;this.$store.dispatch("cdeploy/getTreeInfo").then((function(t){e.roles.viewTreeDataList=t.data,e.roles.viewTreeDataList.forEach((function(t){e.setCheckedValue(t,"view")}))})).catch((function(){}))},recordCheckFn:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.roles.viewTreeDataList;t.forEach((function(t){e.$set(t,"checkInfo",!1),t.children&&t.children.length&&e.recordCheckFn(t.children)}))},toggleInfo:function(e){this.recordCheckFn(),e.checkInfo=!0,this.roles.viewtree=e,this.concatName(),this.recipientItem.value=e.id,this.closeTree()},toggleChildren:function(e,t){var n=this;"view"===t&&(this.$set(e,"showChildren",!e.showChildren),this.$store.dispatch("cdeploy/getTreeInfoChildren",{id:e.id}).then((function(t){t.data.children.forEach((function(e){n.setCheckedValue(e,"view")})),n.$set(e,"children",t.data.children||[])})))},openChildren:function(e,t){var n=this;e.showChildren=!1,"view"===t&&(e.showChildren=this.roles.viewtree.route.some((function(t){return String(t.id)===String(e.id)}))),e.children&&e.children.length&&e.children.forEach((function(e){n.openChildren(e,t)}))},setCheckedValue:function(e,t){if(this.$set(e,"checkInfo",!1),this.$set(e,"has_children",e.has_children),String(this.recipientItem.value)===String(e.id)&&"view"===t)return e.checkInfo=!0,this.checked=e,void this.concatName();e.has_children&&(this.$set(e,"showChildren",!1),this.$set(e,"children",[]))},showTree:function(e){"view"===e&&(this.roles.viewTreeOpen=!this.roles.viewTreeOpen,this.roles.otherTreeOpen=!1)},closeTree:function(){this.roles.viewTreeOpen=!1},concatName:function(){this.$set(this.roles.viewtree,"showName",this.roles.viewtree.full_name)},addRecipient:function(){this.itemInfo.value.splice(this.recipientIndex+1,0,{type:"",value:"",secondLevelList:[],isLoading:!1})},deleteRecipient:function(){1!==this.itemInfo.value.length&&this.itemInfo.value.splice(this.recipientIndex,1)}}}},"8/xK":function(e,t,n){},"86Bk":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.flowDataLoading},expression:"{ isLoading: flowDataLoading }"}],class:[e.isShowNodeConfig?"process-step-node-conf":"process-step"]},[e.flowDataLoading?e._e():[e.isShowNodeConfig?t("div",[t("div",{staticClass:"node-type"},[e._v(e._s(e.nodeType)+"\n        "),t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-three-one close-node-conf",on:{click:e.closeConfigur}})]),e._v(" "),"NORMAL"===e.configur.type?t("basic-node",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"TASK"===e.configur.type?t("autoNode",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"TASK-SOPS"===e.configur.type?t("sopsNode",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"TASK-DEVOPS"===e.configur.type?t("devopsNode",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"SIGN"===e.configur.type?t("signNode",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"APPROVAL"===e.configur.type?t("approval-node",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"BK-PLUGIN"===e.configur.type?t("bk-plugin-node",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e(),e._v(" "),"WEBHOOK"===e.configur.type?t("web-hook-node",{attrs:{"flow-info":e.flowInfo,configur:e.configur},on:{closeConfigur:e.closeConfigur}}):e._e()],1):t("second-flow",{ref:"flowInfo",attrs:{"add-list":e.nodeList,"line-list":e.lineList,"flow-info":e.flowInfo},on:{handleNodeClick:e.handleNodeClick}})]],2)},a=[];i._withStripped=!0},"8EG9":function(e,t,n){"use strict";n("/7De")},"8MAP":function(e,t,n){},"8O5U":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-field-preview",attrs:{id:"bkPreview"}},[t("bk-form",{attrs:{"label-width":200,"form-type":"vertical","ext-cls":"bk-ext-form"}},[e._l(e.fields,(function(n,i){return[n.showFeild?t("div",{key:i,class:{"bk-field-line":"COL_12"===n.layout,"bk-field-half":"COL_6"===n.layout}},[t("CW-"+n.type,{tag:"component",attrs:{item:n,fields:e.fields,"is-preview":e.isPreview,"is-file-preview":e.isFilePreview}})],1):e._e()]}))],2)],1)},a=[];i._withStripped=!0},"8aPs":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-input",{class:{"bk-border-error":e.item.checkValue},attrs:{maxlength:e.maxLength,disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,placeholder:e.item.desc},on:{focus:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},"8fx1":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("z/5e")),a=r(n("efIh"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"INT",mixins:[a.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{max:i.default,isErrMessage:!1}},watch:{"item.val":function(e){this.isErrMessage=e>this.max||!1,this.conditionField(this.item,this.fields)}},mounted:function(){this.item.value&&!this.item.val&&(this.item.val=this.item.value)},methods:{}}},"8gVO":function(e,t,n){var i={"./1c":"9xzc","./1c.js":"9xzc","./abnf":"tSgA","./abnf.js":"tSgA","./accesslog":"mY11","./accesslog.js":"mY11","./actionscript":"+fC4","./actionscript.js":"+fC4","./ada":"Aayt","./ada.js":"Aayt","./angelscript":"28xz","./angelscript.js":"28xz","./apache":"8Kqh","./apache.js":"8Kqh","./applescript":"e8E9","./applescript.js":"e8E9","./arcade":"MF4s","./arcade.js":"MF4s","./arduino":"lE5/","./arduino.js":"lE5/","./armasm":"ozyK","./armasm.js":"ozyK","./asciidoc":"ApBa","./asciidoc.js":"ApBa","./aspectj":"mBTZ","./aspectj.js":"mBTZ","./autohotkey":"BIHe","./autohotkey.js":"BIHe","./autoit":"75kF","./autoit.js":"75kF","./avrasm":"pvv5","./avrasm.js":"pvv5","./awk":"EGmf","./awk.js":"EGmf","./axapta":"qIW7","./axapta.js":"qIW7","./bash":"8Pgg","./bash.js":"8Pgg","./basic":"oVqn","./basic.js":"oVqn","./bnf":"ddo8","./bnf.js":"ddo8","./brainfuck":"WSH0","./brainfuck.js":"WSH0","./c":"H+UY","./c-like":"r5rv","./c-like.js":"r5rv","./c.js":"H+UY","./cal":"d4EH","./cal.js":"d4EH","./capnproto":"Sl5E","./capnproto.js":"Sl5E","./ceylon":"unZW","./ceylon.js":"unZW","./clean":"Uasv","./clean.js":"Uasv","./clojure":"uIR8","./clojure-repl":"FJ32","./clojure-repl.js":"FJ32","./clojure.js":"uIR8","./cmake":"6quq","./cmake.js":"6quq","./coffeescript":"qZUF","./coffeescript.js":"qZUF","./coq":"gLO8","./coq.js":"gLO8","./cos":"gmEm","./cos.js":"gmEm","./cpp":"Agkw","./cpp.js":"Agkw","./crmsh":"yOV0","./crmsh.js":"yOV0","./crystal":"KUpP","./crystal.js":"KUpP","./csharp":"mK8d","./csharp.js":"mK8d","./csp":"QnJG","./csp.js":"QnJG","./css":"7oys","./css.js":"7oys","./d":"jW1C","./d.js":"jW1C","./dart":"fEaW","./dart.js":"fEaW","./delphi":"H4p3","./delphi.js":"H4p3","./diff":"SLii","./diff.js":"SLii","./django":"0kiY","./django.js":"0kiY","./dns":"iobV","./dns.js":"iobV","./dockerfile":"RLXu","./dockerfile.js":"RLXu","./dos":"fP8y","./dos.js":"fP8y","./dsconfig":"uR4j","./dsconfig.js":"uR4j","./dts":"sM9k","./dts.js":"sM9k","./dust":"9Nr/","./dust.js":"9Nr/","./ebnf":"G01c","./ebnf.js":"G01c","./elixir":"dycj","./elixir.js":"dycj","./elm":"UFGb","./elm.js":"UFGb","./erb":"E2cJ","./erb.js":"E2cJ","./erlang":"s8Vx","./erlang-repl":"9JLW","./erlang-repl.js":"9JLW","./erlang.js":"s8Vx","./excel":"9c9R","./excel.js":"9c9R","./fix":"KyKy","./fix.js":"KyKy","./flix":"oU5B","./flix.js":"oU5B","./fortran":"SF9x","./fortran.js":"SF9x","./fsharp":"AhXs","./fsharp.js":"AhXs","./gams":"fZ2E","./gams.js":"fZ2E","./gauss":"rnof","./gauss.js":"rnof","./gcode":"lKKg","./gcode.js":"lKKg","./gherkin":"NRrW","./gherkin.js":"NRrW","./glsl":"3wag","./glsl.js":"3wag","./gml":"5upZ","./gml.js":"5upZ","./go":"CyL5","./go.js":"CyL5","./golo":"kZ3Q","./golo.js":"kZ3Q","./gradle":"lURu","./gradle.js":"lURu","./groovy":"H2RM","./groovy.js":"H2RM","./haml":"T0rU","./haml.js":"T0rU","./handlebars":"5VxD","./handlebars.js":"5VxD","./haskell":"PziN","./haskell.js":"PziN","./haxe":"fHEK","./haxe.js":"fHEK","./hsp":"wi1Z","./hsp.js":"wi1Z","./htmlbars":"ebWy","./htmlbars.js":"ebWy","./http":"wB1n","./http.js":"wB1n","./hy":"hmeD","./hy.js":"hmeD","./inform7":"Ll1m","./inform7.js":"Ll1m","./ini":"KpOm","./ini.js":"KpOm","./irpf90":"B05S","./irpf90.js":"B05S","./isbl":"u0OR","./isbl.js":"u0OR","./java":"My+Z","./java.js":"My+Z","./javascript":"TdF3","./javascript.js":"TdF3","./jboss-cli":"BKhn","./jboss-cli.js":"BKhn","./json":"WtIr","./json.js":"WtIr","./julia":"ImXp","./julia-repl":"t6qC","./julia-repl.js":"t6qC","./julia.js":"ImXp","./kotlin":"qUGr","./kotlin.js":"qUGr","./lasso":"Jb18","./lasso.js":"Jb18","./latex":"FVXi","./latex.js":"FVXi","./ldif":"GgYO","./ldif.js":"GgYO","./leaf":"LptB","./leaf.js":"LptB","./less":"GEZ5","./less.js":"GEZ5","./lisp":"mzJY","./lisp.js":"mzJY","./livecodeserver":"G+vv","./livecodeserver.js":"G+vv","./livescript":"LhHj","./livescript.js":"LhHj","./llvm":"fDA8","./llvm.js":"fDA8","./lsl":"KK3C","./lsl.js":"KK3C","./lua":"7P7d","./lua.js":"7P7d","./makefile":"el66","./makefile.js":"el66","./markdown":"BLBw","./markdown.js":"BLBw","./mathematica":"73oX","./mathematica.js":"73oX","./matlab":"jKVu","./matlab.js":"jKVu","./maxima":"OZ3z","./maxima.js":"OZ3z","./mel":"u34i","./mel.js":"u34i","./mercury":"JCUK","./mercury.js":"JCUK","./mipsasm":"o0In","./mipsasm.js":"o0In","./mizar":"DxbC","./mizar.js":"DxbC","./mojolicious":"ZrqW","./mojolicious.js":"ZrqW","./monkey":"pxCe","./monkey.js":"pxCe","./moonscript":"sbla","./moonscript.js":"sbla","./n1ql":"9Mhc","./n1ql.js":"9Mhc","./nginx":"9U8A","./nginx.js":"9U8A","./nim":"hh0f","./nim.js":"hh0f","./nix":"Rq6a","./nix.js":"Rq6a","./node-repl":"ARiT","./node-repl.js":"ARiT","./nsis":"syIQ","./nsis.js":"syIQ","./objectivec":"m/If","./objectivec.js":"m/If","./ocaml":"7mzT","./ocaml.js":"7mzT","./openscad":"AsRY","./openscad.js":"AsRY","./oxygene":"beiO","./oxygene.js":"beiO","./parser3":"NyhX","./parser3.js":"NyhX","./perl":"alHH","./perl.js":"alHH","./pf":"dnrZ","./pf.js":"dnrZ","./pgsql":"+FGM","./pgsql.js":"+FGM","./php":"KQfT","./php-template":"4Fr3","./php-template.js":"4Fr3","./php.js":"KQfT","./plaintext":"ROUN","./plaintext.js":"ROUN","./pony":"ldBm","./pony.js":"ldBm","./powershell":"UI5O","./powershell.js":"UI5O","./processing":"r7oX","./processing.js":"r7oX","./profile":"uQpx","./profile.js":"uQpx","./prolog":"Q5ZB","./prolog.js":"Q5ZB","./properties":"VrLj","./properties.js":"VrLj","./protobuf":"Lo5G","./protobuf.js":"Lo5G","./puppet":"UCcd","./puppet.js":"UCcd","./purebasic":"GwJY","./purebasic.js":"GwJY","./python":"lRCX","./python-repl":"QWjE","./python-repl.js":"QWjE","./python.js":"lRCX","./q":"Xfvt","./q.js":"Xfvt","./qml":"YSo5","./qml.js":"YSo5","./r":"Jrxr","./r.js":"Jrxr","./reasonml":"6ZBy","./reasonml.js":"6ZBy","./rib":"D68y","./rib.js":"D68y","./roboconf":"9Q8I","./roboconf.js":"9Q8I","./routeros":"2Vkh","./routeros.js":"2Vkh","./rsl":"oKc0","./rsl.js":"oKc0","./ruby":"gst6","./ruby.js":"gst6","./ruleslanguage":"irpp","./ruleslanguage.js":"irpp","./rust":"LOdI","./rust.js":"LOdI","./sas":"QPTg","./sas.js":"QPTg","./scala":"n3/M","./scala.js":"n3/M","./scheme":"QQjU","./scheme.js":"QQjU","./scilab":"6k3J","./scilab.js":"6k3J","./scss":"YROV","./scss.js":"YROV","./shell":"tluB","./shell.js":"tluB","./smali":"Gxxu","./smali.js":"Gxxu","./smalltalk":"jU8F","./smalltalk.js":"jU8F","./sml":"3EHr","./sml.js":"3EHr","./sqf":"4qfg","./sqf.js":"4qfg","./sql":"3gkP","./sql.js":"3gkP","./sql_more":"92Fc","./sql_more.js":"92Fc","./stan":"iTGd","./stan.js":"iTGd","./stata":"1LUk","./stata.js":"1LUk","./step21":"AIHI","./step21.js":"AIHI","./stylus":"vYiF","./stylus.js":"vYiF","./subunit":"Aqyh","./subunit.js":"Aqyh","./swift":"Kjk6","./swift.js":"Kjk6","./taggerscript":"JGhL","./taggerscript.js":"JGhL","./tap":"BrQc","./tap.js":"BrQc","./tcl":"on2m","./tcl.js":"on2m","./thrift":"rfnV","./thrift.js":"rfnV","./tp":"phP4","./tp.js":"phP4","./twig":"9G73","./twig.js":"9G73","./typescript":"r0Rl","./typescript.js":"r0Rl","./vala":"8SK+","./vala.js":"8SK+","./vbnet":"ieeH","./vbnet.js":"ieeH","./vbscript":"Wj43","./vbscript-html":"9Fqr","./vbscript-html.js":"9Fqr","./vbscript.js":"Wj43","./verilog":"4Q+X","./verilog.js":"4Q+X","./vhdl":"MQ8/","./vhdl.js":"MQ8/","./vim":"PGlF","./vim.js":"PGlF","./x86asm":"oVRe","./x86asm.js":"oVRe","./xl":"Jjkb","./xl.js":"Jjkb","./xml":"jctj","./xml.js":"jctj","./xquery":"JopO","./xquery.js":"JopO","./yaml":"Lns6","./yaml.js":"Lns6","./zephir":"nwyE","./zephir.js":"nwyE"};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id="8gVO"},"8zq1":function(e,t,n){"use strict";n.r(t);var i=n("eYYl"),a=n("0uNP");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("3nH4");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"5426a860",null);t.default=s.exports},"9MBU":function(e,t,n){"use strict";n.r(t);var i=n("k85c"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"9ZYk":function(e,t,n){"use strict";n.r(t);var i=n("e+8O"),a=n("EQfD");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("jeD0");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"06fcffc1",null);t.default=s.exports},"9g2r":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-basic-info"},[t("bk-form",{ref:"basicForm",attrs:{"label-width":150,model:e.formInfo,rules:e.rules,"form-type":"vertical"}},[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['节点名称：']"),"data-test-id":"basicInfo-input-nodeName","ext-cls":"bk-item-width",required:!0,property:"name"}},[t("bk-input",{attrs:{"font-size":"medium",maxlength:"120"},model:{value:e.formInfo.name,callback:function(t){e.$set(e.formInfo,"name",t)},expression:"formInfo.name"}})],1),e._v(" "),t("desc-info",{model:{value:e.formInfo.desc,callback:function(t){e.$set(e.formInfo,"desc",t)},expression:"formInfo.desc"}}),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"basicInfo-select-ProcessingScenarios",label:e.$t("m.treeinfo['处理场景：']"),required:!0}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width",clearable:!1,searchable:"",disabled:e.nodeInfo.is_builtin,"font-size":"medium"},on:{selected:e.changeDistribute},model:{value:e.formInfo.distribute_type,callback:function(t){e.$set(e.formInfo,"distribute_type",t)},expression:"formInfo.distribute_type"}},e._l(e.sceneList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1),e._v(" "),e._l(e.prompt,(function(n,i){return n.id===e.formInfo.distribute_type?t("p",{key:i,staticClass:"mt5 mb0 bk-revoke-span"},[t("i",{staticClass:"bk-icon icon-exclamation-circle",staticStyle:{"padding-right":"5px"}}),e._v(" "),t("span",[e._v(e._s(n.prompt))])]):e._e()}))],2),e._v(" "),e.assignorsTypeList.some(t=>t===e.formInfo.distribute_type)?[t("bk-form-item",{attrs:{"data-test-id":"basicInfo-select-assignors",label:e.$t("m.treeinfo['派单人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.assignors=!1}}},[t("deal-person",{ref:"assignors",attrs:{value:e.assignorsInfo,"exclude-role-type-list":e.assignorExclude}})],1)])]:e._e(),e._v(" "),e.processorsInfo.type?[t("bk-form-item",{attrs:{"data-test-id":"basicInfo-component-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{value:e.processorsInfo,"node-info":e.nodeInfo,"show-overbook":!0,"exclude-role-type-list":e.excludeProcessor}})],1)])]:e._e(),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['设置单据状态：']"),required:!0}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",clearable:!1,searchable:"","font-size":"medium"},on:{selected:e.handleTicket},model:{value:e.formInfo.ticket_type,callback:function(t){e.$set(e.formInfo,"ticket_type",t)},expression:"formInfo.ticket_type"}},e._l(e.billStatusList,(function(e){return t("bk-option",{key:e.type,attrs:{id:e.type,name:e.name}})})),1),e._v(" "),"custom"===e.formInfo.ticket_type?[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",loading:e.ticketKeyLoading,clearable:!1,searchable:"","font-size":"medium"},model:{value:e.formInfo.ticket_key,callback:function(t){e.$set(e.formInfo,"ticket_key",t)},expression:"formInfo.ticket_key"}},e._l(e.secondLevelList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e()],2),e._v(" "),e.nodeInfo.is_builtin?e._e():[t("bk-form-item",{attrs:{"data-test-id":"basicInfo-radio-canDeliver",label:e.$t("m.treeinfo['是否可转单：']"),required:!0}},[t("bk-radio-group",{model:{value:e.formInfo.can_deliver,callback:function(t){e.$set(e.formInfo,"can_deliver",t)},expression:"formInfo.can_deliver"}},[t("bk-radio",{attrs:{value:e.trueStatus,"ext-cls":"mr20"}},[e._v(e._s(e.$t('m.treeinfo["是"]')))]),e._v(" "),t("bk-radio",{attrs:{value:e.falseStatus}},[e._v(e._s(e.$t('m.treeinfo["否"]')))])],1)],1)],e._v(" "),e.formInfo.can_deliver?[t("bk-form-item",{attrs:{"data-test-id":"basicInfo-radio-delivers",label:e.$t("m.treeinfo['转单人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.delivers=!1}}},[t("deal-person",{ref:"delivers",attrs:{value:e.deliversInfo,"exclude-role-type-list":e.deliversExclude}})],1)])]:e._e()],2)],1)},a=[];i._withStripped=!0},"9g4e":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("bk-sideslider",{attrs:{"is-show":e.isShow,"quick-close":!0,title:e.title,width:e.width,"ext-cls":"ui-sideslider"},on:{"update:isShow":function(t){e.isShow=t},"update:is-show":function(t){e.isShow=t}}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("render-view",{attrs:{"form-data":e.formData,context:e.context}})],1)])},a=[];i._withStripped=!0},"9psX":function(e,t,n){"use strict";n.r(t);var i=n("ptjD"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"9ume":function(e,t,n){"use strict";n.r(t);var i=n("agSa"),a=n("Szq4");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("/6kH");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"a0138020",null);t.default=s.exports},"9xhR":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("14Xm")),a=d(n("D3Ub")),r=d(n("5WyB")),o=d(n("PRQd")),s=d(n("bcjM")),c=d(n("s4tT")),l=n("ygAv"),u=n("CeR/");function d(e){return e&&e.__esModule?e:{default:e}}t.default={name:"basicNode",components:{BasicCard:c.default,basicInfo:r.default,fieldConfig:o.default,commonTriggerList:s.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}}},data:function(){return{isLoading:!1,secondClick:!1,showMoreConfig:!1,stringValueList:["OPEN","STARTER"],nodeTagList:[],baseFormData:{}}},mounted:function(){this.initData()},methods:{initData:function(){},getNodeTagList:function(){var e=this;this.$store.dispatch("datadict/get_data_by_key",{key:"STATE_TAG_TYPE"}).then((function(t){e.nodeTagList=t.data})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){}))},checkStringValue:function(e){return-1===this.stringValueList.findIndex((function(t){return t===e}))},submitNode:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n,a,r,o,s;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.$refs.basic.backBasicInfo(),!((a=e.$refs.basic.checkStatus).name||a.assignors||a.delivers||a.processors)){t.next=4;break}return t.abrupt("return");case 4:if((r={}).is_draft=!1,r.workflow=e.flowInfo.id,r.type=e.configur.type,r.is_terminable=!1,r.name=n.name,r.desc=n.desc||void 0,r.tag=n.tag,r.distribute_type=n.distribute_type,r.assignors_type=n.assignors_type,r.assignors=n.assignors,r.processors_type=n.processors_type,r.processors=n.processors,r.extras={ticket_status:{name:n.ticket_key,type:n.ticket_type}},r.can_deliver=n.can_deliver,r.delivers_type=n.delivers_type,r.delivers=n.delivers,o=e.$refs.field.showTabList,r.fields=o.map((function(e){return e.id})),s=e.configur.id,!e.secondClick){t.next=26;break}return t.abrupt("return");case 26:e.secondClick=!0,e.$store.dispatch("deployCommon/updateNode",{params:r,id:s}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$emit("closeConfigur",!0)})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}));case 28:case"end":return t.stop()}}),t,e)})))()},closeNode:function(){this.$emit("closeConfigur",!1)},baseFormInfoChange:function(e){var t=e.distribute_type,n=e.can_deliver;if(t!==this.baseFormData.distribute_type||n!==this.baseFormData.can_deliver){this.baseFormData=(0,l.deepClone)(e);var i={PROCESS:[],DISTRIBUTE_THEN_PROCESS:["CLAIM_STATE","DELIVER_STATE"],CLAIM_THEN_PROCESS:["DISTRIBUTE_STATE","DELIVER_STATE"],DISTRIBUTE_THEN_CLAIM:[]}[t]||[];this.configur.is_builtin||(n?i=i.filter((function(e){return"DELIVER_STATE"!==e})):-1===i.indexOf("DELIVER_STATE")&&i.push("DELIVER_STATE")),this.$refs.commonTriggerList&&(this.$refs.commonTriggerList.setFilterSignal(i),this.$refs.commonTriggerList.getBoundTriggerList())}}}}},"A/4B":function(e,t,n){"use strict";n.r(t);var i=n("v5D/"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},A7pL:function(e,t,n){"use strict";n("ZcAa")},AFtY:function(e,t,n){"use strict";n.r(t);var i=n("M78e"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},Abqk:function(e,t,n){"use strict";n.r(t);var i=n("25E2"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},Albq:function(e,t,n){"use strict";n.r(t);var i=n("Pdjk"),a=n("bIVE");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("DPRX");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"3f5b69c0",null);t.default=s.exports},Axd5:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-input",{class:{"bk-border-error":e.item.checkValue},attrs:{placeholder:e.item.desc,type:"textarea",rows:8,disabled:e.item.is_readonly&&!e.isCurrent||e.disabled},on:{focus:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},B2j7:function(e,t,n){"use strict";n("an3D")},BFl6:function(e,t,n){"use strict";n.r(t);var i=n("ew6e"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},BKtx:function(e,t,n){"use strict";n.r(t);var i=n("zmPZ"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},BST3:function(e,t,n){},BVcZ:function(e,t,n){"use strict";n.r(t);var i=n("BccX"),a=n("ciLR");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("1Gpi");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"5b4cc75f",null);t.default=s.exports},BWJp:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=d(n("4d7F")),r=d(n("/f1G")),o=d(n("14Xm")),s=d(n("gDS+")),c=d(n("D3Ub")),l=d(n("sEfC")),u=n("CeR/");function d(e){return e&&e.__esModule?e:{default:e}}t.default={methods:{get_priority:function(e,t){var n=this;return(0,c.default)(o.default.mark((function i(){var a,r;return o.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if((a=JSON.parse((0,s.default)(e))).service_type=t.service,delete a.id,r={id:t.ticket_id},a.impact&&a.urgency){i.next=7;break}return i.next=7,n.$store.dispatch("change/getStepList",r).then((function(t){t.data.forEach((function(t){t.fields.forEach((function(t){"urgency"===t.key&&(a.urgency=e.urgency||t.value),"impact"===t.key&&(a.impact=e.impact||t.value)}))}))}),(function(e){(0,u.errorHandler)(e,n)}));case 7:n.$store.dispatch("apiRemote/get_priority",{data:a}).then((function(e){t.val=e.data})).catch((function(e){(0,u.errorHandler)(e,n)}));case 8:case"end":return i.stop()}}),i,n)})))()},get_data_by_key:function(e){var t=this;return(0,c.default)(o.default.mark((function n(){return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",t.$store.dispatch("datadict/get_data_by_key",{key:e.source_uri,field_key:e.key,service:e.service,current_status:e.ticket_status}).then((function(t){e.choice=t.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(e){(0,u.errorHandler)(e,t)})));case 1:case"end":return n.stop()}}),n,t)})))()},apiRemoteGetData:function(e,t,n){var i=this,a=JSON.parse((0,s.default)(e)),r="apiRemote/get_data";return"workflow"===n&&(r="apiRemote/get_data_workflow"),"submit"===n&&(r="apiRemote/get_data_receipts",a={api_instance_id:t.api_instance_id,kv_relation:t.kv_relation,fields:a}),a.id=t.id,a.kv_relation=t.kv_relation,a.api_instance_id=t.api_instance_id,a.api_info=t.api_info,this.$store.dispatch(r,a).then((function(e){t.choice=[],e.data.map((function(e){return{key:e.key||e.id,name:e.name}})).forEach((function(e){t.choice.push(JSON.parse((0,s.default)(e)))}))})).catch((function(e){(0,u.errorHandler)(e,i)}))},debounce:(0,l.default)((i=(0,c.default)(o.default.mark((function e(t,n,i,a,r){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("priority"!==n.key){e.next=3;break}return i.get_priority(t,n,a),e.abrupt("return",!1);case 3:i.apiRemoteGetData(t,n,a,r);case 4:case"end":return e.stop()}}),e,void 0)}))),function(e,t,n,a,r){return i.apply(this,arguments)}),1e3,{leading:!0,trailing:!0,maxWait:2e3}),isNecessaryToWatch:function(e,t,n){var i=this;return(0,c.default)(o.default.mark((function s(){var l,u,d,f,p,m;return o.default.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(l=[],e.fields.forEach((function(n){if("DATADICT"===n.type&&"TREESELECT"!==n.type&&l.push(i.get_data_by_key(n)),("API"===n.source_type||"priority"===n.key)&&!n.choice.some((function(e){return e.can_delete}))){var a={id:n.id,api_instance_id:n.api_instance_id,kv_relation:n.kv_relation};n.related_fields&&n.related_fields.rely_on&&n.related_fields.rely_on.forEach((function(t){var n=e.fields.find((function(e){return e.key===t}));n&&(a[t]=n.val||"")})),(0,r.default)(a).every((function(e){return!!e}))&&"priority"!==e.key&&l.push(i.apiRemoteGetData(a,n,t))}})),a.default.all(l).then((function(){n&&n()})),(u=e.fields.filter((function(e){return("API"===e.source_type||"priority"===e.key)&&e.related_fields&&e.related_fields.rely_on&&e.related_fields.rely_on.length}))).length){s.next=6;break}return s.abrupt("return");case 6:if(d=[],u.forEach((function(e){d=d.concat(e.related_fields.rely_on)})),(f=e.fields.filter((function(e){return e.related_fields&&e.related_fields.be_relied&&e.related_fields.be_relied.length}))).length){s.next=11;break}return s.abrupt("return");case 11:if((p=f.filter((function(e){return-1!==d.indexOf(e.key)}))).length){s.next=14;break}return s.abrupt("return");case 14:m=i,p.forEach((function(n){m.$watch((function(){return n.val}),(function(){var a;n.val&&u.filter((function(e){return-1!==e.related_fields.rely_on.indexOf(n.key)})).forEach((a=(0,c.default)(o.default.mark((function n(a){var r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:p.filter((function(e){return-1!==a.related_fields.rely_on.indexOf(e.key)})).every((function(e){return e.val}))&&(r={id:a.id,api_instance_id:a.api_instance_id,kv_relation:a.kv_relation},a.related_fields&&a.related_fields.rely_on&&a.related_fields.rely_on.forEach((function(t){var n=p.find((function(e){return e.key===t}));e.fields.find((function(e){return e.key===t}))&&(r[t]=n.val||"")})),"priority"!==a.key&&(a.choice.splice(0,a.choice.length),a.val=""),m.debounce(r,a,m,t));case 3:case"end":return n.stop()}}),n,i)}))),function(e){return a.apply(this,arguments)}))}),{deep:!0})}));case 16:case"end":return s.stop()}}),s,i)})))()},freshApi:function(e,t,n){var i={},a=t.map((function(e){return e.key}));e.related_fields&&e.related_fields.rely_on&&e.related_fields.rely_on.forEach((function(e){var n=t.filter((function(t){return t.key===e}))[0];-1!==a.indexOf(e)&&(i[e]=n&&n.val||"")})),(0,r.default)(i).every((function(e){return!!e}))&&(e.choice.splice(0,e.choice.length),e.val="",this.debounce(i,e,this,n))}}}},BccX:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"service-setting"},[t("section",{staticClass:"settion-card"},[t("h2",{staticClass:"card-title"},[e._v(e._s(e.$t("m.tickets['服务设置']")))]),e._v(" "),t("div",{staticClass:"card-content"},[t("bk-form",{ref:"serviceSetting",staticClass:"service-setting-form",attrs:{"data-test-id":"service_form_serviceSetting","form-type":"vertical",model:e.formData}},[t("bk-form-item",{attrs:{label:e.$t("m.serviceConfig['可见范围']")}},[t("deal-person",{ref:"displayRange",staticClass:"display-range",staticStyle:{width:"600px"},attrs:{"form-type":"inline-auto-width",value:e.formData.visibleRange,"show-role-type-list":e.displayRangeTypes}})],1),e._v(" "),t("bk-form-item",{staticClass:"auto-with-form-item mt20",attrs:{label:e.$t("m.tickets['撤回方式']")}},[t("bk-select",{model:{value:e.formData.revokeWay,callback:function(t){e.$set(e.formData,"revokeWay",t)},expression:"formData.revokeWay"}},e._l(e.revokeWayList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),"specify_node"===e.formData.revokeWay?t("bk-select",{attrs:{placeholder:e.$t("m.treeinfo['请选择撤单节点']"),loading:e.nodeListLoading,searchable:""},model:{value:e.formData.revokeState,callback:function(t){e.$set(e.formData,"revokeState",t)},expression:"formData.revokeState"}},e._l(e.nodeList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1):e._e()],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['自动处理']")}},[t("bk-checkbox",{attrs:{"true-value":!0,"false-value":!1},model:{value:e.formData.is_auto_approve,callback:function(t){e.$set(e.formData,"is_auto_approve",t)},expression:"formData.is_auto_approve"}},[e._v("\n            "+e._s(e.$t("m['当审批节点的审批人为申请人时，自动通过']"))+"\n          ")])],1)],1)],1)]),e._v(" "),t("section",{staticClass:"settion-card notic-card"},[t("h2",{staticClass:"card-title"},[e._v(e._s(e.$t("m.tickets['通知设置']")))]),e._v(" "),t("div",{staticClass:"card-content"},[t("bk-form",{staticClass:"service-setting-form",attrs:{"data-test-id":"service_form_serviceSettingNotification","form-type":"vertical",model:e.formData}},[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['通知方式']")}},[t("bk-checkbox-group",{model:{value:e.formData.notify,callback:function(t){e.$set(e.formData,"notify",t)},expression:"formData.notify"}},e._l(e.noticeType,(function(n){return t("bk-checkbox",{key:n.id,attrs:{value:n.typeName,"ext-cls":"mr40"}},[e._v("\n              "+e._s(n.name)+"\n            ")])})),1)],1)],1)],1)]),e._v(" "),e.openFunction.TRIGGER_SWITCH||e.openFunction.TASK_SWITCH?t("section",{staticClass:"settion-card"},[t("div",{staticClass:"card-title more-configuration mt20",attrs:{"data-test-id":"editService-div-showMoreConfig"},on:{click:function(t){e.showMoreConfig=!e.showMoreConfig}}},[e.showMoreConfig?t("i",{staticClass:"bk-icon icon-up-shape"}):t("i",{staticClass:"bk-icon icon-down-shape"}),e._v(" "),t("span",[e._v(e._s(e.$t("m.taskTemplate['高级配置']")))])]),e._v(" "),e.showMoreConfig?t("div",[t("collapse-transition",[t("div",[t("basic-card",{staticClass:"mt20",attrs:{"card-label":e.$t("m.newCommon['触发器']"),"card-desc":e.$t("m.taskTemplate['满足触发条件后要完成的特定动作']")}},[t("common-trigger-list",{attrs:{origin:"workflow","source-id":e.processId,table:e.flowInfo.table}})],1),e._v(" "),t("basic-card",{staticClass:"mt20",attrs:{"card-label":e.$t("m.taskTemplate['任务配置']"),"card-desc":e.$t("m.taskTemplate['如果需要在流程中调用标准运维的业务流程进而创建任务，请在第一步的流程字段配置中，将已有字段中的“关联业务” 字段添加至流程中。']")}},[t("TaskConfigPanel",{ref:"taskConfigPanel",attrs:{"service-info":e.serviceInfo}})],1)],1)])],1):e._e()]):e._e(),e._v(" "),t("bk-dialog",{attrs:{"mask-close":!1,"show-footer":!1},on:{cancel:e.goToServiceList},model:{value:e.slaValidateDialogShow,callback:function(t){e.slaValidateDialogShow=t},expression:"slaValidateDialogShow"}},[t("div",{staticClass:"sla-validate-msg"},[t("i",{staticClass:"bk-icon icon-check-circle"}),e._v(" "),t("h4",[e._v(e._s(e.$t("m['保存成功']")))]),e._v(" "),e._l(e.slaValidateMsg,(function(n,i){return t("p",{key:i},[e._v(e._s(n))])})),e._v(" "),t("div",{staticClass:"operate-btns"},[t("bk-button",{attrs:{theme:"primary"},on:{click:function(t){e.slaValidateDialogShow=!1}}},[e._v(e._s(e.$t("m['确定']")))]),e._v(" "),t("bk-button",{on:{click:e.goToServiceList}},[e._v(e._s(e.$t("m['取消']")))])],1)],2)])],1)},a=[];i._withStripped=!0},Bi2R:function(e,t,n){},BkRI:function(e,t,n){var i=n("OBhP");e.exports=function(e){return i(e,5)}},Bzqh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"FullScreen",props:{isFull:{type:Boolean,default:!1},title:{type:String,default:""}},watch:{isFull:function(e){e&&(this.$bkMessage({message:this.$t('m.common["按 ESC 键退出全屏"]')}),document.addEventListener("keydown",this.handlerKeyDown))}},methods:{onClose:function(){this.$emit("onClose")},handlerKeyDown:function(e){27===e.keyCode&&(this.onClose(),document.removeEventListener("keydown",this.handlerKeyDown))}}}},C65D:function(e,t,n){"use strict";n.r(t);var i=n("9g4e"),a=n("Vv2+");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("xgIe");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},C6tm:function(e,t,n){"use strict";n.r(t);var i=n("P+p4"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},CBo5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("efIh"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"TEXT",mixins:[r.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)}},mounted:function(){this.conditionField(this.item,this.fields),this.item.value&&!this.item.val&&(this.item.val=this.item.value)},methods:{}}},CPxG:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-send-message"},[e.show?t("bk-tab",{attrs:{active:e.activeName},on:{"tab-change":e.changPanel}},e._l(e.itemInfo.sub_components,(function(n,i){return t("bk-tab-panel",e._b({key:i,attrs:{"test-posi-id":n.key}},"bk-tab-panel",n,!1),[t("template",{slot:"label"},[t("bk-checkbox",{staticStyle:{float:"left",margin:"0px 8px 0 0"},attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus},model:{value:n.checked,callback:function(t){e.$set(n,"checked",t)},expression:"panel.checked"}}),e._v(" "),t("i",{staticClass:"bk-icon",class:[n.icon]}),e._v(" "),t("span",{staticClass:"panel-name"},[e._v(e._s(n.label))])],1),e._v(" "),e._l(n.field_schema,(function(a,r){return t("div",{key:a.key,staticClass:"mb20",attrs:{"test-posi-id":a.key}},[t("bk-form-item",{key:i,attrs:{label:a.name,required:a.required,desc:a.tips}},[t("change-conductor",{attrs:{index:i,"item-info":a,origin:"message","is-show-var":e.isShowVar},on:{"change-panel-status":function(t){return e.changePanelStatus(n,r)}}})],1)],1)}))],2)})),1):e._e()],1)},a=[];i._withStripped=!0},CQIX:function(e,t,n){"use strict";n("f9M4")},"CXV/":function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojNzM3OTg3O30KPC9zdHlsZT4KPGc+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNNzA0LDY0TDcwNCw2NEgxMjh2ODk2aDc2OFYyNTZsMCwwTDcwNCw2NHogTTcwNCwxNTQuNUw4MDUuNSwyNTZINzA0VjE1NC41eiBNODMyLDg5NkgxOTJWMTI4aDQ0OHYxOTJoMTkyCgkJVjg5NnoiLz4KCTxyZWN0IHg9IjI4OCIgeT0iMzIwIiBjbGFzcz0ic3QwIiB3aWR0aD0iMjU2IiBoZWlnaHQ9IjY0Ii8+Cgk8cmVjdCB4PSIyODgiIHk9IjQ0OCIgY2xhc3M9InN0MCIgd2lkdGg9IjQ0OCIgaGVpZ2h0PSI2NCIvPgoJPHJlY3QgeD0iMjg4IiB5PSI1NzYiIGNsYXNzPSJzdDAiIHdpZHRoPSI0NDgiIGhlaWdodD0iNjQiLz4KCTxyZWN0IHg9IjI4OCIgeT0iNzA0IiBjbGFzcz0ic3QwIiB3aWR0aD0iNDQ4IiBoZWlnaHQ9IjY0Ii8+CjwvZz4KPC9zdmc+Cg=="},CYQk:function(e,t,n){"use strict";n("vLQ5")},CjxG:function(e,t,n){"use strict";n.r(t);var i=n("mW7z"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},CyHO:function(e,t,n){"use strict";n.r(t);var i=n("HxM3"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},Cyyo:function(e,t,n){"use strict";n.r(t);var i=n("/BG8"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},DPRX:function(e,t,n){"use strict";n("p9GS")},DX1f:function(e,t,n){},"Ddt+":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-data-content",on:{click:e.closeError}},["CUSTOM"===e.formInfo.source_type?e._l(e.fieldInfo.list,(function(n,i){return t("div",{key:i,staticClass:"bk-custom-line",class:{mb20:i!==e.fieldInfo.list.length-1}},[t("div",{staticClass:"bk-costom-form"},[t("bk-input",{attrs:{maxlength:120,"ext-cls":"bk-custom-input",clearable:!0,disabled:(e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source)&&"bk_biz_id"!==e.formInfo.key,placeholder:e.$t("m.treeinfo['请输入选项名']")},on:{blur:function(t){return e.putChar(n,i)}},model:{value:n.name,callback:function(t){e.$set(n,"name",t)},expression:"item.name"}}),e._v(" "),"TABLE"===e.formInfo.type?[t("bk-checkbox",{staticStyle:{float:"left","margin-right":"10px","line-height":"32px"},attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus},model:{value:n.required,callback:function(t){e.$set(n,"required",t)},expression:"item.required"}},[e._v("\n            "+e._s(e.$t("m.treeinfo['必填']"))+"\n          ")])]:e._e(),e._v(" "),t("bk-input",{attrs:{"ext-cls":"bk-custom-input",disabled:(e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source||e.changeInfo.meta&&"APPROVE_RESULT"===e.changeInfo.meta.code)&&"bk_biz_id"!==e.formInfo.key,placeholder:e.$t("m.treeinfo['请输入选项ID']")},model:{value:n.key,callback:function(t){e.$set(n,"key",t)},expression:"item.key"}}),e._v(" "),t("div",{staticClass:"bk-custom-icon"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",class:{"bk-no-delete":e.changeInfo.meta&&"APPROVE_RESULT"===e.changeInfo.meta.code},on:{click:function(t){return e.addDataLine(n,i)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===e.fieldInfo.list.length||e.changeInfo.meta&&"APPROVE_RESULT"===e.changeInfo.meta.code},on:{click:function(t){return e.deleteDataLine(n,i)}}})])],2),e._v(" "),t("div",{staticClass:"bk-field-error-tip"},[n.nameCheck?t("p",{staticClass:"bk-field-error"},[e._v(e._s(e.$t('m.deployPage["名称不能为空且不能重复"]')))]):[n.keyCheck?t("p",{staticClass:"bk-field-error"},[e._v(e._s(e.$t('m.deployPage["名称ID为英文数字及下划线且不能重复"]')))]):e._e()]],2)])})):e._e(),e._v(" "),"API"===e.formInfo.source_type?[e.apiInfo.remote_system_id&&e.apiInfo.remote_api_id?t("div",{staticClass:"bk-api-param"},[e.apiDetail.req_params&&e.apiDetail.req_params.length&&e.apiDetail.req_params[0].name?t("div",{staticClass:"bk-param"},[t("get-param",{ref:"getParam",attrs:{entry:"addField","form-info":e.formInfo,"change-info":e.changeInfo,"state-list":e.stateList,"api-detail":e.apiDetail}})],1):e._e(),e._v(" "),e.apiDetail.req_body&&Object.keys(e.apiDetail.req_body).length&&e.apiDetail.req_body.properties&&Object.keys(e.apiDetail.req_body.properties).length?t("div",{staticClass:"bk-param"},[t("post-param",{ref:"postParam",attrs:{entry:"addField","form-info":e.formInfo,"change-info":e.changeInfo,"state-list":e.stateList,"api-detail":e.apiDetail}})],1):e._e(),e._v(" "),e.apiDetail.rsp_data&&Object.keys(e.apiDetail.rsp_data).length&&e.apiDetail.rsp_data.properties&&Object.keys(e.apiDetail.rsp_data.properties).length?t("div",{staticClass:"bk-param"},[t("response-data",{ref:"responseData",attrs:{"remote-api-iid":e.apiInfo.remote_api_id,"change-info":e.changeInfo,"form-info":e.formInfo,"state-list":e.stateList,"api-detail":e.apiDetail}})],1):e._e()]):e._e()]:e._e(),e._v(" "),"RPC"===e.formInfo.source_type?[e.prcTable.length?t("div",{staticClass:"bk-api-param"},[t("div",{staticClass:"bk-param"},[t("get-rpc-param",{ref:"getRpcParam",attrs:{"form-info":e.formInfo,"change-info":e.changeInfo,"state-list":e.stateList,"prc-table":e.prcTable}})],1)]):e._e()]:e._e()],2)},a=[];i._withStripped=!0},DoRf:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("14Xm")),a=s(n("gDS+")),r=s(n("D3Ub")),o=s(n("TQwK"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"responseCondition",components:{responseContent:o.default},props:{responseWayList:{type:Array,default:function(){return[]}},responseList:{type:Array,default:function(){return[]}},signal:String},data:function(){return{wayList:[],apiList:[]}},created:function(){},methods:{addResponse:function(e,t){this.responseList.splice(t+1,0,{way:"",wayInfo:{},performData:{runMode:"BACKEND",displayName:"",repeat:"one"},isLoading:!1})},deleteResponse:function(e,t){1!==this.responseList.length&&this.responseList.splice(t,1)},selectedWay:function(){var e=arguments,t=this;return(0,r.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:e[2].wayStatus&&(e[2].wayStatus=!1),e[2].isLoading=!0,e[2].wayInfo=JSON.parse((0,a.default)(t.responseWayList.filter((function(t){return t.key===e[0]}))[0])),setTimeout((function(){e[2].isLoading=!1}),1e3);case 4:case"end":return n.stop()}}),n,t)})))()}}}},Dsai:function(e,t,n){"use strict";n("ml2i")},DtGf:function(e,t,n){"use strict";n("SJYp")},Du1T:function(e,t,n){"use strict";n.r(t);var i=n("429m"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},Dx75:function(e,t,n){},E3ky:function(e,t,n){"use strict";n.r(t);var i=n("W/oT"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},EJGV:function(e,t,n){"use strict";n.r(t);var i=n("UFO8"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},EQfD:function(e,t,n){"use strict";n.r(t);var i=n("7XAC"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},EtUq:function(e,t,n){"use strict";n.r(t);var i=n("jppy"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},FCVG:function(e,t,n){"use strict";n.r(t);var i=n("f5y/"),a=n("9MBU");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"4ffb4b8c",null);t.default=s.exports},FGMr:function(e,t,n){"use strict";n.r(t);var i=n("afA4"),a=n("Du1T");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"ec63f852",null);t.default=s.exports},FQeJ:function(e,t,n){"use strict";n.r(t);var i=n("k2IW"),a=n("/inP");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("vg5J");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"365bc3f0",null);t.default=s.exports},FYiQ:function(e,t,n){},FauL:function(e,t,n){"use strict";n.r(t);var i=n("pV0w"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},FbwU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"NoData",props:{text:{type:String},fontSize:{type:[Number,String],default:16}},data:function(){return{imgUrl:n("tNV3")}}}},G4fa:function(e,t,n){},G6uA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("ybrk"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"RICHTEXT",components:{RichTextEditor:r.default},props:{item:{type:Object,required:!0,default:function(){}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},mounted:function(){this.item.value&&!this.item.val&&(this.item.val=this.item.value)}}},GHP1:function(e,t,n){"use strict";n("n43x")},GX6N:function(e,t,n){},GXg3:function(e,t,n){},GauI:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",{staticClass:"member-field"},[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,"ext-cls":"bk-ext-item",desc:e.item.tips,"desc-type":"icon"}},[t("div",{staticClass:"member-form-item",on:{click:function(t){e.item.checkValue=!1}}},[t("member-select",{class:{"bk-border-error":e.item.checkValue},attrs:{multiple:!1,disabled:e.item.is_readonly},model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}}),e._v(" "),t("business-card",{staticStyle:{"margin-top":"3px"},attrs:{item:e.item}})],1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},Gogv:function(e,t,n){},GtMo:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(e,t){if(!e||!t)return!1;if(-1!==t.indexOf(" "))throw new Error("className should not contain space.");return e.classList?e.classList.contains(t):(" "+e.className+" ").indexOf(" "+t+" ")>-1},a=function(e,t){if(e){for(var n=e.className,a=(t||"").split(" "),r=0,o=a.length;r<o;r++){var s=a[r];s&&(e.classList?e.classList.add(s):i(e,s)||(n+=" "+s))}e.classList||(e.className=n)}},r=function(e,t){if(e&&t){for(var n=t.split(" "),a=" "+e.className+" ",r=0,o=n.length;r<o;r++){var s=n[r];s&&(e.classList?e.classList.remove(s):i(e,s)&&(a=a.replace(" "+s+" "," ")))}e.classList||(e.className=(a||"").replace(/^[\s\uFEFF]+|[\s\uFEFF]+$/g,""))}},o={beforeEnter:function(e){a(e,"collapse-transition"),e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.style.height="0",e.style.paddingTop=0,e.style.paddingBottom=0},enter:function(e){e.dataset.oldOverflow=e.style.overflow,0!==e.scrollHeight?(e.style.height=e.scrollHeight+"px",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom):(e.style.height="",e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom),e.style.overflow="hidden"},afterEnter:function(e){r(e,"collapse-transition"),e.style.height="",e.style.overflow=e.dataset.oldOverflow},beforeLeave:function(e){e.dataset||(e.dataset={}),e.dataset.oldPaddingTop=e.style.paddingTop,e.dataset.oldPaddingBottom=e.style.paddingBottom,e.dataset.oldOverflow=e.style.overflow,e.style.height=e.scrollHeight+"px",e.style.overflow="hidden"},leave:function(e){0!==e.scrollHeight&&(a(e,"collapse-transition"),e.style.height=0,e.style.paddingTop=0,e.style.paddingBottom=0)},afterLeave:function(e){r(e,"collapse-transition"),e.style.height="",e.style.overflow=e.dataset.oldOverflow,e.style.paddingTop=e.dataset.oldPaddingTop,e.style.paddingBottom=e.dataset.oldPaddingBottom}};t.default={name:"CollapseTransition",functional:!0,render:function(e,t){var n=t.children;return e("transition",{on:o},n)}}},Gy6q:function(e,t,n){},Gz9R:function(e,t,n){"use strict";n.r(t);var i=n("nrD6"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},H2GU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n("QbLZ")),a=m(n("m1cH")),r=m(n("jWXv")),o=m(n("rfXi")),s=m(n("14Xm")),c=m(n("D3Ub")),l=m(n("GQeE")),u=m(n("aNPh")),d=m(n("2eEL")),f=m(n("ibAw")),p=n("CeR/");function m(e){return e&&e.__esModule?e:{default:e}}t.default={name:"commonTriggerList",components:{addTrigger:u.default,collapseTransition:d.default},props:{sourceId:{type:[String,Number],default:""},stepSignal:{type:String,default:""},origin:{type:String,default:"task"},sender:{type:[Number,String],default:""},templateStage:{type:String,default:""},table:{type:[Number,String],default:""},nodeType:{type:String,default:""}},data:function(){return{boundTriggerList:[],boundListLoading:!1,showMoreConfig:!1,triggerDialogInfo:{isShow:!1,searchKey:"",list:[],listLoading:!1},triggerSliderInfo:{isShow:!1,title:this.$t("m.taskTemplate['创建触发器']"),width:950,addLoading:!1,item:{}},iconList:[{key:"icon-icon-notice-new",name:"",typeName:"message"},{key:"icon-icon-user-new",name:"",typeName:"user"},{key:"icon-icon-status-new",name:"",typeName:"status"},{key:"icon-icon-api-new",name:"",typeName:"api"}],originInfoToTrigger:{},stage:"",signal:"",type:"",sourceType:"",senderId:"",triggerEventListFilter:"",isFormChanged:!1}},computed:{citeList:function(){return this.triggerDialogInfo.list.filter((function(e){return e.checked}))},globalChoise:function(){return this.$store.state.common.configurInfo},openFunction:function(){return this.$store.state.openFunction},allSignal:function(){var e={state:"STATE",transition:"TRANSITION",workflow:"FLOW"};return this.stepSignal?this.stepSignal:e[this.origin]?(0,l.default)(this.globalChoise.trigger_signals[e[this.origin]]).join(","):""}},watch:{sourceId:function(e){e&&this.initData()},stepSignal:function(){this.initData()}},mounted:function(){var e=this;return(0,c.default)(s.default.mark((function t(){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initData();case 2:case"end":return t.stop()}}),t,e)})))()},methods:{initData:function(){var e=this;return(0,c.default)(s.default.mark((function t(){return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initParams(),e.setFilterSignal(),e.getPublicTriggerList(),t.next=5,e.getBoundTriggerList();case 5:case"end":return t.stop()}}),t,e)})))()},initParams:function(){if(this.senderId=this.sourceId,this.sourceType="workflow",this.stepSignal)return this.sourceType="task",this.triggerEventListFilter="TASK",this.type="task_schemas",void(this.stage=this.templateStage);"state"===this.origin&&(this.triggerEventListFilter="STATE",this.senderId=this.sender,this.type="states"),"transition"===this.origin&&(this.showMoreConfig=!0,this.triggerEventListFilter="TRANSITION",this.senderId=this.sender,this.type="transitions"),"workflow"===this.origin&&(this.showMoreConfig=!0,this.triggerEventListFilter="FLOW",this.type="templates")},setFilterSignal:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=e;["TASK","TASK-SOPS","SIGN"].indexOf(this.nodeType)>-1&&"state"===this.origin&&(t=(0,o.default)(new r.default(["CLAIM_STATE","DELIVER_STATE","DISTRIBUTE_STATE"].concat((0,a.default)(e)))));var n=this.allSignal.split(",");this.signal=n.filter((function(e){return-1===t.indexOf(e)})).join(",")},getBoundTriggerList:function(){var e=this;return(0,c.default)(s.default.mark((function t(){var n;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.sourceId){t.next=2;break}return t.abrupt("return");case 2:return n={source_id:e.sourceId,source_type:e.sourceType,sender:e.senderId,signal__in:e.signal,project_key:e.$store.state.project.id},e.boundListLoading=!0,t.next=6,e.$store.dispatch("taskTemplate/getTemplateTriggers",n).then((function(t){e.boundTriggerList=t.data.map((function(t){return(0,i.default)({},t,{iconKey:e.iconList.find((function(e){return e.typeName===t.icon})).key})}))})).catch((function(t){(0,p.errorHandler)(t,e)})).finally((function(){e.showMoreConfig=Boolean(e.boundTriggerList.length)||"workflow"===e.origin||"transition"===e.origin,e.boundListLoading=!1}));case 6:case"end":return t.stop()}}),t,e)})))()},selectAllFn:function(){var e=this.triggerDialogInfo.list.length!==this.citeList.length;this.triggerDialogInfo.list.forEach((function(t){t.checked=e}))},openNew:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.originInfoToTrigger={id:this.sourceId,signal:this.signal,sender:this.senderId,filter:this.triggerEventListFilter,source:this.sourceType,type:this.type,stage:this.stage},"cite"===e?this.triggerDialogInfo.isShow=!0:(this.triggerSliderInfo.item=t,this.triggerSliderInfo.isShow=!0),this.isFormChanged=!1},citeTrigger:function(){var e=this,t={project_key:this.$store.state.project.id,src_trigger_ids:this.citeList.map((function(e){return e.id})),dst_source_id:this.sourceId,dst_source_type:this.sourceType,dst_sender:this.senderId};this.$store.dispatch("taskTemplate/patchCloneTriggers",t).then((function(){e.$bkMessage({message:e.$t("m.taskTemplate['引用成功']"),theme:"success"})})).catch((function(t){(0,p.errorHandler)(t,e)})).finally((function(){e.triggerDialogInfo.isShow=!1,e.getBoundTriggerList()}))},delTrigger:function(e){var t=this;this.$bkInfo({type:"warning",title:this.$t("m.taskTemplate['确认删除触发器？']"),subTitle:this.$t("m.taskTemplate['一旦删除，该触发器相关的动作将会一并删除。']"),confirmFn:function(){t.doDelTrigger(e)}})},doDelTrigger:function(e){var t=this;this.$store.dispatch("taskTemplate/deleteTrigger",e.id).then((function(){t.$bkMessage({message:t.$t("m.flowManager['删除成功']"),theme:"success"})})).catch((function(e){(0,p.errorHandler)(e,t)})).finally((function(){t.getBoundTriggerList()}))},getPublicTriggerList:function(){var e=this,t={source_id:0,source_type:"basic",sender:0,is_draft:!1,signal__in:this.signal,name__icontains:this.triggerDialogInfo.searchKey,project_key:this.$store.state.project.id};this.table&&(t.source_table_id=this.table),this.triggerDialogInfo.listLoading=!0,this.$store.dispatch("taskTemplate/getTemplateTriggers",t).then((function(t){e.triggerDialogInfo.list=t.data.map((function(t){return(0,i.default)({},t,{checked:!1,iconKey:e.iconList.find((function(e){return e.typeName===t.icon})).key})}))})).catch((function(t){(0,p.errorHandler)(t,e)})).finally((function(){e.triggerDialogInfo.listLoading=!1}))},newTrigger:function(){this.initDialogInfo(),this.$router.push({name:"projectTrigger",query:{project_id:this.$route.query.project_id}})},initDialogInfo:function(){this.triggerDialogInfo.isShow=!1,this.triggerDialogInfo.searchKey=""},searchInfo:function(){this.getPublicTriggerList()},clearSearch:function(){this.triggerDialogInfo.searchKey="",this.getPublicTriggerList()},handleBeforeClose:function(){var e=this;return(0,c.default)(s.default.mark((function t(){var n;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isFormChanged){t.next=5;break}return t.next=3,(0,f.default)();case 3:return n=t.sent,t.abrupt("return",n);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t,e)})))()}}}},HLWp:function(e,t,n){},HOWN:function(e,t,n){"use strict";n.r(t);var i=n("lWSq"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},HQF7:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("m1cH")),a=h(n("P2sY")),r=h(n("14Xm")),o=h(n("D3Ub")),s=h(n("GQeE")),c=h(n("vUrO")),l=h(n("ruTk")),u=h(n("PIEm")),d=h(n("bcjM")),f=h(n("s4tT")),p=h(n("I1Ty")),m=h(n("EstQ"));function h(e){return e&&e.__esModule?e:{default:e}}function v(){return{required:!0,message:m.default.t('m.treeinfo["字段必填"]'),trigger:"blur"}}var g=(0,l.default)();t.default={name:"devops",components:{BasicCard:f.default,commonTriggerList:d.default,NoData:p.default,dealPerson:u.default,BkRenderForm:g,descInfo:c.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}},state:{type:[String,Number],default:function(){return""}}},data:function(){return{isLoading:!1,basicInfo:{nodeName:"",desc:"",plugin:"",version:"",processors:[]},pluginList:[],versionList:[],hookVarList:{},hookSelectList:{},versionListLoading:!1,versionListDisabled:!0,formLoading:!1,basicInfoRules:{nodeName:[v()],plugin:[v()],version:[v()]},checkStatus:{delivers:!1,processors:!1},excludeProcessor:["EMPTY","OPEN"],processorsInfo:{type:"",value:""},formKey:"",hookedVarList:{},initForm:{},stateList:[],schema:{},layout:[],outputsData:[],outputsVarList:{},primarySchema:{},formData:{},formType:"vertical",rules:{maxLength20:{validator:"{{ $self.value.length < 20}}",message:this.$t("m['长度必须大于 20']")},number:{validator:"/!^[0-9]*$/",message:this.$t("m['必须是数字']")},required:{message:this.$t("m['值不能为空']"),validator:'{{ $self.value !== ""}}'},reservedWord:{validator:'{{ !$self.value.includes("bk") }}',message:this.$t("m['不能使用保留字符']")}},context:{bizId:1,site_url:"/o/bk_sops/",projectId:this.$route.query.project_id,baseURL:"",pod_name:"test_pod_name"},pluginTip:"",errorList:[]}},computed:{isHasSchma:function(){return 0===(0,s.default)(this.schema).length&&this.formLoading}},watch:{basicInfo:{handler:function(e){""===e.plugin?(e.version="",this.pluginTip="",this.versionList=[],this.schema={},this.outputsData=[],this.formLoading=!1,this.versionListDisabled=!0):this.versionListDisabled=!1,""===e.version?(this.schema={},this.outputsData=[],this.formLoading=!1):this.formLoading=!0},deep:!0}},mounted:function(){this.initData(),this.getRelatedFields()},methods:{initData:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n,i;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.isLoading=!0,e.basicInfo.nodeName=e.configur.name,e.basicInfo.desc=e.configur.desc,e.processorsInfo={type:e.configur.processors_type,value:e.configur.processors},e.$store.dispatch("bkPlugin/getPluginList").then((function(t){e.pluginList=t.data.plugins,e.getExcludeRoleTypeList()})),0!==(0,s.default)(e.configur.extras).length&&(e.basicInfo.plugin=e.configur.extras.bk_plugin_info.plugin_code,e.onSelectplugin(e.basicInfo.plugin),e.basicInfo.version=e.configur.extras.bk_plugin_info.version,e.initForm=!0,e.getFormInfo(e.basicInfo.version),e.formData=e.configur.extras.bk_plugin_info.inputs,e.primarySchema=e.configur.extras.bk_plugin_info.inputs,e.schema=e.primarySchema,n=e.configur.extras.outputs_var_list||{},i=e.configur.extras.input_var_list||{},(0,s.default)(n).map((function(t){e.$set(e.outputsVarList,t,n[t])})),(0,s.default)(i).map((function(t){e.$set(e.hookVarList,t,i[t]),i[t]&&(e.hookSelectList[t]=e.formData[t])}))),e.isLoading=!1;case 7:case"end":return t.stop()}}),t,e)})))()},getRelatedFields:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n={workflow:e.flowInfo.id,state:e.configur.id,field:""},e.$store.dispatch("apiRemote/get_related_fields",n).then((function(t){e.stateList=t.data}));case 2:case"end":return t.stop()}}),t,e)})))()},onChangeChecked:function(e,t,n){var i=(0,a.default)({},this.formData);e?("integer"===n.type&&(n.type="string"),(0,a.default)(n,{"ui:component":{name:"bk-input",props:{disabled:!0,value:i[t]}}})):(0,a.default)(n,{"ui:component":{name:"bk-input",props:{disabled:!1,value:i[t]}}}),e||(this.hookSelectList[t]=""),this.formKey=(new Date).getTime()},changeConstant:function(e,t,n){"integer"===n.type&&(n.type="string"),this.hookSelectList[t]="{{"+e+"}}",this.formData[t]=this.hookSelectList[t],(0,a.default)(n,{"ui:component":{name:"bk-input",props:{disabled:!0,value:this.hookSelectList[t]}}}),this.formKey=(new Date).getTime()},onchangeOutputCheck:function(e,t){this.outputsVarList[t.row.key]=e},getExcludeRoleTypeList:function(){var e=[];e=this.configur.is_builtin?["BY_ASSIGNOR","STARTER","VARIABLE"]:["OPEN"],"DISTRIBUTE_THEN_PROCESS"!==this.configur.distribute_type&&"DISTRIBUTE_THEN_CLAIM"!==this.configur.distribute_type&&e.push("BY_ASSIGNOR"),this.flowInfo.is_biz_needed||e.push("CMDB"),this.excludeProcessor=["EMPTY","API"].concat((0,i.default)(e))},handleVarClick:function(e,t){this.formData[t]="{{"+e.key+"}}",this.$set(this.hookedVarList,t,!1),this.formKey=(new Date).getTime()},onSelectplugin:function(e){var t=this;this.pluginTip="",this.schema={},this.formData={},this.versionListLoading=!0,this.basicInfo.version="",this.formLoading=!1;try{var n={plugin_code:e};this.$store.dispatch("bkPlugin/getPluginMeta",n).then((function(e){t.pluginTip=e.data.description,t.versionList=e.data.versions}))}catch(e){console.log(e)}finally{this.versionListLoading=!1}},getFormInfo:function(e){var t=this;this.schema={},this.formData={};try{var n={plugin_code:this.basicInfo.plugin,plugin_version:e};this.$store.dispatch("bkPlugin/getPluginDetail",n).then((function(e){delete e.data.inputs.$schema,t.schema=e.data.inputs||{},(0,s.default)(t.schema.properties).map((function(e){"integer"===t.schema.properties[e].type&&(t.schema.properties[e].type="string")})),0!==(0,s.default)(e.data.outputs.properties).length?t.outputsData=(0,s.default)(e.data.outputs.properties).map((function(t){return{key:t,title:e.data.outputs.properties[t].title}})):t.outputsData=[],t.initForm||(t.outputsVarList={},t.hookSelectList={},t.hookVarList={}),t.initForm=!1}))}catch(e){console.log(e)}},closeNode:function(){this.$parent.closeConfigur()},submit:function(){var e=this;this.$refs.basicInfo.validate().then((function(){e.errorList=[];var t=e.schema.required||[];if((0,s.default)(e.$refs.bkForm.value).map((function(n){return!t.includes(n)||(""!==e.$refs.bkForm.value[n]&&0!==e.$refs.bkForm.value[n].length||(e.errorList.includes(n)||e.errorList.push(n),!1))})).every((function(e){return e}))){var n=e.$refs.processors.getValue(),i=n.value,a=n.type,r={plugin_code:e.basicInfo.plugin,version:e.basicInfo.version,inputs:e.formData,context:{}},o=[];if(e.outputsData.forEach((function(t){e.outputsVarList[t.key]&&e.outputsVarList[t.key]&&o.push({name:t.title,ref_path:"resp.outputs."+t.key,source:"global",type:"STRING"})})),!e.$refs.processors||e.$refs.processors.verifyValue()){if(e.$refs.bkForm)if(!e.$refs.bkForm.validateForm())return;var c={name:e.basicInfo.nodeName,desc:e.basicInfo.desc||void 0,processors:i||"",processors_type:a||"",type:"BK-PLUGIN",is_draft:!1,extras:{bk_plugin_info:r,outputs_var_list:e.outputsVarList,input_var_list:e.hookVarList},variables:{outputs:o},workflow:e.configur.workflow},l=e.configur.id;e.$store.dispatch("cdeploy/putWebHook",{params:c,stateId:l}).then((function(){e.$bkMessage({message:e.$t("m['保存成功']"),theme:"success"}),e.$parent.closeConfigur()}),(function(e){console.log(e)})).finally((function(){e.secondClick=!1}))}else e.checkStatus.processors=!0}}))}}}},"Ha+5":function(e,t,n){"use strict";n.r(t);var i=n("NLOC"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},HgU8:function(e,t,n){"use strict";n("aqZ4")},HiwQ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-basic-node"},[t("basic-card",{attrs:{"card-label":e.$t("m.treeinfo['基本信息']")}},[t("bk-form",{ref:"basicInfo",attrs:{model:e.basicInfo,"label-width":150,rules:e.basicInfoRules,"ext-cls":"bk-form","form-type":"vertical"}},[t("bk-form-item",{attrs:{"data-test-id":"devops-input-name",label:e.$t("m.treeinfo['节点名称：']"),required:!0,"ext-cls":"bk-form-width bk-form-display",property:"nodeName"}},[t("bk-input",{attrs:{clearable:!0},model:{value:e.basicInfo.nodeName,callback:function(t){e.$set(e.basicInfo,"nodeName",t)},expression:"basicInfo.nodeName"}})],1),e._v(" "),t("desc-info",{model:{value:e.basicInfo.desc,callback:function(t){e.$set(e.basicInfo,"desc",t)},expression:"basicInfo.desc"}}),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"devops-select-project",label:e.$t("m['项目']"),required:!0,"ext-cls":"bk-form-width bk-form-display",property:"businessId"}},[t("bk-select",{attrs:{searchable:"",disabled:!1},on:{selected:e.onSelectBusiness},model:{value:e.basicInfo.businessId,callback:function(t){e.$set(e.basicInfo,"businessId",t)},expression:"basicInfo.businessId"}},e._l(e.businessList,(function(e){return t("bk-option",{key:e.englishName,attrs:{id:e.englishName,name:e.projectName}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"devops-select-pipeline",label:e.$t("m['流水线：']"),required:!0,property:"pipelineId","ext-cls":"bk-form-width bk-form-display"}},[t("bk-select",{attrs:{searchable:"",loading:e.pipelineLoading,disabled:e.pipelineDisabled},on:{selected:function(t){return e.getPipelineInfo(0)}},model:{value:e.basicInfo.pipelineId,callback:function(t){e.$set(e.basicInfo,"pipelineId",t)},expression:"basicInfo.pipelineId"}},e._l(e.pipelineList,(function(e){return t("bk-option",{key:e.pipelineId,attrs:{id:e.pipelineId,name:e.pipelineName}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"devops-component-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{value:e.processorsInfo,"show-overbook":!0,"node-info":e.configur,"exclude-role-type-list":e.excludeProcessor}})],1)])],1)],1),e._v(" "),t("basic-card",[t("div",{staticClass:"piprline-title"},[t("p",[e._v(e._s(e.$t("m['流水线参数']"))+":")]),e._v(" "),t("p",[e._v(e._s(e.$t("m.treeinfo['调用该API需要传递的参数信息']")))])]),e._v(" "),0!==e.pipelineFormList.length?t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.pipeFormLoading},expression:"{ isLoading: pipeFormLoading }"}],staticClass:"bk-param"},[t("bk-form",{ref:"devopsVariable",attrs:{"ext-cls":"pipelineForm","form-type":"vertical",model:e.pipelineData,rules:e.pipelineRules,"label-width":200}},e._l(e.pipelineFormList,(function(n){return t("bk-form-item",{key:n.id,attrs:{label:n.id,property:n.id,rules:e.pipelineRules[n.id],required:n.required}},[t("bk-input",{attrs:{disabled:e.hookVarList[n.id],clearable:!0},model:{value:e.pipelineData[n.id],callback:function(t){e.$set(e.pipelineData,n.id,t)},expression:"pipelineData[pipeline.id]"}}),e._v(" "),t("bk-checkbox",{attrs:{"ext-cls":"select-check"},on:{change:function(t){return e.onChangeChecked(t,n)}},model:{value:e.hookVarList[n.id],callback:function(t){e.$set(e.hookVarList,n.id,t)},expression:"hookVarList[pipeline.id]"}}),e._v(" "),t("bk-select",{staticStyle:{width:"200px"},attrs:{disabled:!e.hookVarList[n.id],"ext-cls":"select-custom",searchable:"",value:e.getHookListValue(n.id)},on:{selected:function(t){return e.changeConstant(t,n)}}},e._l(e.stateList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.key,name:e.name}})})),1)],1)})),1),e._v(" "),t("span",{staticClass:"setion-title-icon",on:{click:function(t){t.stopPropagation(),e.showPipelineStages=!e.showPipelineStages}}},[e.showPipelineStages?t("i",{staticClass:"bk-icon icon-angle-down"}):t("i",{staticClass:"bk-icon icon-angle-right"}),e._v("\n        "+e._s(e.$t("m.tickets['插件预览']"))+"\n      ")]),e._v(" "),t("devops-preview",{directives:[{name:"show",rawName:"v-show",value:e.showPipelineStages,expression:"showPipelineStages"}],attrs:{stages:e.pipelineStages}})],1):t("no-data"),e._v(" "),t("div",{staticClass:"piprline-title"},[t("p",[e._v(e._s(e.$t("m['输出变量']"))+":")]),e._v(" "),t("p",[e._v(e._s(e.$t('m[\'如何获取蓝盾流水线变量? 可以在bash插件中使用 setEnv "hello" "world" 或者在 Python 插件中 使用 set_env("hello", "world") ，具体的使用方法请参考蓝盾指引。\']')))])]),e._v(" "),t("bk-table",{attrs:{data:e.returnReslut,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m['变量名称']")},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable},on:{change:function(t){return e.changeReturnInput(n.row,n.$index)}},model:{value:n.row.name,callback:function(t){e.$set(n.row,"name",t)},expression:"props.row.name"}})]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['来源']")},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable,placeholder:e.$t("m['输入变量来源，如：resp.message']")},on:{change:function(t){return e.changeReturnInput(n.row,n.$index)}},model:{value:n.row.ref_path,callback:function(t){e.$set(n.row,"ref_path",t)},expression:"props.row.ref_path"}})]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['操作']"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(n){return e.disable||e.isShowDelete===e.returnReslut.indexOf(n.row)?void 0:[t("i",{staticClass:"bk-itsm-icon icon-flow-other-add result-icon",on:{click:e.addReturnReslut}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-other-reduc result-icon",class:{"no-delete":e.retrunResultIsEmtry},on:{click:function(t){return e.deleteReturnReslut(n.row)}}})]}}],null,!0)})],1),e._v(" "),t("common-trigger-list",{attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"mt20",staticStyle:{"font-size":"0"}},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"devops-button-submit",title:e.$t("m.treeinfo['确定']")},on:{click:e.submit}},[e._v("\n        "+e._s(e.$t("m.treeinfo['确定']"))+"\n      ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"devops-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['取消']"))+"\n      ")])],1)],1)],1)},a=[];i._withStripped=!0},HksE:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=m(n("vDqi")),a=n("CeR/"),r=m(n("y7UH")),o=m(n("s8s0")),s=m(n("jzyo")),c=m(n("kAUb")),l=m(n("+DAV")),u=m(n("vHDd")),d=m(n("Tz34")),f=m(n("7Uj4")),p=m(n("tZ7T"));function m(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ServiceProcessStep",components:{secondFlow:r.default,basicNode:o.default,autoNode:s.default,sopsNode:c.default,signNode:l.default,ApprovalNode:d.default,devopsNode:u.default,bkPluginNode:p.default,webHookNode:f.default},props:{serviceInfo:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}}},data:function(){return{flowDataLoading:!1,isShowNodeConfig:!1,nodeList:[],lineList:[],configur:{}}},computed:{processId:function(){return this.serviceInfo.workflow_id},nodeType:function(){return{"TASK-DEVOPS":this.$t('m["蓝盾节点"]'),"TASK-SOPS":this.$t('m["标准运维节点"]'),NORMAL:this.$t('m["手动节点"]'),TASK:this.$t('m["任务节点"]'),APPROVAL:this.$t('m["审批节点"]'),SIGN:this.$t('m["会签节点"]'),WEBHOOK:this.$t('m["WEBHOOK节点"]'),"BK-PLUGIN":this.$t('m["蓝鲸插件节点"]')}[this.configur.type]}},watch:{isShowNodeConfig:function(e){this.$emit("setConfigStatus",e)}},created:function(){this.$emit("setConfigStatus",this.isShowNodeConfig)},mounted:function(){this.processId&&this.getFlowChart()},methods:{getFlowChart:function(){var e=this;this.flowDataLoading=!0,i.default.all([this.$store.dispatch("deployCommon/getStates",{workflow:this.processId}),this.$store.dispatch("deployCommon/getChartLink",{workflow:this.processId,page_size:1e3})]).then(i.default.spread((function(t,n){e.nodeList=t.data,e.lineList=n.data.items}))).finally((function(){e.flowDataLoading=!1}))},handleNodeClick:function(e){this.isShowNodeConfig=!0,this.configur=e},closeConfigur:function(){this.isShowNodeConfig=!1,this.configur={},this.$emit("updateFlowInfo")},submitFlow:function(){var e=this,t=this.$refs.flowInfo.canvasData,n={workflow_id:this.processId,transitions:[]};t.lines.forEach((function(e){n.transitions.push({id:e.lineInfo.id,axis:{start:e.source.arrow,end:e.target.arrow}})})),this.$store.dispatch("deployCommon/updateFlowLine",{params:n}).catch((function(t){(0,a.errorHandler)(t,e)}))},saveProcess:function(){var e=this,t=this.processId;return this.$store.dispatch("cdeploy/submitChart",{params:[],id:t}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"})}),(function(t){return t.data&&t.data.data&&(e.errorList=t.data.data.invalid_state_ids,e.$refs.flowInfo.errorNodes(e.errorList)),(0,a.errorHandler)(t,e),{data:{result:!1}}}))},validate:function(){return this.submitFlow(),this.saveProcess()}}}},Hlvs:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=v(n("GQeE")),a=v(n("4d7F")),r=v(n("14Xm")),o=v(n("m1cH")),s=v(n("D3Ub")),c=v(n("vUrO")),l=v(n("PIEm")),u=v(n("bcjM")),d=v(n("s4tT")),f=v(n("tgnH")),p=v(n("I1Ty")),m=n("CeR/"),h=v(n("EstQ"));function v(e){return e&&e.__esModule?e:{default:e}}function g(){return{required:!0,message:h.default.t('m.treeinfo["字段必填"]'),trigger:"blur"}}t.default={name:"devops",components:{BasicCard:d.default,commonTriggerList:u.default,DevopsPreview:f.default,NoData:p.default,dealPerson:l.default,descInfo:c.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}},state:{type:[String,Number],default:function(){return""}}},data:function(){return{isLoading:!1,basicInfo:{nodeName:"",desc:"",businessId:"",pipelineId:"",processors:[]},businessList:[],pipelineList:[],pipelineDisabled:!0,pipelineLoading:!1,constants:[],hookVarList:{},hookSelectList:{},pipelineFormList:[],pipelineData:{},pipeFormLoading:!1,pipelineStages:[],showPipelineStages:!0,basicInfoRules:{nodeName:[g()],businessId:[g()],pipelineId:[g()]},pipelineRules:{},checkStatus:{delivers:!1,processors:!1},excludeProcessor:["EMPTY","OPEN"],processorsInfo:{type:"",value:""},stateList:[],returnReslut:[{name:"",ref_path:"",check:!1}],disable:!1}},computed:{isShowDelete:function(){return this.returnReslut.length-1},retrunResultIsEmtry:function(){return this.returnReslut.length<=1}},watch:{"basicInfo.businessId":function(e){this.pipelineDisabled=!e,e||(this.pipelineList=[],this.pipelineFormList=[],this.basicInfo.pipelineId="")},"basicInfo.pipelineId":function(e){e||(this.pipelineFormList=[])}},mounted:function(){this.initData(),this.getRelatedFields()},methods:{initData:function(){var e=this;return(0,s.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$store.dispatch("ticket/getDevopsUserProjectList").then((function(t){e.businessList=t.data,e.configur&&!e.configur.is_draft&&(e.basicInfo.nodeName=e.configur.name,e.basicInfo.desc=e.configur.desc,e.basicInfo.businessId=t.data.filter((function(t){return t.project_name===e.configur.extras.devops_info.project_id.name}))[0].englishName,e.onSelectBusiness(),e.basicInfo.pipelineId=e.configur.extras.devops_info.pipeline_id.value,e.processorsInfo={type:e.configur.processors_type,value:e.configur.processors},e.returnReslut=0!==e.configur.extras.devops_info.outputs.length?[].concat((0,o.default)(e.configur.extras.devops_info.outputs),(0,o.default)(e.returnReslut)):[{name:"",ref_path:"",check:!1}],e.getExcludeRoleTypeList(),e.configur.extras.devops_info.constants.forEach((function(t){e.$set(e.hookVarList,t.key,t.checked),e.$set(e.hookSelectList,t.key,t.checked?t.value:"")})),e.getPipelineInfo(1))}));case 1:case"end":return t.stop()}}),t,e)})))()},getRelatedFields:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={workflow:e.flowInfo.id,state:e.configur.id,field:""},t.next=3,e.$store.dispatch("apiRemote/get_related_fields",n).then((function(t){e.stateList=t.data})).catch((function(t){(0,m.errorHandler)(t,e)})).finally((function(){}));case 3:case"end":return t.stop()}}),t,e)})))()},onChangeChecked:function(e,t){e?this.pipelineData[t.id]="":(this.pipelineData[t.id]=t.defaultValue,this.hookSelectList[t.id]="")},changeConstant:function(e,t){this.pipelineData[t.id]="${"+e+"}",this.hookSelectList[t.id]=e},addReturnReslut:function(){this.returnReslut.push({name:"",ref_path:"",check:!1})},changeReturnInput:function(e){e.check?[e.name,e.ref_path].every((function(e){return""===e}))&&(this.returnReslut.pop(),e.check=!1):(e.check=!0,this.returnReslut.push({name:"",ref_path:"",check:!1}))},deleteReturnReslut:function(e){if(!this.retrunResultIsEmtry){var t=this.returnReslut.indexOf(e);-1!==t&&this.returnReslut.splice(t,1)}},getExcludeRoleTypeList:function(){var e=[];e=this.configur.is_builtin?["BY_ASSIGNOR","STARTER","VARIABLE"]:["OPEN"],"DISTRIBUTE_THEN_PROCESS"!==this.configur.distribute_type&&"DISTRIBUTE_THEN_CLAIM"!==this.configur.distribute_type&&e.push("BY_ASSIGNOR"),this.flowInfo.is_biz_needed||e.push("CMDB"),this.excludeProcessor=["EMPTY","API"].concat((0,o.default)(e))},getHookListValue:function(e){return this.hookSelectList[e]&&this.hookSelectList[e].replace(/^\$\{/,"").replace(/\}$/,"")||""},onSelectBusiness:function(){var e=this;this.pipelineLoading=!0,this.basicInfo.pipelineId="";try{this.$store.dispatch("ticket/getDevopsPipelineList",{project_id:this.basicInfo.businessId}).then((function(t){e.pipelineList=t.data}))}catch(e){console.log(e)}finally{this.pipelineLoading=!1}},getPipelineInfo:function(e){var t=this;e||(this.hookSelectList={},this.hookVarList={}),this.pipeFormLoading=!0,a.default.all([this.$store.dispatch("ticket/getDevopsPipelineStartInfo",{project_id:this.basicInfo.businessId,pipeline_id:this.basicInfo.pipelineId}),this.$store.dispatch("ticket/getDevopsPipelineDetail",{project_id:this.basicInfo.businessId,pipeline_id:this.basicInfo.pipelineId})]).then((function(n){t.pipelineData={},t.pipelineFormList=n[0].data.properties,n[0].data.properties.forEach((function(n){e&&(n.defaultValue=t.configur.extras.devops_info.constants.filter((function(e){return e.name===n.id}))[0].value),t.$set(t.pipelineData,n.id,t.hookVarList[n.id]?"${"+n.defaultValue+"}":n.defaultValue),t.pipelineRules[n.id]=[{required:n.required,message:h.default.t('m.treeinfo["字段必填"]'),trigger:"blur"}]})),t.pipelineStages=n[1].data.stages})).catch((function(e){console.log(e)})).finally((function(){t.pipeFormLoading=!1}))},closeNode:function(){this.$parent.closeConfigur()},getConstantValue:function(e){return this.hookVarList[e]?this.pipelineData[e].slice(2,this.pipelineData[e].length-1):this.pipelineData[e]},submit:function(){var e=this;!this.$refs.processors||this.$refs.processors.verifyValue()?a.default.all([this.$refs.basicInfo.validate(),this.$refs.devopsVariable?this.$refs.devopsVariable.validate():null]).then((function(){var t=e.businessList.filter((function(t){return t.project_code===e.basicInfo.businessId}))[0],n=e.pipelineList.filter((function(t){return t.pipelineId===e.basicInfo.pipelineId}))[0],a=(0,i.default)(e.pipelineData).map((function(t){return{value:e.getConstantValue(t),name:t,key:t,checked:e.hookVarList[t],type:e.hookVarList[t]?"variable":"custom"}})),r=e.returnReslut.filter((function(e){return""!==e.name}));r.forEach((function(e){e.source="global",e.type="string"}));var o=e.$refs.processors.getValue(),s=o.value,c=o.type,l={extras:{devops_info:{username:window.username,project_id:{value:t.projectCode,name:t.projectName,key:t.project_id},pipeline_id:{value:n.pipelineId,name:n.pipelineName,key:n.pipeline_id},constants:a,outputs:r}},variables:{outputs:r},processors:s||"",processors_type:c,is_draft:!1,is_terminable:!1,name:e.basicInfo.nodeName,desc:e.basicInfo.desc||void 0,type:"TASK-DEVOPS",workflow:e.configur.workflow},u=e.configur.id;e.$store.dispatch("cdeploy/putDevopsInfo",{params:l,stateId:u}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$parent.closeConfigur()}),(function(t){(0,m.errorHandler)(t,e)})).finally((function(){}))})):this.checkStatus.processors=!0}}}},HtfW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("m1cH")),a=l(n("14Xm")),r=l(n("gDS+")),o=l(n("GQeE")),s=l(n("D3Ub")),c=l(n("VflG"));function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"responseDataNode",components:{},mixins:[c.default],props:{changeInfo:{type:Object,default:function(){return{}}},apiDetail:{type:Object,default:function(){}},stateList:{type:Array,default:function(){return[]}},isCustom:{type:Boolean,default:!1},isStatic:{type:Boolean,default:!1}},data:function(){return{trueStatus:!0,falseStatus:!1,cascaderData:[],organization:{processorPerson:[],processorTree:{},assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:!1},bodyTableData:[],responseTableData:[],paramTableData:[],checkInfo:{name:"",road:""},sourceTypeList:[{id:1,key:"CUSTOM",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"FIELDS",name:this.$t('m.treeinfo["引用变量"]')}],paramTableInfo:{value:"",placeholder:this.$t('m.treeinfo["请选择数据来源"]')},selectInfo:{selectkeylist:[],selectkey:"",selectvaluelist:[],selectvalue:""},isShow:!1,objIsCanUse:!1}},computed:{tableList:function(){return this.responseTableData.filter((function(e){return e.isShow}))}},watch:{apiDetail:function(e,t){this.initData()}},mounted:function(){this.initData()},methods:{initData:function(){this.responseTableDataChange()},responseTableDataChange:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((0,o.default)(e.apiDetail.rsp_data).length){t.next=5;break}e.apiDetail.responseTreeDataList=[{has_children:!1,showChildren:!1,checkInfo:!1,key:"root",is_necessary:!0,type:"object",desc:e.$t('m.treeinfo["初始化数据"]'),parentInfo:"",children:[]}],e.apiDetail.responseTableData=[],t.next=11;break;case 5:return t.next=7,e.jsonschemaToList({root:JSON.parse((0,r.default)(e.apiDetail.rsp_data))});case 7:return e.apiDetail.responseTreeDataList=t.sent,t.next=10,e.treeToTableList(JSON.parse((0,r.default)(e.apiDetail.responseTreeDataList[0].children)));case 10:e.apiDetail.responseTableData=t.sent;case 11:return t.next=13,JSON.parse((0,r.default)(e.apiDetail.responseTableData));case 13:return n=t.sent,t.next=16,n.forEach((function(e){e.isCheck=!1,e.isSatisfied=!1,e.el=null,e.children=[],e.source_type="",e.customValue=e.value,e.value="",e.name=e.key,e.isSelectAbled=!1,e.isSelectedKey=!1,e.isSelectedValue="",e.isSelectedValueDisabled=!0}));case 16:return t.next=18,e.recordChildren(n);case 18:return t.next=20,e.recordParent(n);case 20:return t.next=22,e.showSelectAbled(n);case 22:return t.next=24,n.filter((function(e){return e.isSelectAbled})).forEach(function(){var t=(0,s.default)(a.default.mark((function t(n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.markCanUseArray(n);case 2:case"end":return t.stop()}}),t,e)})));return function(e){return t.apply(this,arguments)}}());case 24:return t.next=26,n;case 26:return e.responseTableData=t.sent,t.next=29,e.makeArrayTree(e.responseTableData.filter((function(e){return!e.level})));case 29:return e.cascaderData=t.sent,e.organization.assignorPerson=JSON.parse((0,r.default)(e.cascaderData)),t.next=33,e.organization.assignorPerson.forEach((function(t){e.treeData(t,"assignors")}));case 33:if(!e.isCustom){t.next=35;break}return t.abrupt("return");case 35:if(!e.changeInfo.api_info||e.changeInfo.api_info.remote_api_id!==e.apiDetail.id){t.next=39;break}return t.next=38,e.changeInfo.variables.outputs.filter((function(e){return"global"===e.source})).forEach(function(){var t=(0,s.default)(a.default.mark((function t(n){var i,r;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.ref_path.split(".");case 2:return i=t.sent,t.next=5,i.map((function(e,t){return e=t+"_"+e}));case 5:r=t.sent,e.responseTableData.filter((function(e){return e.ancestorsList_str===r.toString()})).forEach((function(e){e.isSelectedKey=!0,e.isSelectedValue=n.name,e.isSelectedValueDisabled=!1}));case 7:case"end":return t.stop()}}),t,e)})));return function(e){return t.apply(this,arguments)}}());case 38:e.$parent.$parent.lineInfo.between=e.changeInfo.api_info.succeed_conditions.type;case 39:if(!(e.changeInfo.api_info&&e.changeInfo.api_info.remote_api_id===e.apiDetail.id&&e.changeInfo.api_info.succeed_conditions&&e.changeInfo.api_info.succeed_conditions.expressions&&e.changeInfo.api_info.succeed_conditions.expressions.length)){t.next=45;break}return t.next=42,e.changeInfo.api_info.succeed_conditions.expressions.map((function(t){var n={type:t.type,expressions:[]};return n.expressions=t.expressions.map((function(t){var n=t.key.split(".").map((function(e,t){return e=t+"_"+e})).toString(),i=e.responseTableData.filter((function(e){return e.ancestorsList_str===n}))[0],a={condition:t.condition,key:n,name:"",choiceList:"",value:t.value,type:i?i.type:"string",organization:{assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:!1}};return"boolean"===a.type&&(a.value=a.value?"1":"0"),a.organization.assignorPerson=JSON.parse((0,r.default)(e.cascaderData)),a.organization.assignorPerson.forEach((function(t){e.treeData(t,"assignors",a,n)})),a})),n}));case 42:e.$parent.$parent.lineInfo.expressions=t.sent,t.next=47;break;case 45:return t.next=47,e.$parent.$parent.lineInfo.expressions.forEach((function(t){var n;t.expressions.forEach((n=(0,s.default)(a.default.mark((function t(n){var i;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=JSON.parse((0,r.default)(e.cascaderData)),t.next=3,i.forEach((function(t){e.treeData(t,"assignors")}));case 3:n.organization.assignorPerson=i;case 4:case"end":return t.stop()}}),t,e)}))),function(e){return n.apply(this,arguments)}))}));case 47:case"end":return t.stop()}}),t,e)})))()},treeData:function(e,t,n,i){var a=this;e.checkInfo=!1,e.has_children=!(!e.children||!e.children.length),e.showChildren=!1,i===String(e.ancestorsList_str)&&n&&i&&(e.checkInfo=!0,n.organization.assignorTree=e),e.has_children&&e.children.forEach((function(e){a.treeData(e,t,n,i)}))},recordChildren:function(e,t){for(var n=e.map((function(e){return e.level})),a=Math.max.apply(Math,(0,i.default)(n)),r=function(t){e.filter((function(e){return e.level===t})).forEach((function(t){!function(e,t){e.filter((function(e){return e.level===t.level-1&&e.primaryKey===t.parentPrimaryKey&&e.ancestorsList.toString()===t.ancestorsList.slice(0,-1).toString()}))[0].children.push(t)}(e,t)}))},o=a;o>(t||0);o--)r(o)},recordParent:function(e,t){for(var n=e.map((function(e){return e.level})),a=Math.max.apply(Math,(0,i.default)(n)),r=function(t){e.filter((function(e){return e.level===t})).forEach((function(t){!function(e,t){t.level?t.parentInfo=e.filter((function(e){return e.level===t.level-1&&e.primaryKey===t.parentPrimaryKey&&e.ancestorsList.toString()===t.ancestorsList.slice(0,-1).toString()}))[0]:t.parentInfo=""}(e,t)}))},o=0;o<=(t||a);o++)r(o)},markCanUseArray:function(e){e.isCanUseArray=!0,e.level&&this.markCanUseArray(e.parentInfo)},makeArrayTree:function(e,t){var n=[];return function e(n,i){i.forEach((function(i){if(i.isCanUseArray||t){var a={isCheck:!1,isShow:!1,isShowChildren:!1,isSelect:!1};a.name=i.name,a.type=i.type,a.isSelect=!1,a.ancestorsList_str=i.ancestorsList_str;var r=i.children;a.children=[],n.push(a),r&&r.length&&e(a.children,r)}}))}(n,e),n},changeState:function(e){e.showChildren=!e.showChildren,e.children.forEach((function(t){t.isShow=e.showChildren})),e.showChildren||this.closeChildren(e)},closeChildren:function(e){var t=this;e.children.forEach((function(e){e.isShow=!1,e.has_children&&(e.showChildren=!1,t.closeChildren(e))}))},selectOneKey:function(e){e.isSelectedValue=e.isSelectedValue||e.key,e.isSelectedValueDisabled=!e.isSelectedKey},countArrayAncestors:function(e){var t=[];return function e(n){"array"===n.parentInfo.type&&(t.push(n.parentInfo),e(n.parentInfo)),"object"===n.parentInfo.type&&e(n.parentInfo)}(e),t},showSelectAbled:function(e){var t=this;return(0,s.default)(a.default.mark((function n(){return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:[],(t.objIsCanUse?e.filter((function(e){return!t.countArrayAncestors(e).length})):e.filter((function(e){return!t.countArrayAncestors(e).length&&"object"!==e.type&&"array"!==e.type}))).forEach((function(e){e.isSelectAbled=!0}));case 3:case"end":return n.stop()}}),n,t)})))()}}}},HxM3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("14Xm")),a=o(n("D3Ub")),r=o(n("efIh"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"MULTISELECT",mixins:[r.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{options:[],selectedItems:[]}},watch:{"item.val":function(){this.selectedItems=""===this.item.val?[]:this.item.val.split(","),this.conditionField(this.item,this.fields)},"item.choice":function(e,t){"API"!==this.item.source_type&&"DATADICT"!==this.item.source_type&&"RPC"!==this.item.source_type||t.length===e.length||this.getOption()}},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.item.value&&!e.item.val&&(e.item.val=e.item.value),t.next=3,e.getOption();case 3:return t.next=5,e.judgeValue(e.item.val,e.item.choice);case 5:n=t.sent,e.item.val=n?e.item.val:"",e.selectedItems=""===e.item.val?[]:e.item.val.split(","),e.conditionField(e.item,e.fields);case 9:case"end":return t.stop()}}),t,e)})))()},methods:{getOption:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFieldOptions(e.item);case 2:e.item.choice=t.sent,e.options=e.item.choice;case 4:case"end":return t.stop()}}),t,e)})))()},selected:function(e){var t=this;this.item.val=e.join(","),this.item.related_fields&&this.item.related_fields.be_relied&&this.item.related_fields.be_relied.forEach((function(e){t.fields.forEach((function(t){e===t.key&&(t.value="",t.val=t.value)}))}))}}}},I1Ty:function(e,t,n){"use strict";n.r(t);var i=n("1w2S"),a=n("qgII");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("y5Cw");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"f0f1344a",null);t.default=s.exports},I4J2:function(e,t,n){"use strict";n("v0Be")},IDfM:function(e,t,n){"use strict";n.r(t);var i=n("mVIP"),a=n("fkix");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},IcrL:function(e,t,n){"use strict";n("SqHb")},"Ieu/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("t2rG")),a=r(n("RPM2"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"HalfRowForm",components:{draggable:i.default,FormViewItem:a.default},props:{rowIndex:Number,workflowId:Number,nodeId:Number,fields:Array,rowForms:{type:Array,default:function(){return[]}},crtForm:{type:[String,Number],default:""},addFieldStatus:Boolean},data:function(){return{isEdit:this.checkEdit(),localForms:this.getLocalForms(this.rowForms)}},computed:{editForm:function(){var e=this;return this.isEdit?this.rowForms.find((function(t){return t&&t.id===e.crtForm})):null}},watch:{rowForms:function(e){this.localForms=this.getLocalForms(e)},crtForm:function(e){this.isEdit=""!==e&&this.checkEdit()}},methods:{getLocalForms:function(e){return e.map((function(e){return void 0===e?[]:[e]}))},checkEdit:function(){var e=this;return this.rowForms.find((function(t){return t&&t.id===e.crtForm}))},halfRowFormPut:function(e){return 0===e.el.children.length}}}},"J/S9":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-get-param"},[e.isStatic?t("bk-table",{attrs:{data:e.sopsTableInfo,"ext-cls":"bk-editor-table"}},[t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['字段名']"),prop:"name"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"400"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",[e._v(e._s(n.row.value||"--"))])]}}],null,!1,3905507693)})],1):e._e(),e._v(" "),t("div",{staticClass:"sops-form"},[t("render-form",{key:e.renderKey,ref:"renderForm",attrs:{"form-option":e.formOptions,constants:e.constants,context:e.context,hooked:e.hookedVarList},on:{configLoadingChange:function(t){e.configLoading=t}},scopedSlots:e._u([{key:"tagHook",fn:function({scheme:n}){return[t("div",{staticClass:"hook-area"},[t("bk-checkbox",{attrs:{disabled:e.disabled||e.disabledRenderForm,value:!!e.hookedVarList[n.tag_code]},on:{change:function(t){return e.onHookChange(t,n)}}},[e._v("\n            "+e._s(e.$t('m.tickets["引用变量"]'))+"\n          ")]),e._v(" "),e.hookedVarList[n.tag_code]?t("div",{staticClass:"var-select"},[t("bk-select",{attrs:{disabled:e.disabled||e.disabledRenderForm,clearable:!1,searchable:"",value:e.formData[n.tag_code].replace(/^\$\{/,"").replace(/\}$/,"")},on:{selected:function(t){return e.onSelectVar(t,n)}}},e._l(e.stateList,(function(n){return t("bk-option",{key:n.key,attrs:{id:n.key,name:n.name}},[e._v("\n                "+e._s(n.name)+"\n              ")])})),1)],1):e._e()],1)]}}]),model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}})],1),e._v(" "),e.sliderInfo.show&&!1===e.isStatic?t("div",{staticClass:"bk-add-slider"},[t("bk-sideslider",{attrs:{"is-show":e.sliderInfo.show,title:e.sliderInfo.title,width:e.sliderInfo.width},on:{"update:isShow":function(t){return e.$set(e.sliderInfo,"show",t)},"update:is-show":function(t){return e.$set(e.sliderInfo,"show",t)}}},[t("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},[t("add-field",{attrs:{"change-info":e.changeInfo,"sosp-info":e.showTabData,workflow:e.flowInfo.id,state:e.configur.id},on:{closeShade:e.closeShade,getRelatedFields:e.getRelatedFields}})],1)])],1):e._e()],1)},a=[];i._withStripped=!0},JGQq:function(e,t,n){"use strict";n.r(t);var i=n("Ddt+"),a=n("qJoz");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("kvWR");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"028000e9",null);t.default=s.exports},JXR1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=S(n("z1yn")),a=S(n("jub7")),r=S(n("Za/z")),o=S(n("u14n")),s=S(n("/KdC")),c=S(n("TNjk")),l=S(n("qyUP")),u=S(n("VrAx")),d=S(n("4K0D")),f=S(n("nxpg")),p=S(n("eOfU")),m=S(n("MBfY")),h=S(n("/Hw/")),v=S(n("Q3ZP")),g=S(n("Wl5c")),y=S(n("0njq")),b=S(n("+QRE")),_=S(n("070I")),k=S(n("gy7N")),w=S(n("aYIO")),I=S(n("g9b+")),$=S(n("IDfM"));function S(e){return e&&e.__esModule?e:{default:e}}t.default={name:"preview",components:{"CW-STRING":i.default,"CW-LINK":a.default,"CW-INT":r.default,"CW-TEXT":o.default,"CW-CHECKBOX":s.default,"CW-RADIO":c.default,"CW-SELECT":l.default,"CW-INPUTSELECT":u.default,"CW-MULTISELECT":d.default,"CW-DATE":f.default,"CW-DATETIME":p.default,"CW-MEMBER":m.default,"CW-MEMBERS":h.default,"CW-TABLE":v.default,"CW-CUSTOMTABLE":g.default,"CW-RICHTEXT":y.default,"CW-TREESELECT":b.default,"CW-FILE":_.default,"CW-CASCADE":k.default,"CW-SOPS_TEMPLATE":w.default,"CW-COMPLEX-MEMBERS":I.default,"CW-CUSTOM-FORM":$.default},props:{fields:{type:Array,required:!0,default:function(){return[]}},isPreview:{type:Boolean,default:!1},isFilePreview:{type:Boolean,default:!1}},data:function(){return{}}}},JbQy:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("14Xm")),a=d(n("D3Ub")),r=d(n("gDS+")),o=d(n("0nTK")),s=d(n("jF+y")),c=d(n("uy81")),l=d(n("lXJ6")),u=n("CeR/");function d(e){return e&&e.__esModule?e:{default:e}}var f={endpoint:"Dot",connector:["Flowchart",{stub:[10,16],alwaysRespectStub:!0,gap:2,cornerRadius:10}],connectorOverlays:[["PlainArrow",{width:8,length:6,location:1,id:"arrow"}]],paintStyle:{fill:"rgba(0, 0, 0, 0)",stroke:"",strokeWidth:1,radius:8},hoverPaintStyle:{fill:"#EE8F62",stroke:"#EE8F62",radius:8},cssClass:"template-canvas-endpoint",hoverClass:"template-canvas-endpoint-hover",isSource:!0,isTarget:!0,maxConnections:-1},p={grid:[5,5]},m={paintStyle:{fill:"transparent",stroke:"#a9adb6",strokeWidth:1},hoverPaintStyle:{fill:"transparent",stroke:"#3a84ff",strokeWidth:2},cssClass:"bk-sops-connector",hoverClass:"bk-sops-connector-hover",detachable:!0};t.default={name:"SecondFlow",components:{JsFlow:o.default,NodeTemplate:s.default,Palette:c.default,lineConfigue:l.default},props:{addList:{type:Array,default:function(){return[]}},lineList:{type:Array,default:function(){return[]}},flowInfo:{type:Object,default:function(){return{}}}},data:function(){return{clickSecond:!1,endpointOptions:f,connectorOptions:m,nodeOptions:p,canvasData:{nodes:[],lines:[]},toolsInfo:[{type:"zoomIn",name:" ",title:this.$t("m.treeinfo['放大']"),cls:"bk-itsm-icon icon-flow-other-add"},{type:"zoomOut",name:" ",title:this.$t("m.treeinfo['缩小']"),cls:"bk-itsm-icon icon-flow-other-reduc"},{type:"resetPosition",name:" ",title:this.$t("m.treeinfo['还原']"),cls:"bk-itsm-icon icon-flow-restore"},{type:"frameSelect",name:" ",title:this.$t("m.treeinfo['框选']"),cls:"bk-itsm-icon icon-choose-node"}],nodeInfo:{},toolLimit:4,customLine:{isShow:!1,title:this.$t('m.treeinfo["线条配置"]'),width:700,isOnly:!1,lineInfo:{},lineValue:{},nodeInfo:{from_state:{},to_state:{}}},deleteInfo:{isShow:!1,title:this.$t('m.treeinfo["确认删除"]'),content:this.$t('m.treeinfo["确认后，此节点将从该流程中移除！"]'),info:{}},drawStatus:!1,currentNode:{}}},computed:{nodeStatus:function(){return this.$store.state.deployCommon.nodeStatus},stateNodeInfo:function(){return this.$store.state.deployCommon.nodeInfo}},created:function(){this.initDate()},mounted:function(){this.addLineOverlay()},methods:{initDate:function(){var e=this;this.addList.forEach((function(t,n){var i=t.axis.x?t.axis.x:165+250*n,a=t.axis.y?t.axis.y:195+(n%2==1?5:0);e.canvasData.nodes.push({id:"node_"+t.id,x:i,y:a,type:t.type,name:t.name,showMore:!1,nodeInfo:t}),e.$set(e.nodeInfo,"node_"+t.id,t)})),this.lineList.forEach((function(t){e.canvasData.lines.push({source:{arrow:t.axis.start||"Right",id:"node_"+t.from_state},target:{arrow:t.axis.end||"Left",id:"node_"+t.to_state},lineInfo:t})}))},errorNodes:function(e){var t=this;this.canvasData.nodes.forEach((function(n){e.forEach((function(e){n.nodeInfo.id===e&&t.$set(n.nodeInfo,"errorInfo",!0)}))}))},addLineOverlay:function(){var e=this;this.canvasData.lines.forEach((function(t){var n={source:t.source,target:t.target,lineInfo:t.lineInfo,id:t.lineInfo.id,name:t.lineInfo.name};e.lineOverlay(n)}))},lineOverlay:function(e){if(!this.canvasData.nodes.some((function(t){return e.source.id===t.id&&"START"===t.type}))){var t='<span class="bk-label-test-name">'+(e.name||this.$t('m.treeinfo["默认"]'))+"</span>",n={id:"label_"+e.id,type:"Label",name:t,cls:"label-test",location:.5};this.$refs.jsFlow.addLineOverlay(e,n)}},removerLine:function(e){this.$refs.jsFlow.removeConnector({source:{id:e.sourceId},target:{id:e.targetId}})},onToolClick:function(){},closeShow:function(){this.canvasData.nodes.forEach((function(e){e.showMore=!1}))},onConnectionClick:function(){},onOverlayClick:function(e){var t=this,n=Number(e.id.split("_")[1]),i=this.canvasData.lines.filter((function(e){return e.lineInfo.id===n})),a=this.canvasData.nodes.filter((function(e){return e.id===i[0].source.id})),r=this.$refs.jsFlow.getConnectorsByNodeId(a[0].id);this.customLine.lineInfo=r.filter((function(e){return i[0].source.id===e.sourceId&&i[0].target.id===e.targetId}))[0],this.canvasData.lines.forEach((function(e){e.source.id===t.customLine.lineInfo.sourceId&&e.target.id===t.customLine.lineInfo.targetId&&(t.customLine.lineValue=e.lineInfo)})),this.canvasData.nodes.forEach((function(e){t.customLine.lineInfo.sourceId===e.id&&(t.customLine.nodeInfo.from_state=e.nodeInfo),t.customLine.lineInfo.targetId===e.id&&(t.customLine.nodeInfo.to_state=e.nodeInfo)})),this.customLine.isOnly=2===r.length,this.customLine.isShow=!this.customLine.isShow},submitLine:function(e){this.customLine.lineValue.name&&this.$refs.jsFlow.removeLineOverlay(this.customLine.lineInfo,"label_"+this.customLine.lineValue.id),this.canvasData.lines.forEach((function(t){t.lineInfo.id===e.id&&(t.lineInfo=e)})),this.canvasData.lines=JSON.parse((0,r.default)(this.canvasData.lines));var t={id:"label_"+this.customLine.lineValue.id,type:"Label",name:'<span class="bk-label-test-name">'+(e.name||this.$t('m.treeinfo["默认"]'))+"</span>",cls:"label-test",location:.5};this.$refs.jsFlow.addLineOverlay(this.customLine.lineInfo,t),this.closeLine()},closeLine:function(){this.customLine.isShow=!1},deleteLine:function(){var e=this,t=this.customLine.lineValue.id;this.clickSecond||(this.clickSecond=!0,this.$store.dispatch("deployCommon/deleteLine",t).then((function(){var t=[{source:{arrow:"Left",id:e.customLine.lineInfo.sourceId},target:{arrow:"Left",id:e.customLine.lineInfo.targetId},lineInfo:{}}];e.updateLine(t,"delete"),e.removerLine(e.customLine.lineInfo),e.closeLine()})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.clickSecond=!1})))},onConnection:function(e){this.drawStatus&&(this.drawLine(e),this.drawStatus=!1)},onConnectionDragStop:function(e,t,n){var i={sourceId:e.id,targetId:t};if(this.checkLineInfo(i)){var a=void 0,r={source:e,target:{id:t}},o=document.getElementById(t).getBoundingClientRect(),s=n.clientX-o.left,c=n.clientY-o.Top;a=s<o.width/2?c<o.height/2?s>c?"Top":"Left":s>o.height-c?"Bottom":"Left":c<o.height/2?o.width-s>c?"Top":"Right":o.width-s>o.height-c?"Bottom":"Right",r.target.arrow=a,this.$refs.jsFlow.createConnector(r);var l={sourceId:e.id,targetId:t,sourceEndpoint:{anchor:{type:e.arrow}},targetEndpoint:{anchor:{type:a}}};this.drawLine(l),this.drawStatus=!1}},onBeforeDrop:function(e){return this.checkLineInfo(e)},checkLineInfo:function(e){var t=this.canvasData.nodes.filter((function(t){return t.id===e.sourceId})),n=this.canvasData.nodes.filter((function(t){return t.id===e.targetId})),i={status:!0,msg:""};"START"===t[0].type&&(this.canvasData.lines.some((function(e){return e.source.id===t[0].id}))&&(i.status=!1,i.msg=this.$t('m.treeinfo["开始节点只能单一输出！"]')));"START"===n[0].type&&(i.status=!1,i.msg=this.$t('m.treeinfo["开始节点只能输出！"]')),"END"===t[0].type&&(i.status=!1,i.msg=this.$t('m.treeinfo["结束节点只能输入！"]')),"START"===t[0].type&&"END"===n[0].type&&(i.status=!1,i.msg=this.$t('m.treeinfo["开始节点和结束节点不能直接相连！"]')),e.sourceId===e.targetId&&(i.status=!1,i.msg=this.$t('m.treeinfo["自身不能相连！"]'));for(var a=0;a<this.canvasData.lines.length;a++)e.sourceId===this.canvasData.lines[a].source.id&&e.targetId===this.canvasData.lines[a].target.id&&(i.status=!1,i.msg=this.$t('m.treeinfo["已存在的连线！"]'));return i.status||this.$bkMessage({message:i.msg,theme:"warning"}),this.drawStatus=!0,i.status},drawLine:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){var a,r,o,s;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(a="",r="",o={targetId:"",sourceId:""},t.canvasData.nodes.forEach((function(t){t.id===e.sourceId&&(r=t.nodeInfo.id,o.sourceId=t.id),t.id===e.targetId&&(a=t.nodeInfo.id,o.targetId=t.id)})),s={workflow:t.addList[0].workflow,name:t.$t('m.treeinfo["默认"]'),axis:{start:e.sourceEndpoint.anchor.type,end:e.targetEndpoint.anchor.type},from_state:r,to_state:a},!t.canvasData.lines.some((function(e){return e.source.id===o.sourceId&&e.target.id===o.targetId}))){n.next=8;break}return n.abrupt("return");case 8:if(!t.clickSecond){n.next=10;break}return n.abrupt("return");case 10:return t.clickSecond=!0,n.next=13,t.$store.dispatch("deployCommon/createLine",{lineParams:s}).then((function(n){var i=[{source:{arrow:s.axis.start,id:e.sourceId},target:{arrow:s.axis.end,id:e.targetId},lineInfo:n.data,id:n.data.id,name:n.data.name}];t.updateLine(i,"add"),t.lineOverlay(i[0])})).catch((function(e){(0,u.errorHandler)(e,t),t.canvasData.lines.some((function(e){return e.source.id===o.sourceId&&e.target.id===o.targetId}))||t.$refs.jsFlow.removeConnector({source:{id:o.sourceId},target:{id:o.targetId}})})).finally((function(){t.clickSecond=!1}));case 13:case"end":return n.stop()}}),n,t)})))()},updateLine:function(e,t){var n=this;"delete"===t?e.forEach((function(e){n.canvasData.lines.forEach((function(t,i){t.source.id===e.source.id&&t.target.id===e.target.id&&n.canvasData.lines.splice(i,1)}))})):"update"===t?e.forEach((function(e){n.canvasData.lines.forEach((function(t){t.source.id===e.source.id&&t.target.id===e.target.id&&(t.lineInfo=e.lineInfo)}))})):"add"===t&&(this.canvasData.lines=this.canvasData.lines.concat(e))},onConnectionDetached:function(){},onZoomIn:function(){this.toolLimit>9||(this.toolLimit+=1,this.$refs.jsFlow&&this.$refs.jsFlow.zoomIn())},onZoomOut:function(){0!==this.toolLimit&&(this.toolLimit-=1,this.$refs.jsFlow&&this.$refs.jsFlow.zoomOut())},onResetPosition:function(){this.$refs.jsFlow.resetPosition()},onCanvasFrameSelect:function(){},handleScroll:function(e){e.deltaY>0?this.onZoomOut():this.onZoomIn()},fastAddNode:function(e){var t=this;setTimeout((function(){t.$refs.jsFlow.createConnector(e.line);var n={source:e.line.source,target:e.line.target,lineInfo:e.line.lineInfo,id:e.line.lineInfo.id,name:e.line.lineInfo.name};t.lineOverlay(n)}),100)},updateNode:function(e,t){var n=this;this.$refs.jsFlow.createNode(e.node);var i=[];"COPY"!==t&&this.canvasData.nodes.forEach((function(t){var a=t.x-e.node.x,r=t.y-e.node.y;if(e.node.id!==t.id&&r>=-40&&a>=-150&&a<=150){var o={id:t.id,nodeInfo:t.nodeInfo,x:t.x,y:t.y+100};i.push(o),setTimeout((function(){n.$refs.jsFlow.setNodePosition(o),n.moveNode(o)}),100)}})),this.canvasData.nodes.forEach((function(e){i.forEach((function(t){e.id===t.id&&(e.x=t.x,e.y=t.y)}))}))},onCreateNodeBefore:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.nodeStatus){n.next=2;break}return n.abrupt("return");case 2:return a={workflow:t.flowInfo.id,name:"",type:e.type,is_terminable:!1,axis:{x:e.x,y:e.y},extras:{}},n.next=5,t.$store.dispatch("deployCommon/creatNode",{params:a}).then((function(n){return t.$set(e,"nodeInfo",n.data),!0})).catch((function(n){(0,u.errorHandler)(n,t),t.$refs.jsFlow.removeNode(e)}));case 5:case"end":return n.stop()}}),n,t)})))()},openDelete:function(e){e.nodeInfo&&e.nodeInfo.is_builtin||(this.deleteInfo.info=e,this.deleteNode())},deleteNode:function(){var e=this,t=this.deleteInfo.info.nodeInfo.id;this.clickSecond||(this.clickSecond=!0,this.$store.dispatch("deployCommon/deleteNode",t).then((function(){e.deleteInfo.info.nodeInfo.is_draft||e.$bkMessage({message:e.$t('m.treeinfo["删除成功"]'),theme:"success"});for(var t=e.$refs.jsFlow.getConnectorsByNodeId(e.deleteInfo.info.id),n=[],i=0;i<t.length;i++)n.push({source:{arrow:"Left",id:t[i].sourceId},target:{arrow:"Left",id:t[i].targetId},lineInfo:{}});n.length&&e.updateLine(n,"delete"),e.$refs.jsFlow.removeNode(e.deleteInfo.info),e.closeDelete()})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.clickSecond=!1})))},closeDelete:function(){this.deleteInfo.isShow=!1},configuNode:function(e){var t=this;this.$store.dispatch("deployCommon/getOneStateInfo",{id:e.id}).then((function(e){t.$emit("handleNodeClick",e.data)})).catch((function(e){(0,u.errorHandler)(e,t)}))},onNodeMoveStop:function(e){if(e.x===this.currentNode.x&&e.y===this.currentNode.y)return this.canvasData.nodes.forEach((function(e){e.showMore=!1})),void this.canvasData.nodes.forEach((function(t){e.id===t.id&&(t.showMore=!0)}));for(var t=!1,n=0;n<this.canvasData.nodes.length;n++){var i=this.canvasData.nodes[n];if(e.id!==i.id){var a={x:i.x-e.x,y:i.y-e.y};if("NORMAL"===e.type||"ROUTER"===e.type||"TASK"===e.type){if("NORMAL"===i.type||"ROUTER"===i.type||"TASK"===i.type){if(a.x>=-150&&a.x<=150&&a.y>=-40&&a.y<=40){t=!0;break}}else if(a.x>=-40&&a.x<=150&&a.y>=-40&&a.y<=40){t=!0;break}}else if("NORMAL"===i.type||"ROUTER"===i.type||"TASK"===i.type){if(a.x>=-150&&a.x<=40&&a.y>=-40&&a.y<=40){t=!0;break}}else if(a.x>=-40&&a.x<=40&&a.y>=-40&&a.y<=40){t=!0;break}}}if(t){var r={id:e.id,x:this.stateNodeInfo.x,y:this.stateNodeInfo.y};this.$refs.jsFlow.setNodePosition(r);for(var o=0;o<this.canvasData.nodes.length;o++)e.id===this.canvasData.nodes[o].id&&(this.canvasData.nodes[o].x=this.stateNodeInfo.x,this.canvasData.nodes[o].y=this.stateNodeInfo.y)}else this.moveNode(e)},onNodeMoving:function(e,t){var n=e;n.x=t.pos[0],n.y=t.pos[1]},getBestArrow:function(e){var t=this,n={parent:[],parentLine:[],children:[],childrenLine:[]},i=[];this.canvasData.lines.forEach((function(e){var n=!1;t.canvasData.lines.forEach((function(t){e.source.id===t.target.id&&e.target.id===t.source.id&&(n=!0)})),n||i.push(e)})),i.forEach((function(t){e.id===t.target.id&&(n.parent.push(t.source.id),n.parentLine.push(t)),e.id===t.source.id&&(n.children.push(t.target.id),n.childrenLine.push(t))}));var a=["NORMAL","ROUTER","TASK","TASK-SOPS"],r=this.getEndPointInfo(e,a),o={},s={};n.parent.forEach((function(e){t.canvasData.nodes.forEach((function(n){e===n.id&&(o[e]=t.getEndPointInfo(n,a))}))})),n.children.forEach((function(e){t.canvasData.nodes.forEach((function(n){e===n.id&&(s[e]=t.getEndPointInfo(n,a))}))}));var c=[];n.parent.forEach((function(n){c=[],r.forEach((function(e){var t;o[n].forEach((function(t){c.push({cArrow:e.anchor,pArrow:t.anchor,distance:Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)})})),c=c.sort((t="distance",function(e,n){return e[t]-n[t]}))}));var i=c[0],a={source:{id:n},target:{id:e.id}};t.deleteBestLine(a,i)}));var l=[];n.children.forEach((function(n){l=[],r.forEach((function(e){var t;s[n].forEach((function(t){l.push({cArrow:t.anchor,pArrow:e.anchor,distance:Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)})})),l=l.sort((t="distance",function(e,n){return e[t]-n[t]}))}));var i=l[0],a={source:{id:e.id},target:{id:n}};t.deleteBestLine(a,i)}))},getEndPointInfo:function(e,t){return[{anchor:"Top",x:e.x+(t.some((function(t){return t===e.type}))?75:20),y:e.y},{anchor:"Left",x:e.x,y:e.y+20},{anchor:"Right",x:e.x+(t.some((function(t){return t===e.type}))?150:40),y:e.y+20},{anchor:"Bottom",x:e.x+(t.some((function(t){return t===e.type}))?75:20),y:e.y+40}]},deleteBestLine:function(e,t){var n=this;this.canvasData.lines.some((function(n){return n.source.id===e.source.id&&n.target.id===e.target.id&&n.source.arrow===t.pArrow&&n.target.arrow===t.cArrow}))||(this.$refs.jsFlow.removeConnector({source:{id:e.source.id},target:{id:e.target.id}}),this.canvasData.lines.forEach((function(i){if(i.source.id===e.source.id&&i.target.id===e.target.id){i.source.arrow=t.pArrow,i.target.arrow=t.cArrow;var a={source:{arrow:t.pArrow,id:e.source.id},target:{arrow:t.cArrow,id:e.target.id},lineInfo:i.lineInfo};n.$refs.jsFlow.createConnector(a);var r={source:a.source,target:a.target,lineInfo:a.lineInfo,id:i.lineInfo.id,name:i.lineInfo.name};n.lineOverlay(r)}})))},moveNode:function(e){var t=this,n={axis:{x:e.x,y:e.y}},i=e.nodeInfo.id;this.$store.dispatch("deployCommon/updateNodeAxis",{params:n,id:i}).then((function(){})).catch((function(e){(0,u.errorHandler)(e,t)}))}}}},"Je/e":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"task-form"},[t("div",{staticClass:"use-task-config"},[t("span",{staticClass:"mr5"},[e._v(e._s(e.$t("m.trigger['是否启用']")))]),e._v(" "),t("bk-switcher",{attrs:{"data-test-id":"taskConfig-switcher-isUse"},on:{change:e.handleUseTaskChange},model:{value:e.useTask,callback:function(t){e.useTask=t},expression:"useTask"}})],1),e._v(" "),e.useTask?e._l(e.taskConditionList,(function(n,i){return t("bk-form",{key:i,ref:"taskForms",refInFor:!0,staticClass:"mt10",attrs:{model:n,rules:e.taskConfigRule,"form-type":"vertical"}},[t("div",{staticClass:"task-condition clearfix"},[t("div",{staticClass:"condition-item"},[t("bk-form-item",{attrs:{"data-test-id":"taskConfig-select-taskTemplate",label:e.$t("m.taskTemplate['任务模板']"),required:!0,property:"taskId"}},[t("bk-select",{attrs:{placeholder:e.$t("m.basicModule['请选择']")+e.$t("m.taskTemplate['任务模板']"),"ext-cls":"bk-form-width",searchable:"",clearable:""},model:{value:n.taskId,callback:function(t){e.$set(n,"taskId",t)},expression:"oneCondition.taskId"}},e._l(e.taskTemplateList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1)],1),e._v(" "),t("div",{staticClass:"condition-item"},[t("bk-form-item",{attrs:{"data-test-id":"taskConfig-select-createdTaskNode",label:e.$t("m.tickets['可创建任务节点']"),required:!0,property:"createNodeId"}},[t("bk-select",{attrs:{placeholder:e.$t("m.tickets['请选择可创建任务节点']"),"ext-cls":"bk-form-width",loading:e.nodeListLoading,searchable:"",clearable:""},on:{change:function(t){return e.getCanDealNodeList(t,n)}},model:{value:n.createNodeId,callback:function(t){e.$set(n,"createNodeId",t)},expression:"oneCondition.createNodeId"}},e._l(e.normalNodeList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name,disabled:e.disabled}})})),1)],1)],1),e._v(" "),t("div",{staticClass:"condition-item"},[t("bk-form-item",{attrs:{"data-test-id":"taskConfig-select-processTaskNode",label:e.$t("m.tickets['可处理任务的节点']"),required:!0,property:"dealNodeId"}},[t("bk-select",{attrs:{placeholder:e.$t("m.tickets['请选择可处理任务的节点']"),"ext-cls":"bk-form-width",loading:n.dealLoading,searchable:"",clearable:""},on:{change:e.handleDealNodeChange},model:{value:n.dealNodeId,callback:function(t){e.$set(n,"dealNodeId",t)},expression:"oneCondition.dealNodeId"}},e._l(n.dealList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1)],1),e._v(" "),t("div",{staticClass:"condition-checkbox"},[t("bk-checkbox-group",{model:{value:n.others,callback:function(t){e.$set(n,"others",t)},expression:"oneCondition.others"}},[t("p",[t("bk-checkbox",{attrs:{value:1}},[e._v(e._s(e.$t("m.taskTemplate['处理任务的节点也可以创建任务']")))])],1),e._v(" "),t("p",{staticClass:"mt10"},[t("bk-checkbox",{attrs:{value:2}},[e._v(e._s(e.$t("m.taskTemplate['下一个节点流转是否必须等待任务处理完成']")))])],1)])],1),e._v(" "),t("div",{staticClass:"row-operating"},[t("span",{attrs:{"data-test-id":"trigger_span_add"},on:{click:e.onAddCondition}},[e._v("+")]),e._v(" "),t("span",{attrs:{"data-test-id":"trigger_span_delete"},on:{click:function(t){return e.onDelCondition(i)}}},[e._v("-")])])])])})):e._e()],2)},a=[];i._withStripped=!0},Jje2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("efIh"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"STRING",mixins:[r.default],props:{item:{type:Object,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},computed:{maxLength:function(){return"title"===this.item.key?120:"task_name"===this.item.key?50:null}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)}},mounted:function(){this.conditionField(this.item,this.fields),this.item.value&&!this.item.val&&(this.item.val=this.item.value)}}},JrgT:function(e,t,n){"use strict";n("NOZu")},JtQW:function(e,t,n){"use strict";n("iYOz")},Jwqd:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.COMMON_ATTRS=void 0;var i,a=n("QbLZ"),r=(i=a)&&i.__esModule?i:{default:i};t.getFormMixins=function(e){var t={};for(var n in e)"value"!==n&&(t[n]=e[n]);return{props:(0,r.default)({},o,t),inject:["getContext"],data:function(){return{value:this.$attrs.value?this.$attrs.value:e.value.default}},methods:{getTopViewItem:function(){for(var e=this,t=!1;!t;)e.$parent&&e.$parent.isRootRenderView?t=!0:e=e.$parent;return e}}}};var o=t.COMMON_ATTRS={label:{type:String,required:!1},hiddenLabel:{type:Boolean,default:!1},form:{type:Object,default:function(){return{}}},children:{type:[String,Array],required:!1},desc:{type:String,required:!1}}},KElf:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("rMih"),r=(i=a)&&i.__esModule?i:{default:i},o=n("ygAv");t.default={name:"FormEditItem",components:{AddField:r.default},props:{form:Object,workflowId:Number,nodeId:Number},data:function(){return{formData:(0,o.deepClone)(this.form)}},mounted:function(){this.$refs.formEditItem.scrollIntoView({block:"center"})},methods:{onConfirmClick:function(e){this.$emit("onEditConfirm",(0,o.deepClone)(e))},getAddFieldStatus:function(e){this.$emit("getAddFieldStatus",e)}}}},KLeT:function(e,t,n){},"KW1/":function(e,t,n){"use strict";n.r(t);var i=n("LwjM"),a=n("f5Dy");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},KaYb:function(e,t,n){"use strict";n.r(t);var i=n("J/S9"),a=n("EtUq");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("jNP/");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"8f6e5740",null);t.default=s.exports},L2Eo:function(e,t,n){"use strict";n("8/xK")},LEca:function(e,t,n){"use strict";n.r(t);var i=n("Je/e"),a=n("gSHn");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("TdI4");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"76968992",null);t.default=s.exports},LFVb:function(e,t,n){"use strict";n("0aIx")},LJsK:function(e,t,n){"use strict";n.r(t);var i=n("z/kA"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},LVBE:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form",{ref:"taskForm",attrs:{model:e.item.sopsContent,rules:e.rules,"label-width":200,"form-type":"vertical"}},[e.editTask?e._e():[t("bk-form-item",{attrs:{label:e.$t("m.newCommon['创建方式']"),required:!0}},[t("bk-radio-group",{on:{change:e.handleCreateWayChange},model:{value:e.item.sopsContent.createWay,callback:function(t){e.$set(e.item.sopsContent,"createWay",t)},expression:"item.sopsContent.createWay"}},[t("bk-radio",{staticClass:"bk-form-radio",attrs:{disabled:e.disabled,value:"template"}},[e._v(e._s(e.$t('m.newCommon["手动创建"]')))]),e._v(" "),t("bk-radio",{staticClass:"bk-form-radio",attrs:{disabled:e.disabled,value:"task"}},[e._v(e._s(e.$t('m.newCommon["关联未执行的任务"]')))]),e._v(" "),t("bk-radio",{staticClass:"bk-form-radio",attrs:{disabled:e.disabled,value:"started_task"}},[e._v(e._s(e.$t('m.newCommon["关联已执行的任务"]')))])],1)],1),e._v(" "),"template"===e.item.sopsContent.createWay?t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"ext-cls":"bk-line-height",property:"id","error-display-type":"normal"}},[t("bk-select",{attrs:{searchable:"","ext-cls":"form-item-inline-width mr5",loading:e.loading.templateList,disabled:"RETRY"===e.typeInfo||e.disabled,clearable:!1},on:{selected:e.onSelectTpl},model:{value:e.item.sopsContent.id,callback:function(t){e.$set(e.item.sopsContent,"id",t)},expression:"item.sopsContent.id"}},e._l(e.templateList,(function(e,n){return t("bk-option",{key:n,attrs:{name:e.name,id:e.id}})})),1),e._v(" "),e.item.sopsContent.id?t("bk-select",{attrs:{loading:e.loading.plan,disabled:e.disabled,multiple:"","ext-cls":"form-item-inline-width mr0",placeholder:e.$t("m['选择执行方案，默认选择全部任务节点']")},on:{selected:e.onplanSelect},model:{value:e.item.sopsContent.planId,callback:function(t){e.$set(e.item.sopsContent,"planId",t)},expression:"item.sopsContent.planId"}},[e._l(e.planList,(function(n){return t("bk-option",{key:n.id,staticClass:"sops-plan-option",attrs:{id:n.id,name:n.name}},[t("span",[e._v(e._s(n.name))]),e._v(" "),t("span",{staticClass:"preview-sops-plan",on:{click:function(t){return t.stopPropagation(),e.jumpToSopsSelectSchemePage.apply(null,arguments)}}},[t("i",{staticClass:"bk-icon icon-eye"}),e._v("\n              "+e._s(e.$t('m.flowManager["预览"]'))+"\n            ")])])})),e._v(" "),t("div",{staticClass:"add-sops-scheme",attrs:{slot:"extension"},on:{click:e.jumpToSopsSelectSchemePage},slot:"extension"},[t("i",{staticClass:"bk-icon icon-plus"}),e._v("\n            "+e._s(e.$t("m.newCommon['创建执行方案']"))+"\n          ")])],2):e._e(),e._v(" "),e.item.sopsContent.id?t("div",{staticClass:"reload-template-plan",on:{click:e.onReloadPlanBtnClick}},[t("i",{staticClass:"bk-icon icon-refresh"}),e._v("\n          "+e._s(e.$t('m.newCommon["刷新"]'))+"\n        ")]):e._e()],1):t("bk-form-item",{attrs:{label:"标准运维的任务选择",required:!0,property:"sopsTaskId"}},[t("bk-select",{attrs:{loading:e.loading.sopsTaskList,disabled:e.disabled,searchable:""},on:{change:e.onSopsTaskChange},model:{value:e.item.sopsContent.sopsTask.id,callback:function(t){e.$set(e.item.sopsContent.sopsTask,"id",t)},expression:"item.sopsContent.sopsTask.id"}},e._l(e.sopsTaskList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),e.item.sopsContent.sopsTask.id?t("div",{staticClass:"preview-sops-task",on:{click:function(t){return t.stopPropagation(),e.jumpToSops.apply(null,arguments)}}},[t("i",{staticClass:"bk-icon icon-eye"}),e._v("\n          "+e._s(e.$t('m.flowManager["预览"]'))+"\n        ")]):e._e()],1)]],2),e._v(" "),e.formLoading?e._e():t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.configLoading},expression:"{ isLoading: configLoading }"}],staticClass:"form-wrapper"},[t("h3",{staticClass:"setion-title"},[e._v(e._s(e.$t('m.newCommon["参数配置"]')))]),e._v(" "),e.showRenderForm?t("render-form",{ref:"renderForm",attrs:{"form-option":e.formOptions,constants:e.item.sopsContent.constants,context:e.item.sopsContent.context,hooked:e.hookedVarList},on:{configLoadingChange:function(t){e.configLoading=t}},scopedSlots:e._u([{key:"tagHook",fn:function({scheme:n}){return[t("div",{staticClass:"hook-area"},[t("bk-checkbox",{attrs:{disabled:e.disabled||e.disabledRenderForm,value:!!e.hookedVarList[n.tag_code]},on:{change:function(t){return e.onHookChange(t,n)}}},[e._v("\n            "+e._s(e.$t('m.tickets["引用变量"]'))+"\n          ")]),e._v(" "),e.hookedVarList[n.tag_code]?t("div",{staticClass:"var-select"},[t("bk-select",{class:{"quote-error":e.quoteErrors.includes(n.tag_code)},attrs:{disabled:e.disabled||e.disabledRenderForm,clearable:!1,value:e.item.sopsContent.formData[n.tag_code].replace(/^\$\{/,"").replace(/\}$/,"")},on:{selected:function(t){return e.onSelectVar(t,n)}}},e._l(e.quoteVars,(function(n){return t("bk-option",{key:n.key,attrs:{id:n.key,name:n.name}},[e._v("\n                "+e._s(n.name)+"\n              ")])})),1),e._v(" "),e.quoteErrors.includes(n.tag_code)?t("span",{staticClass:"quote-error-text"},[e._v(e._s(e.$t('m.tickets["请选择变量"]')))]):e._e(),e._v(" "),e.item.sopsContent.constants.find(e=>e.key===n.tag_code).changed?e._e():t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.$t("m.tickets['配置有更新']"),expression:"$t(`m.tickets['配置有更新']`)",modifiers:{top:!0}}],staticClass:"bk-icon icon-info update-tips"})],1):e._e()],1)]}}],null,!1,2175907120),model:{value:e.item.sopsContent.formData,callback:function(t){e.$set(e.item.sopsContent,"formData",t)},expression:"item.sopsContent.formData"}}):t("no-data")],1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2):e._e()},a=[];i._withStripped=!0},LWJh:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-basic-node"},[t("basic-card",[t("bk-form",{ref:"basicInfo",attrs:{model:e.basicInfo,"label-width":150,rules:e.basicInfoRules,"ext-cls":"bk-form","form-type":"vertical"}},[t("bk-form-item",{attrs:{"data-test-id":"devops-input-name",label:e.$t("m.treeinfo['节点名称：']"),required:!0,"error-display-type":"normal","ext-cls":"bk-form-width bk-form-display",property:"nodeName"}},[t("bk-input",{attrs:{clearable:!0},model:{value:e.basicInfo.nodeName,callback:function(t){e.$set(e.basicInfo,"nodeName",t)},expression:"basicInfo.nodeName"}})],1),e._v(" "),t("desc-info",{model:{value:e.basicInfo.desc,callback:function(t){e.$set(e.basicInfo,"desc",t)},expression:"basicInfo.desc"}}),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"devops-select-project",label:e.$t("m['第三方插件']"),required:!0,"error-display-type":"normal","ext-cls":"bk-form-width bk-form-display",property:"plugin"}},[t("bk-select",{attrs:{searchable:"",disabled:!1},on:{selected:e.onSelectplugin},model:{value:e.basicInfo.plugin,callback:function(t){e.$set(e.basicInfo,"plugin",t)},expression:"basicInfo.plugin"}},e._l(e.pluginList,(function(e){return t("bk-option",{key:e.code,attrs:{id:e.code,name:e.name}})})),1),e._v(" "),e.pluginTip?t("div",{staticClass:"tip"},[t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-four-one"}),e._v(" "),t("p",{domProps:{textContent:e._s(e.pluginTip)}})]):e._e()],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"devops-select-pipeline",label:e.$t("m['版本']"),required:!0,property:"version","error-display-type":"normal","ext-cls":"bk-form-width bk-form-display"}},[t("bk-select",{attrs:{searchable:"",loading:e.versionListLoading,disabled:e.versionListDisabled},on:{selected:e.getFormInfo},model:{value:e.basicInfo.version,callback:function(t){e.$set(e.basicInfo,"version",t)},expression:"basicInfo.version"}},e._l(e.versionList,(function(e){return t("bk-option",{key:e,attrs:{id:e,name:e}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"devops-component-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{"show-overbook":!0,value:e.processorsInfo,"node-info":e.configur,"exclude-role-type-list":e.excludeProcessor}})],1)])],1),e._v(" "),t("div",{staticClass:"bk-params-title"},[t("p",[e._v(e._s(e.$t("m.treeinfo['输入参数']"))+":")]),e._v(" "),t("p",[e._v(e._s(e.$t("m['执行蓝鲸插件需要填写的参数信息']")))])]),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isHasSchma},expression:"{ isLoading: isHasSchma }"}]},[0!==Object.keys(e.schema||{}).length?[t("BkRenderForm",{key:e.formKey,ref:"bkForm",staticClass:"bk-form-plugin",attrs:{schema:e.schema,layout:e.layout,rules:e.rules,"form-type":e.formType,context:{...e.context,rules:{}},"http-adapter":{responseParse:{labelKey:"name",valueKey:"id"}}},scopedSlots:e._u([{key:"suffix",fn:function({path:n,schema:i}){return[t("bk-checkbox",{attrs:{"ext-cls":"select-check"},on:{change:function(t){return e.onChangeChecked(t,n,i)}},model:{value:e.hookVarList[n],callback:function(t){e.$set(e.hookVarList,n,t)},expression:"hookVarList[path]"}}),e._v(" "),t("bk-select",{staticStyle:{width:"200px"},attrs:{disabled:!e.hookVarList[n],value:(e.hookSelectList[n]||"").replace(/^\{\{/,"").replace(/\}\}/,""),"ext-cls":"select-custom",searchable:""},on:{selected:function(t){return e.changeConstant(t,n,i)}}},e._l(e.stateList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]}}],null,!1,649486762),model:{value:e.formData,callback:function(t){e.formData=t},expression:"formData"}}),e._v(" "),0!==e.errorList.length?t("p",{staticClass:"errorTip"},[t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-square-one"}),e._v(e._s(e.$t("m['字段']")+e.errorList.toString()+e.$t("m['是必填项！']")))]):e._e()]:t("no-data")],2),e._v(" "),t("div",{staticClass:"bk-params-title"},[t("p",[e._v(e._s(e.$t("m['输出参数']"))+":")]),e._v(" "),t("p",[e._v(e._s(e.$t("m['蓝鲸插件执行之后的输出，可以通过勾选的方式作为引用变量在后面的节点使用']")))])]),e._v(" "),t("div",{staticStyle:{padding:"20px"}},[t("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isHasSchma},expression:"{ isLoading: isHasSchma }"}],attrs:{data:e.outputsData}},[t("bk-table-column",{attrs:{label:e.$t("m['名称']"),prop:"title"}}),e._v(" "),t("bk-table-column",{attrs:{label:"key",prop:"key"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['设置为全局变量']")},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-checkbox",{on:{change:function(t){return e.onchangeOutputCheck(t,n)}},model:{value:e.outputsVarList[n.row.key],callback:function(t){e.$set(e.outputsVarList,n.row.key,t)},expression:"outputsVarList[props.row.key]"}})]}}])})],1)],1),e._v(" "),t("common-trigger-list",{attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"mt20",staticStyle:{"font-size":"0"}},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"devops-button-submit",title:e.$t("m.treeinfo['确定']")},on:{click:e.submit}},[e._v("\n        "+e._s(e.$t("m.treeinfo['确定']"))+"\n      ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"devops-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['取消']"))+"\n      ")])],1)],1)],1)},a=[];i._withStripped=!0},LaJ4:function(e,t,n){"use strict";n("Gogv")},Lbk4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n("gDS+")),a=p(n("14Xm")),r=p(n("D3Ub")),o=p(n("t2rG")),s=p(n("BWJp")),c=p(n("ibAw")),l=p(n("eQfd")),u=p(n("rMih")),d=p(n("jFOa")),f=n("CeR/");function p(e){return e&&e.__esModule?e:{default:e}}t.default={name:"fieldInfo",components:{draggable:o.default,fieldPreview:l.default,addField:u.default,inheritState:d.default},mixins:[s.default],props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}},templateStage:{type:String,default:""},templateInfo:{type:Object,default:function(){return{}}},isShowTitle:{type:Boolean,default:function(){return!1}}},data:function(){return{nodesList:[],isDataLoading:!1,secondClick:!1,showTabList:[],changeInfo:{},sliderInfo:{title:this.$t('m.treeinfo["新增字段"]'),show:!1,width:700},processInfo:{isShow:!1,title:this.$t('m.treeinfo["字段预览"]'),position:{top:150},draggable:!0},previewTab:[],isEditPublic:!1,moduleInfo:{isShow:!1,width:700,headerPosition:"left",autoClose:!1},addOrigin:{isOther:!1},isFormChanged:!1}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},watch:{"templateInfo.id":function(){this.initData()},templateStage:function(){this.initData()}},mounted:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.initData();case 2:case"end":return t.stop()}}),t,e)})))()},beforeDestroy:function(){this.clearFieldsIndexInfo()},methods:{initData:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.templateStage&&(e.addOrigin.isOther=!0,e.addOrigin.addOriginInfo={type:"templateField",addUrl:"taskTemplate/createTemplateField",updateUrl:"taskTemplate/updateTemplateField"}),t.next=3,e.getTableList();case 3:case"end":return t.stop()}}),t,e)})))()},getTableList:function(){var e=this,t="deployCommon/getFieldList",n={};if(this.templateInfo.id)t="taskTemplate/getTemplateFields",n.task_schema_id=this.templateInfo.id,n.stage=this.templateStage;else{if(!this.flowInfo||!this.flowInfo.id)return;n.workflow=this.flowInfo.id,n.state=this.configur.id}this.isDataLoading=!0,this.$store.dispatch(t,n).then((function(t){e.showTabList=e.orderByCacheInfo(t.data),e.showTabList.forEach((function(t){e.globalChoise.field_type.forEach((function(n){t.type===n.typeName&&e.$set(t,"typeName",n.name)})),"COMPLEX-MEMBERS"===t.type&&e.$set(t,"typeName",e.$t("m.newCommon['处理人']")),"SOPS_TEMPLATE"===t.type&&e.$set(t,"typeName",e.$t("m.newCommon['流程模板']")),e.globalChoise.validate_type.forEach((function(n){t.validate_type===n.typeName&&e.$set(t,"is_required",n.name)}))}))})).catch((function(t){(0,f.errorHandler)(t,e)})).finally((function(){e.isDataLoading=!1}))},checkDeleteDisabled:function(e){return!(!e.is_builtin||!this.configur.is_first_state||-1!==["impact","urgency","priority","current_status"].indexOf(e.key))||("APPROVE_RESULT"===e.meta.code||(-1!==["processors","task_name"].indexOf(e.key)||"APPROVAL"===this.configur.type))},checkEditDisabled:function(){return"APPROVAL"===this.configur.type},updateInfo:function(){this.cacheFieldsIndexInfo()},handleBeforeClose:function(){var e=this;return(0,r.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isFormChanged){t.next=5;break}return t.next=3,(0,c.default)();case 3:return n=t.sent,t.abrupt("return",n);case 5:return t.abrupt("return",!0);case 6:case"end":return t.stop()}}),t,e)})))()},closeShade:function(){this.sliderInfo.show=!1},orderByCacheInfo:function(e){var t=this,n=[],i=[];return e.forEach((function(e){var a=t.getOneFieldCacheIndex(e.id);a||0===a?n[a]=e:i.push(e)})),n.filter((function(e){return!!e})).concat(i)},cacheFieldsIndexInfo:function(){var e=this,t=this.showTabList.reduce((function(t,n,i){return t[window.username+"_"+e.flowInfo.id+"_"+e.configur.id+"_"+n.id]=i,t}),{});sessionStorage.setItem("fieldsIndexMap",(0,i.default)(t))},getOneFieldCacheIndex:function(e){var t=sessionStorage.getItem("fieldsIndexMap")||"{}";return JSON.parse(t)[window.username+"_"+this.flowInfo.id+"_"+this.configur.id+"_"+e]},clearFieldsIndexInfo:function(){sessionStorage.removeItem("fieldsIndexMap")},getFrontNodesList:function(){var e=this;if(this.configur.id||this.templateInfo.id){var t="",n={};this.configur.id&&(t="apiRemote/get_related_fields",n.workflow=this.workflow,n.state=this.configur.id),this.templateInfo.id&&(t="taskTemplate/getFrontFieldsList",n.id=this.templateInfo.id,n.stage=this.templateStage),this.$store.dispatch(t,n).then((function(t){e.nodesList=t.data,e.sliderInfo.show=!0,e.isFormChanged=!1})).catch((function(t){(0,f.errorHandler)(t,e)}))}},addField:function(){this.changeInfo={workflow:"",id:"",key:"",name:"",type:"STRING",desc:"",layout:"COL_12",validate_type:"REQUIRE",choice:[],is_builtin:!1,source_type:"CUSTOM",source_uri:"",regex:"EMPTY",custom_regex:"",is_tips:!1,tips:"",meta:{}},this.sliderInfo.title=this.$t('m.treeinfo["新增字段"]'),this.getFrontNodesList()},openField:function(e){this.changeInfo=e,this.changeInfo.is_tips=e.is_tips||!1,this.sliderInfo.title=this.$t('m.treeinfo["编辑字段"]'),this.getFrontNodesList()},previewField:function(){if(this.showTabList.length){this.previewTab=this.showTabList;for(var e=this.previewTab.some((function(e){return"impact"===e.key||"urgency"===e.key})),t=0;t<this.previewTab.length;t++){for(var n=0;n<this.previewTab[t].choice.length;n++)this.previewTab[t].choice[n].typeName=this.previewTab[t].choice[0]?this.previewTab[t].choice[0].key:"";this.$set(this.previewTab[t],"val",this.previewTab[t].default||""),this.$set(this.previewTab[t],"showFeild",!0),"priority"!==this.previewTab[t].key||e||this.$set(this.previewTab[t],"is_readonly",!1)}this.processInfo.isShow=!0,this.isNecessaryToWatch({fields:this.previewTab},"workflow")}},deleteTable:function(e){var t=this;this.$bkInfo({type:"warning",title:this.$t('m.treeinfo["确认删除此字段？"]'),subTitle:this.$t('m.treeinfo["字段一旦删除，此字段将不在可用。请谨慎操作。"]'),confirmFn:function(){var n="deployCommon/deleteField",i={id:e.id,params:{state_id:t.configur.id}};t.templateInfo.id&&(n="taskTemplate/deleteTemplateField",delete i.params),t.secondClick||(t.secondClick=!0,t.$store.dispatch(n,i).then((function(){t.$bkMessage({message:t.$t('m.systemConfig["删除成功"]'),theme:"success"}),t.getTableList()})).catch((function(e){(0,f.errorHandler)(e,t)})).finally((function(){t.secondClick=!1})))}})},openAddModule:function(){this.moduleInfo.isShow=!0},submitModule:function(){var e=this,t=this.$refs.inheritState.checkList.filter((function(e){return!e.is_disabled}));if(t.length){var n={fields:t},i=this.configur.id;if(this.secondClick)return;this.secondClick=!0,this.$store.dispatch("basicModule/add_fields_from_table",{params:n,id:i}).then((function(){e.$bkMessage({message:e.$t('m.systemConfig["添加成功"]'),theme:"success"}),e.moduleInfo.isShow=!1,e.getTableList()})).catch((function(t){(0,f.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}else this.moduleInfo.isShow=!1}}}},LexG:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-hidden-conditions",on:{click:function(t){e.checkStatus=!1}}},[t("div",{staticClass:"bk-form-content",staticStyle:{"margin-left":"0"}},[t("p",{staticClass:"bk-form-p"},[e._v(e._s(e.$t("m.treeinfo['条件组间关系']")))]),e._v(" "),t("bk-radio-group",{model:{value:e.conditionType,callback:function(t){e.conditionType=t},expression:"conditionType"}},[t("bk-radio",{attrs:{value:"and","ext-cls":"mr20"}},[e._v(e._s(e.$t("m.treeinfo['且']")))]),e._v(" "),t("bk-radio",{attrs:{value:"or"}},[e._v(e._s(e.$t("m.treeinfo['或']")))])],1)],1),e._v(" "),e.checkStatus?t("p",{staticClass:"bk-error-msg"},[e._v(e._s(e.$t("m.treeinfo['关系名称，关系表达式，关系值不能为空']")))]):e._e(),e._v(" "),t("i",{staticClass:"bk-icon icon-close",on:{click:e.clearCondition}}),e._v(" "),e._l(e.listInfo,(function(n,i){return t("div",{key:i,staticClass:"bk-between-form",class:{mt20:i}},[t("bk-select",{staticStyle:{"min-width":"85px",float:"left","margin-right":"10px"},attrs:{searchable:""},on:{selected:function(t){return e.changeName(...arguments,n)}},model:{value:n.key,callback:function(t){e.$set(n,"key",t)},expression:"node.key"}},e._l(e.fieldList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),t("bk-select",{staticStyle:{"min-width":"60px",float:"left","margin-right":"10px"},attrs:{searchable:""},model:{value:n.condition,callback:function(t){e.$set(n,"condition",t)},expression:"node.condition"}},e._l(n.betweenList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1),e._v(" "),"SELECT"===n.type||"MULTISELECT"===n.type||"RADIO"===n.type||"CHECKBOX"===n.type||"MEMBERS"===n.type||"TREESELECT"===n.type?[n.choiceList.length?[t("bk-select",{staticStyle:{width:"80px"},attrs:{"ext-cls":"bk-form-style",searchable:"",multiple:n.multiSelect},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"node.value"}},e._l(n.choiceList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:[t("bk-input",{attrs:{"ext-cls":"bk-form-style",type:"INT"===n.type?"number":"text",placeholder:e.$t("m.treeinfo['请输入关系值']")},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"node.value"}})]]:"DATE"===n.type||"DATETIME"===n.type?[t("bk-date-picker",{attrs:{"ext-cls":"bk-form-style",type:"DATETIME"===n.type?"datetime":"date"},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"node.value"}})]:[t("bk-input",{attrs:{"ext-cls":"bk-form-style",type:"INT"===n.type?"number":"text",placeholder:e.$t("m.treeinfo['请输入关系值']")},model:{value:n.value,callback:function(t){e.$set(n,"value",t)},expression:"node.value"}})],e._v(" "),t("div",{staticClass:"bk-between-operat"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addNode(n,i)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===e.listInfo.length},on:{click:function(t){return e.deleteNode(n,i)}}})])],2)}))],2)},a=[];i._withStripped=!0},LwjM:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-trigger-field"},["STRING"===e.item.type||"TEXT"===e.item.type?[t("bk-input",{attrs:{maxlength:120},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})]:"INT"===e.item.type?[t("bk-input",{attrs:{clearable:!0,type:"number"},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})]:"SELECT"===e.item.type||"RADIO"===e.item.type?[t("bk-select",{attrs:{searchable:"",loading:e.item.loading},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}},e._l(e.item.options,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:"CHECKBOX"===e.item.type||"MULTISELECT"===e.item.type?[t("bk-select",{attrs:{searchable:"",multiple:"",loading:e.item.loading},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}},e._l(e.item.options,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:"MEMBERS"===e.item.type||"MULTI_MEMBERS"===e.item.type||"MEMBER"===e.item.type?[t("member-select",{model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})]:"DATE"===e.item.type?[t("bk-date-picker",{attrs:{placeholder:e.$t("m.newCommon['选择日期']")},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})]:"DATETIME"===e.item.type?[t("bk-date-picker",{attrs:{type:"datetime",placeholder:e.$t("m.newCommon['选择日期时间']")},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})]:[t("bk-input",{attrs:{maxlength:120},model:{value:e.item.value,callback:function(t){e.$set(e.item,"value",t)},expression:"item.value"}})]],2)},a=[];i._withStripped=!0},M78e:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("P2sY")),a=s(n("t2rG")),r=s(n("Albq")),o=s(n("RPM2"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ServiceForm",components:{draggable:a.default,HalfRowForm:r.default,FormViewItem:o.default},props:{serviceInfo:Object,nodeId:Number,forms:Array,crtForm:[String,Number],addFieldStatus:Boolean},data:function(){return{formList:this.transFieldsToDraggable(this.forms)}},watch:{forms:{handler:function(e){this.formList=this.transFieldsToDraggable(e)},deep:!0}},mounted:function(){},methods:{transFieldsToDraggable:function(e){var t=[];return e.forEach((function(e){var n=t[t.length-1];if("COL_6"!==e.layout)t.push(e);else if(Array.isArray(n)&&void 0===n[1]&&"right"===e.meta.layout_position)n[1]=e;else{var i="right"===e.meta.layout_position?[void 0,e]:[e,void 0];t.push(i)}})),t.filter((function(e){if(Array.isArray(e)){var t=e.filter((function(e){return e&&e.showFeild}));return t.length?t:t.length}return e.showFeild}))},onRowDragEnd:function(e){for(var t=Number(e.item.dataset.id),n=this.forms.find((function(e){return e.id===t})),i=e.newIndex,a=0;a<e.newIndex;a++)Array.isArray(this.formList[a])&&this.formList[a].every((function(e){return void 0!==e}))&&(i+=1);this.$emit("dragUpdateList",i,n)},onHalfRowDragToRow:function(e){var t=Number(e.item.dataset.id),n=e.newIndex;if(this.forms.find((function(e){return e.id===t}))){for(var i=this.forms.find((function(e){return e.id===t})),a=0;a<e.newIndex;a++){var r=this.formList[a];Array.isArray(r)&&(r.every((function(e){return void 0!==e&&e.id!==t}))&&(n+=1),r.some((function(e){return void 0===e}))&&r.find((function(e){return e&&e.id===t}))&&(n-=1))}i.meta.layout_position="left",this.$emit("dragUpdateList",n,i)}else{var o={api_info:e.item._underlying_vm_.api_info,workflow:"",id:"",key:"",name:e.item._underlying_vm_.name,type:e.item._underlying_vm_.type,desc:"",layout:"COL_12",validate_type:"REQUIRE",choice:[],showFeild:!0,is_builtin:!1,source_type:e.item._underlying_vm_.source_type||"CUSTOM",source_uri:"",regex:"EMPTY",custom_regex:"",is_tips:!1,tips:"",meta:{},default:""};this.$emit("onAddFormClick",n,o)}},onHalfRowDragToHalfRow:function(e){var t=void 0,n=Number(e.item.dataset.id),i=Number(e.target.dataset.rowindex),a=this.formList[i],r=a.find((function(e){return e})),o=this.forms.findIndex((function(e){return e.id===r.id}));if(this.forms.find((function(e){return e.id===n}))){var s=this.forms.find((function(e){return e.id===n}));void 0===a[0]?(s.meta.layout_position="left",t=s.id===r.id||0===o?o:o-1):(s.meta.layout_position="right",t=s.id===r.id||o===this.forms.length-1?o:o+1),this.$emit("dragUpdateList",t,s)}else{var c={api_info:e.item._underlying_vm_.api_info,workflow:"",id:"",key:"",name:e.item._underlying_vm_.name,type:e.item._underlying_vm_.type,desc:"",layout:"COL_6",validate_type:"REQUIRE",choice:[],showFeild:!0,is_builtin:!1,source_type:e.item._underlying_vm_.source_type||"CUSTOM",source_uri:"",regex:"EMPTY",custom_regex:"",is_tips:!1,tips:"",meta:{},default:""};void 0===a[0]?(c.meta.layout_position="left",t=c.id===r.id||0===o?o:o-1):(c.meta.layout_position="right",t=c.id===r.id||o===this.forms.length-1?o:o+1),this.$emit("onAddFormClick",t,c)}},onFormEditClick:function(e){this.$emit("onFormEditClick",e)},onFormCloneClick:function(e){this.crtForm?this.$bkMessage({message:this.$t('m["请先将当前字段属性关闭再进行操作"]'),theme:"warning"}):this.$emit("fieldClone",e)},onEditCancel:function(){"add"===this.crtForm?this.$emit("cancelAdd"):this.$emit("update:crtForm","")},onEditConfirm:function(e){var t=this.forms.find((function(t){return t.id===e.id}));t?"COL_12"===e.layout?e.layout_position="":"COL_12"===t.layout&&(e.layout_position="left"):"COL_6"===e.layout&&(e.layout_position="left"),this.$emit("saveField",(0,i.default)({},t,e))}}}},MBfY:function(e,t,n){"use strict";n.r(t);var i=n("GauI"),a=n("T2YI");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("pLkd");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"6d0b7e2a",null);t.default=s.exports},MEtw:function(e,t,n){"use strict";n.r(t);var i=n("50No"),a=n("rLYG");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("31H0"),n("jr9V");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"2c9f757f",null);t.default=s.exports},MG1K:function(e,t,n){"use strict";n.r(t);var i=n("1lNk"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},MHZE:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",{staticClass:"ci-template"},[t("bk-form",{ref:"devopsForm",attrs:{model:e.item.devopsContent,rules:e.defaultRules,"label-width":200,"form-type":"vertical"}},[t("bk-form-item",{attrs:{label:e.$t("m.tickets['项目']"),required:!0,property:"project_id","error-display-type":"normal"}},[t("bk-select",{attrs:{loading:e.projectLoading,searchable:"",disabled:e.disabled},on:{selected:e.handleProjectChange},model:{value:e.item.devopsContent.project_id,callback:function(t){e.$set(e.item.devopsContent,"project_id",t)},expression:"item.devopsContent.project_id"}},e._l(e.projectList,(function(e){return t("bk-option",{key:e.projectCode,attrs:{id:e.projectCode,name:e.project_name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.tickets['流水线']"),required:!0,property:"pipeline_id","error-display-type":"normal"}},[t("bk-select",{attrs:{loading:e.pipelineLoading,searchable:"",disabled:e.disabled},on:{selected:e.handlePipelineChange},model:{value:e.item.devopsContent.pipeline_id,callback:function(t){e.$set(e.item.devopsContent,"pipeline_id",t)},expression:"item.devopsContent.pipeline_id"}},e._l(e.pipelineList,(function(e){return t("bk-option",{key:e.pipelineId,attrs:{id:e.pipelineId,name:e.pipelineName}})})),1)],1)],1),e._v(" "),t("h3",{staticClass:"setion-title"},[t("span",{staticClass:"setion-title-icon",on:{click:function(t){t.stopPropagation(),e.showPipelineVariable=!e.showPipelineVariable}}},[e.showPipelineVariable?t("i",{staticClass:"bk-icon icon-angle-down"}):t("i",{staticClass:"bk-icon icon-angle-right"})]),e._v("\n    "+e._s(e.$t("m.tickets['流水线变量']"))+"\n  ")]),e._v(" "),t("bk-form",{directives:[{name:"show",rawName:"v-show",value:e.showPipelineVariable,expression:"showPipelineVariable"},{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.pipelineStartLoading},expression:"{ isLoading: pipelineStartLoading }"}],ref:"devopsVariable",attrs:{model:e.item.devopsContent.variables,"label-width":200,"form-type":"vertical"}},e._l(e.pipelineVariableList,(function(n){return t("bk-form-item",{key:n.id,staticClass:"half-width-item",attrs:{label:n.id,required:!0,property:n.id,rules:e.rules[n.id],"error-display-type":"normal"}},[t("bk-input",{attrs:{disabled:e.disabled,clearable:!0},model:{value:e.item.devopsContent.variables[n.id],callback:function(t){e.$set(e.item.devopsContent.variables,n.id,t)},expression:"item.devopsContent.variables[variable.id]"}})],1)})),1),e._v(" "),t("h3",{staticClass:"setion-title border-none"},[t("span",{staticClass:"setion-title-icon",on:{click:function(t){t.stopPropagation(),e.showPipelineStages=!e.showPipelineStages}}},[e.showPipelineStages?t("i",{staticClass:"bk-icon icon-angle-down"}):t("i",{staticClass:"bk-icon icon-angle-right"})]),e._v("\n    "+e._s(e.$t("m.tickets['插件预览']"))+"\n  ")]),e._v(" "),t("devops-preview",{directives:[{name:"show",rawName:"v-show",value:e.showPipelineStages,expression:"showPipelineStages"}],attrs:{stages:e.pipelineStages,loading:e.pipelineDetailLoading}})],1):e._e()},a=[];i._withStripped=!0},MI7q:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("GQeE")),a=s(n("gDS+")),r=s(n("14Xm")),o=s(n("D3Ub"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"getParam",components:{},props:{changeInfo:{type:Object,default:function(){return{}}},apiDetail:{type:Object,default:function(){}},stateList:{type:Array,default:function(){return[]}},isStatic:{type:Boolean,default:function(){return!1}},isCustom:{type:Boolean,default:function(){return!1}},queryValue:{type:Object,default:function(){return{}}},entry:{type:String,default:function(){return""}},formInfo:{type:Object,default:function(){return{}}}},data:function(){return{paramTableData:[],checkInfo:{name:"",road:""},sourceTypeList:[{id:1,key:"CUSTOM",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"FIELDS",name:this.$t('m.treeinfo["引用变量"]')}],paramTableInfo:{value:"",placeholder:this.$t('m.treeinfo["请选择数据来源"]')}}},computed:{},watch:{apiDetail:function(){this.initData()}},mounted:function(){var e=this;return(0,o.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.changeInfo;case 2:return t.next=4,e.isStatic;case 4:return t.next=6,e.queryValue;case 6:return t.next=8,e.initData();case 8:case"end":return t.stop()}}),t,e)})))()},methods:{initData:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,JSON.parse((0,a.default)(e.apiDetail.req_params));case 2:if(t.t0=t.sent,t.t0){t.next=5;break}t.t0=[];case 5:return n=t.t0,t.next=8,n.forEach((function(t){if(t.isCheck=!1,t.isSatisfied=!1,t.el=null,t.customValue=t.value||"",t.source_type="CUSTOM",t.value_key="",e.isStatic)t.value=e.queryValue[t.name]||"";else if(e.changeInfo.api_info&&(0,i.default)(e.changeInfo.api_info.req_params).length&&e.changeInfo.api_info.remote_api_id===e.apiDetail.id)if(/^\$\{params_.*\}$/.test(e.changeInfo.api_info.req_params[t.name]))t.source_type="FIELDS",t.value_key=e.changeInfo.api_info.req_params[t.name]?JSON.parse((0,a.default)(e.changeInfo.api_info.req_params[t.name])).replace(/^\$\{params_/,"").replace(/\}$/,""):"";else{var n=e.changeInfo.api_info.req_params[t.name];t.source_type="CUSTOM",t.value=n}}));case 8:return t.next=10,JSON.parse((0,a.default)(n));case 10:e.paramTableData=t.sent;case 11:case"end":return t.stop()}}),t,e)})))()},addNewItem:function(e){this.$emit("addNewItem",e)}}}},MImu:function(e,t,n){"use strict";n.r(t);var i=n("uv/p"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},MQva:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("gDS+")),a=c(n("14Xm")),r=c(n("D3Ub")),o=c(n("OE89")),s=c(n("VflG"));function c(e){return e&&e.__esModule?e:{default:e}}t.default={name:"nodeCondition",components:{exportTree:o.default},mixins:[s.default],props:{lineInfo:{type:Object,default:function(){return{}}},formInfo:{type:Object,default:function(){return{}}},changeInfo:{type:Object,default:function(){return{}}},apiDetail:{type:Object,default:function(){}},workflow:{type:[String,Number],default:function(){return""}},state:{type:[String,Number],default:function(){return""}},stateList:{type:Array,default:function(){return[]}}},data:function(){return{booleanList:[{id:"1",name:"true"},{id:"0",name:"false"}],checkInfo:{assignors_type:!1,assignors:!1,processors_type:!1,processors:!1},scrollTopStatus:0}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},watch:{apiDetail:function(){this.initData()}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),t,e)})))()},globalChoiseFilter:function(e,t){return e.filter((function(e){switch(t){case"string":return-1!==["==","!=","startswith","endswith","not contains","contains"].indexOf(e.typeName);case"number":return-1!==["==","!=",">",">=","<","<="].indexOf(e.typeName);case"boolean":return-1!==["==","!="].indexOf(e.typeName);default:return!0}}))},addCondition:function(){var e=this,t={type:"and",checkInfo:!1,expressions:[{condition:"",key:"",value:"",name:"",choiceList:"",type:"string",organization:{assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:!1}}]};t.expressions.forEach((function(t){t.organization.assignorPerson=JSON.parse((0,i.default)(e.lineInfo.expressions[0].expressions[0].organization.assignorPerson))})),this.lineInfo.expressions.push(t)},delteCondition:function(e,t){1!==this.lineInfo.expressions.length&&this.lineInfo.expressions.splice(t,1)},addNode:function(e,t){var n={condition:"",key:"",value:"",name:"",choiceList:"",type:"string",organization:{assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:!1}};n.organization.assignorPerson=JSON.parse((0,i.default)(this.lineInfo.expressions[0].expressions[0].organization.assignorPerson)),e.expressions.splice(t+1,0,n)},deleteNode:function(e,t){1!==e.expressions.length&&e.expressions.splice(t,1)},showTree:function(e){var t=!e.organizaInfo.assignorShow;this.closeOther(),e.organizaInfo.assignorShow=t},closeOther:function(){this.lineInfo.expressions.forEach((function(e){e.expressions.forEach((function(e){e.organizaInfo.assignorShow=!1}))}))},recordCheckFn:function(e){var t=this;e.checkInfo=!1,null===e.children||e.children&&!e.children.length||e.children.forEach((function(e){t.recordCheckFn(e)}))},assignorToggle:function(){var e=this;arguments[1].type=arguments[0].type,arguments[1].name=arguments[0].name,arguments[1].key=arguments[0].ancestorsList_str,arguments[1].organization.assignorPerson.forEach((function(t){e.recordCheckFn(t)})),arguments[0].checkInfo=!0,arguments[1].organization.assignorTree=arguments[0],this.checkInfo.assignors=!1,this.closeTree(arguments[1])},closeTree:function(e){e.organizaInfo.assignorShow=!1},toggleChildren:function(){arguments[0].showChildren=!arguments[0].showChildren,arguments[1].organization.assignorPerson=JSON.parse((0,i.default)(arguments[1].organization.assignorPerson))}}}},MTdN:function(e,t,n){},"MX/Q":function(e,t,n){},Mf0c:function(e,t,n){"use strict";n.r(t);var i=n("G6uA"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},MxYs:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{class:["form-view-item",e.crtForm===e.form.id?"click-status":""]},[e.addFieldStatus||e.crtForm!==e.form.id?e._e():t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-square-one"}),e._v(" "),t("div",{staticClass:"drag-element"},[e._t("draggable")],2),e._v(" "),t("div",{staticClass:"form-view-content"},[t("CW-"+e.form.type,{tag:"component",attrs:{item:e.form,fields:e.fields}})],1),e._v(" "),t("div",{staticClass:"mask",on:{click:function(t){return e.$emit("onFormEditClick",e.form)}}}),e._v(" "),t("div",{staticClass:"opt-btns"},["CUSTOM"===e.form.source?t("i",{staticClass:"btn-item bk-itsm-icon icon-itsm-icon-copy",on:{click:function(t){return e.$emit("onFormCloneClick",e.form)}}}):e._e(),e._v(" "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{placement:"auto-start",content:e.$t("m['内置字段，不可删除']"),disabled:!e.deleteDisabled,theme:"Light"},expression:"{ placement: 'auto-start', content: $t(`m['内置字段，不可删除']`), disabled: !deleteDisabled, theme: 'Light' }"}],staticClass:"btn-item bk-icon icon-delete",class:e.deleteDisabled?"disabled":"",on:{click:function(t){return e.onDeleteClick(e.form)}}})])])},a=[];i._withStripped=!0},N3dC:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("ygAv"),a=n("CeR/");t.default={name:"NodeTemplate",props:{node:{type:Object,default:function(){return{}}},canvasData:{type:Object,default:function(){return{}}}},data:function(){return{moveFlag:!1,clickSecond:!1,toolStatus:!1,valueInfo:{node:{},line:{}},typeList:[{type:"NORMAL",iconStyle:"icon-icon-person"},{type:"ROUTER",iconStyle:"icon-icon-person"},{type:"TASK",iconStyle:"icon-api-icon"},{type:"TASK-SOPS",iconStyle:"icon-task-node"},{type:"WEBHOOK",iconStyle:"icon-webhook-icon"},{type:"TASK-DEVOPS",iconStyle:"icon-devops-task-icon"},{type:"BK-PLUGIN",iconStyle:"icon-chajian-icon"},{type:"APPROVAL",iconStyle:"icon-approval-node"}],clickList:[{type:"NORMAL",name:this.$t('m.treeinfo["手动节点"]'),iconStyle:"icon-icon-artificial"},{type:"TASK",name:this.$t('m.treeinfo["API节点"]'),iconStyle:"icon-api-node"},{type:"TASK-SOPS",name:this.$t('m.treeinfo["标准运维节点"]'),iconStyle:"icon-task-icon"},{type:"WEBHOOK",name:this.$t("m['WEBHOOK节点']"),iconStyle:"icon-webhookjiedian"},{type:"APPROVAL",name:this.$t("m.treeinfo['审批节点']"),iconStyle:"icon-approval-node"},{type:"COVERAGE",name:this.$t('m.treeinfo["汇聚网关"]'),iconStyle:"icon-flow-branch"},{type:"ROUTER-P",name:this.$t('m.treeinfo["并行网关"]'),iconStyle:"icon-flow-convergence"},{type:"COPY",name:this.$t('m.treeinfo["复制节点"]'),iconStyle:"icon-copy-new"}],currentNode:{},nodeDisabled:window.RUN_VER}},mounted:function(){if(this.toolStatus=localStorage.getItem("toolStatus")||!1,"ieod"===this.nodeDisabled){var e=[{type:"TASK-DEVOPS",name:this.$t('m["蓝盾节点"]'),iconStyle:"icon-devops-task-icon"},{type:"BK-PLUGIN",name:this.$t("m['蓝鲸插件节点']"),iconStyle:"icon-chajianjiedian"}];this.clickList.splice(0,0,e[0],e[1])}},methods:{hoverNode:function(e){e.nodeInfo&&e.nodeInfo.errorInfo&&(e.nodeInfo.errorInfo=!1)},moveDoneFn:function(e){this.moveFlag=!1;for(var t=document.getElementsByClassName("jsflow-node"),n=0;n<t.length;n++)t[n].style["z-index"]=101;document.getElementById(e.id)&&(document.getElementById(e.id).style["z-index"]=102)},moveFn:function(){this.moveFlag=!0},onNodeClick:function(e){this.currentNode=e;var t=Boolean(e.showMore);if(this.$set(e,"showMore",t),this.moveFlag){var n=this.canvasData.nodes.find((function(t){return t.id===e.id}));this.$store.commit("deployCommon/changeNodeInfo",n)}else;this.moveFlag=!1},clickNode:function(){this.openconfigu()},rightClickNode:function(e){e&&(this.$emit("closeShow"),e.showMore=!0)},openconfigu:function(){var e=(0,i.deepClone)(this.node);Math.abs(e.x-this.currentNode.x)>3||Math.abs(e.y-this.currentNode.y)>3||"ROUTER-P"!==e.type&&"COVERAGE"!==e.type&&"START"!==e.type&&"END"!==e.type&&this.$emit("configuNode",e.nodeInfo)},closeNode:function(){this.node.showMore=!1},addNormal:function(e,t){var n=this;if(!this.clickSecond)if(this.clickSecond=!0,this.$store.commit("deployCommon/changeNodeStatus",!0),"COPY"!==t.type){var i=this.canvasData.lines.filter((function(t){return t.source.id===e.id})),a="NORMAL"===e.type||"TASK"===e.type?310:210,r={workflow:e.nodeInfo.workflow,name:"",type:t.type,is_terminable:!1,axis:{x:e.x+a,y:e.y+80*i.length},extras:{}};this.$store.dispatch("deployCommon/creatNode",{params:r}).then((function(r){n.valueInfo.node={id:"node_"+r.data.id,x:e.x+a,y:e.y+80*i.length,type:t.type,name:r.data.name,showMore:!1,nodeInfo:r.data},n.$emit("closeShow"),n.$emit("updateNode",n.valueInfo,t.type),n.addNewLine(e,r.data.id)})).catch((function(e){n.$bkMessage({message:e.data.msg,theme:"error"})})).finally((function(){n.clickSecond=!1,n.$store.commit("deployCommon/changeNodeStatus",!1)}))}else{var o=this.node.nodeInfo.id;this.$store.dispatch("deployCommon/copyNode",o).then((function(e){n.valueInfo.node={id:"node_"+e.data.id,x:e.data.axis.x-250,y:e.data.axis.y+100,type:e.data.type,name:e.data.name,showMore:!1,nodeInfo:e.data},n.$emit("closeShow"),n.$emit("updateNode",n.valueInfo,t.type)})).catch((function(e){n.$bkMessage({message:e.data.msg,theme:"error"})})).finally((function(){n.clickSecond=!1,n.$store.commit("deployCommon/changeNodeStatus",!1)}))}},addNewLine:function(e,t){var n=this,i={workflow:e.nodeInfo.workflow,name:this.$t('m.treeinfo["默认"]'),axis:{start:"Right",end:"Left"},from_state:e.nodeInfo.id,to_state:t};this.$store.dispatch("deployCommon/createLine",{lineParams:i}).then((function(t){n.valueInfo.line={source:{arrow:"Right",id:e.id},target:{arrow:"Left",id:n.valueInfo.node.id},lineInfo:t.data},n.$emit("fastAddNode",n.valueInfo),n.$emit("updateLine",n.valueInfo.line,"add")})).catch((function(e){(0,a.errorHandler)(e,n)}))},clickDelete:function(e){var t=this;this.$bkInfo({type:"warning",title:this.$t("m['此操作不可撤销，确定要删除吗？']"),confirmFn:function(){t.$emit("openDelete",e)}})},closeTool:function(){this.toolStatus=!0,localStorage.setItem("toolStatus",!0)}}}},N8nL:function(e,t,n){"use strict";n("G4fa")},NFkJ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("ukIK"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"sendMessage",components:{changeConductor:r.default},props:{itemInfo:{type:Object,default:function(){return{}}},isShowVar:{type:Boolean,default:function(){return!0}}},data:function(){return{trueStatus:!0,falseStatus:!1,activeName:"send_email_message",show:!0}},computed:{},created:function(){var e=this;this.itemInfo.sub_components.forEach((function(t){switch(e.$set(t,"checked",t.checked||!1),t.checked&&(e.activeName=t.name),e.$set(t,"label",t.name),e.$set(t,"icon",""),t.key){case"send_email_message":t.icon="icon-email";break;case"send_sms_message":t.icon="icon-mobile";break;case"send_wechat_message":t.icon="icon-weixin"}}))},mounted:function(){},methods:{changPanel:function(e){this.activeName=e},changePanelStatus:function(e,t){console.log(e,t)}}}},NGZu:function(e,t,n){"use strict";n.r(t);var i=n("+KRo"),a=n("VtRw");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("N8nL");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"60ae7397",null);t.default=s.exports},NLOC:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("efIh"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"DATE",mixins:[r.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)}},mounted:function(){if(this.conditionField(this.item,this.fields),this.item.value&&!this.item.val&&(this.item.val=this.item.value),!this.item.val){var e=new Date;this.item.val=e,this.item.value=e}},methods:{}}},NOZu:function(e,t,n){},NPk7:function(e,t,n){"use strict";n.r(t);var i=n("q4Iw"),a=n("Cyyo");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("qkdU");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"21fd4902",null);t.default=s.exports},NXOa:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("efIh")),a=r(n("FCVG"));function r(e){return e&&e.__esModule?e:{default:e}}t.default={name:"CUSTOM-FORM",components:{RenderView:a.default},mixins:[i.default],props:{item:{type:Object,default:function(){}},fields:{type:Array,default:function(){return[]}}},data:function(){return{formData:[],context:{},errMessage:""}},watch:{"item.val":{handler:function(){this.conditionField(this.item,this.fields),this.initRenderView()},immediate:!0}},mounted:function(){this.item.value&&!this.item.val&&(this.item.val=this.item.value)},methods:{initRenderView:function(){this.errMessage="";try{var e="string"==typeof this.item.val?JSON.parse(this.item.val):this.item.val,t=e.form_data,n=e.schemes,i=e.config;this.formData=t,this.context={schemes:n,config:i}}catch(e){this.errMessage=e,this.formData=[]}}}}},Ncax:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,"ext-cls":"bk-ext-item",desc:e.item.tips,"desc-type":"icon"}},[t("div",{staticClass:"member-form-item",on:{click:function(t){e.item.checkValue=!1}}},[t("member-select",{class:{"bk-border-error":e.item.checkValue},attrs:{disabled:e.item.is_readonly&&!e.isCurrent||e.item.evaluDisable||e.disabled,placeholder:e.item.desc},on:{change:e.onMemberSelectChange},model:{value:e.selectedItems,callback:function(t){e.selectedItems=t},expression:"selectedItems"}}),e._v(" "),t("business-card",{attrs:{item:e.item}})],1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},NesJ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("efIh"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"DATETIME",mixins:[r.default],props:{item:{type:Object,default:function(){return{}}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)}},mounted:function(){if(this.conditionField(this.item,this.fields),this.item.value&&!this.item.val&&(this.item.val=this.item.value),!this.item.val){var e=new Date;this.item.val=e,this.item.value=e}},methods:{}}},Nxk6:function(e,t,n){n("dbV7"),e.exports=9007199254740991},NzFv:function(e,t,n){},O4mU:function(e,t,n){"use strict";n.r(t);var i=n("4Vln"),a=n("kjRb");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("B2j7");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"1fec69ca",null);t.default=s.exports},O4pD:function(e,t,n){"use strict";n.r(t);var i=n("RnPO"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},OE89:function(e,t,n){"use strict";n.r(t);var i=n("n5mh"),a=n("O4pD");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("1h6V");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"55a2ec1b",null);t.default=s.exports},OV2Y:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-input-params"},[t("bk-table",{attrs:{data:e.paramTableData,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['名称']"),"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticClass:"bk-more"},[t("span",{style:{paddingLeft:20*n.row.level+"px"}},[n.row.has_children?t("span",{class:["bk-icon","tree-expanded-icon",n.row.showChildren?"icon-down-shape":"icon-right-shape"],on:{click:function(t){return e.changeState(n.row)}}}):t("span",{staticClass:"bk-icon bk-more-icon"}),e._v(" "),t("span",[e._v(e._s(n.row.key||"--"))])])])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['必选']"),width:"60"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.is_necessary?e.$t('m.treeinfo["是"]'):e.$t('m.treeinfo["否"]'))+"\n      ")]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['备注']"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",{attrs:{title:n.row.desc}},[e._v(e._s(n.row.desc||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"280"},scopedSlots:e._u([{key:"default",fn:function(n){return["object"!==n.row.type&&"array"!==n.row.type?[t("div",{staticStyle:{width:"120px",position:"absolute",top:"5px",left:"10px"}},[t("bk-select",{attrs:{clearable:!1,searchable:""},model:{value:n.row.source_type,callback:function(t){e.$set(n.row,"source_type",t)},expression:"props.row.source_type"}},e._l(e.sourceTypeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),n.row.source_type&&"CUSTOM"!==n.row.source_type?t("div",{staticStyle:{width:"120px",position:"absolute",top:"5px",right:"10px"}},[t("bk-select",{attrs:{clearable:!1,searchable:""},model:{value:n.row.value_key,callback:function(t){e.$set(n.row,"value_key",t)},expression:"props.row.value_key"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1):t("div",{staticStyle:{width:"120px",position:"absolute",top:"4px",right:"10px"}},["string"===n.row.type||"number"===n.row.type?[t("bk-input",{attrs:{type:"string"===n.row.type?"text":"number",placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}})]:e._e(),e._v(" "),"boolean"===n.row.type?[t("bk-radio-group",{model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}},[t("bk-radio",{attrs:{value:e.trueSatatus}},[e._v("true")]),e._v(" "),t("bk-radio",{attrs:{value:e.falseSatatus}},[e._v("false")])],1)]:e._e()],2)]:e._e()]}}])}),e._v(" "),t("bk-table-column",{attrs:{width:"60","class-name":"last-add-row-column"},scopedSlots:e._u([{key:"default",fn:function(n){return["array"===n.row.lastType?t("div",{staticClass:"bk-between-operat"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addChildren(n.row)}}}),e._v(" "),"array"===n.row.lastType?t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":e.countSon(n.row)},on:{click:function(t){return e.deletChildren(n.row)}}}):e._e()]):e._e()]}}])})],1)],1)},a=[];i._withStripped=!0},OWBw:function(e,t,n){"use strict";n.r(t);var i=n("wj23"),a=n("A/4B");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("PcV5");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"6a12c7b6",null);t.default=s.exports},OZnK:function(e,t,n){"use strict";n.r(t);var i=n("Hlvs"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},OjZH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("WgRI"),r=(i=a)&&i.__esModule?i:{default:i},o=n("ygAv");t.default={name:"SelectTree",components:{Tree:r.default},model:{prop:"value",event:"selected"},props:{list:{type:Array,default:function(){return[]}},value:{type:[Number,String,Array],default:""},placeholder:{type:String,default:""},loading:{type:Boolean,default:!1},extCls:{type:String,default:""},organizationLoading:Boolean},data:function(){return{isShowTree:!1,displayName:"",displayList:[],checked:null}},watch:{list:function(){this.initData()},value:function(){this.initData()},loading:function(){this.initData()}},created:function(){this.initData()},methods:{initData:function(){var e=this;this.displayList=(0,o.deepClone)(this.list),this.displayList.length&&this.displayList.forEach((function(t){e.setCheckedValue(t)})),this.value&&this.checked&&this.displayList.forEach((function(t){e.openChildren(t)})),this.checked&&this.$emit("change",(0,o.deepClone)(this.checked))},setCheckedValue:function(e){var t=this;if(this.$set(e,"checkInfo",!1),this.$set(e,"has_children",!(!e.children||!e.children.length)),this.value&&String(this.value)===String(e.id))return e.checkInfo=!0,this.checked=e,void this.setDispalyName();e.has_children&&(this.$set(e,"showChildren",!1),e.children.forEach((function(e){t.setCheckedValue(e)})))},openChildren:function(e){var t=this;this.$set(e,"showChildren",!1),this.$set(e,"showChildren",this.checked.route.some((function(t){return String(t.id)===String(e.id)}))),e.children&&e.children.length&&e.children.forEach((function(e){t.openChildren(e)}))},setDispalyName:function(){var e=[];this.checked.route.length&&(e=this.checked.route.map((function(e){return e.name}))),e.push(this.checked.name),this.displayName=e.join("/")},showTree:function(){this.loading||(this.isShowTree=!0)},closeTree:function(){this.isShowTree=!1},toggleInfo:function(e){this.checked=e,this.setDispalyName(),this.cancelAllSectedStatus(),this.$set(e,"checkInfo",!0),this.$emit("selected",e.id),this.$emit("change",(0,o.deepClone)(e)),this.closeTree()},cancelAllSectedStatus:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.displayList;t.forEach((function(t){e.$set(t,"checkInfo",!1),t.children&&t.children.length&&e.cancelAllSectedStatus(t.children)}))},toggleChildren:function(e){this.$set(e,"showChildren",!e.showChildren)}}}},OkDz:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("Jwqd"),a={column:{type:Array,default:function(){return[{name:"操作",type:"text",key:"column1"},{name:"关联相关内容",key:"column2",scheme:"table_text_scheme",attrs:{}},{name:"申请期限",type:"text",key:"column3",attrs:{sort:!0}}]}},value:{type:Array,default:function(){return[]}}};t.default={name:"TagTable",components:{ViewItem:function(){return Promise.resolve().then(n.bind(null,"UsFA"))}},mixins:[(0,i.getFormMixins)(a)],methods:{getScheme:function(e,t){var n=this.getContext().schemes;return t&&t.scheme&&n[t.scheme]?n[t.scheme]:e.scheme?n[e.scheme]:t&&t.type?{type:t.type}:{type:e.type}}}}},"Om//":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}],staticClass:"bk-add-field"},[t("bk-form",{ref:"fieldForm",staticClass:"bk-add-field bk-form-vertical",attrs:{"label-width":200,"form-type":e.formAlign,model:e.formInfo,rules:e.rules}},[Object.keys(e.sospInfo).length?[t("bk-form-item",{style:{marginTop:"vertical"===e.formAlign?0:"20px"},attrs:{label:e.$t("m.treeinfo['前置节点']"),required:!0,property:"prevId","error-display-type":"normal","ext-cls":"bk-mt0-item"}},[t("bk-select",{attrs:{searchable:""},on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.prevId,callback:function(t){e.$set(e.formInfo,"prevId",t)},expression:"formInfo.prevId"}},e._l(e.prevNodeList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1)]:e._e(),e._v(" "),t("bk-form-item",{style:{marginTop:"vertical"===e.formAlign?0:"20px"},attrs:{"data-test-id":"field-input-fieldName",label:e.$t("m.treeinfo['字段名']"),required:!0,property:"name","error-display-type":"normal","ext-cls":"bk-halfline-item bk-halfline-margin"}},[t("bk-input",{attrs:{maxlength:"120",disabled:"TABLE"===e.changeInfo.source&&"bk_biz_id"!==e.formInfo.key,placeholder:e.$t("m.treeinfo['请输入字段显示名']")},on:{change:e.fieldNameChange,input:e.putKey},model:{value:e.formInfo.name,callback:function(t){e.$set(e.formInfo,"name",t)},expression:"formInfo.name"}})],1),e._v(" "),t("bk-form-item",{style:{marginTop:"vertical"===e.formAlign?0:"20px"},attrs:{label:e.$t("m.treeinfo['唯一标识']"),required:!0,property:"key","error-display-type":"normal","ext-cls":"bk-halfline-item"}},[t("bk-input",{attrs:{placeholder:e.$t("m.treeinfo['请输入唯一标识']"),disabled:"number"==typeof e.changeInfo.id||e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source},on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.key,callback:function(t){e.$set(e.formInfo,"key",t)},expression:"formInfo.key"}})],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"field-select-fieldType",label:e.$t("m.treeinfo['字段类型']"),required:!0,property:"type","error-display-type":"normal","ext-cls":"bk-halfline-item bk-halfline-margin bk-mt20-item"}},[t("bk-select",{attrs:{clearable:!1,disabled:(e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source||e.changeInfo.meta&&"APPROVE_RESULT"===e.changeInfo.meta.code)&&"bk_biz_id"!==e.formInfo.key,searchable:""},on:{selected:e.changeType},model:{value:e.formInfo.type,callback:function(t){e.$set(e.formInfo,"type",t)},expression:"formInfo.type"}},e._l(e.fieldTypeList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['校验方式']"),required:!0,"error-display-type":"normal","ext-cls":"bk-halfline-item bk-mt20-item"}},[t("bk-select",{attrs:{clearable:!1,disabled:(e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source||e.changeInfo.meta&&"APPROVE_RESULT"===e.changeInfo.meta.code)&&"bk_biz_id"!==e.formInfo.key,searchable:""},on:{selected:e.changeRegex},model:{value:e.formInfo.regex,callback:function(t){e.$set(e.formInfo,"regex",t)},expression:"formInfo.regex"}},e._l(e.regexList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1)],1),e._v(" "),"ASSOCIATED_FIELD_VALIDATION"!==e.formInfo.regex||e.isEditPublic?e._e():t("div",{staticClass:"bk-form-item bk-relate-conditions",staticStyle:{width:"100%"}},[t("div",{staticClass:"bk-form-content",staticStyle:{"margin-left":"0"}},[t("p",{staticClass:"bk-form-p"},[e._v(e._s(e.$t('m.newCommon["字段间关系"]')))]),e._v(" "),t("bk-radio-group",{on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.regex_config.rule.type,callback:function(t){e.$set(e.formInfo.regex_config.rule,"type",t)},expression:"formInfo.regex_config.rule.type"}},[t("bk-radio",{attrs:{value:"and","ext-cls":"mr20"}},[e._v(e._s(e.$t("m.treeinfo['且']")))]),e._v(" "),t("bk-radio",{attrs:{value:"or"}},[e._v(e._s(e.$t("m.treeinfo['或']")))])],1)],1),e._v(" "),e._l(e.formInfo.regex_config.rule.expressions,(function(n,i){return t("div",{key:i,staticClass:"bk-between-form"},[t("p",{staticClass:"current-field"},[e._v(e._s(e.$t('m.newCommon["当前字段"]')))]),e._v(" "),t("bk-select",{staticStyle:{width:"120px"},attrs:{"ext-cls":"field-valid-select",clearable:!1},on:{change:function(t){return e.$emit("change")}},model:{value:n.condition,callback:function(t){e.$set(n,"condition",t)},expression:"expression.condition"}},e._l(e.betweenList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.typeName,name:e.name}})})),1),e._v(" "),t("bk-select",{staticStyle:{width:"210px"},attrs:{"ext-cls":"field-valid-select",clearable:!1},on:{change:function(t){return e.onRegexFieldChange(t,n)}},model:{value:n.key,callback:function(t){e.$set(n,"key",t)},expression:"expression.key"}},e._l(e.regexFieldList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),t("div",{staticClass:"bk-between-operate"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addExpression()}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===e.formInfo.regex_config.rule.expressions.length},on:{click:function(t){return e.deleteExpression(i)}}})])],1)}))],2),e._v(" "),"CUSTOM"===e.formInfo.regex?[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['正则规则']"),required:!0,property:"key","error-display-type":"normal","ext-cls":"bk-halfline-item bk-halfline-margin bk-mt20-item"}},[t("bk-input",{attrs:{disabled:(e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source)&&"bk_biz_id"!==e.formInfo.key,placeholder:e.$t("m.treeinfo['请输入正则规则']")},on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.customRegex,callback:function(t){e.$set(e.formInfo,"customRegex",t)},expression:"formInfo.customRegex"}})],1)]:e._e()],2),e._v(" "),t("bk-form",{ref:"dataForm",staticClass:"bk-form-vertical",attrs:{"label-width":200,"form-type":e.formAlign,model:e.formInfo}},[e.showType.sourceList.some(t=>t===e.formInfo.type)?[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['数据源']"),required:!0,"ext-cls":"bk-mt20-item"}},[t("data-source",{ref:"dataSource",attrs:{"form-info":e.formInfo,"prc-data":e.prcData,"change-info":e.assignValue,"api-info":e.apiInfo.api_info,"dictionary-data":e.dictionaryData},on:{changeApiInfo:e.changeApiInfo,getRpcData:e.getRpcData}})],1),e._v(" "),"DATADICT"!==e.formInfo.source_type&&"RPC"!==e.formInfo.source_type||"RPC"===e.formInfo.source_type&&e.prcTable.length?[e._l(e.globalChoise.source_type,(function(n,i){return[n.typeName===e.formInfo.source_type?t("bk-form-item",{key:i,attrs:{label:n.name,desc:n.desc,required:!0,"ext-cls":"bk-mt20-item"}},[e.isShowDataSourcebtn?t("bk-button",{staticClass:"configuration-data-source",attrs:{disabled:e.isDisabled,theme:"primary",title:e.$t("m['配置数据源']"),outline:!0},on:{click:e.openDataSource}},[e._v(e._s(e.$t("m['配置数据源']")))]):e._e(),e._v(" "),t("bk-dialog",{attrs:{width:"960",title:"API"===e.formInfo.source_type?e.$t("m['配置接口数据']"):e.$t("m['配置自定义数据']"),theme:"primary","auto-close":!1,"mask-close":!1},on:{confirm:e.validateContent},model:{value:e.isShowDataSource,callback:function(t){e.isShowDataSource=t},expression:"isShowDataSource"}},[t("data-content",{ref:"dataContent",refInFor:!0,attrs:{"form-info":e.formInfo,workflow:e.workflow,state:e.state,"change-info":e.assignValue,"api-detail":e.apiDetail,"api-info":e.apiInfo.api_info,"kv-relation":e.apiInfo.kv_relation,"prc-table":e.prcTable,"field-info":e.fieldInfo}})],1)],1):e._e()]}))]:e._e()]:e._e(),e._v(" "),"CUSTOMTABLE"===e.formInfo.type?[t("bk-form-item",{attrs:{"data-test-id":"field_form_custom",label:e.$t("m.treeinfo['自定义数据']"),required:!0,"ext-cls":"bk-mt20-item"}},[t("div",{on:{click:function(t){e.checkStatus.customTableStatus=!1}}},[t("custom-table-data",{attrs:{"custom-table-info":e.customTableInfo}}),e._v(" "),e.checkStatus.customTableStatus?t("p",{staticClass:"bk-field-error"},[e._v(e._s(e.$t('m.treeinfo["请填写正确格式的自定义数据"]')))]):e._e()],1),e._v(" "),(e.changeInfo.is_builtin||"TABLE"===e.changeInfo.source||e.changeInfo.meta&&"APPROVE_RESULT"===e.changeInfo.meta.code)&&"bk_biz_id"!==e.formInfo.key?t("div",{staticClass:"bk-form-disabled"}):e._e()])]:e._e(),e._v(" "),"FILE"===e.formInfo.type?[t("bk-form-item",{attrs:{"ext-cls":"bk-input-position bk-mt20-item",label:e.$t("m.treeinfo['上传附件模板']")}},[t("bk-button",{attrs:{theme:"default",title:e.$t("m.treeinfo['点击上传']")}},[e._v("\n          "+e._s(e.$t("m.treeinfo['点击上传']"))+"\n        ")]),e._v(" "),t("input",{staticClass:"bk-input-file",attrs:{type:"file"},domProps:{value:e.fileVal},on:{change:e.handleFile}}),e._v(" "),t("ul",{staticClass:"bk-file-list"},e._l(e.fileList,(function(n,i){return t("li",{key:i},[t("span",{staticClass:"bk-file-success"},[t("i",{staticClass:"bk-icon icon-check-1"})]),e._v(" "),t("span",[e._v(e._s(n.name))]),e._v(" "),t("span",{staticClass:"bk-file-delete",on:{click:function(t){return e.deleteFile(n,i)}}},[e._v("×")])])})),0),e._v(" "),!e.changeInfo.is_builtin&&"TABLE"!==e.changeInfo.source||"bk_biz_id"===e.formInfo.key?e._e():t("div",{staticClass:"bk-form-disabled"})],1)]:e._e(),e._v(" "),e.showType.belongDefaultList.some(t=>e.formInfo.type===t)?[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['默认值']"),"ext-cls":"bk-mt20-item"}},[t("default-value",{attrs:{"form-info":e.formInfo,"field-info":e.fieldInfo,"dictionary-data":e.dictionaryData,"change-info":e.changeInfo,"api-info":e.apiInfo,"check-status":e.checkStatus,label:e.$t("m.treeinfo['默认值']")}})],1)]:e._e(),e._v(" "),e.addOrigin.isOther&&"publicField"===e.addOrigin.addOriginInfo.type?e._e():[t("bk-form-item",{attrs:{"ext-cls":"bk-halfline-item bk-halfline-margin bk-mt20-item",label:e.$t("m.treeinfo['布局要求']"),required:!0}},[t("bk-radio-group",{on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.layout,callback:function(t){e.$set(e.formInfo,"layout",t)},expression:"formInfo.layout"}},[e._l(e.globalChoise.layout_type,(function(n,i){return[t("bk-radio",{key:i,attrs:{"ext-cls":"mr20",value:n.typeName,disabled:e.showType.layoutList.some(t=>t===e.formInfo.type)}},[e._v("\n              "+e._s(n.name)+"\n            ")])]}))],2)],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-halfline-item bk-mt20-item",label:e.$t("m.treeinfo['字段必填']"),required:!0}},[t("bk-radio-group",{on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.validate,callback:function(t){e.$set(e.formInfo,"validate",t)},expression:"formInfo.validate"}},[e._l(e.globalChoise.validate_type,(function(n,i){return[t("bk-radio",{key:i,attrs:{"ext-cls":"mr20",value:n.typeName,disabled:"title"===e.changeInfo.key||e.changeInfo.is_builtin||"bk_biz_id"===e.formInfo.key}},[e._v("\n              "+e._s(n.name)+"\n            ")])]}))],2)],1)],e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-tanble-height bk-mt20-item",label:e.$t("m.treeinfo['填写说明']")}},[t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.formInfo.desc,expression:"formInfo.desc",modifiers:{trim:!0}}],staticClass:"bk-form-textarea bk-textarea-tanble bk-halfline-item bk-halfline-margin field-input-tips",attrs:{placeholder:e.$t("m.treeinfo['请输入字段填写说明']")},domProps:{value:e.formInfo.desc},on:{change:function(t){return e.$emit("change")},input:function(t){t.target.composing||e.$set(e.formInfo,"desc",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("p",{staticClass:"field-tips-checkbox",staticStyle:{"margin-left":"335px"}},[t("bk-checkbox",{attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus},on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.is_tips,callback:function(t){e.$set(e.formInfo,"is_tips",t)},expression:"formInfo.is_tips"}},[e._v("\n          "+e._s(e.$t('m.treeinfo["添加额外提示说明"]'))+"\n        ")])],1)]),e._v(" "),e.formInfo.is_tips?[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['字段释疑']"),required:!0,"ext-cls":"bk-mt20-item"}},[t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.formInfo.tips,expression:"formInfo.tips",modifiers:{trim:!0}}],staticClass:"bk-form-textarea bk-textarea-tanble bk-halfline-item bk-halfline-margin",attrs:{placeholder:e.$t("m.treeinfo['请输入，用于鼠标经过提示']")},domProps:{value:e.formInfo.tips},on:{change:function(t){return e.$emit("change")},input:function(t){t.target.composing||e.$set(e.formInfo,"tips",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("p",{staticClass:"bk-label-tips"},[t("span",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:e.formInfo.tips||e.$t("m.treeinfo['字段释疑填填看哦']"),expression:"(formInfo.tips || $t(`m.treeinfo['字段释疑填填看哦']`))",modifiers:{top:!0}}]},[e._v("\n            "+e._s(e.$t('m.treeinfo["效果预览"]'))+"\n          ")])])])]:e._e(),e._v(" "),e.addOrigin.isOther&&"publicField"===e.addOrigin.addOriginInfo.type||!e.changeInfo.meta||"APPROVE_RESULT"===e.changeInfo.meta.code?e._e():[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['是否设置字段隐藏条件']"),"ext-cls":"bk-mt20-item"}},[t("bk-switcher",{attrs:{size:"small",disabled:"title"===e.changeInfo.key},on:{change:function(t){return e.$emit("change")}},model:{value:e.formInfo.show_type,callback:function(t){e.$set(e.formInfo,"show_type",t)},expression:"formInfo.show_type"}})],1),e._v(" "),e.formInfo.show_type?[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['隐藏条件']"),desc:e.$t("m.treeinfo['字段默认为显示。当满足以下配置条件时，该字段将会被隐藏。']"),"ext-cls":"bk-mt20-item"}},[t("hidden-conditions",{ref:"hiddenConditions",attrs:{"template-info":e.templateInfo,"template-stage":e.templateStage,"add-origin":e.addOrigin,workflow:e.workflow,state:e.state,"form-info":e.formInfo}})],1)]:e._e()]],2),e._v(" "),t("div",{staticClass:"operate-btns mt20"},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"field_button_submit",title:e.$t("m.treeinfo['提交']"),loading:e.secondClick},on:{click:e.checkInfo}},[e._v("\n      "+e._s(e.$t("m.treeinfo['提交']"))+"\n    ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"field_button_cancel",title:e.$t("m.treeinfo['取消']"),disabled:e.secondClick},on:{click:e.onCancelClick}},[e._v("\n      "+e._s(e.$t("m.treeinfo['取消']"))+"\n    ")])],1)],1)},a=[];i._withStripped=!0},On6X:function(e,t,n){"use strict";n("TQfa")},Ox22:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"templateNode",props:{node:{type:Object,default:function(){return{}}}},data:function(){return{typeList:[{type:"NORMAL",iconStyle:"icon-icon-person"},{type:"ROUTER",iconStyle:"icon-icon-person"},{type:"TASK",iconStyle:"icon-api-icon"},{type:"TASK-SOPS",iconStyle:"icon-task-node"},{type:"SIGN",iconStyle:"icon-sign-node-white"},{type:"APPROVAL",iconStyle:"icon-approval-node"}]}},methods:{}}},OzIr:function(e,t,n){},"P+p4":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("P2sY"),r=(i=a)&&i.__esModule?i:{default:i},o=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}(n("wsa1"));var s={language:"javascript",theme:"vs-dark",automaticLayout:!0,minimap:{enabled:!1},wordWrap:"on",wrappingIndent:"same"};t.default={name:"CodeEditor",props:{value:{type:String,default:""},options:{type:Object,default:function(){return{}}}},data:function(){return{editorOptions:(0,r.default)({},s,this.options,{value:this.value}),monacoInstance:null}},watch:{value:function(e){e!==this.monacoInstance.getValue()&&this.monacoInstance.setValue(e)},options:{deep:!0,handler:function(e){this.editorOptions=(0,r.default)({},s,e,{value:this.value}),this.updateOptions()}}},mounted:function(){this.initIntance()},beforeDestroy:function(){this.monacoInstance&&this.monacoInstance.dispose()},methods:{initIntance:function(){var e=this;this.monacoInstance=o.editor.create(this.$el,this.editorOptions);var t=this.monacoInstance.getModel();if(t.setEOL(0),this.value.indexOf("\r\n")>-1){var n=document.createElement("textarea");n.value=this.value,this.$emit("input",n.value)}t.onDidChangeContent((function(){var t=e.monacoInstance.getValue();e.$emit("input",t)})),this.monacoInstance.addCommand(o.KeyMod.CtrlCmd|o.KeyCode.KEY_S,(function(){var t=e.monacoInstance.getValue();e.$emit("saveContent",t)}))},updateOptions:function(){this.monacoInstance.updateOptions(this.editorOptions)}}}},P0kt:function(e,t,n){"use strict";n.r(t);var i=n("/5i8"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},P2aA:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"devops-preview",class:{"full-screen":e.isFullScreen}},[t("header",{staticClass:"devops-header"},[e.isFullScreen?t("span",{staticClass:"exit-full-screen",on:{click:function(t){return t.stopPropagation(),e.onCloseFullScreen.apply(null,arguments)}}},[t("i",{staticClass:"bk-itsm-icon icon-order-close"}),e._v(" "),t("span",{staticClass:"exit-text"},[e._v(e._s(e.$t("m.common['退出全屏']")))])]):t("i",{staticClass:"bk-itsm-icon icon-order-open",on:{click:function(t){return t.stopPropagation(),e.openFullScreen()}}})]),e._v(" "),t("section",{staticClass:"devops-preview-wrap"},[t("div",{staticClass:"devops-preview-body"},e._l(e.stages,(function(n,i){return t("div",{key:n.id,staticClass:"stage"},[t("span",{staticClass:"stage-connect-line"}),e._v(" "),t("h4",{staticClass:"stage-name"},[e._v(e._s(n.name))]),e._v(" "),e._l(n.containers,(function(a,r){return t("ul",{key:a.id,staticClass:"containers"},[0!==i?t("svg",{staticClass:"container-connect-line left",style:e.getSvgStyle(n,r),attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"60",height:0===r?70:56*(n.containers[r-1].elements.length+1)}},[t("path",{attrs:{d:e.getPath(n,r)}})]):e._e(),e._v(" "),t("svg",{staticClass:"container-connect-line",style:e.getSvgStyle(n,r),attrs:{xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",width:"60",height:0===r?70:56*(n.containers[r-1].elements.length+1)}},[t("path",{attrs:{d:e.getPath(n,r)}})]),e._v(" "),t("li",{staticClass:"element container-title"},[e._v("\n            "+e._s(a.name)+"\n            "),0!==i?t("span",{staticClass:"semicircle"}):e._e(),e._v(" "),0!==i?t("span",{staticClass:"triangle"}):e._e()]),e._v(" "),e._l(a.elements,(function(n){return t("li",{key:n.id,class:["element",{"not-execute":!e.isElementCanExecute(n)}]},[e._v("\n            "+e._s(n.name)+"\n          ")])}))],2)}))],2)})),0),e._v(" "),e.loading?t("div",{staticClass:"loading"},[t("i",{staticClass:"bk-itsm-icon icon-icon-loading"}),e._v(" "),t("span",[e._v(e._s(e.$t("m.tickets['预览正在加载中']")))])]):e._e()])])},a=[];i._withStripped=!0},PAo4:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("QbLZ")),a=o(n("tQ05")),r=n("L2JU");function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"modifyFields",components:{fieldInfo:a.default},props:{fieldSchema:{type:Array,default:function(){return[]}}},data:function(){return{fieldKeyItem:"",fieldValueItem:"",fieldValue:"",show:!0,sourceTypeList:[{id:1,key:"custom",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"reference",name:this.$t('m.treeinfo["引用变量"]')}],variableList:[]}},computed:(0,i.default)({globalChoise:function(){return this.$store.state.common.configurInfo}},(0,r.mapState)("trigger",{triggerVariables:function(e){return e.triggerVariables}})),watch:{triggerVariables:function(e){this.variableList=e}},mounted:function(){this.variableList=this.triggerVariables,this.initData()},methods:{initData:function(){var e=this;if(this.fieldSchema.forEach((function(t){e.$set(t,"referenceType",t.ref_type||"custom")})),this.fieldKeyItem=this.fieldSchema[0],this.fieldValueItem=this.fieldSchema[1],this.$set(this.fieldValueItem,"itemInfo",[]),this.fieldKeyItem.value){var t=this.fieldKeyItem.choice.filter((function(t){return t.key===e.fieldKeyItem.value}));t[0].val=this.fieldValueItem.value,t[0].value=t[0].val,this.fieldValueItem.itemInfo=t,this.show=!0}},selectedFieldKey:function(e){var t=this;this.fieldValueItem.itemInfo.splice(0,this.fieldValueItem.itemInfo.length),this.show=!1,this.$nextTick((function(){var n=t.fieldKeyItem.choice.find((function(t){return t.key===e}));n.showFeild=!0,t.fieldValueItem.itemInfo.push(n),t.show=!0}))},selectedReference:function(){this.fieldValueItem.itemInfo[0].value=""}}}},PGA1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n("GQeE")),a=f(n("P2sY")),r=f(n("14Xm")),o=f(n("D3Ub")),s=f(n("I1Ty")),c=n("CeR/"),l=n("ygAv"),u=f(n("efIh")),d=f(n("PaSM"));function f(e){return e&&e.__esModule?e:{default:e}}t.default={name:"SOPS_TEMPLATE",components:{NoData:s.default},mixins:[u.default,d.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},basicInfomation:{type:Object,default:function(){return{}}},typeInfo:{type:String,default:function(){return""}},disabled:{type:Boolean,default:!1}},data:function(){return{disabledRenderForm:!1,editTask:!0,constantDefaultValue:{},templateList:[],planList:[],sopsTaskList:[],optionalNodeIdList:[],hookedVarList:{},quoteVars:[],quoteVarsLoading:!1,quoteErrors:[],configLoading:!1,formLoading:!1,loading:{templateList:!1,sopsTaskList:!1,plan:!1},lastEditTaskName:"",rules:{},previewSopsTaskUrl:""}},computed:{bkBizId:function(){return this.basicInfomation&&-1!==this.basicInfomation.bk_biz_id?this.basicInfomation.bk_biz_id:""},showRenderForm:function(){return this.item.sopsContent.constants.filter((function(e){return"show"===e.show_type})).length>0},formOptions:function(){return{showRequired:!0,showGroup:!0,showLabel:!0,showHook:!0,showDesc:!0,formEdit:!this.disabled&&!this.disabledRenderForm}}},created:function(){this.item.sopsContent||this.$set(this.item,"sopsContent",{id:"",sopsTask:{id:"",template_id:""},planId:"",createWay:"template",exclude_task_nodes_id:[],formData:{},context:{project:{id:"",bk_biz_id:"",name:"",from_cmdb:!0},bk_biz_id:"",site_url:window.SITE_URL_SOPS+window.PREFIX_SOPS},constants:[]}),this.rules.id=this.checkCommonRules("select").select,this.rules.sopsTaskId=this.checkCommonRules("select").select},mounted:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.item.value&&(e.item.sopsContent.id=e.item.value.id,(n=e.templateList.find((function(t){return t.id===e.item.sopsContent.id})))&&void 0!==n.bk_biz_id&&(e.item.sopsContent.context.project.bk_biz_id=n.bk_biz_id,e.item.sopsContent.context.project.id=e.item.sopsContent.id,e.item.sopsContent.context.project.name=e.item.name),e.item.sopsContent.constants=e.item.value.constants,e.item.value.constants.forEach((function(t){t.value&&(e.item.sopsContent.formData[t.key]=(0,l.deepClone)(t.value)),t.is_quoted&&(e.hookedVarList[t.key]=!0)}))),e.editTask=!!e.item.value,e.editTask&&e.item.value.id&&e.getTemplateDetail(e.item.value.bk_biz_id,e.item.value.id),e.basicInfomation.id&&e.getTicketOutput(),e.getTemplateList();case 5:case"end":return t.stop()}}),t,e)})))()},methods:{getTicketOutput:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e.quoteVarsLoading=!0,t.next=4,e.$store.dispatch("ticket/getTicketOutput",e.basicInfomation.id);case 4:n=t.sent,e.quoteVars=n.data,t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),console.error(t.t0);case 11:return t.prev=11,e.quoteVarsLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,e,[[0,8,11,14]])})))()},onSelectTpl:function(e){var t=this;this.item.sopsContent.id=e;var n=this.templateList.find((function(e){return e.id===t.item.sopsContent.id}));n&&void 0!==n.bk_biz_id&&(this.item.sopsContent.context.project.bk_biz_id=n.bk_biz_id,this.item.sopsContent.context.project.id=n.project_id,this.item.sopsContent.context.project.name=n.project_name),this.hookedVarList={},this.quoteErrors=[],this.getTempaltePlanList(),this.getTemplateDetail(n.bk_biz_id,this.item.sopsContent.id)},onSopsTaskChange:function(e){if(!e)return!1;this.hookedVarList={},this.quoteErrors=[],this.setTaskNameAndDisable(e),this.getSopsTaskDetail(e)},setTaskNameAndDisable:function(e){var t=this.fields.find((function(e){return"task_name"===e.key})),n=this.sopsTaskList.find((function(t){return t.id===e}));t&&(this.lastEditTaskName=t.val||t.value,t.val=n.name,t.value=n.name,t.is_readonly=!0),this.disabledRenderForm="started_task"===this.item.sopsContent.createWay},clearTaskNameAndDisable:function(){if(this.item.sopsContent.sopsTask.id){var e=this.fields.find((function(e){return"task_name"===e.key}));e&&(e.val=this.lastEditTaskName,e.value=this.lastEditTaskName,e.is_readonly=!1)}},getSopsTaskDetail:function(e){var t=this;return(0,o.default)(r.default.mark((function n(){var i;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.configLoading=!0,i={bk_biz_id:t.bkBizId,task_id:e},n.next=4,t.$store.dispatch("taskFlow/getSopsTaskDetail",i).then((function(e){t.previewSopsTaskUrl=e.data.task_url;var n=[];for(var i in e.data.constants)"show"===e.data.constants[i].show_type&&n.push(e.data.constants[i]);n.sort((function(e,t){return e-t})),t.item.sopsContent.constants=n,t.item.sopsContent.sopsTask.template_id=e.data.template_id})).catch((function(e){(0,c.errorHandler)(e,t)})).finally((function(){t.configLoading=!1}));case 4:case"end":return n.stop()}}),n,t)})))()},getTemplateDetail:function(e,t){var n=this;this.formLoading=!0;var i={template_id:t,bk_biz_id:e||""};this.$store.dispatch("getTemplateDetail",i).then((function(e){var t=[];e.data.constants.forEach((function(e){var i=n.item.sopsContent.constants.find((function(t){return t.key===e.key}));n.editTask&&!i||(i&&(e=(0,a.default)(i,e)),e.is_meta&&(e.meta=(0,l.deepClone)(e)),n.item.value&&(e.value=(0,l.deepClone)(n.item.sopsContent.formData[e.key])),n.constantDefaultValue[e.key]=(0,l.deepClone)(e.value),"show"===e.show_type&&t.push(e))})),n.item.sopsContent.constants=t,n.optionalNodeIdList=e.data.optional_ids})).catch((function(e){(0,c.errorHandler)(e,n)})).finally((function(){n.formLoading=!1}))},getTemplateList:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading.templateList=!0,n={bk_biz_id:e.bkBizId,with_common:!0},t.next=4,e.$store.dispatch("getTemplateList",n).then((function(t){e.templateList=t.data})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.loading.templateList=!1}));case 4:case"end":return t.stop()}}),t,e)})))()},getSopsTaskList:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.loading.sopsTaskList=!0,n={bk_biz_id:e.bkBizId,is_started:"started_task"===e.item.sopsContent.createWay},t.next=4,e.$store.dispatch("taskFlow/getSopsTask",n).then((function(t){e.sopsTaskList=t.data})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.loading.sopsTaskList=!1}));case 4:case"end":return t.stop()}}),t,e)})))()},getTempaltePlanList:function(){var e=this;return(0,o.default)(r.default.mark((function t(){var n,i,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.item.sopsContent.id,i=e.templateList.find((function(e){return e.id===n})),e.planList=[],e.loading.plan=!0,a={bk_biz_id:i.bk_biz_id,template_id:i.id},t.next=7,e.$store.dispatch("getTemplatePlanList",a).then((function(t){e.planList=t.data})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.loading.plan=!1}));case 7:case"end":return t.stop()}}),t,e)})))()},onplanSelect:function(e){var t=this;return(0,o.default)(r.default.mark((function n(){var i,a,o,s,c;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=[],e.length>0?(e.forEach((function(e){var n=t.planList.find((function(t){return t.id===e}));if(n.data)for(var a=JSON.parse(n.data),r=0;r<a.length;r++)-1===i.indexOf(a[r])&&i.push(a[r])})),t.item.sopsContent.exclude_task_nodes_id=t.optionalNodeIdList.filter((function(e){return!i.includes(e)}))):t.item.sopsContent.exclude_task_nodes_id=[],a=t.templateList.find((function(e){return e.id===t.item.sopsContent.id})),n.prev=3,t.formLoading=!0,n.next=7,t.$store.dispatch("taskFlow/getSopsPreview",{bk_biz_id:a.bk_biz_id,template_id:a.id,exclude_task_nodes_id:t.item.sopsContent.exclude_task_nodes_id});case 7:for(c in o=n.sent,s=[],o.data.pipeline_tree.constants)"show"===o.data.pipeline_tree.constants[c].show_type&&s.push(o.data.pipeline_tree.constants[c]);s.sort((function(e,t){return e.index-t.index})),t.item.sopsContent.constants=s,n.next=17;break;case 14:n.prev=14,n.t0=n.catch(3),console.error(n.t0);case 17:return n.prev=17,t.formLoading=!1,n.finish(17);case 20:case"end":return n.stop()}}),n,t,[[3,14,17,20]])})))()},jumpToSops:function(){window.open(this.previewSopsTaskUrl)},handleCreateWayChange:function(e){this.clearTaskNameAndDisable(),this.item.sopsContent.id="",this.item.sopsContent.planId="",this.item.sopsContent.constants=[],this.item.sopsContent.sopsTask.id="","task"===e||"started_task"===e?this.getSopsTaskList():this.getTemplateList()},onReloadPlanBtnClick:function(){this.item.sopsContent.id&&this.getTempaltePlanList()},validate:function(){var e=this;this.$refs.taskForm.validate();var t=!0;this.disabled||this.disabledRenderForm?t=!0:this.$refs.renderForm&&(t=this.$refs.renderForm.validate());var n="template"===this.item.sopsContent.createWay?!!this.item.sopsContent.id:!!this.item.sopsContent.sopsTask.id,a=(0,i.default)(this.hookedVarList).every((function(t){return!e.hookedVarList[t]||""!==e.item.sopsContent.formData[t]||(e.quoteErrors.push(t),!1)}));return t&&n&&a},jumpToSopsSelectSchemePage:function(){var e=this.item.sopsContent.id,t="taskflow/newtask/"+this.templateList.find((function(t){return t.id===e})).project_id+"/selectnode/?template_id="+e+"&entrance=templateEdit";window.open(window.SOPS_URL+t,"__blank")},onHookChange:function(e,t){this.$set(this.hookedVarList,t.tag_code,e);var n=this.item.sopsContent.constants.find((function(e){return e.key===t.tag_code}));if(n.is_quoted=e,e)this.item.sopsContent.formData[t.tag_code]="";else{this.item.sopsContent.formData[t.tag_code]=n?(0,l.deepClone)(this.constantDefaultValue[t.tag_code]):"";var i=this.quoteErrors.findIndex((function(e){return e===t.tag_code}));i>-1&&this.quoteErrors.splice(i,1)}},onSelectVar:function(e,t){this.item.sopsContent.formData[t.tag_code]="${"+e+"}";var n=this.quoteErrors.findIndex((function(e){return e===t.tag_code}));n>-1&&this.quoteErrors.splice(n,1)}}}},PIEm:function(e,t,n){"use strict";n.r(t);var i=n("6Mdl"),a=n("BKtx");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("jIqJ");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"5c3adbce",null);t.default=s.exports},PLXv:function(e,t,n){},PRQd:function(e,t,n){"use strict";n.r(t);var i=n("65Fp"),a=n("f1Q0");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("xXNg");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"24384eed",null);t.default=s.exports},PSjz:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-response-content"},[t("div",{on:{click:function(t){e.item.contentStatus=!1}}},[t("bk-form",{ref:"conductorForm",attrs:{"form-type":"horizontal","label-width":200}},["api"===e.item.wayInfo.key?[t("api-call",{attrs:{item:e.item}})]:"modify_field"===e.item.wayInfo.key||"modify_first_state_field"===e.item.wayInfo.key?[t("modify-field",{attrs:{"field-schema":e.item.wayInfo.field_schema}})]:[e._l(e.item.wayInfo.field_schema,(function(e,n){return["SUBCOMPONENT"===e.type?[t("send-message",{key:n,attrs:{"item-info":e}})]:[t("bk-form-item",{key:n,attrs:{"ext-cls":e.required?"bk-field-schema mb20":"bk-field-schema no-require-item mb20",label:e.name,required:e.required,desc:e.tips}},[t("change-conductor",{attrs:{"item-info":e}})],1)]]}))],e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.trigger['执行方式']"),required:!0,"ext-cls":"bk-field-schema mb20"}},[t("bk-radio-group",{model:{value:e.item.performData.runMode,callback:function(t){e.$set(e.item.performData,"runMode",t)},expression:"item.performData.runMode"}},[t("bk-radio",{attrs:{value:"BACKEND","ext-cls":"mr50 pr10"}},[e._v(e._s(e.$t("m.trigger['后台自动执行']")))]),e._v(" "),e.isShowFrontendTrigger?t("bk-radio",{attrs:{value:"MANUAL"}},[e._v(e._s(e.$t("m.trigger['按钮触发']")))]):e._e()],1)],1),e._v(" "),"MANUAL"===e.item.performData.runMode?[t("bk-form-item",{attrs:{required:!0,label:e.$t("m.trigger['按钮名称']"),"ext-cls":"bk-field-schema mb20"}},[t("bk-input",{staticStyle:{width:"260px"},attrs:{clearable:!0},model:{value:e.item.performData.displayName,callback:function(t){e.$set(e.item.performData,"displayName",t)},expression:"item.performData.displayName"}})],1)]:e._e(),e._v(" "),t("bk-form-item",{attrs:{required:!0,label:e.$t("m.trigger['触发次数']"),"ext-cls":"bk-field-schema"}},[t("bk-radio-group",{model:{value:e.item.performData.repeat,callback:function(t){e.$set(e.item.performData,"repeat",t)},expression:"item.performData.repeat"}},[t("bk-radio",{attrs:{value:"one",disabled:e.disableRepeat,"ext-cls":"mr50 pr10"}},[e._v(e._s(e.$t("m.trigger['一次']")))]),e._v(" "),t("bk-radio",{attrs:{value:"more"}},[e._v(e._s(e.$t("m.trigger['不限']")))])],1)],1)],2),e._v(" "),e.item.contentStatus?t("p",{staticClass:"bk-error-info"},[e._v(e._s(e.$t("m.trigger['您还有内容未填写，请确认。']")))]):e._e()],1)])},a=[];i._withStripped=!0},PcV5:function(e,t,n){"use strict";n("GX6N")},Pdjk:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"half-row-form"},[t("div",{staticClass:"row-form-view"},[e._l(e.localForms,(function(n,i){return[t("draggable",{key:i,staticClass:"form-drag-wrap",attrs:{handle:".view-form","data-rowindex":e.rowIndex,value:n,group:{name:"view-form",put:e.halfRowFormPut}},on:{add:function(t){return e.$emit("onHalfRowDragToHalfRow",t)}}},e._l(n,(function(n){return t("div",{key:n.id,staticClass:"half-form-item",attrs:{"data-id":n.id}},[t("form-view-item",{attrs:{fields:e.fields,form:n,"add-field-status":e.addFieldStatus,"crt-form":e.crtForm},on:{onFormEditClick:function(t){return e.$emit("onFormEditClick",t)},onFormCloneClick:function(t){return e.$emit("onFormCloneClick",t)},onFormDeleteClick:function(t){return e.$emit("onFormDeleteClick",t)}}},[t("div",{staticClass:"view-form",attrs:{slot:"draggable"},slot:"draggable"},[t("i",{staticClass:"bk-itsm-icon icon-move-new"})])])],1)})),0)]}))],2)])},a=[];i._withStripped=!0},Q3ZP:function(e,t,n){"use strict";n.r(t);var i=n("g2DR"),a=n("ymPp");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},QtrE:function(e,t,n){"use strict";n("X13e")},R5iJ:function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojNzM3OTg3O30KPC9zdHlsZT4KPGc+Cgk8cmVjdCB4PSI1MTIiIHk9IjIyNCIgY2xhc3M9InN0MCIgd2lkdGg9Ijk2IiBoZWlnaHQ9IjY0Ii8+Cgk8cmVjdCB4PSI0MTYiIHk9IjI4OCIgY2xhc3M9InN0MCIgd2lkdGg9Ijk2IiBoZWlnaHQ9IjY0Ii8+Cgk8cmVjdCB4PSI1MTIiIHk9IjM1MiIgY2xhc3M9InN0MCIgd2lkdGg9Ijk2IiBoZWlnaHQ9IjY0Ii8+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNNDE2LDY0MGgxOTJWNDgwaC05NnYtNjRoLTk2VjY0MHogTTQ2NCw1MjhoOTZ2NjRoLTk2VjUyOHoiLz4KCTxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik05Niw5NnY4MzJoODMyVjk2SDk2eiBNODY0LDg2NEgxNjBWMTYwaDI1NnY2NGg5NnYtNjRoMzUyVjg2NHoiLz4KPC9nPgo8L3N2Zz4K"},RPM2:function(e,t,n){"use strict";n.r(t);var i=n("MxYs"),a=n("MImu");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("QtrE");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"645f2dbc",null);t.default=s.exports},RnPO:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("2eEL"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"exportTree",components:{collapseTransition:r.default},props:{treeDataList:{type:Array,default:[]},treeIndex:{type:Number,default:0}},data:function(){return{pLeft:"padding-left:"+15*(this.treeIndex+1)+"px; padding-right: 10px;"}},methods:{toggleChildren:function(e){this.$emit("toggleChildren",e)},toggle:function(e){this.$emit("toggle",e)},selectItem:function(e){this.$emit("selectItem",e)}}}},SAMo:function(e,t,n){"use strict";n.r(t);var i=n("eDZ/"),a=n("AFtY");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("vvUq");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"4ee5254b",null);t.default=s.exports},SJYp:function(e,t,n){},SLTv:function(e,t,n){"use strict";n("1TTJ")},SO4U:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"CUSTOMTABLE",props:{item:{type:Object,required:!0,default:function(){}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{multiSelect:!0}},watch:{"item.val":function(){if(""===this.item.val){this.item.val=[];for(var e={},t=0;t<this.item.meta.columns.length;t++){e[this.item.meta.columns[t].key]=""}this.item.val.push(e)}"function"==typeof this.$parent.refresh&&this.$parent.refresh()}},created:function(){var e=this;if(""===this.item.val||Array.isArray(this.item.val)&&!this.item.val.length){this.item.val=[];for(var t={},n=0;n<this.item.meta.columns.length;n++){t[this.item.meta.columns[n].key]=""}this.item.val.push(t)}this.item.val.forEach((function(t){e.item.meta.columns.forEach((function(e){if(("multiselect"===e.display||"select"===e.display)&&!("string"==typeof t[e.key]?[t[e.key]]:t[e.key]).every((function(t){return e.choice.find((function(e){return e.key===t}))}))){var n=e.choice.find((function(n){return n.name===t[e.key]}));t[e.key]=n?n.key:""}}))}))},methods:{addOne:function(){for(var e={},t=0;t<this.item.meta.columns.length;t++){e[this.item.meta.columns[t].key]=""}this.item.val.push(e)},deleteOne:function(e){var t=this;1===this.item.val.length?this.$bkMessage({message:"默认行不能删除",theme:"warning"}):this.$bkInfo({title:"确认要删除此条数据？",confirmFn:function(){t.item.val.splice(e.$index,1)}})}}}},SPZl:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-second-flow"},[t("js-flow",{ref:"jsFlow",attrs:{"data-test-id":"service_jsflow_serviceProcess",selector:"entry-item","endpoint-options":e.endpointOptions,"connector-options":e.connectorOptions,"node-options":e.nodeOptions,tools:e.toolsInfo},on:{onConnectionClick:e.onConnectionClick,onToolClick:e.onToolClick,onConnection:e.onConnection,onConnectionDragStop:e.onConnectionDragStop,onBeforeDrop:e.onBeforeDrop,onCreateNodeBefore:e.onCreateNodeBefore,onNodeMoveStop:e.onNodeMoveStop,onNodeMoving:e.onNodeMoving,onOverlayClick:e.onOverlayClick},scopedSlots:e._u([{key:"nodeTemplate",fn:function({node:n}){return[t("node-template",{ref:"templateNode",attrs:{node:n,"canvas-data":e.canvasData},on:{openDelete:e.openDelete,closeShow:e.closeShow,fastAddNode:e.fastAddNode,updateNode:e.updateNode,updateLine:e.updateLine,configuNode:e.configuNode}})]}}]),model:{value:e.canvasData,callback:function(t){e.canvasData=t},expression:"canvasData"}},[t("template",{slot:"palettePanel"},[t("Palette")],1)],2),e._v(" "),t("div",{staticClass:"bk-configu-line"},[t("bk-sideslider",{attrs:{"is-show":e.customLine.isShow,title:e.customLine.title,width:e.customLine.width},on:{"update:isShow":function(t){return e.$set(e.customLine,"isShow",t)},"update:is-show":function(t){return e.$set(e.customLine,"isShow",t)}}},[e.customLine.isShow?t("div",{attrs:{slot:"content"},slot:"content"},[t("lineConfigue",{attrs:{"custom-line":e.customLine,"flow-info":e.flowInfo},on:{submitLine:e.submitLine,closeLine:e.closeLine,deleteLine:e.deleteLine}})],1):e._e()])],1)],1)},a=[];i._withStripped=!0},SUIt:function(e,t,n){"use strict";n.r(t);var i=n("MHZE"),a=n("gr+U");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("DtGf");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"3c746b04",null);t.default=s.exports},SioU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("14Xm")),a=h(n("gDS+")),r=h(n("m1cH")),o=h(n("D3Ub")),s=h(n("2Vgw")),c=h(n("NGZu")),l=h(n("c6Q5")),u=h(n("hA3y")),d=h(n("FGMr")),f=h(n("VflG")),p=n("CeR/"),m=n("ygAv");function h(e){return e&&e.__esModule?e:{default:e}}t.default={name:"dataContent",components:{getParam:c.default,postParam:l.default,responseData:u.default,getRpcParam:d.default},mixins:[f.default],props:{formInfo:{type:Object,default:function(){return{}}},changeInfo:{type:Object,default:function(){return{}}},apiDetail:{type:Object,default:function(){return{}}},workflow:{type:[String,Number],default:function(){return""}},state:{type:[String,Number],default:function(){return""}},apiInfo:{type:Object,default:function(){return{remote_system_id:"",remote_api_id:"",req_params:{},req_body:{},rsp_data:""}}},fieldInfo:{type:Object,default:function(){return{}}},kvRelation:{type:Object,default:function(){return{}}},prcTable:{type:Array,default:function(){return[]}}},data:function(){return{stateList:[],trueStatus:!0,falseStatus:!1,initDataContent:{}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},mounted:function(){this.getRelatedFields(),this.initDataContent=(0,m.deepClone)(this.apiDetail)},methods:{addDataLine:function(e,t){if(!this.changeInfo.meta||"APPROVE_RESULT"!==this.changeInfo.meta.code){this.fieldInfo.list.splice(t+1,0,{name:"",key:"",required:!1,nameCheck:!1,keyCheck:!1})}},deleteDataLine:function(e,t){1===this.fieldInfo.list.length||this.changeInfo.meta&&"APPROVE_RESULT"===this.changeInfo.meta.code||this.fieldInfo.list.splice(t,1)},closeError:function(){this.fieldInfo.list.forEach((function(e){e.nameCheck=!1,e.keyCheck=!1}))},getRelatedFields:function(){var e=this;if(this.state){var t={workflow:this.workflow,state:this.state,field:""};this.$store.dispatch("apiRemote/get_related_fields",t).then((function(t){e.stateList=t.data})).catch((function(t){(0,p.errorHandler)(t,e)})).finally((function(){}))}},countArrayAncestors:function(e){var t=[];return function e(n){"array"===n.parentInfo.type&&(t.push(n),e(n.parentInfo)),"object"===n.parentInfo.type&&e(n.parentInfo)}(e),t},listTojson:function(e){var t={};return e.length&&e.forEach((function(e){t[e.name]="CUSTOM"===e.source_type?e.value:"${params_"+e.value_key+"}"})),t},apiFz:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var n,o,s,c,l,u,d,f,p,m,h,v,g;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.$refs.getParam){t.next=4;break}t.t0={},t.next=7;break;case 4:return t.next=6,e.listTojson(e.$refs.getParam.paramTableData);case 6:t.t0=t.sent;case 7:if(e.apiInfo.req_params=t.t0,e.$refs.postParam){t.next=12;break}t.t1={},t.next=15;break;case 12:return t.next=14,e.treeToJson(e.$refs.postParam.bodyTableData.filter((function(e){return!e.level})));case 14:t.t1=t.sent;case 15:if(e.apiInfo.req_body=t.t1,n=!1,!e.$refs.getParam){t.next=25;break}if((o=e.$refs.getParam.paramTableData.filter((function(e){return e.is_necessary}))).forEach((function(e){e.isCheck=!0,e.isSatisfied="CUSTOM"===e.source_type?!!e.value:!!e.value_key})),!(s=o.filter((function(e){return!e.isSatisfied}))[0])){t.next=25;break}return e.$bkMessage({message:e.$t('m.treeinfo["请输入GET参数！"]'),theme:"error"}),n||(s.el.scrollIntoView(!0),n=!0),t.abrupt("return",!1);case 25:if(!e.$refs.postParam){t.next=34;break}if((c=e.$refs.postParam.bodyTableData.filter((function(e){return e.is_necessary&&"object"!==e.type&&"array"!==e.type}))).forEach((function(e){e.isCheck=!0,e.isSatisfied="CUSTOM"===e.source_type?e.value.toString():!!e.value_key})),!(l=c.filter((function(e){return!e.isSatisfied}))[0])){t.next=34;break}return e.$refs.postParam.bodyTableData.forEach((function(e){e.showChildren=!0,e.isShow=!0})),e.$bkMessage({message:e.$t('m.treeinfo["请输入POST参数！"]'),theme:"error"}),n||(l.el.scrollIntoView(!0),n=!0),t.abrupt("return",!1);case 34:if(e.$refs.responseData){t.next=37;break}return e.$bkMessage({message:e.$t('m.treeinfo["数据为空，请联系管理员"]'),theme:"error"}),t.abrupt("return",!1);case 37:if(u=e.$refs.responseData.responseTableData.filter((function(e){return e.isSelectedKey}))[0],d=e.$refs.responseData.responseTableData.filter((function(e){return e.isSelectedValue}))[0],u&&d){t.next=43;break}return e.$bkMessage({message:e.$t('m.treeinfo["请选择返回数据"]'),theme:"error"}),e.$refs.responseData.isCheck=!0,t.abrupt("return",!1);case 43:return f=[].concat((0,r.default)(JSON.parse((0,a.default)(u.ancestorsList))),[u.primaryKey]),p=[].concat((0,r.default)(JSON.parse((0,a.default)(d.ancestorsList))),[d.primaryKey]),t.next=47,e.countArrayAncestors(u);case 47:return m=t.sent,t.next=50,e.countArrayAncestors(d);case 50:if(h=t.sent,v=f.indexOf(m[0].primaryKey),g=p.indexOf(h[0].primaryKey),1===m.length&&1===h.length){t.next=55;break}return t.abrupt("return",!1);case 55:return e.apiInfo.rsp_data=f.slice(0,v).map((function(e){return e=e.replace(/^\d+\_/,"")})).join("."),e.kvRelation.key=f.slice(v+1).map((function(e){return e=e.replace(/^\d+\_/,"")})).join("."),e.kvRelation.name=p.slice(g+1).map((function(e){return e=e.replace(/^\d+\_/,"")})).join("."),t.abrupt("return",!0);case 59:case"end":return t.stop()}}),t,e)})))()},putChar:function(e,t){var n=this;e.key||(this.fieldInfo.list[t].key="",(0,s.default)(this.fieldInfo.list[t].name,{style:s.default.STYLE_NORMAL,heteronym:!1}).forEach((function(e){n.fieldInfo.list[t].key=""+n.fieldInfo.list[t].key+e})),this.fieldInfo.list[t].key=this.fieldInfo.list[t].key.toUpperCase(),this.fieldInfo.list[t].key=this.fieldInfo.list[t].key.replace(/\ /g,"_"),this.fieldInfo.list[t].key.length>=32&&(this.fieldInfo.list[t].key=this.fieldInfo.list[t].key.substr(0,32)))}}}},SqHb:function(e,t,n){},Szq4:function(e,t,n){"use strict";n.r(t);var i=n("serL"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},T2YI:function(e,t,n){"use strict";n.r(t);var i=n("o1/R"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},T3vI:function(e,t,n){"use strict";n.r(t);var i=n("VwbA"),a=n("VhbG");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("IcrL");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"2993b5be",null);t.default=s.exports},TDZ0:function(e,t,n){"use strict";n("zi6X")},TNjk:function(e,t,n){"use strict";n.r(t);var i=n("dm0o"),a=n("Gz9R");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},TOmV:function(e,t,n){"use strict";n.r(t);var i=n("Vj9y"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},TQfa:function(e,t,n){},TQwK:function(e,t,n){"use strict";n.r(t);var i=n("PSjz"),a=n("P0kt");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("Udb1");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"37bd3d27",null);t.default=s.exports},TdI4:function(e,t,n){"use strict";n("ZSwf")},TlPd:function(e,t,n){},Tz34:function(e,t,n){"use strict";n.r(t);var i=n("bBb/"),a=n("MG1K");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("8EG9");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"fdb3893a",null);t.default=s.exports},UA1S:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("ul",{staticClass:"child-node"},e._l(e.treeDataList,(function(n,i){return t("li",{key:i,staticClass:"vue-tree-item"},[t("div",{class:["tree-node",{down:n.showChildren,"set-frist-pLeft":e.treeIndex+1===1,active:n.checkInfo}],style:e.pLeft,on:{click:function(t){return e.toggle(n)}}},[n.showChildren?t("i",{staticClass:"bk-icon icon-down-shape",class:{"bk-padding":!n.has_children},on:{click:function(t){return t.stopPropagation(),e.toggleChildren(n)}}}):t("i",{staticClass:"bk-icon icon-right-shape",class:{"bk-padding":!n.has_children},on:{click:function(t){return t.stopPropagation(),e.toggleChildren(n)}}}),e._v(" "),t("i",{staticClass:"bk-icon icon-folder-open-shape"}),e._v(" "),t("span",{staticClass:"name-text",attrs:{title:n.name}},[e._v(e._s(n.name))]),e._v(" "),n.checkInfo?t("i",{staticClass:"bk-icon icon-check-1",staticStyle:{float:"right","margin-top":"11px"}}):e._e()]),e._v(" "),t("collapse-transition",[n.showChildren&&n.children?[t("Tree",{attrs:{"tree-data-list":n.children,"tree-index":e.treeIndex+1},on:{toggle:e.toggle,toggleChildren:e.toggleChildren}})]:e._e()],2)],1)})),0)},a=[];i._withStripped=!0},UCAk:function(e,t,n){"use strict";n("MTdN")},UFO8:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"descInfo",props:{value:{type:String,default:function(){return""}}},data:function(){return{isEdit:!1,desc:this.value}},watch:{value:function(e){this.desc=e}},mounted:function(){},methods:{edit:function(){this.isEdit=!0,this.$nextTick((function(){this.$refs.input.focus()}))},change:function(e){this.isEdit=!1,this.$emit("input",e)}}}},"UL6+":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{staticStyle:{"font-size":"0"},attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("rich-text-editor",{attrs:{"full-title":e.item.name,id:e.item.key,"is-preview":e.disabled},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},Udb1:function(e,t,n){"use strict";n("Bi2R")},UftK:function(e,t,n){},UhCq:function(e,t,n){"use strict";n.r(t);var i=n("86Bk"),a=n("sjGJ");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("uThF");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"06f07877",null);t.default=s.exports},UljE:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"member-content"},[t("bk-select",{class:{"member-select":!0,"half-member-select":e.recipientItem.key},attrs:{searchable:""},on:{selected:e.getSecondLevelList},model:{value:e.recipientItem.key,callback:function(t){e.$set(e.recipientItem,"key",t)},expression:"recipientItem.key"}},e._l(e.recipientKeyList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1),e._v(" "),"ORGANIZATION"!==e.recipientItem.key?["VARIABLE"===e.recipientItem.key?[t("bk-select",{staticStyle:{float:"left",width:"50%","margin-right":"6px"},attrs:{searchable:""},model:{value:e.recipientItem.value,callback:function(t){e.$set(e.recipientItem,"value",t)},expression:"recipientItem.value"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:"PERSON"===e.recipientItem.key&&Array.isArray(e.recipientItem.value)?[t("member-select",{staticStyle:{float:"left",width:"50%","margin-right":"6px"},model:{value:e.recipientItem.value,callback:function(t){e.$set(e.recipientItem,"value",t)},expression:"recipientItem.value"}})]:"GENERAL"!==e.recipientItem.key&&"CMDB"!==e.recipientItem.key&&"IAM"!==e.recipientItem.key||!Array.isArray(e.recipientItem.value)?e._e():[t("bk-select",{staticStyle:{float:"left",width:"50%","margin-right":"6px"},attrs:{loading:e.recipientItem.isLoading,"show-select-all":"",multiple:"",searchable:""},model:{value:e.recipientItem.value,callback:function(t){e.$set(e.recipientItem,"value",t)},expression:"recipientItem.value"}},e._l(e.recipientItem.secondLevelList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]]:e._e(),e._v(" "),"ORGANIZATION"===e.recipientItem.key?[t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeTree,expression:"closeTree"}],staticClass:"bk-search-tree",staticStyle:{float:"left",width:"50%","margin-right":"6px"}},[t("div",{staticClass:"bk-search-tree-wrapper",on:{click:function(t){return t.stopPropagation(),e.showTree("view")}}},[t("span",{class:{"bk-color-tree":e.roles.viewtree.name}},[e._v("\n          "+e._s(e.roles.viewtree.showName||e.$t('m.serviceConfig["请选择"]'))+"\n        ")]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})]),e._v(" "),t("transition",{attrs:{name:"common-fade"}},[e.roles.viewTreeOpen?t("div",{staticClass:"bk-search-tree-content"},[t("export-tree",{attrs:{"tree-data-list":e.roles.viewTreeDataList},on:{toggle:e.toggleInfo,toggleChildren:function(t){return e.toggleChildren(...arguments,"view")}}})],1):e._e()])],1)]:e._e(),e._v(" "),"MULTI_MEMBERS"===e.itemInfo.type?t("div",{staticClass:"bk-between-operat"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:e.addRecipient}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===e.itemInfo.value.length},on:{click:e.deleteRecipient}})]):e._e()],2)},a=[];i._withStripped=!0},UsFA:function(e,t,n){"use strict";n.r(t);var i=n("XClk"),a=n("nVin");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("mOxC");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"27b534c8",null);t.default=s.exports},VbaA:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("ul",[t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['开始节点']"),expression:"$t(`m.treeinfo['开始节点']`)",modifiers:{right:!0}}]},[t("div",{staticClass:"entry-item entry-start",attrs:{"data-type":"START"}},[e._v("\n      "+e._s(e.$t('m.treeinfo["开始"]'))+"\n    ")]),e._v(" "),t("div",{staticClass:"entry-disabled"})]),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['结束节点']"),expression:"$t(`m.treeinfo['结束节点']`)",modifiers:{right:!0}}]},[t("div",{staticClass:"entry-item",attrs:{"data-type":"END"}},[e._v("\n      "+e._s(e.$t('m.treeinfo["结束"]'))+"\n    ")]),e._v(" "),t("div",{staticClass:"entry-disabled"})]),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['手动节点']"),expression:"$t(`m.treeinfo['手动节点']`)",modifiers:{right:!0}}]},[e._m(0)]),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['API节点']"),expression:"$t(`m.treeinfo['API节点']`)",modifiers:{right:!0}}]},[e._m(1)]),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m['WEBHOOK节点']"),expression:"$t(`m['WEBHOOK节点']`)",modifiers:{right:!0}}]},[e._m(2)]),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['标准运维节点']"),expression:"$t(`m.treeinfo['标准运维节点']`)",modifiers:{right:!0}}]},[e._m(3)]),e._v(" "),"ieod"===e.nodeDisabled?t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m['蓝盾节点']"),expression:"$t(`m['蓝盾节点']`)",modifiers:{right:!0}}]},[e._m(4)]):e._e(),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['审批节点']"),expression:"$t(`m.treeinfo['审批节点']`)",modifiers:{right:!0}}]},[e._m(5)]),e._v(" "),"ieod"===e.nodeDisabled?t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m['蓝鲸插件节点']"),expression:"$t(`m['蓝鲸插件节点']`)",modifiers:{right:!0}}]},[e._m(6)]):e._e(),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['并行网关']"),expression:"$t(`m.treeinfo['并行网关']`)",modifiers:{right:!0}}]},[e._m(7)]),e._v(" "),t("li",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m.treeinfo['汇聚网关']"),expression:"$t(`m.treeinfo['汇聚网关']`)",modifiers:{right:!0}}]},[e._m(8)])])},a=[function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"10px 0 0"},attrs:{"data-type":"NORMAL"}},[e("i",{staticClass:"bk-itsm-icon icon-icon-artificial",staticStyle:{"font-size":"26px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"12px 0 2px"},attrs:{"data-type":"TASK"}},[e("i",{staticClass:"bk-itsm-icon icon-api-node",staticStyle:{"font-size":"26px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"12px 0 2px"},attrs:{"data-type":"WEBHOOK"}},[e("i",{staticClass:"bk-itsm-icon icon-webhookjiedian plugin",staticStyle:{"font-size":"42px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"12px 0 2px"},attrs:{"data-type":"TASK-SOPS"}},[e("i",{staticClass:"bk-itsm-icon icon-task-icon",staticStyle:{"font-size":"26px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"12px 0 2px"},attrs:{"data-type":"TASK-DEVOPS"}},[e("i",{staticClass:"bk-itsm-icon icon-devops-task-icon",staticStyle:{"font-size":"26px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"12px 0 2px"},attrs:{"data-type":"APPROVAL"}},[e("i",{staticClass:"bk-itsm-icon icon-approval-node",staticStyle:{"font-size":"26px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",staticStyle:{margin:"12px 0 2px"},attrs:{"data-type":"BK-PLUGIN"}},[e("i",{staticClass:"bk-itsm-icon icon-chajianjiedian plugin",staticStyle:{"font-size":"42px"}})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",attrs:{"data-type":"ROUTER-P"}},[e("i",{staticClass:"bk-itsm-icon icon-flow-convergence"})])},function(){var e=this._self._c;return e("div",{staticClass:"entry-item entry-gateway",attrs:{"data-type":"COVERAGE"}},[e("i",{staticClass:"bk-itsm-icon icon-flow-branch"})])}];i._withStripped=!0},VflG:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("m1cH")),a=c(n("P2sY")),r=c(n("GQeE")),o=n("Zw8t"),s=n("ygAv");function c(e){return e&&e.__esModule?e:{default:e}}t.default={props:{},data:function(){},created:function(){},watch:{},methods:{jsonschemaToList:function(e){var t=[],n=function e(t,n,i,a,o){var s={showChildren:!0,checkInfo:!1,key:n,type:i.type||"",desc:i.description.toString(),default:void 0!==i.default&&i.default.toString()?i.default:"",is_necessary:!a||!!o&&!!o.length&&-1!==o.indexOf(n),children:[],value:void 0!==i.default?i.default:""};if("object"===s.type&&(s.has_children=!(!i.properties||!(0,r.default)(i.properties).length)),"array"===s.type&&(s.has_children=i.items,s.showChildren=!0),t.push(s),"object"===s.type)for(var c in i.properties)e(s.children,c,i.properties[c],1,i.required||[]);"array"===s.type&&i.items&&e(s.children,"items",i.items,1,i.required||[])};for(var i in e)n(t,i,e[i],0,["root"]);return t},listToJsonschema:function(e,t){var n={},i=function e(n,i,r,o){if(i.key&&i.type){var s={};if(s[i.key]={type:i.type,description:i.desc.toString(),required:i.children&&i.children.length?i.children.filter((function(e){return e.is_necessary})).map((function(e){return e.key})):[]},s[i.key].required.length||delete s[i.key].required,r||(s[i.key].$schema="http://json-schema.org/draft-04/schema#"),"array"===i.type){if(i.children.length&&(s[i.key].items={}),"array"===o)for(var c in(0,a.default)(n,s[i.key]),i.children)e(n.items,i.children[c],1,"array");if("object"===o)for(var l in(0,a.default)(n,s),i.children)e(n[i.key].items,i.children[l],1,"array")}else if("object"===i.type){if(s[i.key].properties={},"array"===o)for(var u in(0,a.default)(n,s[i.key]),i.children)e(n.properties,i.children[u],1,"object");if("object"===o)for(var d in(0,a.default)(n,s),i.children)e(n[i.key].properties,i.children[d],1,"object")}else void 0!==i.default&&i.default.toString()&&("number"===i.type&&(i.default=Number(i.default)),"boolean"===i.type&&(i.default=!!i.default),"string"===i.type&&(i.default=i.default.toString())),s[i.key].default=i.default.toString()?i.default:"",void 0!==i.default_temp&&i.default_temp.toString()&&("number"===i.type&&(i.default_temp=Number(i.default_temp)),"boolean"===i.type&&(i.default_temp=!!i.default_temp),"string"===i.type&&(i.default_temp=i.default_temp.toString())),"update"===t&&(s[i.key].default=i.default_temp.toString()?i.default_temp:""),"array"===o&&(0,a.default)(n,s[i.key]),"object"===o&&(0,a.default)(n,s)}};for(var r in e)i(n,e[r],0,"object");return n},jsonschemaToJson:function(e){var t={},n=function e(t,n,i,r,o){var s={};if("object"===i.type){if(s[n]={},"object"===o)for(var c in(0,a.default)(t,s),i.properties)e(t[n],c,i.properties[c],1,"object");else if("array"===o)for(var l in t.push(s[n]),i.properties)e(t[0],l,i.properties[l],1,"object")}else if("array"===i.type)s[n]=[],"object"===o?((0,a.default)(t,s),i.children&&i.children.length&&e(t[n],"items",i.items,1,"array")):"array"===o&&(t.push(s[n]),i.children&&i.children.length&&e(t[0],n,i.items,1,"array"));else{switch(i.type){case"boolean":s[n]=!!i.default;break;case"number":s[n]=Number(i.default);break;case"string":s[n]=i.default.toString()||""}"object"===o?(0,a.default)(t,s):"array"===o&&t.push(s[n])}};for(var i in e)n(t,i,e[i],0,"object");return t},jsonToJsonschema:function(e){var t={root:{$schema:"http://json-schema.org/draft-04/schema#",type:"object",description:this.$t('m.systemConfig["初始化数据"]'),required:[],properties:{}}},n=function e(t,n,i,o,s){if(i&&null!=o){"array"!==t.type&&t.required.push(i);var c={};if(c[i]={type:o.constructor.name.toLowerCase(),description:"",required:[]},"array"===o.constructor.name.toLowerCase()){if(o.length&&(c[i].items={}),"array"===s)for(var l in(0,a.default)(n,c[i]),o)e(n,n.items,"items",o[l],"array");if("object"===s)for(var u in(0,a.default)(n,c),o)e(n[i],n[i].items,"items",o[u],"array")}else if("object"===o.constructor.name.toLowerCase()){if(c[i].properties={},"array"===s)for(var d in(0,a.default)(n,c[i]),o)e(n,n.properties,d,o[d],"object");if("object"===s&&((0,a.default)(n,c),(0,r.default)(o).length))for(var f in o)e(n[i],n[i].properties,f,o[f],"object")}else void 0!==o&&o.toString()&&("number"===o.constructor.name.toLowerCase()&&(o=Number(o)),"boolean"===o.constructor.name.toLowerCase()&&(o=!!o),"string"===o.constructor.name.toLowerCase()&&(o=o.toString())),c[i].default=o,"array"===s&&(0,a.default)(n,c[i]),"object"===s&&(0,a.default)(n,c)}};for(var i in e)n(t.root,t.root.properties,i,e[i],"object");return t},treeToTableList:function(e,t,n,a,r){var o=[];return function e(t,n,a,r,o,s){for(var c=0;c<n.length;c++){n[c].lastType=o,n[c].level=a,n[c].isShow=!0,n[c].showChildren=!0,n[c].primaryKey=a+"_"+n[c].key,"array"===o&&(n[c].primaryKey+="_"+c),n[c].parentPrimaryKey=r,n[c].ancestorsList=s;var l=[].concat((0,i.default)(s),[n[c].primaryKey]);n[c].ancestorsList_str=l.toString(),t.push(n[c]),n[c].children&&n[c].children.length&&e(t,n[c].children,a+1,n[c].primaryKey,n[c].type,l)}}(o,e,t||0,n||"",a||"object",r&&r.length?r:[]),o},treeToJson:function(e){var t={},n=function e(t,n,i,r){if(n.key)if("array"===n.type){if("array"===r)for(var o in t.push([]),n.children)e(t[t.length-1],n.children[o],1,"array");if("object"===r){var s={};for(var c in s[n.key]=[],(0,a.default)(t,s),n.children)e(t[n.key],n.children[c],1,"array")}}else if("object"===n.type){var l={};if("array"===r)for(var u in t.push(l),n.children)e(t[t.length-1],n.children[u],1,"object");if("object"===r)for(var d in l[n.key]={},(0,a.default)(t,l),n.children)e(t[n.key],n.children[d],1,"object")}else{if("number"===n.type&&(n.value=Number(n.value)),"array"===r){var f="CUSTOM"===n.source_type?n.value:"${params_"+n.value_key+"}";t.push(f)}if("object"===r){var p={};p[n.key]="CUSTOM"===n.source_type?n.value:"${params_"+n.value_key+"}",(0,a.default)(t,p)}}};for(var i in e)n(t,e[i],0,"object");return t},jsonValueToTree:function(e,t){var n=(0,s.deepClone)(t),i=function e(t,n,i,r){var c=(0,o.checkDataType)(i);if("object"===r){var l=t.find((function(e){return e.key===n}));if(!l)return;if("Array"===c){if(!l.children||!l.children.length)return;for(var u=(0,a.default)({parentInfo:""},l.children[0]),d=1;d<i.length;d++)l.children.push((0,s.deepClone)(u));for(var f in i)e(l.children[f],"items",i[f],"array")}else if("Object"===c)for(var p in i)e(l.children,p,i[p],"object");else/^\$\{params_.*\}$/.test(i)?(l.source_type="FIELDS",l.value_key=i?(0,s.deepClone)(i).replace(/^\$\{params_/,"").replace(/\}$/,""):"",l.value=void 0!==i&&i.toString()?(0,s.deepClone)(i):""):(l.source_type="CUSTOM",l.value=void 0!==i&&i.toString()?(0,s.deepClone)(i):"",l.value_key="",l.default_temp=l.value)}else if("array"===r)if("Array"===c){var m=t.find((function(e){return e.key===n}));if(!m)return;if(!m.children||!m.children.length)return;for(var h=t.children[0],v=1;v<i.length;v++)t.children.push((0,s.deepClone)(h));for(var g in i)e(t.children[g],"items",i[g],"array")}else if("Object"===c)for(var y in i)e(t.children,y,i[y],"object");else/^\$\{params_.*\}$/.test(i)?(t.source_type="FIELDS",t.value_key=i?(0,s.deepClone)(i).replace(/^\$\{params_/,"").replace(/\}$/,""):""):(t.source_type="CUSTOM",t.value=void 0!==i&&i.toString()?(0,s.deepClone)(i):"",t.default_temp=t.value)};for(var r in e)i(n[0].children,r,e[r],"object");return n}}}},VhbG:function(e,t,n){"use strict";n.r(t);var i=n("/9eO"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},Vj9y:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=f(n("m1cH")),a=f(n("P2sY")),r=f(n("14Xm")),o=f(n("gDS+")),s=f(n("D3Ub")),c=f(n("QbLZ")),l=f(n("VflG")),u=n("ygAv"),d=n("L2JU");function f(e){return e&&e.__esModule?e:{default:e}}t.default={name:"inputParams",mixins:[l.default],props:{itemInfo:{type:Object,default:function(){return{}}}},data:function(){return{sourceTypeList:[{id:1,key:"CUSTOM",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"FIELDS",name:this.$t('m.treeinfo["引用变量"]')}],variableList:[]}},computed:(0,c.default)({paramTableData:function(){return this.itemInfo.apiContent.bodyTableData.filter((function(e){return e.isShow}))},globalChoise:function(){return this.$store.state.common.configurInfo}},(0,d.mapState)("trigger",{triggerVariables:function(e){return e.triggerVariables}})),watch:{triggerVariables:function(e){this.variableList=e}},created:function(){this.initData()},mounted:function(){this.variableList=this.triggerVariables},methods:{initData:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.$set(e.itemInfo.apiContent,"treeDataList",{}),t.next=3,e.jsonschemaToList({root:JSON.parse((0,o.default)(e.itemInfo.apiContent.req_body))});case 3:return e.itemInfo.apiContent.treeDataList=t.sent,e.itemInfo.value&&(e.itemInfo.apiContent.treeDataList=e.jsonValueTreeList(e.itemInfo.value,JSON.parse((0,o.default)(e.itemInfo.apiContent.treeDataList)))),t.next=7,e.treeToTableList(JSON.parse((0,o.default)(e.itemInfo.apiContent.treeDataList[0].children)));case 7:return e.itemInfo.apiContent.bodyTableData=t.sent,(n=JSON.parse((0,o.default)(e.itemInfo.apiContent.bodyTableData))).forEach((function(e){e.name=e.key||"",e.children=[],e.source_type=e.source_type||"CUSTOM",e.value=void 0!==e.value?e.value:"",e.value_key=void 0!==e.value_key&&e.value_key.toString()?e.value_key:""})),e.recordChildren(n),t.next=13,n;case 13:e.itemInfo.apiContent.bodyTableData=t.sent;case 14:case"end":return t.stop()}}),t,e)})))()},jsonValueTreeList:function(e,t){var n=function e(t,n,i,r,s){if("object"===s){var c=n.filter((function(e){return e.key===i}));if(!c.length)return;if("array"===r.constructor.name.toLowerCase()){if(!c[0].children||!c[0].children.length)return;for(var l=JSON.parse((0,o.default)((0,a.default)({parentInfo:""},c[0].children[0]))),d=1;d<r.length;d++)c[0].children.push((0,u.deepClone)(l));for(var f in r)e(c[0].children,c[0].children[f],"items",r[f],"array")}else if("object"===r.constructor.name.toLowerCase())if(r.ref_type)"reference"===r.ref_type?(c[0].source_type="FIELDS",c[0].value_key=r.value,c[0].value=r.value):(c[0].source_type="CUSTOM",c[0].value=r.value,c[0].value_key="",c[0].default_temp=c[0].value);else for(var p in r)e(c[0],c[0].children,p,r[p],"object");else"reference"===r.ref_type?(c[0].source_type="FIELDS",c[0].value_key=r.value,c[0].value=r.value):(c[0].source_type="CUSTOM",c[0].value=r.value,c[0].value_key="",c[0].default_temp=c[0].value)}else if("array"===s)if("array"===r.constructor.name.toLowerCase()){var m=n.filter((function(e){return e.key===i}));if(!m.length)return;if(!m[0].children||!m[0].children.length)return;for(var h=JSON.parse((0,o.default)(n.children[0])),v=1;v<r.length;v++)n.children.push(h);for(var g in r)e(n.children,n.children[g],"items",r[g],"array")}else if("object"===r.constructor.name.toLowerCase())if(r.ref_type)"reference"===r.ref_type?(n.source_type="FIELDS",n.value_key=r.value):(n.source_type="CUSTOM",n.value=r.value,n.default_temp=n.value);else for(var y in r)e(n,n.children,y,r[y],"object");else"reference"===r.ref_type?(n.source_type="FIELDS",n.value_key=r.value):(n.source_type="CUSTOM",n.value=r.value,n.default_temp=n.value)};for(var i in e)n(t[0],t[0].children,i,e[i],"object");return t},recordChildren:function(e,t){for(var n=e.map((function(e){return e.level})),a=Math.max.apply(Math,(0,i.default)(n)),r=function(t){e.filter((function(e){return e.level===t})).forEach((function(t){!function(e,t){e.filter((function(e){return e.level===t.level-1&&e.primaryKey===t.parentPrimaryKey&&e.ancestorsList.toString()===t.ancestorsList.slice(0,-1).toString()}))[0].children.push(t)}(e,t)}))},o=a;o>(t||0);o--)r(o)},changeState:function(e){e.showChildren=!e.showChildren,e.children.forEach((function(t){t.isShow=e.showChildren})),e.showChildren||this.closeChildren(e)},closeChildren:function(e){var t=this;e.children.forEach((function(e){e.isShow=!1,e.has_children&&(e.showChildren=!1,t.closeChildren(e))}))},countSon:function(e){return 1===this.itemInfo.apiContent.bodyTableData.filter((function(t){return t.level===e.level-1&&t.primaryKey===e.parentPrimaryKey&&t.ancestorsList.toString()===e.ancestorsList.slice(0,-1).toString()}))[0].children.length},countChildren:function(e){var t=this;return(0,s.default)(r.default.mark((function n(){var i,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,a=function e(t){if(t.children&&t.children.length)for(var n=0;n<t.children.length;n++)i+=1,e(t.children[n])},t.next=4,a(e);case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),n,t)})))()},cleanValue:function(e){var t=this;return(0,s.default)(r.default.mark((function n(){var i,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=JSON.parse((0,o.default)(e)),a=function e(t){if(t.value="",t.source_type="CUSTOM",t.children&&t.children.length)for(var n=0;n<t.children.length;n++)e(t.children[n])},t.next=4,a(i);case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),n,t)})))()},addChildren:function(e){var t=this;return(0,s.default)(r.default.mark((function n(){var a,s,c,l,u,d;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=t.itemInfo.apiContent.bodyTableData.filter((function(t){return t.level===e.level-1&&t.primaryKey===e.parentPrimaryKey&&t.ancestorsList.toString()===e.ancestorsList.slice(0,-1).toString()}))[0],c=t.itemInfo.apiContent.bodyTableData.indexOf(s)+1,n.next=4,t.countChildren(s);case 4:return l=n.sent,n.next=7,t.cleanValue(s.children[0]);case 7:return u=n.sent,n.next=10,t.treeToTableList(JSON.parse((0,o.default)([].concat((0,i.default)(s.children),[u]))),s.level+1,s.primaryKey,"array",s.ancestorsList);case 10:return d=n.sent,n.next=13,d.forEach((function(e){e.children=[]}));case 13:return s.children=d.filter((function(e){return e.level===s.level+1})),n.next=16,t.recordChildren(d,s.level+1);case 16:(a=t.itemInfo.apiContent.bodyTableData).splice.apply(a,[c,l].concat((0,i.default)(d)));case 17:case"end":return n.stop()}}),n,t)})))()},deletChildren:function(e){var t=this;return(0,s.default)(r.default.mark((function n(){var i,a,o;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.countSon(e)){n.next=2;break}return n.abrupt("return");case 2:if(!((i=t.itemInfo.apiContent.bodyTableData.filter((function(t){return t.level===e.level-1&&t.primaryKey===e.parentPrimaryKey&&t.ancestorsList.toString()===e.ancestorsList.slice(0,-1).toString()}))[0].children).length<=1)){n.next=5;break}return n.abrupt("return");case 5:return i.splice(i.indexOf(e),1),a=t.itemInfo.apiContent.bodyTableData.indexOf(e),n.next=9,t.countChildren(e);case 9:o=n.sent,t.itemInfo.apiContent.bodyTableData.splice(a,o+1);case 11:case"end":return n.stop()}}),n,t)})))()}}}},VrAx:function(e,t,n){"use strict";n.r(t);var i=n("sHh5"),a=n("3jvg");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("XEYe");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"5ecc5a94",null);t.default=s.exports},VtRw:function(e,t,n){"use strict";n.r(t);var i=n("MI7q"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"Vv2+":function(e,t,n){"use strict";n.r(t);var i=n("fOTe"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},VwbA:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-api-call"},[e._l(e.item.wayInfo.field_schema,(function(n,i){return[t("bk-form-item",{key:i,attrs:{"ext-cls":"bk-field-schema mb20",label:n.name,required:n.required,desc:n.tips}},["api_source"===n.key?[t("bk-select",{attrs:{"ext-cls":"bk-form-display",clearable:!1,placeholder:e.$t("m.treeinfo['请选择接入系统']"),searchable:""},on:{selected:function(t){return e.changeCode(...arguments,n)}},model:{value:n.systemId,callback:function(t){e.$set(n,"systemId",t)},expression:"itemInfo.systemId"}},e._l(e.apiSysList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),n.systemId?[t("bk-select",{attrs:{"ext-cls":"bk-form-display",clearable:!1,searchable:""},on:{selected:function(t){return e.changeApi(...arguments,n)}},model:{value:n.apiId,callback:function(t){e.$set(n,"apiId",t)},expression:"itemInfo.apiId"}},e._l(e.apiList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]:e._e()]:e._e(),e._v(" "),"API_INFO"===n.type&&e.apiId?[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticStyle:{"min-height":"100px"}},[e.isLoading?e._e():t("input-params",{attrs:{"item-info":n}})],1)]:e._e()],2)]}))],2)},a=[];i._withStripped=!0},"W/oT":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=h(n("m1cH")),a=h(n("14Xm")),r=h(n("GQeE")),o=h(n("D3Ub")),s=h(n("vUrO")),c=h(n("PIEm")),l=h(n("I1Ty")),u=h(n("KaYb")),d=h(n("bcjM")),f=h(n("s4tT")),p=n("CeR/"),m=n("ygAv");function h(e){return e&&e.__esModule?e:{default:e}}t.default={name:"sopsDevopsTask",components:{BasicCard:f.default,sopsGetParam:u.default,commonTriggerList:d.default,NoData:l.default,dealPerson:c.default,descInfo:s.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}},state:{type:[String,Number],default:function(){return""}}},data:function(){return{secondClick:!1,quoteVars:[],hookedVarList:{},constantDefaultValue:{},basicsFormData:{name:"",desc:"",templateId:"",projectId:"",planId:[],processType:"",processors:[]},processOptions:[{id:"business",name:"项目流程"},{id:"common",name:"公共流程"}],isLoading:!1,excludeTaskNodesId:[],projectList:[],templateList:[],paramTableData:[],stateList:[],fieldList:[],constants:[],context:{project:{id:"",bk_biz_id:"",name:"",from_cmdb:!0},bk_biz_id:"",site_url:window.SITE_URL_SOPS+window.PREFIX_SOPS},sopsFormLoading:!1,processesLoading:!1,planLoading:!1,planList:[],optionalNodeIdList:[],templateDisable:!1,planDisable:!1,processDisable:!1,renderFormValidate:!1,biz:[{name:this.$t('m.treeinfo["业务"]'),custom_type:"",source_type:"custom",value:"--",key:1}],rules:{name:[{required:!0,message:"必填项",trigger:"blur"},{max:50,message:"不能多于50个字符",trigger:"blur"}],processType:[{required:!0,message:"必填项",trigger:"blur"}],projectId:[{required:!0,message:"必填项",trigger:"blur"}],templateId:[{required:!0,message:"必填项",trigger:"blur"}]},checkStatus:{delivers:!1,processors:!1},excludeProcessor:[],processorsInfo:{type:"",value:""},initFormDate:{}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},created:function(){},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,e.getRelatedFields(),t.next=4,e.$store.dispatch("apiRemote/get_user_project_list");case 4:if((n=t.sent)&&(e.projectList=n.data),0===(0,r.default)(e.configur.extras).length){t.next=23;break}if(e.basicsFormData.name=e.configur.name,e.basicsFormData.desc=e.configur.desc,e.basicsFormData.processType=e.configur.extras.sops_info.template_source,e.excludeTaskNodesId=e.configur.extras.sops_info.exclude_task_nodes_id||[],e.basicsFormData.projectId=e.configur.extras.sops_info.bk_biz_id.value,"common"!==e.basicsFormData.processType){t.next=17;break}return t.next=15,e.getTemplateList(e.basicsFormData.processType);case 15:t.next=19;break;case 17:return t.next=19,e.getProjectTemplateList(e.basicsFormData.projectId);case 19:return t.next=21,e.getTemplateDetail(e.configur.extras.sops_info.template_id);case 21:e.basicsFormData.templateId=e.configur.extras.sops_info.template_id,e.processorsInfo={type:e.configur.processors_type,value:e.configur.processors};case 23:e.getExcludeRoleTypeList(),e.isLoading=!1;case 25:case"end":return t.stop()}}),t,e)})))()},getTemplateList:function(e){var t=this;return(0,o.default)(a.default.mark((function n(){var i,r;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(r=(i="common"===e)?{}:{bk_biz_id:t.basicsFormData.projectId},i||(t.basicsFormData.projectId=""),t.basicsFormData.templateId="",t.basicsFormData.planId=[],t.templateDisable=!i,t.planDisable=!i,!i){n.next=11;break}return t.processesLoading=!0,n.next=11,t.$store.dispatch("getTemplateList",r).then((function(e){t.templateList=e.data})).catch((function(e){(0,p.errorHandler)(e,t)})).finally((function(){t.processesLoading=!1}));case 11:case"end":return n.stop()}}),n,t)})))()},getProjectTemplateList:function(e){var t=this;return(0,o.default)(a.default.mark((function n(){var i,r;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i={bk_biz_id:e},"common"===t.basicsFormData.processType){n.next=8;break}return t.processesLoading=!0,t.basicsFormData.templateId="",n.next=6,t.$store.dispatch("getTemplateList",i);case 6:(r=n.sent).result&&(t.templateList=r.data,t.templateDisable=!1,t.planDisable=!1,t.processesLoading=!1);case 8:case"end":return n.stop()}}),n,t)})))()},getTemplateDetail:function(e){var t=this;return(0,o.default)(a.default.mark((function n(){var i,r;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i={bk_biz_id:"common"===t.basicsFormData.processType?"":t.basicsFormData.projectId,template_id:e},void 0!==(r=t.templateList.find((function(t){return t.id===e})))&&(t.context.project.bk_biz_id=r.bk_biz_id,t.context.project.id=t.template),t.constants=[],t.hookedVarList={},t.sopsFormLoading=!0,t.basicsFormData.planId=[],n.next=9,t.$store.dispatch("getTemplateDetail",i).then((function(n){t.processingVariables(n.data.constants),t.optionalNodeIdList=n.data.all_ids||[],t.getTempaltePlanList(e)})).catch((function(e){(0,p.errorHandler)(e,t)})).finally((function(){t.sopsFormLoading=!1}));case 9:case"end":return n.stop()}}),n,t)})))()},getTempaltePlanList:function(e){var t=this,n=this.templateList.find((function(t){return t.id===e}));this.planList=[];var i={bk_biz_id:n.bk_biz_id,template_id:n.id};this.planLoading=!0,this.$store.dispatch("getTemplatePlanList",i).then((function(e){t.planList=e.data,0!==t.excludeTaskNodesId.length&&e.data.forEach((function(e){if(e.data){var n=t.optionalNodeIdList.filter((function(t){return!JSON.parse(e.data).includes(t)}));0===n.filter((function(e){return!t.excludeTaskNodesId.includes(e)})).length&&t.excludeTaskNodesId.length===n.length&&t.basicsFormData.planId.push(e.id)}})),t.onplanSelect(t.basicsFormData.planId)})).catch((function(e){(0,p.errorHandler)(e,t)})).finally((function(){t.planLoading=!1}))},onplanSelect:function(e){var t=this;return(0,o.default)(a.default.mark((function n(){var i,r,o,s,c,l;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(i=[],e.length>0?(e.forEach((function(e){var n=t.planList.find((function(t){return t.id===e}));if(n.data)for(var a=JSON.parse(n.data),r=0;r<a.length;r++)-1===i.indexOf(a[r])&&i.push(a[r])})),t.excludeTaskNodesId=t.optionalNodeIdList.filter((function(e){return!i.includes(e)}))):t.excludeTaskNodesId=[],r=t.templateList.find((function(e){return e.id===t.basicsFormData.templateId})),n.prev=3,t.sopsFormLoading=!0,o="common"===t.basicsFormData.processType,s=[],o){n.next=15;break}return n.next=10,t.$store.dispatch("taskFlow/getSopsPreview",{bk_biz_id:r.bk_biz_id,template_id:r.id,exclude_task_nodes_id:t.excludeTaskNodesId});case 10:for(l in c=n.sent,t.initFormDate=(0,m.deepClone)(c.data.pipeline_tree.constants),c.data.pipeline_tree.constants)"show"===c.data.pipeline_tree.constants[l].show_type&&s.push(c.data.pipeline_tree.constants[l]);n.next=16;break;case 15:s.push([]);case 16:t.processingVariables(s),n.next=22;break;case 19:n.prev=19,n.t0=n.catch(3),console.error(n.t0);case 22:return n.prev=22,t.sopsFormLoading=!1,n.finish(22);case 25:case"end":return n.stop()}}),n,t,[[3,19,22,25]])})))()},onChangeHook:function(e,t){this.hookedVarList[e]=t;var n=this.constants.find((function(t){return t.key===e})),i=this.initFormDate[e];this.$set(n,"value",i.value)},processingVariables:function(e){var t=this,n=e;n.sort((function(e,t){return e.index-t.index})),n.map((function(e){t.$set(t.hookedVarList,e.key,!1)})),Object.prototype.hasOwnProperty.call(this.configur.extras,"sops_info")&&n.forEach((function(e){var n=t.configur.extras.sops_info.constants.find((function(t){return t.key===e.key}));n&&(t.constantDefaultValue[e.key]=(0,m.deepClone)(n.value),n.is_quoted?(t.$set(t.hookedVarList,e.key,!0),e.value="${"+n.value+"}"):e.value=n.value)})),this.constants=n},getRelatedFields:function(){var e=this;return(0,o.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={workflow:e.flowInfo.id,state:e.configur.id,field:""},t.next=3,e.$store.dispatch("apiRemote/get_related_fields",n).then((function(t){e.stateList=t.data})).catch((function(t){(0,p.errorHandler)(t,e)})).finally((function(){}));case 3:case"end":return t.stop()}}),t,e)})))()},getExcludeRoleTypeList:function(){var e=[];e=this.configur.is_builtin?["BY_ASSIGNOR","STARTER","VARIABLE"]:["OPEN"],this.flowInfo.is_iam_used,"DISTRIBUTE_THEN_PROCESS"!==this.configur.distribute_type&&"DISTRIBUTE_THEN_CLAIM"!==this.configur.distribute_type&&e.push("BY_ASSIGNOR"),this.flowInfo.is_biz_needed||e.push("CMDB"),this.excludeProcessor=["EMPTY","API"].concat((0,i.default)(e))},onClearProcess:function(){"common"!==this.basicsFormData.processType&&(this.templateDisable=!0,this.planDisable=!0,this.constants=[]),this.templateList=[],this.basicsFormData.templateId="",this.planList=[]},onClearTemplate:function(){this.basicsFormData.planId=[],this.basicsFormData.templateId="",this.constants=[],this.planList=[]},closeNode:function(){this.$parent.closeConfigur()},submit:function(){var e=this;this.$refs.processors&&!this.$refs.processors.verifyValue()&&(this.checkStatus.processors=!0),this.$refs.getParam?this.renderFormValidate=this.$refs.getParam.getRenderFormValidate():this.renderFormValidate=!0,this.secondClick||this.$refs.basicsForm.validate().then((function(){if(e.renderFormValidate&&e.$refs.processors.verifyValue()){e.secondClick=!0;var t=[],n=e.projectList.find((function(t){return t.bk_biz_id===e.basicsFormData.projectId})),i={name:n?n.name:e.$t('m.treeinfo["业务"]'),value:n?n.bk_biz_id:e.basicsFormData.projectId,key:1,value_type:"custom"};e.constants.map((function(n){var i=(0,r.default)(e.$refs.getParam.formData).filter((function(e){return e===n.key})),a=n.name,o=n.key,s=e.hookedVarList[i]?"variable":"custom";if("show"===n.show_type){var c={value:e.hookedVarList[i]?e.$refs.getParam.formData[i].slice(2,e.$refs.getParam.formData[i].length-1):e.$refs.getParam.formData[i],name:a,key:o||1,value_type:s,type:n.custom_type,is_quoted:e.hookedVarList[i]};t.push(c)}}));var a=e.$refs.processors.getValue(),o=a.value,s=a.type,c={extras:{sops_info:{bk_biz_id:i,template_id:e.basicsFormData.templateId,constants:t,exclude_task_nodes_id:e.excludeTaskNodesId,template_source:e.basicsFormData.processType}},processors:o||"",processors_type:s,is_draft:!1,is_terminable:!1,name:e.basicsFormData.name,desc:e.basicsFormData.desc||void 0,type:"TASK-SOPS",workflow:e.configur.workflow},l=e.configur.id;e.$store.dispatch("cdeploy/putSopsInfo",{params:c,stateId:l}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$parent.closeConfigur()}),(function(t){(0,p.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}}))}}}},"W3y+":function(e,t){e.exports="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDIyLjEuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IuWbvuWxgl8yIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCIKCSB2aWV3Qm94PSIwIDAgMTAyNCAxMDI0IiBzdHlsZT0iZW5hYmxlLWJhY2tncm91bmQ6bmV3IDAgMCAxMDI0IDEwMjQ7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojYzNjZGQ3O30KPC9zdHlsZT4KPGcgaWQ9IuS4iuS8oCI+Cgk8cGF0aCBjbGFzcz0ic3QwIiBkPSJNODk3LDQyMi45Yy0yOC40LTI4LjQtNjMuMy00Ny44LTEwMS4zLTU3Yy0xMC4xLTU3LjktMzcuNi0xMTEuMi04MC0xNTMuNkM2NjEuMywxNTgsNTg4LjksMTI4LDUxMiwxMjgKCQlzLTE0OS4zLDMwLTIwMy42LDg0LjRjLTQyLjQsNDIuNC02OS45LDk1LjctODAsMTUzLjZjLTM4LjEsOS4yLTczLDI4LjYtMTAxLjMsNTdjLTQwLjYsNDAuNi02Myw5NC42LTYzLDE1MnYxMAoJCWMwLDU3LjQsMjIuNCwxMTEuNCw2MywxNTJzOTQuNiw2MywxNTIsNjNoNDF2LTY0aC00MWMtODMuMywwLTE1MS02Ny43LTE1MS0xNTF2LTEwYzAtODMuMyw2Ny43LTE1MSwxNTEtMTUxaDkuMgoJCWMtMC4xLTIuNi0wLjItNS4zLTAuMi03LjlsMCwwbDAsMGMwLTEuNywwLTMuMywwLjEtNC45YzAtMC40LDAtMC44LDAtMS4zYzAtMS42LDAuMS0zLjIsMC4yLTQuN2MwLTAuNCwwLTAuNywwLjEtMS4xCgkJYzAuMS0xLjIsMC4xLTIuNSwwLjItMy43YzAtMC42LDAuMS0xLjIsMC4xLTEuOGMwLjEtMS40LDAuMi0yLjcsMC4zLTQuMWMwLjEtMC44LDAuMi0xLjYsMC4zLTIuNWMwLjEtMC42LDAuMS0xLjIsMC4yLTEuOQoJCWMxLjItMTAuMywzLjEtMjAuNCw1LjYtMzAuMmwwLDBjOS44LTM4LjQsMjkuOC03My42LDU4LjYtMTAyLjNDMzk1LjksMjE1LjMsNDUyLjIsMTkyLDUxMiwxOTJzMTE2LjEsMjMuMywxNTguNCw2NS42CgkJYzI4LjcsMjguNyw0OC43LDYzLjksNTguNiwxMDIuM2wwLDBjMi41LDkuOCw0LjQsMTkuOSw1LjYsMzAuMmMwLjEsMC42LDAuMSwxLjIsMC4yLDEuOWMwLjEsMC44LDAuMiwxLjYsMC4zLDIuNQoJCWMwLjEsMS40LDAuMiwyLjcsMC4zLDQuMWMwLDAuNiwwLjEsMS4yLDAuMSwxLjhjMC4xLDEuMiwwLjIsMi41LDAuMiwzLjdjMCwwLjQsMCwwLjcsMC4xLDEuMWMwLjEsMS42LDAuMSwzLjIsMC4yLDQuNwoJCWMwLDAuNCwwLDAuOCwwLDEuM2MwLDEuNiwwLjEsMy4zLDAuMSw0LjlsMCwwbDAsMGMwLDIuNy0wLjEsNS4zLTAuMiw3LjloOS4yYzgzLjMsMCwxNTEsNjcuNywxNTEsMTUxdjEwYzAsODMuMy02Ny43LDE1MS0xNTEsMTUxCgkJaC00MXY2NGg0MWM1Ny40LDAsMTExLjQtMjIuNCwxNTItNjNzNjMtOTQuNiw2My0xNTJ2LTEwQzk2MCw1MTcuNSw5MzcuNiw0NjMuNSw4OTcsNDIyLjl6Ii8+Cgk8cG9seWdvbiBjbGFzcz0ic3QwIiBwb2ludHM9IjM3Ni4yLDYwMi45IDQyMS41LDY0OC4xIDQ4MCw1ODkuNiA0ODAsODk2IDU0NCw4OTYgNTQ0LDU4OS42IDYwMi41LDY0OC4xIDY0Ny44LDYwMi45IDUxMiw0NjcuMSAJIi8+CjwvZz4KPC9zdmc+Cgo="},WOBF:function(e,t,n){"use strict";n("utoA")},WP3n:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("CeR/"),r=n("BWJp"),o=(i=r)&&i.__esModule?i:{default:i};t.default={name:"hiddenConditions",mixins:[o.default],props:{workflow:{type:[String,Number],default:function(){return""}},state:{type:[String,Number],default:function(){return""}},formInfo:{type:Object,default:function(){return{}}},templateStage:{type:String,default:""},templateInfo:{type:Object,default:function(){return{}}},addOrigin:{type:Object,default:function(){return{isOther:!1,addOriginInfo:{}}}}},data:function(){return{isLoading:!1,listInfo:[],conditionType:"and",fieldList:[],checkStatus:!1}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},mounted:function(){this.getFrontNodesList()},methods:{getFrontNodesList:function(){var e=this;if(this.state||this.templateInfo.id){var t="",n={};this.state&&(t="apiRemote/get_related_fields",n.workflow=this.workflow,n.state=this.state),this.templateInfo.id&&(t="taskTemplate/getFrontFieldsList",n.id=this.templateInfo.id,n.stage=this.templateStage),this.isLoading=!0,this.$store.dispatch(t,n).then((function(t){e.frontNodesList=t.data,e.initData()})).catch((function(t){(0,a.errorHandler)(t,e)})).finally((function(){e.isLoading=!1}))}},initData:function(){var e=this;this.listInfo=[],this.formInfo.show_conditions.expressions&&this.formInfo.show_conditions.expressions.length?(this.formInfo.show_conditions.expressions.forEach((function(t){e.frontNodesList.forEach((function(n){if(n.key===t.key){var i="MULTISELECT"===n.type||"CHECKBOX"===n.type||"MEMBERS"===n.type||"TREESELECT"===n.type,a=e.checkBetweenList(n.type);e.listInfo.push({condition:t.condition,key:t.key,value:i?t.value.split(","):t.value,choiceList:n.choice,type:t.type,multiSelect:i,betweenList:a})}}))})),this.conditionType=this.formInfo.show_conditions.type):(this.listInfo=[{condition:"",key:"",value:"",choiceList:"",type:"STRING",multiSelect:!1,betweenList:this.checkBetweenList("STRING")}],this.conditionType="and"),this.fieldList=[],this.frontNodesList.forEach((function(t){t.key===e.formInfo.key||["CUSTOMTABLE","FILE","RICHTEXT","TABLE","DATETIMERANGE","MEMBERS"].some((function(e){return e===t.type}))||e.fieldList.push(t)})),this.fieldList.forEach((function(t){"RPC"===t.source_type&&e.getRpcData(t)})),this.isNecessaryToWatch({fields:this.fieldList},"workflow")},getRpcData:function(e){var t=this;this.$store.dispatch("apiRemote/getRpcData",e).then((function(t){e.choice=t.data})).catch((function(e){(0,a.errorHandler)(e,t)}))},checkBetweenList:function(e){return["MULTISELECT","CHECKBOX","MEMBERS","TREESELECT"].some((function(t){return t===e}))?this.globalChoise.methods.filter((function(e){return"issuperset"===e.typeName||"notissuperset"===e.typeName})):["DATE","DATETIME","DATETIMERANGE","INT"].some((function(t){return t===e}))?this.globalChoise.methods.filter((function(e){return"issuperset"!==e.typeName&&"notissuperset"!==e.typeName})):this.globalChoise.methods.filter((function(e){return"=="===e.typeName||"!="===e.typeName}))},clearCondition:function(){this.listInfo=[{condition:"",key:"",value:"",choiceList:"",type:"STRING",multiSelect:!1,betweenList:this.checkBetweenList("STRING")}]},changeName:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=this.fieldList.filter((function(e){return e.key===t[0]}))[0],a="MULTISELECT"===i.type||"CHECKBOX"===i.type||"MEMBERS"===i.type||"TREESELECT"===i.type,r=this.checkBetweenList(i.type);t[2].type=i.type,t[2].value=a?[]:"",t[2].betweenList=r,t[2].condition="","SELECT"===i.type||"MULTISELECT"===i.type||"RADIO"===i.type||"CHECKBOX"===i.type||"MEMBERS"===i.type||"TREESELECT"===i.type?(t[2].choiceList=[],i.choice.forEach((function(e){t[2].choiceList.push({key:e.key,name:e.name})})),t[2].multiSelect=a):t[2].choiceList=""},addNode:function(e,t){var n={condition:"",key:"",value:"",choiceList:"",type:"STRING",multiSelect:!1,betweenList:this.checkBetweenList("STRING")};this.listInfo.splice(t+1,0,n)},deleteNode:function(e,t){1!==this.listInfo.length&&this.listInfo.splice(t,1)},checkList:function(){return this.checkStatus=this.listInfo.some((function(e){return!(e.key&&e.condition&&(Array.isArray(e.value)?e.value.length:e.value))})),this.checkStatus}}}},WSG0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("oCYn")),a=r(n("C65D"));function r(e){return e&&e.__esModule?e:{default:e}}var o=i.default.extend(a.default);t.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{title:"title",formData:[],context:{schemes:{}}},t=new o({el:document.createElement("div"),propsData:{isShow:!1,title:e.title,formData:e.formData,context:e.context},data:{isShow:!1}});t.viewmodel=t.$mount();var n=document.body;return n.appendChild(t.viewmodel.$el),t.isShow=!0,t.$on("update:isShow",(function(e){e||(t.isShow=!1)})),t.viewmodel}},WenH:function(e,t,n){},Wew5:function(e,t,n){},WgRI:function(e,t,n){"use strict";n.r(t);var i=n("UA1S"),a=n("5R1Y");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("h4G3");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"85db1284",null);t.default=s.exports},Wl5c:function(e,t,n){"use strict";n.r(t);var i=n("lpJK"),a=n("b0Dy");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},WzOL:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("QbLZ")),a=s(n("u8Ap")),r=n("L2JU"),o=n("CeR/");function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"triggerFields",components:{memberSelect:a.default},props:{item:{type:Object,default:function(){return{}}}},data:function(){return{keyList:[]}},computed:(0,i.default)({globalChoise:function(){return this.$store.state.common.configurInfo}},(0,r.mapState)("trigger",{triggerVariables:function(e){return e.triggerVariables}})),watch:{triggerVariables:function(e){this.keyList=e}},created:function(){this.item.value&&(this.keyList=this.triggerVariables,this.getConditionList())},methods:{getConditionList:function(){var e=this,t=this.keyList.filter((function(t){return t.key===e.item.key}))[0];["SELECT","RADIO","MULTISELECT","CHECKBOX"].some((function(e){return e===t.type}))&&(this.$set(this.item,"loading",!0),this.$set(this.item,"options",[]),"DATADICT"===t.source_type?this.$store.dispatch("datadict/get_data_by_key",{key:t.source_uri,field_key:t.key}).then((function(t){e.item.options=t.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.item.loading=!1})):"API"===t.source_type?this.$store.dispatch("apiRemote/get_data_workflow",{kv_relation:t.kv_relation,api_instance_id:t.api_instance_id}).then((function(t){e.item.options=t.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.item.loading=!1})):"RPC"===t.source_type?this.$store.dispatch("apiRemote/getRpcData",{meta:t.meta,source_uri:t.source_uri}).then((function(t){e.item.options=t.data.map((function(e){return{key:e.key,name:e.name}}))})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.item.loading=!1})):(this.item.options=t.choice.map((function(e){return{key:e.key,name:e.name}})),this.item.loading=!1))}}}},X13e:function(e,t,n){},XClk:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"view-item"},[e.crumbsList.length>1?t("div",{staticClass:"bread-crumbs"},e._l(e.crumbsList,(function(n,i){return t("span",{key:i,staticClass:"crumbs-item",on:{click:function(t){return t.stopPropagation(),e.onCrumbsClick(i)}}},[e._v("\n      "+e._s(n.label)+"\n    ")])})),0):e._e(),e._v(" "),e.crumbsList.length<=1?t(e.componentType,e._b({tag:"component",attrs:{form:e.form}},"component",e.getAttrs(e.form),!1)):t("render-view",{ref:"childrenView",attrs:{"hidden-label":!0,"form-data":e.childrenViewConfig.form_data,context:e.getContext()}})],1)},a=[];i._withStripped=!0},XDfz:function(e,t,n){"use strict";n.r(t);var i=n("LexG"),a=n("c6BP");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("L2Eo");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"7a97f3de",null);t.default=s.exports},XEYe:function(e,t,n){"use strict";n("alFg")},XUL0:function(e,t,n){"use strict";n.r(t);var i=n("kSST"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},XiH4:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-date-picker",{class:{"bk-border-error":e.item.checkValue},attrs:{type:"datetime",disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,placeholder:e.$t("m.newCommon['选择日期时间']")},on:{"open-change":function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},"Y6/M":function(e,t,n){"use strict";n.r(t);var i=n("vlfB"),a=n("CjxG");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("3Xpq");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"23a8f17e",null);t.default=s.exports},Y9oG:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("gDS+")),a=l(n("14Xm")),r=l(n("D3Ub")),o=l(n("OE89")),s=l(n("efIh")),c=n("CeR/");function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"TREESELECT",components:{exportTree:o.default},mixins:[s.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,required:!0,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{options:[],treeSlectInfo:{show:!1,treeDataList:[],info:{}}}},computed:{},watch:{"item.val":function(){var e=this;this.treeSlectInfo.treeDataList.forEach((function(t){e.treeData(t)})),this.conditionField(this.item,this.fields)}},mounted:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.$nextTick((function(){e.getTreeInfo(),e.conditionField(e.item,e.fields)}));case 1:case"end":return t.stop()}}),t,e)})))()},methods:{getTreeInfo:function(){var e=this,t={},n="";"RPC"===this.item.source_type?(n="apiRemote/getRpcData",t={source_uri:this.item.source_uri}):"DATADICT"===this.item.source_type&&(n="dictdata/getTreeInfo",t={key:this.item.source_uri,view_type:"tree"}),this.$store.dispatch(n,t).then((function(t){e.treeSlectInfo.treeDataList=t.data,e.item.choice=t.data,e.treeSlectInfo.treeDataList.forEach((function(t){e.treeData(t)}))})).catch((function(t){(0,c.errorHandler)(t,e)}))},showTree:function(){var e=this;if(!this.disabled){this.item.checkValue=!1,this.treeSlectInfo.show=!this.treeSlectInfo.show;var t="";this.fields.forEach((function(n,i){n.id===e.item.id&&(t=i)})),t===this.fields.length-1&&document.getElementById("bkPreview")&&setTimeout((function(){document.getElementById("bkPreview").scrollTop+=100}),100)}},closeTree:function(){this.treeSlectInfo.show=!1},toggleInfo:function(e){var t=this;this.treeSlectInfo.treeDataList.forEach((function(e){t.recordCheckFn(e)})),e.checkInfo=!0,this.treeSlectInfo.treeDataList=JSON.parse((0,i.default)(this.treeSlectInfo.treeDataList)),this.treeSlectInfo.info=e,this.item.val=this.treeSlectInfo.info.id,this.closeTree()},treeData:function(e){var t=this;if(e.showChildren=!1,e.checkInfo=!1,e.has_children=!!e.children.length,String(this.item.val)===String(e.id)){e.checkInfo=!0,this.treeSlectInfo.info=e;var n=[];this.treeSlectInfo.info.route&&this.treeSlectInfo.info.route.length&&this.treeSlectInfo.info.route.forEach((function(e){n.push(e.name)})),n.push(this.treeSlectInfo.info.name),this.treeSlectInfo.info.showName=n.join(" / ")}e.has_children&&e.children.length&&e.children.forEach((function(n){n.parent_id===e.id&&(e.showChildren=!0),t.treeData(n)}))},recordCheckFn:function(e){var t=this;e.checkInfo=!1,e.children&&e.children.length&&e.children.forEach((function(e){t.recordCheckFn(e)}))},toggleChildren:function(e){e.showChildren=!e.showChildren,this.treeSlectInfo.treeDataList=JSON.parse((0,i.default)(this.treeSlectInfo.treeDataList))}}}},YWQd:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{staticClass:"bk-form-int",attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-input",{class:{"bk-border-error":e.item.checkValue},attrs:{clearable:!0,type:"number",disabled:e.item.is_readonly&&!e.isCurrent||e.disabled},on:{focus:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",e._n(t))},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):e.isErrMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["已超出最大值!"]')))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},"Z/e7":function(e,t,n){},ZBhg:function(e,t,n){"use strict";n("dqgt")},ZSwf:function(e,t,n){},"Za/z":function(e,t,n){"use strict";n.r(t);var i=n("YWQd"),a=n("34/K");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},ZbRn:function(e,t,n){},ZcAa:function(e,t,n){},Zi5M:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-basic-node"},[t("basic-card",{attrs:{"card-label":e.$t("m.treeinfo['基本信息']")}},[t("bk-form",{ref:"nodeInfoForm",attrs:{"label-width":150,model:e.formInfo,rules:e.nodeInfoRule}},[t("bk-form-item",{attrs:{"data-test-id":"signNode-input-name",label:e.$t("m.treeinfo['节点名称：']"),required:!0,property:"name","ext-cls":"bk-form-width"}},[t("bk-input",{attrs:{maxlength:"120"},model:{value:e.formInfo.name,callback:function(t){e.$set(e.formInfo,"name",t)},expression:"formInfo.name"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['处理方式：']"),required:!0,property:"nodeType"}},[t("bk-radio-group",{model:{value:e.formInfo.is_sequential,callback:function(t){e.$set(e.formInfo,"is_sequential",t)},expression:"formInfo.is_sequential"}},[t("bk-radio",{attrs:{value:!1,"ext-cls":"mr50 pr40"}},[e._v(e._s(e.$t("m.treeinfo['多人随机会签']"))+"\n            "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("m.treeinfo['要求所有处理人全部处理完成，多人处理没有先后顺序要求。']"),expression:"$t(`m.treeinfo['要求所有处理人全部处理完成，多人处理没有先后顺序要求。']`)"}],staticClass:"bk-itsm-icon icon-icon-info tooltip-icon"})]),e._v(" "),t("bk-radio",{attrs:{value:!0}},[e._v(e._s(e.$t("m.treeinfo['多人依次会签']"))+"\n            "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("m.treeinfo['要求所有处理人按照名单顺序，依次全部处理完成。']"),expression:"$t(`m.treeinfo['要求所有处理人按照名单顺序，依次全部处理完成。']`)"}],staticClass:"bk-itsm-icon icon-icon-info tooltip-icon"})])],1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"signNode-radio-processors ",label:e.$t("m.treeinfo['处理人：']"),required:!0,property:"processors","ext-cls":"bk-processor-width form-cus-height"}},[t("member-select",{model:{value:e.formInfo.processors,callback:function(t){e.$set(e.formInfo,"processors",t)},expression:"formInfo.processors"}}),e._v(" "),e.formInfo.processors.length?t("p",{staticClass:"bk-processor-length"},[e._v(e._s(e.$t("m.treeinfo['共']"))),t("span",[e._v(e._s(e.formInfo.processors.length))]),e._v(e._s(e.formInfo.is_sequential?e.$t("m.treeinfo['人']")+e.$t("m.treeinfo['，名单顺序将会影响会签顺序']"):e.$t("m.treeinfo['人']")))]):e._e()],1)],1)],1),e._v(" "),t("basic-card",{staticClass:"mt20",attrs:{"card-label":e.$t("m.treeinfo['字段配置']")}},[t("field-config",{ref:"field",attrs:{"flow-info":e.flowInfo,configur:e.configur}})],1),e._v(" "),t("basic-card",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.getConditionFlag},expression:"{ isLoading: getConditionFlag }"}],staticClass:"mt20",attrs:{"card-label":e.$t("m.treeinfo['会签提前结束配置']"),"card-desc":e.$t("m.treeinfo['默认结束条件：所有处理人处理完成，会签自动结束；若配置了会签提前结束条件，满足条件，将提前结束']")}},[t("div",{staticClass:"bk-condition-content"},[e._l(e.finishCondition.expressions,(function(n,i){return t("div",{key:i,staticClass:"bk-condition-group"},[t("p",{staticClass:"bk-group-title"},[e._v(e._s(e.$t("m.treeinfo['或-条件组']"))+e._s(i+1))]),e._v(" "),t("div",{class:{"bk-group-content":!0,"bk-group-contents":n.expressions.length>1}},e._l(n.expressions,(function(a,r){return t("bk-form",{key:r,ref:"finishConditionForms",refInFor:!0,attrs:{"label-width":0,rules:e.finishConditionRule,model:a,"form-type":"inline","ext-cls":"bk-condition"}},[t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus",property:"key"}},[n.expressions.length>1?t("div",{staticClass:"bk-left-block"},[t("span",{class:{"left-top-default":!0,"no-left-border":0===r}}),e._v(" "),t("span",{class:{"left-bottom-default":!0,"no-left-border":r===n.expressions.length-1}}),e._v(" "),r!==n.expressions.length-1?t("span",{staticClass:"bk-left-letter"},[e._v(e._s(e.$t("m.common['且']")))]):e._e()]):e._e(),e._v(" "),t("bk-select",{attrs:{"font-size":"medium",clearable:!1,"ext-cls":"bk-form-width-long"},on:{selected:function(t){return e.selectCondition(t,a,r,i)}},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"expression.key"}},e._l(e.allCondition,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus"}},[t("bk-select",{attrs:{"font-size":"medium",clearable:!1,"ext-cls":"bk-form-width-short"},model:{value:a.condition,callback:function(t){e.$set(a,"condition",t)},expression:"expression.condition"}},e._l(e.betweenList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"signNode-input-conditionValue","ext-cls":"bk-form-item-cus",property:"value"}},[t("bk-input",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:a.tooltipInfo,expression:"expression.tooltipInfo"}],attrs:{"ext-cls":"bk-form-width-long",disabled:!e.formInfo.processors.length&&"INT"===a.meta.unit||!a.key,clearable:!1,type:"number",max:"INT"===a.meta.unit?e.formInfo.processors.length:100,min:0,precision:0},on:{change:function(t){return e.giveTooltip(a)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"expression.value"}}),e._v(" "),"PERCENT"===a.meta.unit?t("span",{staticClass:"buttonIcon"},[e._v("%")]):e._e()],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus"}},[t("div",{staticClass:"bk-operate-expression"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add mr10",on:{click:function(t){return e.operateExpression(n)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce mr10",class:{"bk-itsm-icon-disable":1===n.expressions.length},on:{click:function(t){return e.operateExpression(n,"del",r,i,a)}}})])]),e._v(" "),t("i",{staticClass:"bk-icon icon-close bk-delete-group",on:{click:function(t){return e.operateGroup("del",i)}}})],1)})),1)])})),e._v(" "),t("p",{staticClass:"bk-add-group",on:{click:e.operateGroup}},[t("i",{staticClass:"bk-itsm-icon icon-add-new mr5"}),e._v("\n        "+e._s(e.$t("m.treeinfo['添加“或”条件组']")))])],2)]),e._v(" "),t("common-trigger-list",{attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"bk-node-btn"},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"signNode-button-submit",title:e.$t("m.treeinfo['确定']"),loading:e.secondClick},on:{click:e.submitNode}},[e._v("\n      "+e._s(e.$t("m.treeinfo['确定']"))+"\n    ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"signNode-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n      "+e._s(e.$t("m.treeinfo['取消']"))+"\n    ")])],1)],1)},a=[];i._withStripped=!0},Zicn:function(e,t,n){},ZsJz:function(e,t,n){"use strict";n.r(t);var i=n("H2GU"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},a6LX:function(e,t,n){"use strict";n.r(t);var i=n("ni6I"),a=n("1fnQ");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("1lIc");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"61e4873a",null);t.default=s.exports},aDD8:function(e,t,n){"use strict";n.r(t);var i=n("PAo4"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},aNPh:function(e,t,n){"use strict";n.r(t);var i=n("x9y/"),a=n("BFl6");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("lVyC");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"85bababe",null);t.default=s.exports},aQoq:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=b(n("P2sY")),a=b(n("m1cH")),r=b(n("14Xm")),o=b(n("gDS+")),s=b(n("D3Ub")),c=b(n("vUrO")),l=b(n("NGZu")),u=b(n("c6Q5")),d=b(n("uK6t")),f=b(n("1Eew")),p=b(n("rMih")),m=b(n("VflG")),h=b(n("bcjM")),v=b(n("PIEm")),g=b(n("s4tT")),y=n("CeR/");function b(e){return e&&e.__esModule?e:{default:e}}t.default={name:"autoNode",components:{getParam:l.default,postParam:u.default,responseDataNode:d.default,nodeCondition:f.default,addField:p.default,commonTriggerList:h.default,dealPerson:v.default,BasicCard:g.default,descInfo:c.default},mixins:[m.default],props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}},state:{type:[String,Number],default:function(){return""}}},data:function(){return{isLoading:!0,lineInfo:{template:"",condition_type:"",name:"",checkName:!1,between:"and",expressions:[{type:"and",expressions:[{condition:"",key:"",name:"",value:"",choiceList:"",type:"string",organization:{assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:!1}}]}]},formInfo:{workflow:"",name:"",desc:"",type:"TASK",api_info:{remote_system_id:"",remote_api_id:"",req_params:{},req_body:{},rsp_data:"data.info,data.result",need_poll:!1,succeed_conditions:{expressions:[],type:"and"},end_conditions:{poll_interval:1,poll_time:3}},variables:{inputs:[],outputs:[]},processors_type:"",processors:""},processorsInfo:{type:"",value:""},checkStatus:{processors:!1},organizaInfo:{processorsShow:!1,assignorShow:!1},fieldList:[],excludeRoleTypeList:[],apiDetail:{},apiList:[],apiSysList:[],secondClick:!1,stateList:[],sliderInfo:{title:this.$t('m.treeinfo["添加变量"]'),show:!1,width:700},showTabData:{},changeInfo:{workflow:"",id:"",key:"",name:"",type:"STRING",desc:"",layout:"COL_12",validate_type:"REQUIRE",choice:[],is_builtin:!1,source_type:"CUSTOM",source_uri:"",regex:"EMPTY",custom_regex:"",is_tips:!1,tips:""}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return(0,s.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.configur;case 2:return t.next=4,e.flowInfo;case 4:return e.formInfo.name=e.configur.name,e.formInfo.desc=e.configur.desc,e.getRelatedFields(),e.getExcludeRoleTypeList(),e.configur.processors_type&&(e.formInfo.processors_type=e.configur.processors_type,e.formInfo.processors="PERSON"===e.formInfo.processors_type?e.configur.processors.split(","):e.configur.processors),e.processorsInfo={type:e.configur.processors_type,value:e.configur.processors},e.configur.api_info&&(e.formInfo.api_info=JSON.parse((0,o.default)(e.configur.api_info))),t.next=13,e.getRemoteSystemData();case 13:return t.next=15,e.getApiTableList(e.formInfo.api_info.remote_system_id);case 15:case"end":return t.stop()}}),t,e)})))()},getExcludeRoleTypeList:function(){var e=[];e=this.configur.is_builtin?["BY_ASSIGNOR","STARTER","VARIABLE"]:["OPEN"],"DISTRIBUTE_THEN_PROCESS"!==this.configur.distribute_type&&"DISTRIBUTE_THEN_CLAIM"!==this.configur.distribute_type&&e.push("BY_ASSIGNOR"),this.flowInfo.is_biz_needed||e.push("CMDB"),this.excludeRoleTypeList=["EMPTY","API"].concat((0,a.default)(e))},submitNode:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n,i,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.apiFz();case 2:if(t.sent){t.next=5;break}return t.abrupt("return");case 5:if(e.checkLineInfo()){t.next=7;break}return t.abrupt("return");case 7:if(e.formInfo.workflow=e.flowInfo.id,(n=JSON.parse((0,o.default)(e.formInfo))).is_draft=!1,n.processors_type="",n.processors="",n.desc=e.formInfo.desc||void 0,!e.$refs.processors||e.$refs.processors.verifyValue()){t.next=16;break}return e.checkStatus.processors=!0,t.abrupt("return");case 16:if(e.$refs.processors&&(i=e.$refs.processors.getValue(),n.processors_type=i.type,n.processors=i.value),a=e.configur.id,!e.secondClick){t.next=20;break}return t.abrupt("return");case 20:e.secondClick=!0,e.$store.dispatch("deployCommon/updateNode",{params:n,id:a}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$emit("closeConfigur",!0)}),(function(t){(0,y.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}));case 22:case"end":return t.stop()}}),t,e)})))()},getRelatedFields:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={workflow:e.flowInfo.id,state:e.configur.id,field:""},t.next=3,e.$store.dispatch("apiRemote/get_related_fields",n).then((function(t){e.stateList=t.data})).catch((function(t){(0,y.errorHandler)(t,e)}));case 3:case"end":return t.stop()}}),t,e)})))()},closeNode:function(){this.$emit("closeConfigur",!1)},closeShade:function(){this.sliderInfo.show=!1},getRemoteSystemData:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={project_key:e.$store.state.project.id},t.next=3,e.$store.dispatch("apiRemote/get_all_remote_system",n).then((function(t){e.apiSysList=t.data.filter((function(e){return e.is_activated}))})).catch((function(t){(0,y.errorHandler)(t,e)}));case 3:case"end":return t.stop()}}),t,e)})))()},getApiTableList:function(e){var t=this;return(0,s.default)(r.default.mark((function n(){var a;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a={remote_system:e||""},t.isLoading=!0,n.next=4,t.$store.dispatch("apiRemote/get_remote_api",a).then((function(e){t.apiList=e.data.filter((function(e){return e.is_activated})),t.configur.api_info&&(t.apiDetail=(0,i.default)({},t.apiList.filter((function(e){return e.id===t.configur.api_info.remote_api_id}))[0]))})).catch((function(e){(0,y.errorHandler)(e,t)})).finally((function(){t.isLoading=!1}));case 4:case"end":return n.stop()}}),n,t)})))()},changeMethod:function(e){var t=this;return(0,s.default)(r.default.mark((function n(){var a;return r.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t.lineInfo={template:"",condition_type:"",name:"",checkName:!1,between:"and",expressions:[{type:"and",expressions:[{condition:"",key:"",name:"",value:"",choiceList:"",type:"string",organization:{assignorPerson:[],assignorTree:{}},organizaInfo:{assignorShow:!1}}]}]},t.formInfo.variables={inputs:[],outputs:[]},t.formInfo.api_info.need_poll=!1,t.formInfo.api_info.succeed_conditions={expressions:[],type:"and"},t.formInfo.api_info.end_conditions={poll_interval:1,poll_time:3},t.configur.api_info&&t.configur.api_info.remote_api_id===e&&(t.formInfo.api_info=JSON.parse((0,o.default)(t.configur.api_info))),a=t.apiList.filter((function(t){return t.id===e}))[0],n.next=9,(0,i.default)({},a);case 9:t.apiDetail=n.sent;case 10:case"end":return n.stop()}}),n,t)})))()},changeCode:function(e){this.formInfo.api_info.remote_api_id="",this.formInfo.api_info.req_params={},this.formInfo.api_info.req_body={},this.formInfo.api_info.rsp_data="",this.getApiTableList(e)},checkLineInfo:function(){return!this.formInfo.api_info.need_poll||(this.lineInfo.expressions.forEach((function(e){e.checkInfo=e.expressions.some((function(e){return!e.condition.toString()||!e.key.toString()||!e.value.toString()}))})),this.lineInfo.expressions.some((function(e){return e.checkInfo}))?(this.$bkMessage({message:this.$t('m.treeinfo["请完善轮询配置！"]'),theme:"warning"}),!1):(this.formInfo.api_info.succeed_conditions={expressions:[],type:this.lineInfo.between},this.formInfo.api_info.succeed_conditions.expressions=this.lineInfo.expressions.map((function(e){var t={type:e.type,expressions:[]};return t.expressions=e.expressions.map((function(e){return{key:e.key.split(",").map((function(e){return e=e.replace(/^\d+\_/,"")})).join("."),condition:e.condition,value:"number"===e.type?Number(e.value):"boolean"===e.type?!!Number(e.value):e.value,type:e.type,source:"global",choiceList:[]}})),t})),this.formInfo.api_info.end_conditions.poll_interval.toString()&&this.formInfo.api_info.end_conditions.poll_time.toString()?(this.formInfo.api_info.end_conditions.poll_interval=Number(this.formInfo.api_info.end_conditions.poll_interval),this.formInfo.api_info.end_conditions.poll_time=Number(this.formInfo.api_info.end_conditions.poll_time),!0):(this.$bkMessage({message:this.$t('m.treeinfo["请完善轮询间隔、次数！"]'),theme:"warning"}),!1)))},apiFz:function(){var e=this;return(0,s.default)(r.default.mark((function t(){var n,i,a;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.formInfo.name){t.next=3;break}return e.$bkMessage({message:e.$t('m.treeinfo["请填写节点名称！"]'),theme:"warning"}),t.abrupt("return",!1);case 3:if(e.formInfo.api_info.remote_system_id&&e.formInfo.api_info.remote_api_id){t.next=6;break}return e.$bkMessage({message:e.$t('m.treeinfo["请选取接口！"]'),theme:"warning"}),t.abrupt("return",!1);case 6:if(!e.$refs.getParam){t.next=13;break}if((n=e.$refs.getParam.paramTableData.filter((function(e){return e.is_necessary}))).forEach((function(e){e.isCheck=!0,e.isSatisfied="CUSTOM"===e.source_type?!!e.value:!!e.value_key})),!n.filter((function(e){return!e.isSatisfied}))[0]){t.next=13;break}return e.$bkMessage({message:e.$t('m.treeinfo["请输入GET参数！"]'),theme:"warning"}),t.abrupt("return",!1);case 13:if(!e.$refs.postParam){t.next=21;break}if((i=e.$refs.postParam.bodyTableData.filter((function(e){return e.is_necessary&&"object"!==e.type&&"array"!==e.type}))).forEach((function(e){e.isCheck=!0,e.isSatisfied="CUSTOM"===e.source_type?e.value.toString():!!e.value_key})),!i.filter((function(e){return!e.isSatisfied}))[0]){t.next=21;break}return e.$refs.postParam.bodyTableData.forEach((function(e){e.showChildren=!0,e.isShow=!0})),e.$bkMessage({message:e.$t('m.treeinfo["请输入POST参数！"]'),theme:"warning"}),t.abrupt("return",!1);case 21:if(e.$refs.getParam){t.next=25;break}t.t0={},t.next=28;break;case 25:return t.next=27,e.listTojson(e.$refs.getParam.paramTableData);case 27:t.t0=t.sent;case 28:if(e.formInfo.api_info.req_params=t.t0,e.$refs.postParam){t.next=33;break}t.t1={},t.next=36;break;case 33:return t.next=35,e.treeToJson(e.$refs.postParam.bodyTableData.filter((function(e){return!e.level})));case 35:t.t1=t.sent;case 36:if(e.formInfo.api_info.req_body=t.t1,(a=e.$refs.responseDataNode?e.$refs.responseDataNode.responseTableData.filter((function(e){return e.isSelectedKey})):[]).length){t.next=40;break}return t.abrupt("return",!0);case 40:if(a.every((function(e){return!!e.isSelectedValue}))){t.next=45;break}return e.$refs.responseDataNode&&e.$refs.responseDataNode.responseTableData.forEach((function(e){e.showChildren=!0,e.isShow=!0})),e.$bkMessage({message:e.$t('m.treeinfo["勾选全局变量后，请提供变量名"]'),theme:"warning"}),a.forEach((function(e){e.isCheck=!0,e.isSatisfied=e.isSelectedValue})),t.abrupt("return",!1);case 45:return e.formInfo.variables.outputs=a.map((function(e){var t={name:"",ref_path:"",type:e.type,source:"global"};return t.name=JSON.parse((0,o.default)(e.isSelectedValue)),t.ref_path=e.ancestorsList_str.split(",").map((function(e){return e=e.replace(/^\d+\_/,"")})).join("."),t})),e.formInfo.api_info.rsp_data=e.formInfo.variables.outputs.map((function(e){return e.ref_path})).join(","),t.abrupt("return",!0);case 48:case"end":return t.stop()}}),t,e)})))()},listTojson:function(e){var t={};return e.length&&e.forEach((function(e){t[e.name]="CUSTOM"===e.source_type?e.value:"${params_"+e.value_key+"}"})),t},addNewItem:function(e){this.showTabData=e,this.sliderInfo.show=!0}}}},aRCN:function(e,t,n){},aYIO:function(e,t,n){"use strict";n.r(t);var i=n("LVBE"),a=n("sshH");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("WOBF");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"aad0502a",null);t.default=s.exports},afA4:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-get-param"},[t("bk-table",{attrs:{data:e.prcTable,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['名称']"),prop:"name"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['必选']")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.is_necessary?e.$t('m.treeinfo["是"]'):e.$t('m.treeinfo["否"]'))+"\n      ")]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['备注']"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",{attrs:{title:n.row.desc}},[e._v(e._s(n.row.desc||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticStyle:{width:"120px",position:"absolute",top:"5px",left:"15px"}},[t("bk-select",{attrs:{clearable:!1,searchable:""},model:{value:n.row.source_type,callback:function(t){e.$set(n.row,"source_type",t)},expression:"props.row.source_type"}},e._l(e.sourceTypeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),"CUSTOM"===n.row.source_type?t("div",{staticStyle:{width:"140px",position:"absolute",top:"4px",right:"15px"}},[t("bk-input",{attrs:{clearable:!0,placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}})],1):t("div",{staticStyle:{width:"140px",position:"absolute",top:"4px",right:"15px"}},[t("bk-select",{attrs:{clearable:!1,searchable:""},model:{value:n.row.value_key,callback:function(t){e.$set(n.row,"value_key",t)},expression:"props.row.value_key"}},e._l(e.stateList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)]}}])})],1)],1)},a=[];i._withStripped=!0},agSa:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",[t("bk-table",{attrs:{data:e.list,disabled:!0}},[t("bk-table-column",{attrs:{width:"40"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-checkbox",{attrs:{disabled:e.disable},model:{value:n.row.select,callback:function(t){e.$set(n.row,"select",t)},expression:"props.row.select"}})]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['字段名']"),"render-header":e.$renderHeader},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable},on:{change:function(t){return e.changeInput(n.row,n.$index)}},model:{value:n.row.key,callback:function(t){e.$set(n.row,"key",t)},expression:"props.row.key"}})]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['值']"),"render-header":e.$renderHeader},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{staticStyle:{"z-index":"101"},attrs:{behavior:"simplicity",disabled:e.disable,placeholder:e.isStatus?e.$t("m['输入“{{”可选择引用变量']"):e.$t("m['请输入']")},on:{change:function(t){return e.changeInput(n.row,n.$index)}},model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}}),e._v(" "),e.isStatus?t("bk-popover",{ref:"inputParam"+n.$index,attrs:{placement:"bottom",theme:"light",arrow:!1,always:!n.row.value,disabled:!n.row.value,"ext-cls":n.row.value?"show-tippy":"",transfer:!0}},[t("div",{staticClass:"params-select-value",attrs:{slot:"content"},slot:"content"},[t("ul",{staticClass:"params-select"},e._l(e.wwwFormData,(function(n,i){return t("li",{key:i,on:{click:function(t){return e.handleSelectContent(n)}}},[e._v("\n                "+e._s(n.name)+"\n                "),t("span",{staticClass:"variable-key"},[e._v("("+e._s(n.key)+")")])])})),0)])]):e._e()]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['描述']"),"render-header":e.$renderHeader},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable},on:{change:function(t){return e.changeInput(n.row,n.$index)}},model:{value:n.row.desc,callback:function(t){e.$set(n.row,"desc",t)},expression:"props.row.desc"}})]}}])}),e._v(" "),t("bk-table-column",{attrs:{width:"40"},scopedSlots:e._u([{key:"default",fn:function(n){return e.isShowDelete!==e.list.indexOf(n.row)?[e.disable?e._e():t("i",{staticClass:"bk-itsm-icon icon-itsm-icon-three-one",on:{click:function(t){return e.handleDelete(n.row)}}})]:void 0}}],null,!0)})],1)],1)},a=[];i._withStripped=!0},alFg:function(e,t,n){},an3D:function(e,t,n){},aqZ4:function(e,t,n){},"b/Aw":function(e,t,n){"use strict";n.r(t);var i=n("nuXq"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},b0Dy:function(e,t,n){"use strict";n.r(t);var i=n("SO4U"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"b1K/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(e,t,n,i,a){var r=sessionStorage.getItem("cursorIndex"),o=r&&JSON.parse(r);if(!e||!e.selectionStart&&0!==e.selectionStart||o.name!==t)return n+i;var s=o.start,c=o.end,l=e.scrollTop;return a.$nextTick((function(){e.selectionStart=s+i.length,e.selectionEnd=s+i.length,e.scrollTop=l,e.focus()})),n.substr(0,s)+i+n.substr(c)}},"bBb/":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-basic-node"},[t("basic-card",{attrs:{"card-label":e.$t("m.treeinfo['基本信息']")}},[t("bk-form",{ref:"nodeInfoForm",staticStyle:{"margin-bottom":"40px"},attrs:{"form-type":"vertical","label-width":150,model:e.formInfo,rules:e.nodeInfoRule}},[t("bk-form-item",{attrs:{"data-test-id":"approveNode-input-nodeName",label:e.$t("m.treeinfo['节点名称：']"),required:!0,property:"name","ext-cls":"bk-form-width"}},[t("bk-input",{attrs:{maxlength:"120"},model:{value:e.formInfo.name,callback:function(t){e.$set(e.formInfo,"name",t)},expression:"formInfo.name"}})],1),e._v(" "),t("desc-info",{model:{value:e.formInfo.desc,callback:function(t){e.$set(e.formInfo,"desc",t)},expression:"formInfo.desc"}}),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"approveNode-radio-approveMode",label:e.$t("m.treeinfo['审批方式：']"),required:!0,property:"nodeType"}},[t("bk-radio-group",{on:{change:e.handleChangeDispose},model:{value:e.processType,callback:function(t){e.processType=t},expression:"processType"}},[t("bk-radio",{attrs:{value:"multi","ext-cls":"mr20"}},[e._v(e._s(e.$t("m.treeinfo['或签']"))+"\n            "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("m.treeinfo['多个审批人当有一个审批人审批即可，该审批节点的审批结果为该审批人的审批结果']"),expression:"$t(`m.treeinfo['多个审批人当有一个审批人审批即可，该审批节点的审批结果为该审批人的审批结果']`)"}],staticClass:"bk-itsm-icon icon-icon-info tooltip-icon"})]),e._v(" "),t("bk-radio",{attrs:{value:"sequential","ext-cls":"mr20"}},[e._v(e._s(e.$t("m.treeinfo['顺序会签']"))+"\n            "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("m.treeinfo['所有审批人必须按照审批人列表的顺序依次审批，直到满足条件才会结束，当不设置提前结束条件时，需要所有的审批人按照顺序依次审批完该节点才会结束']"),expression:"$t(`m.treeinfo['所有审批人必须按照审批人列表的顺序依次审批，直到满足条件才会结束，当不设置提前结束条件时，需要所有的审批人按照顺序依次审批完该节点才会结束']`)"}],staticClass:"bk-itsm-icon icon-icon-info tooltip-icon"})]),e._v(" "),t("bk-radio",{attrs:{value:"random"}},[e._v(e._s(e.$t("m.treeinfo['随机会签']"))+"\n            "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("m.treeinfo['所有审批人都可以审批，没有顺序要求，直到满足条件才会结束，当不设置提前结束条件时，需要所有的审批人都审批完该节点才会结束']"),expression:"$t(`m.treeinfo['所有审批人都可以审批，没有顺序要求，直到满足条件才会结束，当不设置提前结束条件时，需要所有的审批人都审批完该节点才会结束']`)"}],staticClass:"bk-itsm-icon icon-icon-info tooltip-icon"})])],1),e._v(" "),e.isShowSignSwitch?[t("span",{staticClass:"bk-condtion-switch"},[e._v(e._s(e.$t("m.treeinfo['提前结束条件']")))]),e._v(" "),t("bk-switcher",{attrs:{"data-test-id":"approve-switcher-condtion",theme:"primary"},model:{value:e.isShowSignOptions,callback:function(t){e.isShowSignOptions=t},expression:"isShowSignOptions"}}),e._v(" "),t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.$t("m.treeinfo['若配置了会签提前结束条件，满足条件，将提前结束']"),expression:"$t(`m.treeinfo['若配置了会签提前结束条件，满足条件，将提前结束']`)"}],staticClass:"bk-itsm-icon icon-icon-info tooltip-icon"}),e._v(" "),e.isShowSignOptions?t("div",{staticClass:"bk-condition-content"},[e._l(e.finishCondition.expressions,(function(n,i){return t("div",{key:i,staticClass:"bk-condition-group"},[t("p",{staticClass:"bk-group-title"},[e._v(e._s(e.$t("m.treeinfo['或-条件组']"))+e._s(i+1))]),e._v(" "),t("div",{class:{"bk-group-content":!0,"bk-group-contents":n.expressions.length>1}},e._l(n.expressions,(function(a,r){return t("bk-form",{key:r,ref:"finishConditionForms",refInFor:!0,attrs:{"label-width":0,rules:e.finishConditionRule,model:a,"form-type":"inline","ext-cls":"bk-condition"}},[t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus",property:"key"}},[n.expressions.length>1?t("div",{staticClass:"bk-left-block"},[t("span",{class:{"left-top-default":!0,"no-left-border":0===r}}),e._v(" "),t("span",{class:{"left-bottom-default":!0,"no-left-border":r===n.expressions.length-1}}),e._v(" "),r!==n.expressions.length-1?t("span",{staticClass:"bk-left-letter"},[e._v(e._s(e.$t("m.common['且']")))]):e._e()]):e._e(),e._v(" "),t("bk-select",{attrs:{"data-test-id":"approve-select-condtionType","font-size":"medium",clearable:!1,"ext-cls":"bk-form-width-long"},on:{selected:function(t){return e.selectCondition(t,a,r,i)}},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"expression.key"}},e._l(e.allCondition,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus"}},[t("bk-select",{attrs:{"data-test-id":"approve-select-condtion","font-size":"medium",clearable:!1,"ext-cls":"bk-form-width-short"},model:{value:a.condition,callback:function(t){e.$set(a,"condition",t)},expression:"expression.condition"}},e._l(e.betweenList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus",property:"value"}},[t("bk-input",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:a.tooltipInfo,expression:"expression.tooltipInfo"}],attrs:{"data-test-id":"approve-condtion-value","ext-cls":"bk-form-width-long",disabled:!e.$refs.processors.getValue().value&&"INT"===a.meta.unit||!a.key,clearable:!1,type:"number",max:"INT"===a.meta.unit?e.formInfo.processors.length:100,min:0,precision:0},on:{change:function(t){return e.giveTooltip(a)}},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"expression.value"}}),e._v(" "),"PERCENT"===a.meta.unit?t("span",{staticClass:"buttonIcon"},[e._v("%")]):e._e()],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-form-item-cus"}},[t("div",{staticClass:"bk-operate-expression"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add mr10",on:{click:function(t){return e.operateExpression(n)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce mr10",class:{"bk-itsm-icon-disable":1===n.expressions.length},on:{click:function(t){return e.operateExpression(n,"del",r,i,a)}}})])]),e._v(" "),t("i",{staticClass:"bk-icon icon-close bk-delete-group",on:{click:function(t){return e.operateGroup("del",i)}}})],1)})),1)])})),e._v(" "),t("p",{staticClass:"bk-add-group",attrs:{"data-test-id":"approve-condtion-addGroup"},on:{click:e.operateGroup}},[t("i",{staticClass:"bk-itsm-icon icon-add-new mr5"}),e._v("\n              "+e._s(e.$t("m.treeinfo['添加“或”条件组']")))])],2):e._e()]:e._e()],2),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"approveNode-component-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{value:e.processorsInfo,"show-overbook":!0,"node-info":e.configur,"exclude-role-type-list":e.excludeProcessor}})],1)]),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"approveNode-input-ticketStatus",label:e.$t("m.treeinfo['设置单据状态：']"),required:!0,"ext-cls":"bk-form-width"}},[t("bk-select",{attrs:{"ext-cls":"inline-form-width",clearable:!1,searchable:"","font-size":"medium"},on:{selected:e.handleTicket},model:{value:e.formInfo.ticket_type,callback:function(t){e.$set(e.formInfo,"ticket_type",t)},expression:"formInfo.ticket_type"}},e._l(e.billStatusList,(function(e){return t("bk-option",{key:e.type,attrs:{id:e.type,name:e.name}})})),1),e._v(" "),"custom"===e.formInfo.ticket_type?[t("bk-select",{attrs:{"ext-cls":"inline-form-width mt10",loading:e.ticketKeyLoading,clearable:!1,searchable:"","font-size":"medium"},model:{value:e.formInfo.ticket_key,callback:function(t){e.$set(e.formInfo,"ticket_key",t)},expression:"formInfo.ticket_key"}},e._l(e.secondLevelList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e()],2),e._v(" "),e.configur.is_builtin?e._e():[t("bk-form-item",{attrs:{"data-test-id":"approveNode-radio-canDeliver",label:e.$t("m.treeinfo['是否可转单：']"),required:!0}},[t("bk-radio-group",{model:{value:e.formInfo.can_deliver,callback:function(t){e.$set(e.formInfo,"can_deliver",t)},expression:"formInfo.can_deliver"}},[t("bk-radio",{attrs:{value:!0,"ext-cls":"mr20"}},[e._v(e._s(e.$t('m.treeinfo["是"]')))]),e._v(" "),t("bk-radio",{attrs:{value:!1}},[e._v(e._s(e.$t('m.treeinfo["否"]')))])],1)],1)],e._v(" "),e.formInfo.can_deliver?[t("bk-form-item",{attrs:{"data-test-id":"approveNode-component-deliver",label:e.$t("m.treeinfo['转单人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.delivers=!1}}},[t("deal-person",{ref:"delivers",attrs:{value:e.deliversInfo,"exclude-role-type-list":e.deliversExclude}})],1)])]:e._e(),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['自动处理']"),required:!0}},[t("bk-checkbox",{attrs:{"true-value":!0,"false-value":!1},model:{value:e.formInfo.is_allow_skip,callback:function(t){e.$set(e.formInfo,"is_allow_skip",t)},expression:"formInfo.is_allow_skip"}},[e._v("\n          "+e._s(e.$t("m['节点处理人为空时，直接跳过且不视为异常']"))+"\n        ")])],1)],2),e._v(" "),t("field-config",{ref:"field",attrs:{"is-show-title":!0,"flow-info":e.flowInfo,configur:e.configur}}),e._v(" "),t("common-trigger-list",{attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"bk-node-btn"},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"approve-button-submit",title:e.$t("m.treeinfo['确定']"),loading:e.secondClick},on:{click:e.submitNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['确定']"))+"\n      ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"approve-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['取消']"))+"\n      ")])],1)],1)],1)},a=[];i._withStripped=!0},bIVE:function(e,t,n){"use strict";n.r(t);var i=n("Ieu/"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},bcjM:function(e,t,n){"use strict";n.r(t);var i=n("11RT"),a=n("ZsJz");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("r/L1");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"00c1c6e8",null);t.default=s.exports},bddw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("FQeJ")),a=n("ygAv"),r=n("CeR/");n("p77/"),n("9RMS"),n("/l/C"),n("LEOp");var o=l(n("v/C2")),s=l(n("FIf5")),c=n("Tt5C");function l(e){return e&&e.__esModule?e:{default:e}}n("9MOC");["javascript","java","python","shell","powershell","markdown"].forEach((function(e){s.default.registerLanguage(e,n("8gVO")("./"+e))})),t.default={name:"RichTextEditor",components:{FullScreen:i.default,Editor:c.Editor,viewer:c.Viewer},model:{prop:"value",event:"change"},props:{value:{type:String,default:""},options:{type:Object,default:function(){}},id:{type:[String,Number],required:!0},fullTitle:{type:String,default:""},isPreview:{type:Boolean,default:!1}},data:function(){return{isFull:!1,height:250,editorOptions:{viewer:!0,hideModeSwitch:!1,usageStatistics:!1,language:"zh-CN",plugins:[[o.default,{hljs:s.default}]]}}},watch:{value:function(e){var t=this.$refs.toastuiEditor&&this.$refs.toastuiEditor.editor;t&&t.setHtml(e,!0)}},mounted:function(){window.addEventListener("resize",this.handleScreenChange)},beforeDestroy:function(){window.removeEventListener("resize",this.handleScreenChange)},methods:{getHtml:function(){return this.$refs.toastuiEditor.invoke("getHtml")},onEditorLoad:function(){try{var e=this.$refs.toastuiEditor.getRootElement().querySelector(".te-mode-switch-section");e.classList.add("cus-change-mode"),e.querySelector(".te-switch-button.markdown").innerText=this.$t('m.common["Markdown模式"]'),e.querySelector(".te-switch-button.wysiwyg").innerText=this.$t('m.common["富文本模式"]')}catch(e){(0,r.errorHandler)(e)}},onEditorBlur:function(){var e=this.getHtml(),t=(0,a.appendTargetAttrToHtml)(e);this.$emit("change",t)},setHeight:function(e){this.height=e},getFullScreenContentHeight:function(){return document.body.clientHeight-50},handleScreenChange:function(){if(this.isFull){var e=this.getFullScreenContentHeight();this.setHeight(e)}},openFullScreen:function(){this.isFull=!0,this.handleScreenChange()},closeFullSreen:function(){this.isFull=!1,this.setHeight(250)}}}},c6BP:function(e,t,n){"use strict";n.r(t);var i=n("WP3n"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},c6Q5:function(e,t,n){"use strict";n.r(t);var i=n("wA6F"),a=n("qCK4");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("7LjQ");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"725441f0",null);t.default=s.exports},ciLR:function(e,t,n){"use strict";n.r(t);var i=n("xY5K"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},cydg:function(e,t,n){"use strict";n.r(t);var i=n("HQF7"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},d88Z:function(e,t,n){"use strict";n.r(t);var i=n("/xVU"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},dD0k:function(e,t,n){"use strict";n("hF++")},dGg1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CUSTOM_FORM_TEMPLATE={config:{mode:"sideslider"},schemes:{base_text_scheme:{type:"text",attrs:{styles:{label:["border"],value:["highlight","border"]},desc:"通用描述文字"}},table_text_scheme:{type:"text",attrs:{styles:{label:["border"],value:["highlight","border"]}}},base_table_scheme:{type:"table",attrs:{column:[{name:"操作",type:"text",key:"column1"},{name:"关联相关内容",key:"column2",scheme:"table_text_scheme",attrs:{}},{name:"申请期限",type:"text",key:"column3",attrs:{sort:!0}}]}},sub_table_scheme:{type:"table",attrs:{column:[{name:"关联内容-类型",key:"column1",scheme:"base_text_scheme"},{name:"类型值",key:"column2",scheme:"table_text_scheme"}]}},sub2_table_scheme:{type:"table",attrs:{column:[{name:"主机",key:"column1",scheme:"base_text_scheme"}]}}},form_data:[{label:"业务：",scheme:"base_text_scheme",value:"蓝鲸",desc:"覆盖 scheme 中通用描述文字",children:[{label:"子业务1：",scheme:"base_text_scheme",value:"test1"},{label:"子业务2：",scheme:"base_text_scheme",value:"test2"}]},{label:"提单人：",scheme:"base_text_scheme",value:""},{label:"提单时间：",scheme:"base_text_scheme",value:""}]}},dTVR:function(e,t,n){"use strict";n.r(t);var i=n("rGm2"),a=n("q+QX");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("LFVb");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"464c8891",null);t.default=s.exports},dU2m:function(e,t,n){"use strict";n.r(t);var i=n("0vGa"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},dV6M:function(e,t,n){"use strict";n.r(t);var i=n("MQva"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},db1v:function(e,t,n){"use strict";n.r(t);var i=n("30Fg"),a=n("hv+2");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("45Gy");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"7b188e93",null);t.default=s.exports},dbV7:function(e,t,n){var i=n("Y7ZC");i(i.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},djC9:function(e,t,n){"use strict";n("dxRU")},dm0o:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"ext-cls":"bk-line-height","desc-type":"icon"}},[t("bk-radio-group",{on:{change:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}},[e._l(e.item.choice,(function(n){return[t("bk-radio",{key:n.key,attrs:{disabled:e.disabled,value:n.key,"ext-cls":"mr20"}},[e._v(e._s(n.name))])]}))],2),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},dqgt:function(e,t,n){},dwEX:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-default-value"},["STRING"===e.formInfo.type?[t("bk-input",{attrs:{"ext-cls":"bk-half",clearable:!0,placeholder:e.$t("m.treeinfo['请输入']")},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})]:e._e(),e._v(" "),"TEXT"===e.formInfo.type?[t("div",{staticStyle:{height:"30px"}},[t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:e.formInfo.default_value,expression:"formInfo.default_value",modifiers:{trim:!0}}],staticClass:"bk-form-textarea bk-textarea-tanble",staticStyle:{width:"49%"},attrs:{rows:"8",placeholder:e.$t("m.treeinfo['请输入']")},domProps:{value:e.formInfo.default_value},on:{input:function(t){t.target.composing||e.$set(e.formInfo,"default_value",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}})])]:e._e(),e._v(" "),"RICHTEXT"===e.formInfo.type?[t("div",[t("rich-text-editor",{attrs:{id:"default-rich-text-editor","full-title":e.label},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1)]:e._e(),e._v(" "),"MULTISELECT"===e.formInfo.type||"CHECKBOX"===e.formInfo.type||"SELECT"===e.formInfo.type||"RADIO"===e.formInfo.type||"INPUTSELECT"===e.formInfo.type?["API"===e.formInfo.source_type||"RPC"===e.formInfo.source_type?[t("bk-input",{attrs:{"ext-cls":"bk-half",clearable:!0,placeholder:e.$t("m.treeinfo['请输入']")},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})]:[t("bk-select",{attrs:{"ext-cls":"bk-half",multiple:"MULTISELECT"===e.formInfo.type||"CHECKBOX"===e.formInfo.type,searchable:""},on:{toggle:e.getSelectList},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}},e._l(e.selectList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]]:e._e(),e._v(" "),"INT"===e.formInfo.type?[t("div",{staticClass:"bk-half"},[t("bk-input",{attrs:{clearable:!0,type:"number",precision:e.precision},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1)]:e._e(),e._v(" "),"DATE"===e.formInfo.type?[t("div",{staticClass:"bk-half"},[t("bk-date-picker",{attrs:{placeholder:e.$t("m.newCommon['选择日期']")},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1)]:e._e(),e._v(" "),"DATETIME"===e.formInfo.type?[t("div",{staticClass:"bk-half"},[t("bk-date-picker",{attrs:{type:"datetime",placeholder:e.$t("m.newCommon['选择日期时间']")},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1)]:e._e(),e._v(" "),"MEMBER"===e.formInfo.type?[t("div",{staticStyle:{width:"49%"}},[t("member-select",{attrs:{multiple:!1},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1)]:e._e(),e._v(" "),"MEMBERS"===e.formInfo.type?[t("div",{staticStyle:{width:"49%"}},[t("member-select",{model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1)]:e._e(),e._v(" "),"CUSTOM-FORM"===e.formInfo.type?[t("div",{staticClass:"editor-wrap"},[t("div",{staticClass:"editor-btn-group"},[t("router-link",{staticClass:"opt-item",attrs:{target:"_blank",to:{name:"CustomFormTest"}}},[e._v(e._s(e.$t("m.common['查看模板']")))]),e._v(" "),t("span",{staticClass:"opt-item",on:{click:e.downCustomFormTempalte}},[e._v("\n          "+e._s(e.$t("m.common['下载模板']")))])],1),e._v(" "),t("code-editor",{attrs:{options:{language:"json"}},model:{value:e.formInfo.default_value,callback:function(t){e.$set(e.formInfo,"default_value",t)},expression:"formInfo.default_value"}})],1),e._v(" "),e.checkStatus.customFormStatus?t("p",{staticClass:"bk-field-error"},[e._v("\n      "+e._s(e.$t("m.treeinfo['格式错误！（JSON 语法错误或者根元素缺少 schemes 和 form_data 属性）']"))+"\n    ")]):e._e()]:e._e()],2)},a=[];i._withStripped=!0},dwwr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("CeR/");t.default={name:"inheritState",props:{workflow:{type:[String,Number],default:function(){return""}},state:{type:[String,Number],default:function(){return""}},showTabList:{type:Array,default:function(){return[]}},configur:{type:Object,default:function(){return{}}}},data:function(){return{isDataLoading:!1,trueStatus:!0,falseStatus:!1,dataList:[],checkList:[]}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},mounted:function(){this.getTicketTables()},methods:{getTicketTables:function(){var e=this,t=this.workflow;this.isDataLoading=!0,this.$store.dispatch("basicModule/get_ticket_tables",{params:{},id:t}).then((function(t){e.dataList=t.data.fields,e.dataList.forEach((function(t){e.globalChoise.field_type.forEach((function(n){t.type===n.typeName&&e.$set(t,"typeName",n.name)})),e.$set(t,"is_readonly",!1),e.$set(t,"is_disabled",!1),e.showTabList.forEach((function(e){t.key===e.key&&(t.is_readonly=e.is_readonly,t.is_disabled=!0)})),"priority"===t.key&&(t.is_readonly=!0)})),e.configur.is_first_state&&(e.dataList=e.dataList.filter((function(e){return"current_status"!==e.key}))),e.$nextTick((function(){e.dataList.forEach((function(t){t.is_disabled&&e.$refs.table.toggleRowSelection(t,!0)}))}))})).catch((function(t){(0,i.errorHandler)(t,e)})).finally((function(){e.isDataLoading=!1}))},handleSelectAll:function(e){this.checkList=e},handleSelect:function(e){this.checkList=e},disabledFn:function(e){return!this.showTabList.some((function(t){return t.key===e.key}))}}}},dxRU:function(e,t,n){},"e+8O":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("ul",{staticClass:"child-node"},[e.treeDataList.length?e._l(e.treeDataList,(function(n,i){return t("li",{key:i,staticClass:"vue-tree-item"},[!e.isKeyValue&&n.children&&n.children.length||e.isKeyValue?t("div",{class:["tree-node",{down:n.showChildren,"set-frist-pLeft":e.treeIndex+1===1,active:n.checkInfo}],style:e.pLeft,on:{click:function(t){return t.stopPropagation(),e.toggle(n)}}},[n.showChildren||"object"!==n.type?e._e():t("i",{staticClass:"bk-icon icon-right-shape",class:{"bk-padding":!n.has_children},on:{click:function(t){return t.stopPropagation(),e.toggleChildren(n)}}}),e._v(" "),n.showChildren&&"object"===n.type?t("i",{staticClass:"bk-icon icon-down-shape",class:{"bk-padding":!n.has_children},on:{click:function(t){return t.stopPropagation(),e.toggleChildren(n)}}}):e._e(),e._v(" "),t("i",{staticClass:"bk-icon icon-folder-open-shape"}),e._v(" "),t("span",{staticClass:"name-text",attrs:{title:n.name}},[e._v(e._s(n.name))]),e._v(" "),n.checkInfo?t("i",{staticClass:"bk-icon icon-check-1",staticStyle:{float:"right","margin-top":"11px"}}):e._e()]):e._e(),e._v(" "),t("collapse-transition",["object"===n.type&&n.showChildren&&n.children?[t("exportTree",{attrs:{"tree-data-list":n.children,"tree-index":e.treeIndex+1,"is-key-value":e.isKeyValue},on:{selectItem:e.selectItem,toggle:e.toggle,toggleChildren:e.toggleChildren}})]:e._e()],2)],1)})):[e.isKeyValue?e._e():t("li",{staticClass:"vue-tree-item"},[t("div",{staticClass:"tree-node set-frist-pLeft"},[t("span",{staticClass:"name-text"},[e._v(e._s(e.$t('m.deployPage["暂无数据"]')))])])])]],2)},a=[];i._withStripped=!0},e07s:function(e,t,n){"use strict";n("gHwO")},e42N:function(e,t,n){},"eDZ/":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"service-ticket-form"},[e.formList.length?t("div",{staticClass:"form-list",staticStyle:{padding:"10px 0"}},[t("bk-form",{attrs:{"form-type":"vertical"}},[t("draggable",{attrs:{"data-test-id":"service_draggable_serviceFormDrag",handle:".dragElement",value:e.formList,group:{name:"view-form",pull:!1,put:["view-form","half-row-field","form-view-item"]}},on:{end:e.onRowDragEnd,add:e.onHalfRowDragToRow}},[e._l(e.formList,(function(n,i){return[Array.isArray(n)?t("half-row-form",{key:i,attrs:{"row-index":i,"workflow-id":e.serviceInfo.workflow_id,"node-id":e.nodeId,fields:e.forms,"row-forms":n,"add-field-status":e.addFieldStatus,"crt-form":e.crtForm},on:{onHalfRowDragToHalfRow:e.onHalfRowDragToHalfRow,onFormEditClick:e.onFormEditClick,onFormCloneClick:e.onFormCloneClick,onFormDeleteClick:function(t){return e.$emit("fieldDelete",t)},onEditCancel:e.onEditCancel,onEditConfirm:e.onEditConfirm}}):[t("form-view-item",{key:n.id,attrs:{"data-id":n.id,fields:e.forms,form:n,"add-field-status":e.addFieldStatus,"crt-form":e.crtForm},on:{onFormEditClick:e.onFormEditClick,onFormCloneClick:e.onFormCloneClick,onFormDeleteClick:function(t){return e.$emit("fieldDelete",t)}}},[t("div",{staticClass:"dragElement",attrs:{slot:"draggable"},slot:"draggable"},[t("i",{staticClass:"bk-itsm-icon icon-move-new"})])])]]}))],2)],1)],1):t("div",{staticClass:"no-form"},[t("h3",[e._v(e._s(e.$t("m.tickets['暂无服务表单']")))]),e._v(" "),t("p",[e._v(e._s(e.$t("m.tickets['请在左侧的“控件库”或“已有字段”点击添加']")))])])])},a=[];i._withStripped=!0},eL66:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("4d7F")),a=s(n("14Xm")),r=s(n("D3Ub")),o=n("CeR/");function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"TaskConfigPanel",components:{},props:{serviceInfo:{type:Object,default:function(){return{}}}},data:function(){return{taskConfigRule:{taskId:[{required:!0,message:this.$t("m.taskTemplate['请选择任务模板']"),trigger:"blur"}],createNodeId:[{required:!0,message:this.$t("m['请选择可创建任务节点']"),trigger:"blur"}],dealNodeId:[{required:!0,message:this.$t("m['请选择可处理任务的节点']"),trigger:"blur"}]},taskTemplateList:[],normalNodeList:[],taskConditionList:[],selectedDealNodeIds:[],useTask:!1,nodeListLoading:!1,isBizNeed:!1}},computed:{taskSettings:function(){if(this.serviceInfo.extras&&this.serviceInfo.extras.task_settings){var e=this.serviceInfo.extras.task_settings;if(Array.isArray(e))return this.serviceInfo.extras.task_settings}return[]}},created:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getUpdatedFlow();case 2:return e.initTaskCondition(),e.getTaskTemplateList(),t.next=6,e.getNodeList();case 6:e.handleDealNodeChange();case 7:case"end":return t.stop()}}),t,e)})))()},methods:{initTaskCondition:function(){var e=this;if(this.serviceInfo.extras&&this.serviceInfo.extras.task_settings){var t=this.serviceInfo.extras.task_settings;Array.isArray(t)?(this.taskConditionList=t.map((function(e){var t={taskId:e.task_schema_id,createNodeId:e.create_task_state,dealNodeId:e.execute_task_state,others:[],dealLoading:!1,dealList:[]};return e.execute_can_create&&t.others.push(1),e.need_task_finished&&t.others.push(2),t})),this.taskConditionList.forEach((function(t){e.getCanDealNodeList(t.createNodeId,t)})),this.useTask=!!t.length):(0,o.errorHandler)("taskSettings not Array",this)}},getTaskTemplateList:function(){var e=this;return this.$store.dispatch("taskTemplate/getTemplateList",{is_draft:!1}).then((function(t){e.taskTemplateList=t.data.filter((function(t){return!(!e.isBizNeed&&"SOPS"===t.component_type)}))})).catch((function(t){(0,o.errorHandler)(t,e)}))},getNodeList:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.nodeListLoading=!0,t.abrupt("return",e.$store.dispatch("deployCommon/getStates",{workflow:e.serviceInfo.workflow_id}).then((function(t){e.normalNodeList=t.data.filter((function(e){return!e.is_builtin&&"ROUTER-P"!==e.type&&"COVERAGE"!==e.type}))})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.nodeListLoading=!1})));case 2:case"end":return t.stop()}}),t,e)})))()},getCanDealNodeList:function(e,t){var n=this;if(e){this.$set(t,"dealLoading",!0);var i={id:e,include_self:!0};return this.$store.dispatch("deployCommon/getOrderedStates",i).then((function(e){t.dealList=e.data})).catch((function(e){(0,o.errorHandler)(e,n)})).finally((function(){n.$set(t,"dealLoading",!1)}))}},getAllDealNodeIds:function(){this.selectedDealNodeIds=this.taskConditionList.map((function(e){return e.dealNodeId})).filter((function(e){return!!e}))},handleDealNodeChange:function(){var e=this;this.getAllDealNodeIds(),this.normalNodeList.forEach((function(t){t.disabled=!1,e.selectedDealNodeIds.includes(t.id)&&(t.disabled=!0)}))},onAddCondition:function(){this.taskConditionList.push({taskId:"",createNodeId:"",dealNodeId:"",others:[1,2]})},onDelCondition:function(e){this.taskConditionList.splice(e,1),0===this.taskConditionList.length&&(this.useTask=!1)},validate:function(){var e=this;return(0,r.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.useTask){t.next=2;break}return t.abrupt("return",!0);case 2:return n=e.$refs.taskForms.map((function(e){return e.validate()})),t.abrupt("return",i.default.all(n));case 4:case"end":return t.stop()}}),t,e)})))()},getPostParams:function(){return this.useTask?this.taskConditionList.map((function(e){return{create_task_state:e.createNodeId,task_schema_id:e.taskId,execute_task_state:e.dealNodeId,need_task_finished:-1!==e.others.indexOf(2),execute_can_create:-1!==e.others.indexOf(1)}})):[]},getUpdatedFlow:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("design/getFlowDetail",{params:e.serviceInfo.workflow_id}).then((function(t){e.isBizNeed=t.data.is_biz_needed}));case 2:case"end":return t.stop()}}),t,e)})))()},handleUseTaskChange:function(e){e&&!this.taskConditionList.length&&this.onAddCondition()}}}},"eM+a":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-upload"},[t("div",{staticClass:"file-wrapper",class:{isdrag:e.isdrag}},[t("img",{staticClass:"upload-icon",attrs:{src:e.uploadIcon}}),e._v(" "),t("span",{staticClass:"drop-upload"},[e._v(e._s(e.dragText))]),e._v(" "),t("span",{staticClass:"click-upload"},[e._v(e._s(e.clickText))]),e._v(" "),t("input",{ref:"uploadel",attrs:{accept:e.accept,multiple:e.multiple,disabled:e.disabled,type:"file",accept:".txt,.log,.pdf,.doc,.ppt,.xls,.docx,.pptx,.xlsx,.zip,.jpg,.png"},on:{change:e.selectFile}})]),e._v(" "),e.tip?t("p",{staticClass:"tip"},[e._v(e._s(e.tip))]):e._e(),e._v(" "),e.fileList.length?t("div",{staticClass:"all-file"},e._l(e.fileList,(function(n,i){return t("div",{key:i},[t("div",{staticClass:"file-item"},[t("div",{staticClass:"file-icon"},[t("img",{attrs:{src:e.getIcon(n)}})]),e._v(" "),n.done?e._e():t("i",{staticClass:"bk-icon icon-close close-upload",on:{click:function(t){return e.deleteFile(i,n)}}}),e._v(" "),t("div",{staticClass:"file-info"},[t("div",{staticClass:"file-name"},[t("span",[e._v(e._s(n.name))])]),e._v(" "),t("div",{staticClass:"file-message"},[t("span",{directives:[{name:"show",rawName:"v-show",value:!n.done&&"running"===n.status,expression:"!file.done && file.status === 'running'"}],staticClass:"upload-speed"},[e._v(e._s(e.speed)+e._s(e.unit))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:!n.done,expression:"!file.done"}],staticClass:"file-size"},[e._v(e._s(e.filesize(n.size)))]),e._v(" "),t("span",{directives:[{name:"show",rawName:"v-show",value:n.done,expression:"file.done"}],staticClass:"file-size done"},[e._v(e._s("上传完成"))])]),e._v(" "),t("div",{staticClass:"progress-bar-wrapper"},[t("div",{staticClass:"progress-bar",class:{fail:n.errorMsg},style:{width:n.progress}})])])]),e._v(" "),n.errorMsg?t("p",{staticClass:"error-msg"},[e._v(e._s(n.errorMsg))]):e._e()])})),0):e._e()])},a=[];i._withStripped=!0},eOfU:function(e,t,n){"use strict";n.r(t);var i=n("XiH4"),a=n("f3v2");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},eQfd:function(e,t,n){"use strict";n.r(t);var i=n("8O5U"),a=n("gt7i");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("TDZ0");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"0be47cb7",null);t.default=s.exports},eYYl:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",e._l(e.responseList,(function(n,i){return t("div",{key:i,staticClass:"bk-trigger-condition"},[t("div",{staticClass:"bk-condition-name"},[t("p",[e._v(e._s(e.$t("m.trigger['响应动作']")))]),e._v(" "),t("div",{staticClass:"bk-between-operat"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addResponse(n,i)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===e.responseList.length},on:{click:function(t){return e.deleteResponse(n,i)}}})])]),e._v(" "),t("div",{staticClass:"bk-condition-content"},[t("div",{staticClass:"bk-response-way"},[t("p",{staticClass:"bk-response-name"},[e._v(e._s(e.$t("m.trigger['动作名称']"))),t("span",{staticClass:"bk-span-square"},[e._v("*")])]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-way-input",clearable:!1,searchable:""},on:{selected:function(t){return e.selectedWay(...arguments,n)}},model:{value:n.way,callback:function(t){e.$set(n,"way",t)},expression:"item.way"}},e._l(e.responseWayList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),n.wayStatus?t("p",{staticClass:"bk-error-info"},[e._v(e._s(e.$t("m.trigger['动作名称为必填项']")))]):e._e()],1),e._v(" "),n.wayInfo.field_schema&&n.wayInfo.field_schema.length?t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:n.isLoading},expression:"{ isLoading: item.isLoading }"}],staticStyle:{"min-height":"100px"}},[!n.isLoading&&n.wayInfo.field_schema&&n.wayInfo.field_schema.length?t("response-content",{attrs:{item:n,signal:e.signal}}):e._e()],1):e._e()])])})),0)},a=[];i._withStripped=!0},efIh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("14Xm")),a=o(n("D3Ub")),r=n("CeR/");function o(e){return e&&e.__esModule?e:{default:e}}t.default={methods:{getFieldOptions:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:a=[],n.t0=e.source_type,n.next="CUSTOM"===n.t0?4:"API"===n.t0?6:"DATADICT"===n.t0?9:"RPC"===n.t0?17:24;break;case 4:return a=e.choice,n.abrupt("break",24);case 6:return a=[],e.choice.forEach((function(e){a.push({key:String(e.id||e.key),name:e.name,can_delete:Boolean(e.can_delete)})})),n.abrupt("break",24);case 9:if(a=[],!e.choice.some((function(e){return e.can_delete}))){n.next=13;break}return a=e.choice,n.abrupt("break",24);case 13:if("TREESELECT"===e.type){n.next=16;break}return n.next=16,t.$store.dispatch("datadict/get_data_by_key",{key:e.source_uri,field_key:e.key,service:e.service,current_status:e.ticket_status}).then((function(n){a=n.data.map((function(n){var i={key:n.key,name:n.name};return"current_status"===e.key&&t.$set(i,"isOver",n.is_over),i}))})).catch((function(e){(0,r.errorHandler)(e,t)}));case 16:return n.abrupt("break",24);case 17:if(a=[],!e.choice.some((function(e){return e.can_delete}))){n.next=21;break}return a=e.choice,n.abrupt("break",24);case 21:return n.next=23,t.$store.dispatch("apiRemote/getRpcData",e).then((function(e){a=e.data})).catch((function(e){(0,r.errorHandler)(e,t)}));case 23:return n.abrupt("break",24);case 24:return n.abrupt("return",a);case 25:case"end":return n.stop()}}),n,t)})))()},judgeValue:function(e,t){if(e)return t.some((function(t){return-1!==e.toString().indexOf(t.key)}))},conditionField:function(e,t){for(var n=0;n<t.length;n++)if(!t[n].show_type&&(t[n].hasOwnProperty("show_conditions")||t[n].hasOwnProperty("show_result")&&!t[n].show_result)){if(t[n].show_conditions.expressions&&t[n].show_conditions.expressions.length)for(var i=0;i<t[n].show_conditions.expressions.length;i++)if(e.key===t[n].show_conditions.expressions[i].key&&e.key===t[n].key&&null===t[n].value)t[n].showFeild=!0;else if(e.key===t[n].show_conditions.expressions[i].key){if(1===t[n].show_conditions.expressions.length)t[n].showFeild=this.conditionSwitch(e,t[n].show_conditions.expressions[i]);else if("and"===t[n].show_conditions.type){for(var a=[],r=0;r<t[n].show_conditions.expressions.length;r++)for(var o=0;o<t.length;o++)if(t[n].show_conditions.expressions[r].key===t[o].key){var s=this.conditionSwitch(t[o],t[n].show_conditions.expressions[r]);a.push(s)}t[n].showFeild=a.every((function(e){return!!e}))}else{for(var c=[],l=0;l<t[n].show_conditions.expressions.length;l++)for(var u=0;u<t.length;u++)if(t[n].show_conditions.expressions[l].key===t[u].key){var d=this.conditionSwitch(t[u],t[n].show_conditions.expressions[l]);c.push(d)}t[n].showFeild=c.some((function(e){return!!e}))}t[n].showFeild=!t[n].showFeild}}else t[n].showFeild=!0},conditionSwitch:function(e,t){var n=!1,i=["CHECKBOX","MEMBERS","MULTISELECT","TREESELECT"];switch(t.condition){case"==":if(i.some((function(t){return t===e.type})))n=t.value.split(",").map((function(t){return-1===e.val.indexOf(t)})).every((function(e){return!e}))&&e.val.length===t.value.length;else n=e.val===t.value||Number(e.val)===Number(t.value);break;case"!=":if(i.some((function(t){return t===e.type}))){var a=t.value.split(",").map((function(t){return-1===e.val.indexOf(t)}));n=a.some((function(e){return!!e}))?a.some((function(e){return!!e})):e.val.length!==t.value.length}else n=e.val!==t.value&&Number(e.val)!==Number(t.value);break;case">":n="DATE"===e.type||"DATETIME"===e.type?this.timeStamp(e.val)>this.timeStamp(t.value):Number(e.val)>Number(t.value);break;case"<":n="DATE"===e.type||"DATETIME"===e.type?this.timeStamp(e.val)<this.timeStamp(t.value):Number(e.val)<Number(t.value);break;case">=":n="DATE"===e.type||"DATETIME"===e.type?this.timeStamp(e.val)>=this.timeStamp(t.value):Number(e.val)>=Number(t.value);break;case"<=":n="DATE"===e.type||"DATETIME"===e.type?this.timeStamp(e.val)<=this.timeStamp(t.value):Number(e.val)<=Number(t.value);break;case"issuperset":n=t.value.split(",").map((function(t){return-1===e.val.indexOf(t)})).every((function(e){return!e}));break;case"notissuperset":n=!t.value.split(",").map((function(t){return-1===e.val.indexOf(t)})).every((function(e){return!e}));break;default:n=!0}return n},timeStamp:function(e){var t=e.replace(/-/g,"/");return new Date(t).getTime()}}}},eofb:function(e,t,n){"use strict";n.r(t);var i=n("dwwr"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},eqfU:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-select",{class:{"bk-form-two":e.firstShow},attrs:{searchable:"","font-size":"medium",disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,placeholder:e.item.choice[0]?e.item.choice[0].desc:e.firstPlace},on:{selected:e.itemSelect},model:{value:e.firstInfo,callback:function(t){e.firstInfo=t},expression:"firstInfo"}},e._l(e.item.choice,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1),e._v(" "),e.firstShow?[t("bk-select",{class:{"bk-form-two-other":e.firstShow},attrs:{searchable:"",disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,"font-size":"medium",placeholder:e.firstList[0]?e.firstList[0].desc:e.secondPlace},on:{selected:e.changeFrist},model:{value:e.secondInfo,callback:function(t){e.secondInfo=t},expression:"secondInfo"}},e._l(e.firstList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e()],2),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2):e._e()},a=[];i._withStripped=!0},ew6e:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n("QbLZ")),a=p(n("14Xm")),r=p(n("P2sY")),o=p(n("gDS+")),s=p(n("D3Ub")),c=p(n("PaSM")),l=p(n("uz2X")),u=p(n("8zq1")),d=n("CeR/"),f=n("ygAv");function p(e){return e&&e.__esModule?e:{default:e}}t.default={name:"addTrigger",components:{triggerCondition:l.default,responseCondition:u.default},mixins:[c.default],props:{projectId:String,triggerInfo:{type:Object,default:function(){return{}}},originInfoToTrigger:{type:Object,default:function(){return{}}}},data:function(){return{contentLoading:!1,formData:{name:"",is_enabled:!0,desc:"",signal:"",moduleTypeDisabled:!1,variableLoading:!1},triggerEventList:[],iconList:[{key:"icon-icon-notice-new",name:"",typeName:"message"},{key:"icon-icon-user-new",name:"",typeName:"user"},{key:"icon-icon-status-new",name:"",typeName:"status"},{key:"icon-icon-api-new",name:"",typeName:"api"}],iconInfo:{status:!1,key:"icon-icon-notice-new",name:"",typeName:""},responseWayList:[],rulesList:[],ruleItem:{name:"",historyName:"",nameChange:!1,triggerStatus:!1,showContent:!0,triggerRules:{type:"all",list:[{type:"all",itemList:[{key:"",condition:"",value:"",conditionList:[],type:"STRING"}]}]},responseList:[{way:"",wayInfo:{},performData:{runMode:"BACKEND",displayName:"",repeat:"one"},isLoading:!1}]},backInfo:{responseList:[],triggerInfo:{}},btnLoading:!1,triggerAllRules:[],rules:{},moduleTypes:[],initFormData:{}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},mounted:function(){this.initData(),this.rules.name=this.checkCommonRules("name").name,this.rules.signal=this.checkCommonRules("select").select},methods:{initData:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n,i,s,c,l,u,d;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i in n=JSON.parse((0,o.default)(e.ruleItem)),e.rulesList.push(n),e.iconList.forEach((function(t){switch(t.key){case"icon-icon-notice-new":t.name=e.globalChoise.trigger_icon.find((function(e){return"message"===e.typeName})).name;break;case"icon-icon-user-new":t.name=e.globalChoise.trigger_icon.find((function(e){return"user"===e.typeName})).name;break;case"icon-icon-status-new":t.name=e.globalChoise.trigger_icon.find((function(e){return"status"===e.typeName})).name;break;case"icon-icon-api-new":t.name=e.globalChoise.trigger_icon.find((function(e){return"api"===e.typeName})).name}})),e.iconInfo.key=e.iconList[0].key,e.iconInfo.name=e.iconList[0].name,e.iconInfo.typeName=e.iconList[0].typeName,e.triggerEventList=[],e.globalChoise.trigger_signals){for(c in s={key:i,name:e.globalChoise.trigger_categories[i],children:[]},e.globalChoise.trigger_signals[i])s.children.push({key:c,name:e.globalChoise.trigger_signals[i][c]});e.triggerEventList.push(s)}if(!e.originInfoToTrigger.id){t.next=21;break}return l=e.originInfoToTrigger.sender,u=e.originInfoToTrigger.type,d={workflow:e.originInfoToTrigger.id},"task_schemas"===u&&(d.stage=e.originInfoToTrigger.stage,delete d.workflow),"states"===u&&(d.state=e.originInfoToTrigger.sender),t.next=16,e.$store.dispatch("trigger/getTriggerVariables",{id:l,type:u,params:d}).then((function(t){e.$store.commit("trigger/changeTriggerVariables",t.data)}));case 16:e.triggerEventList=e.triggerEventList.filter((function(t){return t.key===e.originInfoToTrigger.filter})),e.triggerEventList[0].children=e.triggerEventList[0].children.filter((function(t){return-1!==e.originInfoToTrigger.signal.indexOf(t.key)})),1===e.triggerEventList.length&&1===e.triggerEventList[0].children.length&&(e.formData.signal=e.triggerEventList[0].children[0].key),t.next=22;break;case 21:e.$store.commit("trigger/changeTriggerVariables",e.globalChoise.ticket_variables);case 22:return e.getModuleTypes(),t.next=25,e.getResponseList();case 25:e.triggerInfo.id?(e.contentLoading=!0,e.getData()):e.initFormData=(0,f.deepClone)((0,r.default)({},{formData:e.formData}));case 26:case"end":return t.stop()}}),t,e)})))()},getModuleTypes:function(){var e=this;this.$store.dispatch("basicModule/get_tables",{all:!0}).then((function(t){e.moduleTypes=t.data})).catch((function(t){(0,d.errorHandler)(t,e)}))},getData:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n,i,s,c;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.iconList.find((function(t){return t.typeName===e.triggerInfo.icon})),e.iconInfo.key=n.key,e.iconInfo.name=n.name,e.iconInfo.typeName=n.typeName,e.formData.name=e.triggerInfo.name,e.formData.is_enabled=e.triggerInfo.is_enabled,e.formData.desc=e.triggerInfo.desc,e.formData.signal=e.triggerInfo.signal,e.triggerInfo.source_table_id&&(e.formData.moduleTypeDisabled=!0,e.giveTableVariables(e.triggerInfo.source_table_id)),t.next=11,e.getTriggerRules();case 11:i=e.triggerAllRules.filter((function(t){return t.trigger_id===e.triggerInfo.id})),e.rulesList=[],s=0;case 14:if(!(s<i.length)){t.next=24;break}return(c=JSON.parse((0,o.default)(e.ruleItem))).triggerStatus=i[s].by_condition||!!i[s].condition,c.triggerStatus&&(c.triggerRules=e.conditionValue(i[s].condition)),c.triggerRules.id=i[s].id,t.next=21,e.responseValue(i[s].action_schemas,c);case 21:s++,t.next=14;break;case 24:e.contentLoading=!1,e.initFormData=(0,f.deepClone)((0,r.default)({},{formData:e.formData},{ruleItem:e.ruleItem},{rulesList:e.rulesList}));case 26:case"end":return t.stop()}}),t,e)})))()},conditionValue:function(e){var t=this,n={type:"",list:[]};for(var i in e)n.type=i,e[i].forEach((function(e){var i={};for(var a in e)i.type=a,i.itemList=[],e[a].forEach((function(e){var n={key:e.key,condition:e.operator,meta:e.meta,value:["CHECKBOX","MULTISELECT","MEMBERS","MULTI_MEMBERS","MEMBER"].some((function(t){return t===e.field_type}))?e.value.split(","):e.value,conditionList:[],type:e.field_type};n.conditionList=t.globalChoise.trigger_methods[e.field_type.toLowerCase()],i.itemList.push(n)}));n.list.push(i)}));return n},responseValue:function(e,t){var n=this;return(0,s.default)(a.default.mark((function i(){var r;return a.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return r={id__in:e.join(",")},i.next=3,n.$store.dispatch("trigger/getResponseListById",r).then((function(e){var i,r=e.data;t.responseList=[],t.name=r[0].name,r.forEach((i=(0,s.default)(a.default.mark((function e(i){var r;return a.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:(r={id:i.id,way:"",wayInfo:{},performData:{runMode:"BACKEND",displayName:"",repeat:"one"},isLoading:!1}).way=i.component_type,r.wayInfo=JSON.parse((0,o.default)(n.responseWayList.find((function(e){return e.key===i.component_type})))),"api"===r.way?r.wayInfo.field_schema.forEach((function(e){i.params.forEach((function(t){e.key===t.key&&n.$set(e,"value",t.value)}))})):r.wayInfo.field_schema.forEach((function(e){"SUBCOMPONENT"===e.type?i.params.forEach((function(t){t.key===e.key&&e.sub_components.forEach((function(e){t.sub_components.forEach((function(t){t.key===e.key&&(e.checked=!0,e.field_schema.forEach((function(e){t.params.forEach((function(t){e.key===t.key&&(e.referenceType=t.ref_type,e.value=t.value)}))})))}))}))})):i.params.forEach((function(t){e.key===t.key&&(n.$set(e,"value",t.value),n.$set(e,"ref_type",t.ref_type))}))})),r.performData.runMode=i.operate_type,r.performData.displayName=i.display_name,r.performData.repeat=i.can_repeat?"more":"one",t.responseList.push(r);case 8:case"end":return e.stop()}}),e,n)}))),function(e){return i.apply(this,arguments)})),n.rulesList.push(t)})).catch((function(e){(0,d.errorHandler)(e,n)}));case 3:case"end":return i.stop()}}),i,n)})))()},getResponseFields:function(e){var t=this;return(0,s.default)(a.default.mark((function n(){var r;return a.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r={source_uri:e.source_uri,trigger_source_id:t.originInfoToTrigger.id,trigger_source_type:"workflow"},n.next=3,t.$store.dispatch("apiRemote/getRpcData",r).then((function(t){e.choice=t.data.map((function(e){return(0,i.default)({},e,{showFeild:!0,value:""})}))})).catch((function(e){(0,d.errorHandler)(e,t)}));case 3:case"end":return n.stop()}}),n,t)})))()},handleClick:function(){this.iconInfo.status=!0},handleClickOutSide:function(){this.iconInfo.status=!1},changeIcon:function(e){this.iconInfo.key=e.key,this.iconInfo.name=e.name,this.iconInfo.typeName=e.typeName,this.iconInfo.status=!1},addRule:function(){var e=JSON.parse((0,o.default)(this.ruleItem));this.rulesList.push(e),this.$emit("change")},deleteRule:function(e){1!==this.rulesList.length&&(this.rulesList.splice(e,1),this.$emit("change"))},changeName:function(e){e.historyName=e.name,e.nameChange=!0,this.$emit("change")},handleClickName:function(e,t){e.nameChange=!1,"close"===t&&(e.name=e.historyName)},showContent:function(e){e.showContent=!e.showContent},submitTrigger:function(e){var t=this;this.$refs.triggerBasic.validate().then((function(){t.$refs.triggerMade.validate().then((function(){if(!t.checkInfo()){var n={name:t.formData.name,source_type:"basic",source_id:0,signal:t.formData.signal,sender:0,is_draft:e,is_enabled:t.formData.is_enabled,icon:t.iconInfo.typeName,desc:t.formData.desc,project_key:t.$store.state.project.id};t.originInfoToTrigger.id&&(n.source_type=t.originInfoToTrigger.source,n.sender=t.originInfoToTrigger.id,n.source_id=t.originInfoToTrigger.id,n.sender=t.originInfoToTrigger.sender),t.projectId&&(n.project_key=t.projectId),t.triggerInfo.id?t.putTrigger(n):t.creatTrigger(n)}}))}))},checkInfo:function(){var e=this,t=!1;return this.rulesList.forEach((function(n){n.triggerStatus&&n.triggerRules.list.forEach((function(e){e.itemList.forEach((function(e){"non_empty"===e.condition?n.triggerRules.checkStatus=""===e.key:n.triggerRules.checkStatus=""===e.key||""===e.condition||""===e.value}))})),n.responseList.forEach((function(t){e.$set(t,"wayStatus",!t.way),t.wayInfo.field_schema&&("api"===t.wayInfo.key?t.wayInfo.field_schema.forEach((function(e){"api_source"===e.key?t.contentStatus=t.contentStatus?t.contentStatus:!e.apiId:e.apiContent.bodyTableData.forEach((function(e){"array"!==e.type&&"object"!==e.type&&e.is_necessary&&(t.contentStatus=t.contentStatus?t.contentStatus:"CUSTOM"===e.source_type?""===e.value:""===e.value_key)}))})):t.wayInfo.field_schema.forEach((function(e){if("SUBCOMPONENT"===e.type&&e.sub_components&&e.sub_components.length)t.contentStatus=!e.sub_components.some((function(e){return e.checked})),t.contentStatus||e.sub_components.forEach((function(e){e.checked&&e.field_schema.forEach((function(e){e.required&&("MEMBERS"===e.type||"MULTI_MEMBERS"===e.type?t.contentStatus=t.contentStatus?t.contentStatus:e.value.some((function(e){return Array.isArray(e.value)?!e.value.length:!e.value})):t.contentStatus=t.contentStatus?t.contentStatus:!e.value)}))}));else if(e.required){var n=["STARTER_LEADER","ASSIGN_LEADER"];"MEMBERS"===e.type||"MULTI_MEMBERS"===e.type?t.contentStatus=t.contentStatus?t.contentStatus:e.value.some((function(e){return Array.isArray(e.value)?n.includes(e.key)?e.value.length:!e.value.length:!e.value})):t.contentStatus=t.contentStatus?t.contentStatus:"field_value"===e.key?!(e.itemInfo[0].value||e.itemInfo[0].val):!e.value}})),"MANUAL"!==t.performData.runMode||t.contentStatus||(t.contentStatus=!t.performData.displayName))})),t=n.triggerRules.checkStatus||n.responseList.some((function(e){return e.contentStatus||e.wayStatus}))})),t},closeTrigger:function(){this.$emit("closeTrigger")},creatTrigger:function(e){var t=this;this.btnLoading=!0,this.$store.dispatch("trigger/createTriggerRule",e).then((function(e){t.backInfo.triggerInfo=e.data;var n=t.responseParams();t.createRespond(n)})).catch((function(e){(0,d.errorHandler)(e,t),t.btnLoading=!1})).finally((function(){}))},putTrigger:function(e){var t=this;this.btnLoading=!0;var n=this.triggerInfo.id;this.$store.dispatch("trigger/putTriggerRule",{params:e,id:n}).then((function(e){t.backInfo.triggerInfo=e.data;var n=t.responseParams();t.createRespond(n)})).catch((function(e){(0,d.errorHandler)(e,t),t.btnLoading=!1})).finally((function(){}))},createRespond:function(e){var t=this,n=e,i=this.originInfoToTrigger.id;this.$store.dispatch("trigger/createRespond",{id:i,params:n}).then((function(e){t.backInfo.responseList=e.data,t.createTriggerCondition()})).catch((function(e){(0,d.errorHandler)(e,t),t.btnLoading=!1})).finally((function(){}))},responseParams:function(){var e=this,t=[];return this.rulesList.forEach((function(n){n.responseList.forEach((function(i){var a={};i.id&&(a.id=i.id),a.name=n.name,a.display_name=i.performData.displayName,a.operate_type=i.performData.runMode,a.can_repeat="more"===i.performData.repeat,a.component_type=i.wayInfo.key,a.params=[],"api"===i.wayInfo.key?a.params=e.responseApiInfo(i):i.wayInfo.field_schema.forEach((function(t){if("SUBCOMPONENT"===t.type){var n={key:t.key,sub_components:[]};t.sub_components.forEach((function(t){if(t.checked){var i={key:t.key,params:[]};t.field_schema.forEach((function(t){var n={key:t.key,value:e.formattingValue(t),ref_type:t.referenceType};i.params.push(n)})),n.sub_components.push(i)}})),a.params.push(n)}else{var i={key:t.key,value:e.formattingValue(t),ref_type:t.referenceType};a.params.push(i)}})),t.push(a)}))})),t},responseApiInfo:function(e){var t=this,n=[];return e.wayInfo.field_schema.forEach((function(e){if("api_source"===e.key)n.push({key:e.key,value:e.apiId});else{var i={key:e.key,value:{}};i.value=t.treeToJson(e.apiContent.bodyTableData.filter((function(e){return!e.level}))),n.push(i)}})),n},treeToJson:function(e){var t={},n=function e(t,n,i,a){if(n.key)if("array"===n.type){if("array"===a)for(var o in t.push([]),n.children)e(t[t.length-1],n.children[o],1,"array");if("object"===a){var s={};for(var c in s[n.key]=[],(0,r.default)(t,s),n.children)e(t[n.key],n.children[c],1,"array")}}else if("object"===n.type){var l={};if("array"===a)for(var u in t.push(l),n.children)e(t[t.length-1],n.children[u],1,"object");if("object"===a)for(var d in l[n.key]={},(0,r.default)(t,l),n.children)e(t[n.key],n.children[d],1,"object")}else{if("number"===n.type&&(n.value=Number(n.value)),"array"===a){var f={is_leaf:"object"!==n.type&&"array"!==n.type,ref_type:"CUSTOM"===n.source_type?"custom":"reference",value:"CUSTOM"===n.source_type?n.value:n.value_key};t.push(f)}if("object"===a){var p={};p[n.key]={is_leaf:"object"!==n.type&&"array"!==n.type,ref_type:"CUSTOM"===n.source_type?"custom":"reference",value:"CUSTOM"===n.source_type?n.value:n.value_key},(0,r.default)(t,p)}}};for(var i in e)n(t,e[i],0,"object");return t},formattingValue:function(e){var t="";return"receivers"===e.key||"MEMBERS"===e.type||"MEMBER"===e.type?(t=[],e.value.forEach((function(e){var n={ref_type:"VARIABLE"===e.key?"reference":"custom",value:{member_type:e.key,members:Array.isArray(e.value)?e.value.join(","):e.value}};t.push(n)}))):t="VARIABLE"===e.value?Array.isArray(e.insertValue)?e.insertValue.join(","):e.insertValue:e.itemInfo&&e.itemInfo[0].id?e.itemInfo[0].value||e.itemInfo[0].val:e.value,t},createTriggerCondition:function(){var e=this,t=this.conditionParams(),n=this.backInfo.triggerInfo.id;this.$store.dispatch("trigger/batchTriggerCondition",{params:t,id:n}).then((function(){e.$bkMessage({message:e.triggerInfo.id?e.$t("m.common['保存成功']"):e.$t("m.trigger['创建成功']"),theme:"success"}),e.closeTrigger(),e.$emit("getList")})).catch((function(t){(0,d.errorHandler)(t,e)})).finally((function(){e.btnLoading=!1}))},conditionParams:function(){var e=this,t=[],n=0;return this.rulesList.forEach((function(i){var a={condition:{},name:i.name,by_condition:i.triggerStatus,action_schemas:[]};i.triggerRules.id&&(a.id=i.triggerRules.id),i.triggerStatus?(a.condition[i.triggerRules.type]=[],i.triggerRules.list.forEach((function(e){var t={};t[e.type]=[],e.itemList.forEach((function(n){var i={key:n.key,value:Array.isArray(n.value)?n.value.join(","):n.value,field_type:n.type,operator:n.condition,type:"custom"};t[e.type].push(i)})),a.condition[i.triggerRules.type].push(t)}))):a.condition="",i.responseList.forEach((function(t,i){a.action_schemas.push(e.backInfo.responseList[n+i])})),n+=i.responseList.length,t.push(a)})),t},getTriggerRules:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={trigger_id:e.triggerInfo.id},t.next=3,e.$store.dispatch("trigger/getTriggerRules",n).then((function(t){e.triggerAllRules=t.data})).catch((function(t){(0,d.errorHandler)(t,e)})).finally((function(){}));case 3:case"end":return t.stop()}}),t,e)})))()},getResponseList:function(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("trigger/getResponseList").then(function(){var t=(0,s.default)(a.default.mark((function t(n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.responseWayList=n.data,e.originInfoToTrigger.id&&"task"!==e.originInfoToTrigger.source?e.responseWayList.forEach((function(t){var n;t.field_schema.forEach((n=(0,s.default)(a.default.mark((function t(n){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("RPC"!==n.source_type){t.next=3;break}return t.next=3,e.getResponseFields(n);case 3:case"end":return t.stop()}}),t,e)}))),function(e){return n.apply(this,arguments)}))})):e.responseWayList=e.responseWayList.filter((function(e){return"modify_field"!==e.key&&"modify_specified_state_processor"!==e.key}));case 2:case"end":return t.stop()}}),t,e)})));return function(e){return t.apply(this,arguments)}}()).catch((function(t){(0,d.errorHandler)(t,e)}));case 2:case"end":return t.stop()}}),t,e)})))()},giveTableVariables:function(e){var t=this;this.formData.variableLoading=!0,this.$store.dispatch("basicModule/get_trigger_tables",e).then((function(e){var n=e.data.fields;n.forEach((function(e){e.name+=t.$t("m.trigger['（基础模型）']")})),t.$store.commit("trigger/changeTriggerVariables",t.globalChoise.ticket_variables.concat(n))})).catch((function(e){(0,d.errorHandler)(e,t)})).finally((function(){t.formData.variableLoading=!1}))}}}},f1Q0:function(e,t,n){"use strict";n.r(t);var i=n("Lbk4"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},f3v2:function(e,t,n){"use strict";n.r(t);var i=n("NesJ"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},f5Dy:function(e,t,n){"use strict";n.r(t);var i=n("WzOL"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"f5y/":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"render-view",staticStyle:{"margin-left":"10px"}},e._l(e.formData,(function(n,i){return t("div",{key:i+new Date,staticClass:"view-item-wrap"},[t("ViewItem",{attrs:{"top-index":i,"is-top":!0,scheme:e.getScheme(n),form:n}})],1)})),0)},a=[];i._withStripped=!0},f7Ks:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-input",{class:{"bk-border-error":e.item.checkValue},attrs:{maxlength:120,disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,placeholder:e.item.desc},on:{focus:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}}),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},f9M4:function(e,t,n){},fOTe:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"Sideslider",components:{RenderView:function(){return Promise.resolve().then(n.bind(null,"FCVG"))}},props:{title:{type:String,default:""},formData:{type:Array,default:function(){return[]}},context:{type:Object,default:function(){return{schemes:{}}}},width:{type:[String,Number],default:800}},data:function(){return{isShow:!0}}}},fX4K:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("div",{staticClass:"bk-form-width"},[t("bk-select",{attrs:{clearable:!1,disabled:e.disabled,searchable:""},on:{selected:e.getSecondLevelList},model:{value:e.formData.levelOne,callback:function(t){e.$set(e.formData,"levelOne",t)},expression:"formData.levelOne"}},e._l(e.firstLevelList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1)],1),e._v(" "),"ORGANIZATION"!==e.formData.levelOne?["VARIABLE"===e.formData.levelOne?t("div",{staticClass:"bk-form-width"},[t("bk-select",{attrs:{loading:e.isLoading,disabled:e.disabled,"show-select-all":"",multiple:"",searchable:""},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}},e._l(e.frontMemberField,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.key,name:e.name}})})),1)],1):"PERSON"===e.formData.levelOne?t("div",{staticClass:"bk-form-width"},[t("member-select",{attrs:{disabled:e.disabled},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}})],1):"CMDB"===e.formData.levelOne?t("div",{staticClass:"bk-form-width"},[t("bk-select",{attrs:{loading:e.isLoading,"show-select-all":"",multiple:"",searchable:""},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}},e._l(e.secondLevelList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1):"GENERAL"===e.formData.levelOne?t("div",{staticClass:"bk-form-width"},[t("bk-select",{attrs:{loading:e.isLoading,disabled:e.disabled,searchable:""},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}},e._l(e.secondLevelList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1):e._e()]:e._e(),e._v(" "),"ORGANIZATION"===e.formData.levelOne?t("div",{staticClass:"bk-form-width"},[t("select-tree",{attrs:{list:e.organizationList},model:{value:e.formData.levelSecond,callback:function(t){e.$set(e.formData,"levelSecond",t)},expression:"formData.levelSecond"}})],1):e._e()],2),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2):e._e()},a=[];i._withStripped=!0},"fc+3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("14Xm")),a=d(n("D3Ub")),r=d(n("gDS+")),o=d(n("dTVR")),s=d(n("BWJp")),c=d(n("PaSM")),l=d(n("bcjM")),u=n("CeR/");function d(e){return e&&e.__esModule?e:{default:e}}t.default={components:{templateNode:o.default,commonTriggerList:l.default},mixins:[s.default,c.default],props:{customLine:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}}},data:function(){return{isDataLoading:!1,secondClick:!1,booleanList:[{id:"1",name:"true"},{id:"0",name:"false"}],widthStatus:0,scrollTopStatus:0,lineInfo:{template:"",condition_type:"",name:"",checkName:!1,between:!0,expressions:[{type:"and",expressions:[{condition:"",key:"",value:"",choiceList:"",type:"STRING",betweenList:[]}]}]},templateList:[],fieldList:[],globalTypeList:["SELECT","MULTISELECT","RADIO","CHECKBOX","MEMBERS","TREESELECT"],rules:{}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo},openFunction:function(){return this.$store.state.openFunction}},watch:{fieldList:{handler:function(){this.dealList()},deep:!0}},mounted:function(){var e=this;this.initData(),this.rules.name=this.checkCommonRules("name").name,this.rules.value=this.checkCommonRules("select").select,this.rules.key=this.rules.value,this.rules.condition=this.rules.value,this.$store.state.common.slideTimeout=setInterval((function(){e.$refs.lienHeight?e.scrollTopStatus=e.$refs.lienHeight.offsetHeight+60>document.body.offsetHeight:clearInterval(e.$store.state.common.slideTimeout)}),100)},methods:{initData:function(){var e=this;this.widthStatus=0;var t=["START","END","ROUTER-P","COVERAGE"];t.some((function(t){return e.customLine.nodeInfo.from_state.type===t}))&&(this.widthStatus+=1),t.some((function(t){return e.customLine.nodeInfo.to_state.type===t}))&&(this.widthStatus+=1),this.lineInfo.name=this.customLine.lineValue.name===this.$t("m.treeinfo['默认']")?"":this.customLine.lineValue.name,this.lineInfo.condition_type=this.customLine.lineValue.condition_type,this.lineInfo.between=this.customLine.lineValue.condition.type,this.lineInfo.expressions=JSON.parse((0,r.default)(this.customLine.lineValue.condition.expressions)),this.lineInfo.expressions.forEach((function(e){e.expressions.forEach((function(e){"BOOLEAN"===e.type&&(e.value=e.value?"1":"0")}))})),this.getFieldList(),this.getBetweenTemplate()},checkBetweenList:function(e){var t=[];if(["MULTISELECT","CHECKBOX","MEMBERS","TREESELECT"].some((function(t){return t===e})))t=this.globalChoise.methods.filter((function(e){return"issuperset"===e.typeName||"notissuperset"===e.typeName}));else if(["DATE","DATETIME","DATETIMERANGE","INT"].some((function(t){return t===e})))t=this.globalChoise.methods.filter((function(e){return"issuperset"!==e.typeName&&"notissuperset"!==e.typeName}));else if(["TEXT","STRING"].some((function(t){return t===e}))){var n=["==","!=","in","notin"];t=this.globalChoise.methods.filter((function(e){return n.includes(e.typeName)}))}else{var i=["==","!="];t=this.globalChoise.methods.filter((function(e){return i.includes(e.typeName)}))}return t},getBetweenTemplate:function(){var e=this,t={workflow:this.customLine.lineValue.workflow};this.$store.dispatch("deployCommon/getLineTemplate",t).then((function(t){e.templateList=t.data.items})).catch((function(t){(0,u.errorHandler)(t,e)}))},getRpcData:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.$store.dispatch("apiRemote/getRpcData",e).then((function(t){e.choice=t.data})).catch((function(e){(0,u.errorHandler)(e,t)}));case 2:case"end":return n.stop()}}),n,t)})))()},getFieldList:function(){var e=this,t=this.customLine.lineValue.id;this.isDataLoading=!0,this.$store.dispatch("deployCommon/getLineField",{id:t}).then((function(t){e.fieldList=t.data,e.fieldList.forEach((function(t){"RPC"===t.source_type&&e.getRpcData(t)})),e.isNecessaryToWatch({fields:e.fieldList},"workflow"),e.dealList()})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.isDataLoading=!1}))},dealList:function(){var e=this;this.lineInfo.expressions.forEach((function(t){e.$set(t,"checkInfo",!1),t.expressions.forEach((function(t){t.type=t.type||"STRING",t.choiceList="",e.$set(t,"betweenList",[]),t.betweenList=e.checkBetweenList(t.type),"SELECT"!==t.type&&"MULTISELECT"!==t.type&&"RADIO"!==t.type&&"CHECKBOX"!==t.type&&"MEMBERS"!==t.type&&"TREESELECT"!==t.type&&"INT"!==t.type||e.fieldList.forEach((function(n){n.key===t.key&&(t.choiceList=[],n.choice.forEach((function(e){t.choiceList.push({id:e.key,name:e.name})})),"MULTISELECT"!==t.type&&"CHECKBOX"!==t.type&&"MEMBERS"!==t.type&&"TREESELECT"!==t.type||(t.value=Array.isArray(t.value)?t.value:t.value.split(",")),e.$set(t,"multiSelect",!("SELECT"===t.type||"RADIO"===t.type)))}))}))}))},changeTemplate:function(e,t){var n=this.templateList.filter((function(e){return e.id===t.id}))[0];this.lineInfo.condition_type="by_field",this.lineInfo.between=n.data.type,this.lineInfo.expressions=n.data.expressions,this.lineInfo.name=n.name},changeCondition:function(){this.lineInfo.template="",this.lineInfo.expressions=[{type:"and",checkInfo:!1,expressions:[{condition:"",key:"",value:"",choiceList:"",type:"STRING",betweenList:this.checkBetweenList("STRING")}]}]},changeName:function(){var e=arguments,t=this.fieldList.filter((function(t){return e[0]===t.key}))[0];arguments[2].meta=t.meta;var n=arguments[2];n.source=n.source||"field",n.type=t.type,this.globalTypeList.some((function(e){return e===n.type}))?(n.choiceList=t.choice.map((function(e){return{id:e.key,name:e.name}})),this.$set(n,"multiSelect",!("SELECT"===n.type||"RADIO"===n.type))):(n.choiceList="",this.$set(n,"multiSelect",!1)),n.value=n.multiSelect?[]:"";var i=this.checkBetweenList(n.type);this.$set(arguments[2],"betweenList",i),n.condition=""},addCondition:function(){var e={type:"and",checkInfo:!1,expressions:[{condition:"",key:"",value:"",choiceList:"",type:"STRING",betweenList:this.checkBetweenList("STRING")}]};this.lineInfo.expressions.push(e)},delteCondition:function(e,t){1!==this.lineInfo.expressions.length&&this.lineInfo.expressions.splice(t,1)},addNode:function(e,t){var n={condition:"",key:"",value:"",choiceList:"",type:"STRING",betweenList:this.checkBetweenList("STRING")};e.expressions.splice(t+1,0,n)},deleteNode:function(e,t){1!==e.expressions.length&&e.expressions.splice(t,1)},submitLine:function(){var e=this;if("by_field"===this.lineInfo.condition_type&&(this.lineInfo.expressions.forEach((function(e){e.checkInfo=e.expressions.some((function(e){return!(e.condition&&e.key&&(Array.isArray(e.value)?e.value.length:e.value))}))})),this.lineInfo.expressions.some((function(e){return e.checkInfo}))))return;this.$refs.lineForm.validate().then((function(){e.submitFn()}),(function(e){console.warn(e)}))},submitFn:function(){var e=this;if(!this.secondClick){this.secondClick=!0;var t={name:this.lineInfo.name,condition_type:this.lineInfo.condition_type,condition:{expressions:[],type:this.lineInfo.between},from_state:this.customLine.lineValue.from_state,to_state:this.customLine.lineValue.to_state,workflow:this.customLine.lineValue.workflow};this.lineInfo.expressions.forEach((function(e){t.condition.expressions.push({checkInfo:e.checkInfo,expressions:[],type:e.type})})),this.lineInfo.expressions.forEach((function(n,i){n.expressions.forEach((function(n){t.condition.expressions[i].expressions.push({choiceList:[],condition:n.condition,key:n.key,source:n.source,type:n.type,value:e.formattingData(n),meta:n.meta})}))}));var n=this.customLine.lineValue.id;this.$store.dispatch("deployCommon/updateLine",{lineParams:t,id:n}).then((function(t){e.$bkMessage({message:e.$t('m.treeinfo["配置成功！"]'),theme:"success"}),e.$emit("submitLine",t.data)})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}},closeLine:function(){this.$emit("closeLine")},deleteLine:function(){this.$emit("deleteLine")},submitTemplate:function(){var e=this;this.lineInfo.expressions.forEach((function(t){t.expressions.forEach((function(t){t.value=e.formattingData(t)}))}));var t={workflow:this.customLine.lineValue.workflow,name:this.lineInfo.name,data:{expressions:this.lineInfo.expressions,type:this.lineInfo.between}};if(this.lineInfo.template&&(t.id=this.lineInfo.template),this.lineInfo.name&&!this.secondClick){this.secondClick=!0;var n=this.lineInfo.template?"deployCommon/updateLineTemplate":"deployCommon/submitLineTemplate";this.$store.dispatch(n,{params:t}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功！"]'),theme:"success"})})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}}}}},fkix:function(e,t,n){"use strict";n.r(t);var i=n("NXOa"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},g2DR:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-table",{attrs:{data:e.item.val,size:"small"}},[e._l(e.item.choice,(function(n){return[t("bk-table-column",{key:n.key,attrs:{label:n.name},scopedSlots:e._u([{key:"default",fn:function(i){return[t("bk-input",{attrs:{clearable:!0,disabled:e.disabled},model:{value:i.row[n.key],callback:function(t){e.$set(i.row,n.key,t)},expression:"props.row[title.key]"}})]}}],null,!0)})]})),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.user['操作']"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-button",{attrs:{theme:"primary",disabled:e.disabled,text:""},on:{click:e.addOne}},[e._v("\n            "+e._s(e.$t('m.newCommon["添加"]'))+"\n          ")]),e._v(" "),t("bk-button",{attrs:{theme:"primary",disabled:e.disabled,text:""},on:{click:function(t){return e.deleteOne(n)}}},[e._v("\n            "+e._s(e.$t('m.newCommon["删除"]'))+"\n          ")])]}}],null,!1,1830905243)})],2),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},g5Ts:function(e,t,n){"use strict";n.r(t);var i=n("hSKY"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"g9b+":function(e,t,n){"use strict";n.r(t);var i=n("fX4K"),a=n("x+JR");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("1u4o");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"8c164c82",null);t.default=s.exports},gEzK:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeTree,expression:"closeTree"}],staticClass:"bk-search-tree bk-form-width",class:{"bk-border-error":e.item.checkValue}},[t("div",{staticClass:"bk-search-tree-wrapper",class:{bkdisabled:e.disabled},on:{click:function(t){return t.stopPropagation(),e.showTree.apply(null,arguments)}}},[t("span",{class:{"bk-color-tree":e.treeSlectInfo.info.name}},[e._v("\n          "+e._s(e.treeSlectInfo.info.showName||e.$t('m.newCommon["请选择"]'))+"\n        ")]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})]),e._v(" "),t("transition",{attrs:{name:"common-fade"}},[e.treeSlectInfo.show?[e.treeSlectInfo.treeDataList.length?t("div",{staticClass:"bk-search-tree-content"},[t("export-tree",{attrs:{"tree-data-list":e.treeSlectInfo.treeDataList},on:{toggle:e.toggleInfo,toggleChildren:e.toggleChildren}})],1):t("div",{staticClass:"bk-search-tree-content"},[t("p",{staticClass:"bk-search-tree-nodata"},[e._v(e._s(e.$t('m.treeinfo["暂无数据"]')))])])]:e._e()],2)],1)]),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2):e._e()},a=[];i._withStripped=!0},gHwO:function(e,t,n){},gLev:function(e,t,n){"use strict";n.r(t);var i=n("JbQy"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},gMgb:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"tag-table"},[e.hiddenLabel?e._e():t("label",{staticClass:"table-label"},[e._v(e._s(e.label))]),e._v(" "),t("bk-table",{ref:"tagTable",attrs:{data:e.form.value,border:!0}},e._l(e.column,(function(n){return t("bk-table-column",{key:n.key,attrs:{label:n.name,prop:n.key},scopedSlots:e._u([{key:"default",fn:function(i){return[t("ViewItem",{attrs:{scheme:e.getScheme(n,i.row[n.key]),form:i.row[n.key]}})]}}],null,!0)})})),1)],1)},a=[];i._withStripped=!0},gSHn:function(e,t,n){"use strict";n.r(t);var i=n("eL66"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},gdLX:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-dialog-form"},[t("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}],ref:"table",attrs:{data:e.dataList,size:"small"},on:{"select-all":e.handleSelectAll,select:e.handleSelect}},[t("bk-table-column",{attrs:{type:"selection",width:"60",align:"center",selectable:e.disabledFn}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['字段名称']"),prop:"name"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['唯一标识']"),prop:"key"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['字段类型']"),prop:"typeName"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['是否只读']")},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-radio-group",{model:{value:n.row.is_readonly,callback:function(t){e.$set(n.row,"is_readonly",t)},expression:"props.row.is_readonly"}},[t("bk-radio",{staticClass:"mr20",attrs:{value:e.trueStatus,disabled:"priority"===n.row.key||n.row.is_disabled}},[e._v("\n            "+e._s(e.$t('m.treeinfo["是"]'))+"\n          ")]),e._v(" "),t("bk-radio",{attrs:{value:e.falseStatus,disabled:"priority"===n.row.key||n.row.is_disabled}},[e._v("\n            "+e._s(e.$t('m.treeinfo["否"]'))+"\n          ")])],1)]}}])})],1)],1)},a=[];i._withStripped=!0},"gr+U":function(e,t,n){"use strict";n.r(t);var i=n("vXIu"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},gt7i:function(e,t,n){"use strict";n.r(t);var i=n("JXR1"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},gy7N:function(e,t,n){"use strict";n.r(t);var i=n("eqfU"),a=n("t9cD");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("tPsg");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"588a75c2",null);t.default=s.exports},h1eg:function(e,t,n){"use strict";n.r(t);var i=n("Y9oG"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},h42h:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",[t("ul",{staticClass:"bk-config-tab"},e._l(e.panels,(function(n,i){return t("li",{key:n.id,class:{"bk-check-config":e.acticeTab===n.key},on:{click:function(t){return e.changeTab(n,i)}}},[t("span",[e._v(e._s(n.label))])])})),0),e._v(" "),"queryParams"===e.acticeTab?[t("div",{staticClass:"param-config"},[t("i",{staticClass:"bk-itsm-icon icon-info-fail"}),e._v(" "),t("span",{staticStyle:{"font-size":"12px",color:"#63656e"}},[e._v(e._s(e.$t("m['参数说明']")))]),e._v(" "),t("params-table",{attrs:{list:e.config.queryParams,"state-list":e.stateList,"is-status":e.isStatus,disable:e.disable},on:{changeFormStatus:e.changeFormStatus}})],1)]:e._e(),e._v(" "),"auth"===e.acticeTab?[t("div",{staticClass:"param-config"},[t("bk-radio-group",{model:{value:e.config.authRadio,callback:function(t){e.$set(e.config,"authRadio",t)},expression:"config.authRadio"}},[t("bk-radio",{attrs:{value:"none"}},[e._v(e._s(e.$t("m['无需认证']")))]),e._v(" "),t("bk-radio",{attrs:{value:"bearer_token"}},[e._v("Bearer Token")]),e._v(" "),t("bk-radio",{attrs:{value:"basic_auth"}},[e._v("Basic Auth")])],1),e._v(" "),t("div",{staticClass:"bk-radio-config"},["none"===e.config.authRadio?t("div",[t("span",[e._v(e._s(e.$t("m['该请求不需要任何认证']")))])]):"bearer_token"===e.config.authRadio?t("div",[t("div",{staticClass:"config-option",staticStyle:{width:"80%"}},[t("p",{staticClass:"mb5"},[e._v("TOKEN ：")]),e._v(" "),t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable,clearable:!0},model:{value:e.config.auth_config.Token,callback:function(t){e.$set(e.config.auth_config,"Token",t)},expression:"config.auth_config.Token"}})],1)]):t("div",{staticStyle:{display:"flex"}},[t("div",{staticClass:"config-option"},[t("p",{staticClass:"mb5"},[e._v(e._s(e.$t("m['用户名']"))+"：")]),e._v(" "),t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable,clearable:!0},model:{value:e.config.auth_config.username,callback:function(t){e.$set(e.config.auth_config,"username",t)},expression:"config.auth_config.username"}})],1),e._v(" "),t("div",{staticClass:"config-option"},[t("p",{staticClass:"mb5"},[e._v(e._s(e.$t("m['密码']"))+"：")]),e._v(" "),t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable,type:"password",clearable:!0},model:{value:e.config.auth_config.password,callback:function(t){e.$set(e.config.auth_config,"password",t)},expression:"config.auth_config.password"}})],1)])])],1)]:e._e(),e._v(" "),"body"===e.acticeTab?[t("div",{staticClass:"param-config"},[t("div",{staticStyle:{display:"flex","align-items":"center","margin-bottom":"8px"}},[t("bk-radio-group",{staticStyle:{width:"500px"},model:{value:e.config.bodyRadio,callback:function(t){e.$set(e.config,"bodyRadio",t)},expression:"config.bodyRadio"}},[t("bk-radio",{attrs:{value:"none"}},[e._v(e._s(e.$t("m['默认']")))]),e._v(" "),t("bk-radio",{attrs:{value:"form-data",disabled:e.radioDisabled}},[e._v("form-data")]),e._v(" "),t("bk-radio",{attrs:{value:"x-www-form-urlencoded",disabled:e.radioDisabled}},[e._v("x-www-form-urlencoded")]),e._v(" "),t("bk-radio",{attrs:{value:"raw",disabled:e.radioDisabled}},[e._v("raw")])],1),e._v(" "),"raw"===e.config.bodyRadio?t("bk-select",{staticStyle:{width:"100px"},attrs:{"ext-cls":"select-custom",disabled:!1,behavior:"simplicity"},model:{value:e.config.rawType,callback:function(t){e.$set(e.config,"rawType",t)},expression:"config.rawType"}},e._l(e.rawList,(function(e,n){return t("bk-option",{key:n,attrs:{id:e,name:e}})})),1):e._e()],1),e._v(" "),"form-data"===e.config.bodyRadio?[t("params-table",{attrs:{list:e.config.bodyFormData,"is-status":e.isStatus,disable:e.disable,"state-list":e.stateList},on:{changeFormStatus:e.changeFormStatus}})]:e._e(),e._v(" "),"x-www-form-urlencoded"===e.config.bodyRadio?[t("params-table",{attrs:{list:e.config.bodyWwwForm,disable:e.disable,"is-status":e.isStatus,"state-list":e.stateList},on:{changeFormStatus:e.changeFormStatus}})]:e._e(),e._v(" "),"raw"===e.config.bodyRadio?[t("textarea",{directives:[{name:"model",rawName:"v-model",value:e.config.bodyValue,expression:"config.bodyValue"}],ref:"textarea",staticClass:"bk-form-textarea",staticStyle:{resize:"vertical"},attrs:{placeholder:e.$t("m['请输入']")},domProps:{value:e.config.bodyValue},on:{input:function(t){t.target.composing||e.$set(e.config,"bodyValue",t.target.value)}}}),e._v(" "),t("ul",{directives:[{name:"show",rawName:"v-show",value:0!==e.rawVarList.length,expression:"rawVarList.length !== 0"}],staticClass:"raw-select",style:{left:e.left+"px",top:e.top+"px"}},e._l(e.rawVarList,(function(n,i){return t("li",{key:i,on:{click:function(t){return e.handleSelectContent(n)}}},[e._v("\n            "+e._s(n.name)+"\n            "),t("span",{staticClass:"variable-key"},[e._v("("+e._s(n.key)+")")])])})),0)]:e._e()],2)]:e._e(),e._v(" "),"headers"===e.acticeTab?[t("div",{staticClass:"param-config"},[t("params-table",{attrs:{list:e.config.headers,disable:e.disable,"state-list":e.stateList,"is-status":e.isStatus}})],1)]:e._e(),e._v(" "),"settings"===e.acticeTab?[t("div",{staticClass:"param-config"},[t("div",{staticClass:"setting-option"},[t("p",{staticClass:"mb5"},[e._v(e._s(e.$t("m['请求超时']")))]),e._v(" "),t("div",{staticClass:"setting-content"},[t("bk-input",{attrs:{type:"number",behavior:"simplicity",max:1e3,min:0},model:{value:e.config.settings.timeout,callback:function(t){e.$set(e.config.settings,"timeout",t)},expression:"config.settings.timeout"}}),e._v(" "),t("span",{staticStyle:{"margin-left":"5px"}},[e._v("s")])],1)])])]:e._e()],2)},a=[];i._withStripped=!0},h4G3:function(e,t,n){"use strict";n("nTEs")},hA3y:function(e,t,n){"use strict";n.r(t);var i=n("tl4E"),a=n("jvs4");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("CQIX");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"7add65fd",null);t.default=s.exports},hAcJ:function(e,t,n){"use strict";n.r(t);var i=n("zfNu"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"hF++":function(e,t,n){},hHxK:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("QbLZ")),a=s(n("q9fp")),r=n("L2JU"),o=s(n("b1K/"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"changeConductor",components:{memberInfo:a.default},props:{itemInfo:{type:Object,default:function(){return{}}},origin:{type:String,default:"normal"},index:{type:Number},isShowVar:{type:Boolean,default:function(){return!0}}},data:function(){return{precision:0,insertValue:"",variableList:[]}},computed:(0,i.default)({globalChoise:function(){return this.$store.state.common.configurInfo}},(0,r.mapState)("trigger",{triggerVariables:function(e){return e.triggerVariables}})),watch:{triggerVariables:function(e){this.variableList=e}},created:function(){if(("SELECT"===this.itemInfo.type||"MULTISELECT"===this.itemInfo.type)&&this.itemInfo.use_variable&&!this.itemInfo.choice.some((function(e){return"VARIABLE"===e.key}))){this.itemInfo.choice.push({key:"VARIABLE",name:"引用变量"});var e="MULTISELECT"===this.itemInfo.type?[]:"";this.$set(this.itemInfo,"insertValue",e)}this.$set(this.itemInfo,"referenceType",this.itemInfo.referenceType||"custom"),this.itemInfo.ref_type?(this.itemInfo.referenceType=this.itemInfo.ref_type,"reference"===this.itemInfo.ref_type?"SELECT"!==this.itemInfo.type&&"MULTISELECT"!==this.itemInfo.type||(this.itemInfo.insertValue="MULTISELECT"===this.itemInfo.type?this.itemInfo.value.split(","):this.itemInfo.value,this.itemInfo.value="VARIABLE"):"MULTISELECT"===this.itemInfo.type&&(this.itemInfo.value=this.itemInfo.value?this.itemInfo.value.split(","):[])):"MULTISELECT"===this.itemInfo.type&&(this.itemInfo.value=this.itemInfo.value?this.itemInfo.value.split(","):[])},mounted:function(){this.variableList=this.triggerVariables},methods:{changeInsert:function(e){this.itemInfo.value=(0,o.default)(this.$el.querySelector(".bk-form-textarea, .bk-form-input"),"conductorId"+this.index,this.itemInfo.value,"${"+e+"}",this),this.itemInfo.referenceType="import",this.insertValue=""},changeImport:function(){this.itemInfo.referenceType="reference"},changeMessagePanel:function(e){e&&"message"===this.origin&&this.$emit("change-panel-status")}}}},hSKY:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("ygAv");t.default={name:"SelectTree",components:{},model:{prop:"value",event:"selected"},props:{list:{type:Array,default:function(){return[]}},value:{type:[Number,String,Array],default:""},extCls:{type:String,default:""},organizationLoading:Boolean},data:function(){return{isShowTree:!1,displayName:"",displayList:[],checked:null}},watch:{list:function(){this.initData()},isShowTree:function(e){e&&this.setTreeNodeTitle()}},created:function(){this.initData()},methods:{nodeClickOne:function(e){this.checked=e,this.$emit("toggle",e),this.$emit("selected",e.id),this.setDispalyName(),this.closeTree()},asyncLoadNodes:function(e){var t=this;this.$set(e,"loading",!0),this.$store.dispatch("cdeploy/getTreeInfoChildren",{id:e.id}).then((function(n){n.data.children.forEach((function(e){t.setCheckedValue(e)})),t.$set(e,"children",n.data.children||[])})),this.setTreeNodeTitle(),this.$set(e,"loading",!1)},setDispalyName:function(){this.displayName=this.checked.full_name},setTreeNodeTitle:function(){this.$nextTick((function(){document.querySelectorAll(".tree-node").forEach((function(e){e.title=e.innerText}))}))},setinitValue:function(e){var t=this;this.$store.dispatch("cdeploy/getTreeInfoChildren",{id:e}).then((function(e){t.checked=e.data,t.setDispalyName()}))},initData:function(){var e=this;this.displayList=(0,i.deepClone)(this.list),this.displayList.length&&this.displayList.forEach((function(t){e.setCheckedValue(t)})),this.value&&0!==this.value.length&&this.setinitValue(Number(this.value)),this.checked&&this.$emit("change",(0,i.deepClone)(this.checked))},setCheckedValue:function(e){this.$set(e,"expanded",!1),this.$set(e,"async",e.has_children)},showTree:function(){this.loading||(this.isShowTree=!0)},closeTree:function(){this.isShowTree=!1}}}},hftF:function(e,t,n){"use strict";n.r(t);var i=n("gMgb"),a=n("sRDs");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("6jts"),n("dD0k");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"75b3441b",null);t.default=s.exports},hj6f:function(e,t,n){"use strict";n("Zicn")},"hk/f":function(e,t,n){"use strict";n.r(t);var i=n("x6yq"),a=n("C6tm");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("lI7c");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"0bbd7fbd",null);t.default=s.exports},hmS1:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("m1cH")),a=l(n("gDS+")),r=l(n("GQeE")),o=l(n("14Xm")),s=l(n("D3Ub")),c=l(n("VflG"));function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"postParam",mixins:[c.default],props:{changeInfo:{type:Object,default:function(){return{}}},apiDetail:{type:Object,default:function(){}},stateList:{type:Array,default:function(){return[]}},isStatic:{type:Boolean,default:function(){return!1}},isCustom:{type:Boolean,default:!1},bodyValue:{type:Object,default:function(){}},entry:{type:String,default:function(){return""}},formInfo:{type:Object,default:function(){return{}}}},data:function(){return{trueSatatus:!0,falseSatatus:!1,lala:{value:"111",offsetTop:""},bodyTableData:[],paramTableData:[],checkInfo:{name:"",road:""},sourceTypeList:[{id:1,key:"CUSTOM",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"FIELDS",name:this.$t('m.treeinfo["引用变量"]')}],paramTableInfo:{value:"",placeholder:this.$t('m.treeinfo["请选择数据来源"]')}}},computed:{tableList:function(){return this.bodyTableData.filter((function(e){return e.isShow}))}},watch:{apiDetail:function(){this.initData()}},mounted:function(){var e=this;return(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.isStatic;case 2:return t.next=4,e.bodyValue;case 4:return t.next=6,e.initData();case 6:case"end":return t.stop()}}),t,e)})))()},methods:{initData:function(){this.bodyTableDataChange()},bodyTableDataChange:function(){var e=this;return(0,s.default)(o.default.mark((function t(){var n;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((0,r.default)(e.apiDetail.req_body).length){t.next=5;break}e.apiDetail.treeDataList=[{has_children:!1,showChildren:!0,checkInfo:!1,key:"root",is_necessary:!0,type:"object",desc:e.$t('m.treeinfo["初始化数据"]'),parentInfo:"",children:[]}],e.apiDetail.bodyTableData=[],t.next=12;break;case 5:return t.next=7,e.jsonschemaToList({root:JSON.parse((0,a.default)(e.apiDetail.req_body))});case 7:return e.apiDetail.treeDataList=t.sent,e.isStatic||e.isCustom?e.apiDetail.treeDataList=e.jsonValueToTree(e.bodyValue,JSON.parse((0,a.default)(e.apiDetail.treeDataList))):e.changeInfo.api_info&&e.changeInfo.api_info.remote_api_id===e.apiDetail.id&&(e.apiDetail.treeDataList=e.jsonValueToTree(e.changeInfo.api_info.req_body,JSON.parse((0,a.default)(e.apiDetail.treeDataList)))),t.next=11,e.treeToTableList(JSON.parse((0,a.default)(e.apiDetail.treeDataList[0].children)));case 11:e.apiDetail.bodyTableData=t.sent;case 12:return t.next=14,JSON.parse((0,a.default)(e.apiDetail.bodyTableData));case 14:return n=t.sent,t.next=17,n.forEach((function(e){e.isCheck=!1,e.isSatisfied=!1,e.el=null,e.customValue=e.value||"",e.name=e.key||"",e.children=[],e.source_type=e.source_type||"CUSTOM",e.value=void 0!==e.value?e.value:"",e.value_key=void 0!==e.value_key&&e.value_key.toString()?e.value_key:""}));case 17:return t.next=19,e.recordChildren(n);case 19:return t.next=21,n;case 21:e.bodyTableData=t.sent;case 22:case"end":return t.stop()}}),t,e)})))()},recordChildren:function(e,t){for(var n=e.map((function(e){return e.level})),a=Math.max.apply(Math,(0,i.default)(n)),r=function(t){e.filter((function(e){return e.level===t})).forEach((function(t){!function(e,t){e.filter((function(e){return e.level===t.level-1&&e.primaryKey===t.parentPrimaryKey&&e.ancestorsList.toString()===t.ancestorsList.slice(0,-1).toString()}))[0].children.push(t)}(e,t)}))},o=a;o>(t||0);o--)r(o)},changeState:function(e){e.showChildren=!e.showChildren,e.children.forEach((function(t){t.isShow=e.showChildren})),e.showChildren||this.closeChildren(e)},closeChildren:function(e){var t=this;e.children.forEach((function(e){e.isShow=!1,e.has_children&&(e.showChildren=!1,t.closeChildren(e))}))},changeType:function(){},countChildren:function(e){var t=this;return(0,s.default)(o.default.mark((function n(){var i,a;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=0,a=function e(t){if(t.children&&t.children.length)for(var n=0;n<t.children.length;n++)i+=1,e(t.children[n])},t.next=4,a(e);case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),n,t)})))()},cleanValue:function(e){var t=this;return(0,s.default)(o.default.mark((function n(){var i,r;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=JSON.parse((0,a.default)(e)),r=function e(t){if(t.value="",t.source_type="CUSTOM",t.children&&t.children.length)for(var n=0;n<t.children.length;n++)e(t.children[n])},t.next=4,r(i);case 4:return t.abrupt("return",i);case 5:case"end":return t.stop()}}),n,t)})))()},countSon:function(e){return 1===this.bodyTableData.filter((function(t){return t.level===e.level-1&&t.primaryKey===e.parentPrimaryKey}))[0].children.length},addChildren:function(e){var t=this;return(0,s.default)(o.default.mark((function n(){var r,s,c,l,u,d;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return s=t.bodyTableData.filter((function(t){return t.level===e.level-1&&t.primaryKey===e.parentPrimaryKey}))[0],c=t.bodyTableData.indexOf(s)+1,n.next=4,t.countChildren(s);case 4:return l=n.sent,n.next=7,t.cleanValue(s.children[0]);case 7:return u=n.sent,n.next=10,t.treeToTableList(JSON.parse((0,a.default)([].concat((0,i.default)(s.children),[u]))),s.level+1,s.primaryKey,"array",s.ancestorsList);case 10:return d=n.sent,n.next=13,d.forEach((function(e){e.children=[]}));case 13:return s.children=d.filter((function(e){return e.level===s.level+1})),n.next=16,t.recordChildren(d,s.level+1);case 16:(r=t.bodyTableData).splice.apply(r,[c,l].concat((0,i.default)(d)));case 17:case"end":return n.stop()}}),n,t)})))()},deletChildren:function(e){var t=this;return(0,s.default)(o.default.mark((function n(){var i,a,r;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.countSon(e)){n.next=2;break}return n.abrupt("return");case 2:if(!((i=t.bodyTableData.filter((function(t){return t.level===e.level-1&&t.primaryKey===e.parentPrimaryKey}))[0].children).length<=1)){n.next=5;break}return n.abrupt("return");case 5:return i.splice(i.indexOf(e),1),a=t.bodyTableData.indexOf(e),n.next=9,t.countChildren(e);case 9:r=n.sent,t.bodyTableData.splice(a,r+1);case 11:case"end":return n.stop()}}),n,t)})))()},changeField:function(e,t){var n=this;return(0,s.default)(o.default.mark((function e(){return o.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:case"end":return e.stop()}}),e,n)})))()},addNewItem:function(e){this.$emit("addNewItem",e)}}}},hocR:function(e,t,n){"use strict";n("22hR")},"hv+2":function(e,t,n){"use strict";n.r(t);var i=n("OjZH"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},iGEm:function(e,t,n){"use strict";n("6z7N")},iUS4:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-basic-node"},[t("basic-card",{attrs:{"card-label":e.$t("m.treeinfo['基本信息']")}},[t("bk-form",{ref:"basicsForm",attrs:{"data-test-id":"service-form-sopsNode","label-width":150,model:e.basicsFormData,rules:e.rules,"ext-cls":"bk-form","form-type":"vertical"}},[t("bk-form-item",{attrs:{"data-test-id":"sopsNode-select-nodeName",label:e.$t("m.treeinfo['节点名称：']"),"error-display-type":"normal",required:!0,property:"name"}},[t("bk-input",{attrs:{"ext-cls":"bk-form-width",maxlength:"120"},model:{value:e.basicsFormData.name,callback:function(t){e.$set(e.basicsFormData,"name",t)},expression:"basicsFormData.name"}})],1),e._v(" "),t("desc-info",{model:{value:e.basicsFormData.desc,callback:function(t){e.$set(e.basicsFormData,"desc",t)},expression:"basicsFormData.desc"}}),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"sopsNode-select-processType","error-display-type":"normal",label:e.$t("m['流程类型：']"),required:!0,property:"processType"}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",placeholder:e.$t("m['请选择流程类型']"),searchable:""},on:{selected:e.getTemplateList},model:{value:e.basicsFormData.processType,callback:function(t){e.$set(e.basicsFormData,"processType",t)},expression:"basicsFormData.processType"}},e._l(e.processOptions,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"sopsNode-select-business","error-display-type":"normal",label:e.$t("m['关联业务：']"),required:!0,property:"projectId"}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",placeholder:e.$t("m['请选择关联业务']"),searchable:"",disabled:e.processDisable},on:{clear:e.onClearProcess,selected:e.getProjectTemplateList},model:{value:e.basicsFormData.projectId,callback:function(t){e.$set(e.basicsFormData,"projectId",t)},expression:"basicsFormData.projectId"}},e._l(e.projectList,(function(n){return t("bk-option",{key:n.bk_biz_id,attrs:{id:n.bk_biz_id,name:n.name}},[e._v("\n            "+e._s(n.name)),t("span",{staticStyle:{"font-size":"12px",color:"#ded6d7"}},[e._v("  "+e._s("("+n.bk_biz_id+")"))])])})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"sopsNode-select-processTemplate",label:e.$t("m['流程模板：']"),"error-display-type":"normal",required:!0,property:"templateId"}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",placeholder:e.$t("m['请选择流程模板']"),searchable:"",disabled:e.templateDisable,loading:e.processesLoading},on:{clear:e.onClearTemplate,selected:e.getTemplateDetail},model:{value:e.basicsFormData.templateId,callback:function(t){e.$set(e.basicsFormData,"templateId",t)},expression:"basicsFormData.templateId"}},e._l(e.templateList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m['执行方案：']")}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",disabled:e.planDisable,placeholder:e.$t("m['选择执行方案，默认选择全部任务节点']"),multiple:"",clearable:!0,loading:e.planLoading},on:{selected:e.onplanSelect},model:{value:e.basicsFormData.planId,callback:function(t){e.$set(e.basicsFormData,"planId",t)},expression:"basicsFormData.planId"}},e._l(e.planList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"sopsnode-component-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{"show-overbook":!0,value:e.processorsInfo,"node-info":e.configur,"exclude-role-type-list":e.excludeProcessor}})],1)])],1),e._v(" "),t("div",{staticClass:"sops-params-title"},[t("p",[e._v(e._s(e.$t("m.treeinfo['输入参数']"))+":")]),e._v(" "),t("p",[e._v(e._s(e.$t("m.treeinfo['调用该API需要传递的参数信息']")))])]),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.sopsFormLoading},expression:"{ isLoading: sopsFormLoading }"}],staticClass:"bk-param"},[0!==e.constants.length?t("sops-get-param",{ref:"getParam",attrs:{configur:e.configur,"param-table-data":e.paramTableData,"state-list":e.stateList,fields:e.fieldList,context:e.context,"init-form-date":e.initFormDate,constants:e.constants,"hooked-var-list":e.hookedVarList,"constant-default-value":e.constantDefaultValue,"quote-vars":e.quoteVars,"flow-info":e.flowInfo},on:{onChangeHook:e.onChangeHook}}):t("no-data"),e._v(" "),t("common-trigger-list",{attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"mt20",staticStyle:{"font-size":"0"}},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"sopsNode-button-submit",title:e.$t("m.treeinfo['确定']"),loading:e.secondClick},on:{click:e.submit}},[e._v("\n          "+e._s(e.$t("m.treeinfo['确定']"))+"\n        ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"sopsNode-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n          "+e._s(e.$t("m.treeinfo['取消']"))+"\n        ")])],1)],1)],1)],1)},a=[];i._withStripped=!0},iYOz:function(e,t,n){},ibAw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(n("4d7F"));t.default=function(e,t){return new i.default((function(n){window.app.$bkInfo({title:e||a.default.$t('m["确定离开当前页？"]'),subTitle:t||a.default.$t('m["离开将会导致未保存信息丢失"]'),okText:a.default.$t('m["离开"]'),confirmFn:function(){return n(!0)},cancelFn:function(){return n(!1)}})}))};var a=r(n("EstQ"));function r(e){return e&&e.__esModule?e:{default:e}}},iesT:function(e,t,n){"use strict";n.r(t);var i=n("bddw"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},in5P:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild&&!e.loading?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"ext-cls":"bk-line-height","desc-type":"icon"}},[t("bk-checkbox-group",{ref:e.item.key,attrs:{value:e.selects},on:{change:e.selected}},e._l(e.item.choice,(function(n){return t("bk-checkbox",{key:n.key,attrs:{value:n.key,disabled:e.disabled,"ext-cls":"mr20"}},[e._v(e._s(n.name)+"\n      ")])})),1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},ioCs:function(e,t,n){"use strict";n.r(t);var i=n("11QV"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},j7Oh:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("QbLZ")),a=c(n("14Xm")),r=c(n("D3Ub")),o=c(n("efIh")),s=c(n("2Vgw"));function c(e){return e&&e.__esModule?e:{default:e}}t.default={name:"INPUTSELECT",mixins:[o.default],props:{item:{type:Object,default:function(){return{}}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{options:[],addStatus:!1,tempChoice:{name:"",key:""}}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)},"item.choice":function(e,t){"API"!==this.item.source_type&&"DATADICT"!==this.item.source_type&&"RPC"!==this.item.source_type||t.length===e.length||this.getOption()}},mounted:function(){var e=this;return(0,r.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return!e.item.val&&e.item.value&&(e.item.val=e.item.value),t.next=3,e.getOption();case 3:n=e.judgeValue(e.item.val,e.item.choice),e.item.val=n?e.item.val:"",e.conditionField(e.item,e.fields);case 6:case"end":return t.stop()}}),t,e)})))()},methods:{getOption:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFieldOptions(e.item);case 2:e.item.choice=t.sent,e.options=e.item.choice;case 4:case"end":return t.stop()}}),t,e)})))()},selected:function(){var e=this;this.item.related_fields&&this.item.related_fields.be_relied&&this.item.related_fields.be_relied.forEach((function(t){e.fields.forEach((function(e){t===e.key&&(e.value="",e.val=e.value)}))}))},giveDefaultKey:function(){var e=this;this.tempChoice.name&&!this.tempChoice.key&&(this.tempChoice.key="",(0,s.default)(this.tempChoice.name,{style:s.default.STYLE_NORMAL,heteronym:!1}).forEach((function(t){e.tempChoice.key+=""+t})),this.tempChoice.key=this.tempChoice.key.toUpperCase().replace(/\ /g,"_"),this.tempChoice.key.length>=32&&(this.tempChoice.key=this.tempChoice.key.substr(0,32)))},confirmAdd:function(){this.tempChoice.name&&(this.addStatus=!1,this.options.push((0,i.default)({},this.tempChoice,{can_delete:!0})),this.item.val=this.tempChoice.key,this.tempChoice.key="",this.tempChoice.name=this.tempChoice.key)},cancelAdd:function(){this.addStatus=!1,this.tempChoice.key="",this.tempChoice.name=this.tempChoice.key},handleDeleteOption:function(e){e===this.item.val&&(this.item.val=""),this.options=this.options.filter((function(t){return t.key!==e}))}}}},"jD+q":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-customtable-data"},e._l(e.customTableInfo.list,(function(n,i){return t("div",{key:i,staticClass:"bk-custom-line",class:{mb10:i!==e.customTableInfo.list.length-1}},[t("bk-input",{attrs:{"ext-cls":"bk-custom-input",clearable:!0,placeholder:e.$t("m.treeinfo['请输入名称']")},model:{value:n.name,callback:function(t){e.$set(n,"name",t)},expression:"item.name"}}),e._v(" "),t("bk-checkbox",{staticStyle:{float:"left","margin-right":"10px","line-height":"32px"},attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus},model:{value:n.required,callback:function(t){e.$set(n,"required",t)},expression:"item.required"}},[e._v("\n      "+e._s(e.$t("m.treeinfo['必填']"))+"\n    ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-custom-small",clearable:!1,searchable:""},model:{value:n.display,callback:function(t){e.$set(n,"display",t)},expression:"item.display"}},e._l(e.typeList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),t("textarea",{directives:[{name:"model",rawName:"v-model.trim",value:n.choice,expression:"item.choice",modifiers:{trim:!0}}],staticClass:"bk-form-textarea bk-textarea-tanble",staticStyle:{width:"180px","min-height":"32px"},attrs:{placeholder:e.$t("m.treeinfo['请输入，Enter分隔']"),disabled:"select"!==n.display&&"multiselect"!==n.display},domProps:{value:n.choice},on:{input:function(t){t.target.composing||e.$set(n,"choice",t.target.value.trim())},blur:function(t){return e.$forceUpdate()}}}),e._v(" "),t("div",{staticClass:"bk-custom-icon"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addTableData(n,i)}}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":1===e.customTableInfo.list.length},on:{click:function(t){return e.reduceTableData(n,i)}}})])],1)})),0)},a=[];i._withStripped=!0},"jF+y":function(e,t,n){"use strict";n.r(t);var i=n("nveJ"),a=n("+fOZ");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("ZBhg");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"1b6c9754",null);t.default=s.exports},jFOa:function(e,t,n){"use strict";n.r(t);var i=n("gdLX"),a=n("eofb");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},jIqJ:function(e,t,n){"use strict";n("0kDG")},jK1o:function(e,t,n){},"jNP/":function(e,t,n){"use strict";n("0T5/")},jUNn:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modify-fields"},[t("bk-form-item",{attrs:{"ext-cls":"bk-field-schema",label:e.fieldKeyItem.name,required:e.fieldKeyItem.required,desc:e.fieldKeyItem.tips}},[t("bk-select",{staticStyle:{width:"270px"},attrs:{"ext-cls":"bk-insert-info",searchable:""},on:{selected:e.selectedFieldKey},model:{value:e.fieldKeyItem.value,callback:function(t){e.$set(e.fieldKeyItem,"value",t)},expression:"fieldKeyItem.value"}},e._l(e.fieldKeyItem.choice,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),e.fieldKeyItem.value?[t("bk-form-item",{attrs:{"ext-cls":"bk-field-schema",label:e.fieldValueItem.name,required:e.fieldValueItem.required,desc:e.fieldValueItem.tips}},[t("div",{staticStyle:{float:"left",width:"268px"}},[t("bk-select",{attrs:{clearable:!1,searchable:""},on:{selected:e.selectedReference},model:{value:e.fieldValueItem.referenceType,callback:function(t){e.$set(e.fieldValueItem,"referenceType",t)},expression:"fieldValueItem.referenceType"}},e._l(e.sourceTypeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),"custom"===e.fieldValueItem.referenceType?t("div",{staticStyle:{float:"left",width:"268px","margin-left":"10px"}},[e.show?t("field-info",{attrs:{fields:e.fieldValueItem.itemInfo,origin:"trigger"}}):e._e()],1):e._e(),e._v(" "),"reference"===e.fieldValueItem.referenceType?t("div",{staticStyle:{float:"left",width:"268px","margin-left":"10px"}},[t("bk-select",{staticStyle:{width:"270px"},attrs:{"ext-cls":"bk-insert-info",searchable:""},model:{value:e.fieldValueItem.itemInfo[0].value,callback:function(t){e.$set(e.fieldValueItem.itemInfo[0],"value",t)},expression:"fieldValueItem.itemInfo[0].value"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1):e._e()])]:e._e()],2)},a=[];i._withStripped=!0},jWBk:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("4d7F")),a=d(n("m1cH")),r=d(n("GQeE")),o=d(n("vUrO")),s=d(n("pIur")),c=d(n("s4tT")),l=d(n("PIEm")),u=d(n("bcjM"));function d(e){return e&&e.__esModule?e:{default:e}}t.default={name:"webHookNode",components:{BasicCard:c.default,dealPerson:l.default,commonTriggerList:u.default,requestConfig:s.default,descInfo:o.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}},isStatus:{type:Boolean,default:function(){return!0}},disable:{type:Boolean,default:function(){return!1}},taskErrorTip:{type:Boolean,default:function(){return!1}}},data:function(){return{isLoading:!1,secondClick:!1,isDropdownShow:!1,curEq:"GET",requestOptions:["GET","POST"],formData:{name:"",desc:"",url:"",success_exp:""},rules:{name:[{required:!0,message:this.$t("m['必填项']"),trigger:"blur"}],url:[{required:!0,message:this.$t("m['必填项']"),trigger:"blur"},{validator:function(e){if(-1!==e.indexOf("{{"))return!0;return/(http|https):\/\/\S*/.test(e)},message:this.$t("m['必需以http://或https://开头']"),trigger:"blur"}]},returnReslut:[{name:"",ref_path:"",check:!1}],processorsInfo:{type:"",value:""},checkStatus:{delivers:!1,processors:!1},excludeProcessor:["EMPTY","OPEN"],isShowUrlVariable:!1,filterParams:"",stateList:[],errorTip:!1,urlField:""}},computed:{retrunResultIsEmtry:function(){return this.returnReslut.length<=1},filterVariableList:function(){if(!this.formData.url)return[];var e=this.formData.url.lastIndexOf("{{");if(-1!==e){var t=this.formData.url.substring(e+2,this.formData.url.length)||"";this.filterParams=t||"";var n=this.stateList.filter((function(e){return-1!==e.name.indexOf(t)||-1!==e.key.indexOf(t)}));return 0!==n.length&&this.$refs.urlInput.focus(),n}return[]},isShowDelete:function(){return this.returnReslut.length-1}},watch:{taskErrorTip:function(e){this.errorTip=e}},mounted:function(){this.getWebHookDetail(),this.getRelatedFields()},methods:{getWebHookDetail:function(){if(this.isStatus){if(console.log(this.configur),0!==(0,r.default)(this.configur.extras).length){var e=this.configur.extras.webhook_info,t=e.url,n=e.success_exp,i=e.method;this.formData.name=this.configur.name,this.formData.desc=this.configur.desc,this.formData.success_exp=n,this.formData.url=t,this.curEq=i,console.log(this.formData),this.processorsInfo.type=this.configur.processors_type,this.processorsInfo.value=this.configur.processors,this.returnReslut=0!==this.configur.variables.outputs.length?[].concat((0,a.default)(this.configur.variables.outputs),(0,a.default)(this.returnReslut)):[{name:"",ref_path:"",check:!1}]}}else{var o=this.configur.api_info.webhook_info,s=o.url,c=o.success_exp,l=o.method;this.formData.name=this.configur.name,this.formData.success_exp=c,this.formData.url=s,this.curEq=l}},getRelatedFields:function(){var e=this;if(this.isStatus){var t={workflow:this.flowInfo.id,state:this.configur.id,field:""};this.$store.dispatch("apiRemote/get_related_fields",t).then((function(t){e.stateList=t.data}))}},handleSelectContent:function(e){this.formData.url=this.formData.url.slice(0,-(this.filterParams.length+2))+"{{ "+e.key+"}}",this.$refs.urlInput.focus()},handleUrlChange:function(e){e.endsWith("{{")?this.isShowUrlVariable=!0:this.isShowUrlVariable=!1},selectRequsetOpt:function(e){this.curEq=e},closeNode:function(){this.$parent.closeConfigur()},addReturnReslut:function(){this.returnReslut.push({name:"",ref_path:"",check:!1})},changeReturnInput:function(e){e.check?[e.name,e.ref_path].every((function(e){return""===e}))&&(this.returnReslut.pop(),e.check=!1):(e.check=!0,this.returnReslut.push({name:"",ref_path:"",check:!1}))},changeFormStatus:function(e){this.errorTip=e},validate:function(){return this.$refs.webForm.validate()},deleteReturnReslut:function(e){if(!this.retrunResultIsEmtry){var t=this.returnReslut.indexOf(e);-1!==t&&this.returnReslut.splice(t,1)}},submit:function(){var e=this;i.default.all([this.$refs.processors.verifyValue(),this.$refs.webForm.validate()]).then((function(){var t=e.$refs.processors.getValue(),n=t.value,i=t.type,a=e.$refs.requestConfig.config,r=a.queryParams,o=a.bodyFormData,s=a.bodyWwwForm,c=a.authRadio,l=a.auth_config,u=a.settings,d=a.bodyValue,f=a.bodyRadio,p=a.rawType,m=a.headers,h=r.filter((function(e){return e.select})),v=e.returnReslut.filter((function(e){return""!==e.name}));v.forEach((function(e){e.source="global",e.type="string"}));var g={auth_type:"None"!==c?c:"",auth_config:{}},y=l.username,b=l.password,_=l.Token;"basic_auth"===c?(g.auth_config.username=y,g.auth_config.password=b):"bearer_token"===c&&(g.auth_config.token=_);var k=m.filter((function(e){return e.select})),w={type:"none"!==f?f:"",raw_type:"",content:""};"form-data"===f?w.content=o.filter((function(e){return e.select})):"x-www-form-urlencoded"===f?w.content=s.filter((function(e){return e.select})):"raw"===f&&(w.raw_type=p||"Text",w.content=d);var I={timeout:Number(u.timeout)},$={name:e.formData.name,desc:e.formData.desc||void 0,processors:n||"",processors_type:i||"",type:"WEBHOOK",is_draft:!1,extras:{webhook_info:{method:e.curEq,url:e.formData.url,query_params:h,auth:g,headers:k,body:w,settings:I,success_exp:e.formData.success_exp}},variables:{outputs:v,inputs:[]},workflow:e.configur.workflow};if("GET"===e.curEq?e.errorTip=!h.every((function(e){return""!==e.key&&""!==e.value})):"string"!=typeof w.content&&(e.errorTip=![w.content,h].every((function(e){return e.every((function(e){return""!==e.key&&""!==e.value}))}))),!e.errorTip&&!e.secondClick){e.secondClick=!0;var S=e.configur.id;e.$store.dispatch("cdeploy/putWebHook",{params:$,stateId:S}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$parent.closeConfigur()}),(function(e){console.log(e)})).finally((function(){e.secondClick=!1}))}}))}}}},jeD0:function(e,t,n){"use strict";n("qmm4")},jfEP:function(e,t,n){},jppy:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("rMih"),r=(i=a)&&i.__esModule?i:{default:i},o=n("ygAv");t.default={name:"sopsGetParam",components:{addField:r.default},props:{quoteVars:Array,constantDefaultValue:Object,context:{type:Object,default:function(){return{}}},constants:{type:Array,default:function(){return[]}},isStaticData:{type:Array,default:function(){return[]}},configur:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}},stateList:{type:Array,default:function(){return[]}},isStatic:{type:Boolean,default:function(){return!1}},hookedVarList:Object,isHook:{type:Boolean,default:function(){return!0}},isEdit:{type:Boolean,default:function(){return!0}},initFormDate:Object},data:function(){return{disabled:!1,ticketDisable:!1,disabledRenderForm:!1,configLoading:!1,quoteErrors:[],renderKey:"",formData:{},formOptions:{showRequired:!0,showGroup:!0,showLabel:!0,showHook:this.isHook,showDesc:!0,formEdit:!this.disabled&&!this.disabledRenderForm&&this.isEdit},fieldList:[],checkInfo:{name:"",road:""},biz:[{name:this.$t('m.treeinfo["业务"]'),custom_type:"",source_type:"custom",value:"--",key:1}],changeInfo:{workflow:"",id:"",key:"",name:"",type:"STRING",desc:"",layout:"COL_12",validate_type:"REQUIRE",choice:[],is_builtin:!1,source_type:"CUSTOM",source_uri:"",regex:"EMPTY",custom_regex:"",is_tips:!1,tips:""},sourceTypeList:[{id:1,key:"custom",name:this.$t('m.treeinfo["自定义"]')},{id:2,key:"component_inputs",name:this.$t('m.treeinfo["引用变量"]')}],sliderInfo:{title:this.$t('m.treeinfo["添加变量"]'),show:!1,width:700},showTabData:{},sopsTableInfo:[]}},computed:{},watch:{constants:{handler:function(){this.renderKey=(new Date).getTime()},deep:!0},isEdit:function(){this.renderKey=(new Date).getTime()}},mounted:function(){var e=this;this.isStatic&&(this.sopsTableInfo=[],this.isStaticData.forEach((function(t){var n={name:t.name,value:t.value};e.sopsTableInfo.push(n)})))},methods:{onHookChange:function(e,t){this.$emit("onChangeHook",t.tag_code,e);var n=this.constants.find((function(e){return e.key===t.tag_code}));if(n.is_quoted=e,e)this.formData[t.tag_code]="";else{this.formData[t.tag_code]=n?(0,o.deepClone)(this.constantDefaultValue[t.tag_code]):this.initFormDate[t.tag_code].value;var i=this.quoteErrors.findIndex((function(e){return e===t.tag_code}));i>-1&&this.quoteErrors.splice(i,1)}},changeTicketformDisable:function(e){this.$set(this.$refs.renderForm.formOption,"formEdit",e)},onSelectVar:function(e,t){this.formData[t.tag_code]="${"+e+"}"},getRenderFormValidate:function(){return this.$refs.renderForm.validate()},getRelatedFields:function(){this.$parent.getRelatedFields()},addNewItem:function(e){this.showTabData=e,this.sliderInfo.show=!0,this.$refs["selectSops"+e.key].close()},closeShade:function(){this.sliderInfo.show=!1},showNew:function(e,t){this.paramTableShow.forEach((function(n){n.key===e.key&&(n.value=t.data.key)}))}}}},jr9V:function(e,t,n){"use strict";n("HLWp")},jub7:function(e,t,n){"use strict";n.r(t);var i=n("f7Ks"),a=n("0rd9");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},jvs4:function(e,t,n){"use strict";n.r(t);var i=n("4lVZ"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},jzyo:function(e,t,n){"use strict";n.r(t);var i=n("sAov"),a=n("0Aq+");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("+iia");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"f755dc54",null);t.default=s.exports},k2IW:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{class:{"full-screen-wrap":e.isFull}},[e.isFull?t("div",{staticClass:"full-screen-header"},[t("span",{staticClass:"full-screen-title"},[e._v(e._s(e.title))]),e._v(" "),t("div",{staticClass:"full-exit-btn",on:{click:function(t){return t.stopPropagation(),e.onClose.apply(null,arguments)}}},[t("i",{staticClass:"bk-itsm-icon icon-order-close"}),e._v(" "),t("span",{staticClass:"exit-text"},[e._v(e._s(e.$t("m.common['退出全屏']")))])])]):e._e(),e._v(" "),t("div",{staticClass:"full-screen-content"},[e._t("default")],2)])},a=[];i._withStripped=!0},k5mY:function(e,t,n){},k85c:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("UsFA"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"RenderView",components:{ViewItem:r.default},props:{formData:{type:Array,default:function(){return[]}},context:{type:Object,default:function(){return{}}}},provide:function(){var e=this;return{getContext:function(){return e.context}}},data:function(){return{isRootRenderView:null,value:{}}},created:function(){this.initRenderView()},methods:{getScheme:function(e){return this.context.schemes[e.scheme]?this.context.schemes[e.scheme]:{}},initRenderView:function(){for(var e=this,t=!1;!t&&e.$parent;)"render-view"===e.$parent.$options._componentTag?t=!0:e=e.$parent;this.isRootRenderView=!t}}}},kAUb:function(e,t,n){"use strict";n.r(t);var i=n("iUS4"),a=n("E3ky");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("5xyE");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"2e7d6b1a",null);t.default=s.exports},kQq5:function(e,t,n){"use strict";n.r(t);var i=n("mE3A"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},kSST:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("14Xm")),a=o(n("D3Ub")),r=o(n("efIh"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"SELECT",mixins:[r.default],props:{item:{type:Object,default:function(){return{}}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{options:[]}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)},"item.choice":function(e,t){"API"!==this.item.source_type&&"DATADICT"!==this.item.source_type&&"RPC"!==this.item.source_type||t.length===e.length||this.getOption()}},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return!e.item.val&&e.item.value&&(e.item.val=e.item.value),t.next=3,e.getOption();case 3:n=e.judgeValue(e.item.val,e.item.choice),e.item.val=n?e.item.val:"",e.conditionField(e.item,e.fields);case 6:case"end":return t.stop()}}),t,e)})))()},methods:{getOption:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFieldOptions(e.item);case 2:e.item.choice=t.sent,e.options=e.item.choice;case 4:case"end":return t.stop()}}),t,e)})))()},selected:function(){var e=this;this.item.related_fields&&this.item.related_fields.be_relied&&this.item.related_fields.be_relied.forEach((function(t){e.fields.forEach((function(e){t===e.key&&(e.value="",e.val=e.value)}))}))}}}},kWbx:function(e,t,n){"use strict";n.r(t);var i=n("jWBk"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},kjRb:function(e,t,n){"use strict";n.r(t);var i=n("KElf"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},kvWR:function(e,t,n){"use strict";n("+LW1")},l3JT:function(e,t,n){"use strict";n("PLXv")},lAAG:function(e,t,n){"use strict";n.r(t);var i=n("jD+q"),a=n("9psX");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("SLTv");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"96b3fa0c",null);t.default=s.exports},lI7c:function(e,t,n){"use strict";n("vT7S")},lNfD:function(e,t,n){},lR6s:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("2eEL"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"Tree",components:{collapseTransition:r.default},props:{treeDataList:{type:Array,default:[]},treeIndex:{type:Number,default:0}},data:function(){return{pLeft:"padding-left:"+15*(this.treeIndex+1)+"px; padding-right: 10px;"}},methods:{toggleChildren:function(e){this.$emit("toggleChildren",e)},toggle:function(e){this.$emit("toggle",e)}}}},lSBQ:function(e,t,n){"use strict";n("WenH")},lVyC:function(e,t,n){"use strict";n("MX/Q")},lWSq:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("14Xm")),a=c(n("D3Ub")),r=c(n("efIh")),o=c(n("u8Ap")),s=c(n("EP+X"));function c(e){return e&&e.__esModule?e:{default:e}}t.default={name:"MEMBERS",components:{memberSelect:o.default,businessCard:s.default},mixins:[r.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{selectedItems:[]}},watch:{"item.val":function(e){this.selectedItems=e?e.split(","):[]}},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.selectedItems=e.item.val?e.item.val.split(","):[],e.conditionField(e.item,e.fields);case 2:case"end":return t.stop()}}),t,e)})))()},methods:{onMemberSelectChange:function(e){this.item.val=e.join(",")}}}},lXJ6:function(e,t,n){"use strict";n.r(t);var i=n("+CIw"),a=n("yX+q");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("Dsai");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"6192534b",null);t.default=s.exports},lpJK:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-table",{attrs:{data:e.item.val,size:"small"}},[e._l(e.item.meta.columns,(function(n){return[t("bk-table-column",{key:n.key,attrs:{label:n.name},scopedSlots:e._u([{key:"default",fn:function(i){return["input"===n.display?[t("bk-input",{attrs:{clearable:!0,disabled:e.disabled},model:{value:i.row[n.key],callback:function(t){e.$set(i.row,n.key,t)},expression:"props.row[columnItem.key]"}})]:e._e(),e._v(" "),"select"===n.display?[t("bk-select",{attrs:{searchable:"","font-size":"medium","popover-min-width":180,disabled:e.disabled},model:{value:i.row[n.key],callback:function(t){e.$set(i.row,n.key,t)},expression:"props.row[columnItem.key]"}},e._l(n.choice,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e(),e._v(" "),"multiselect"===n.display?[t("bk-select",{attrs:{searchable:"",multiple:"","popover-min-width":180,"font-size":"medium",disabled:e.disabled,"show-select-all":""},model:{value:i.row[n.key],callback:function(t){e.$set(i.row,n.key,t)},expression:"props.row[columnItem.key]"}},e._l(n.choice,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e(),e._v(" "),"date"===n.display?[t("bk-date-picker",{attrs:{transfer:!0,disabled:e.disabled},model:{value:i.row[n.key],callback:function(t){e.$set(i.row,n.key,t)},expression:"props.row[columnItem.key]"}})]:e._e(),e._v(" "),"datetime"===n.display?[t("bk-date-picker",{attrs:{transfer:!0,disabled:e.disabled,type:"datetime"},model:{value:i.row[n.key],callback:function(t){e.$set(i.row,n.key,t)},expression:"props.row[columnItem.key]"}})]:e._e()]}}],null,!0)})]})),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.user['操作']"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-button",{attrs:{theme:"primary",text:"",disabled:e.disabled},on:{click:e.addOne}},[e._v("\n            "+e._s(e.$t('m.newCommon["添加"]'))+"\n          ")]),e._v(" "),t("bk-button",{attrs:{theme:"primary",text:"",disabled:e.disabled},on:{click:function(t){return e.deleteOne(n)}}},[e._v("\n            "+e._s(e.$t('m.newCommon["删除"]'))+"\n          ")])]}}],null,!1,3418295963)})],2)],1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2):e._e()},a=[];i._withStripped=!0},m4Da:function(e,t,n){},mE3A:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("rfXi")),a=s(n("R5iJ")),r=s(n("CXV/")),o=s(n("W3y+"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"bk-upload",props:{name:{type:String,default:"upload_file"},multiple:{type:Boolean,default:!0},accept:{type:String,default:"*"},delayTime:{type:Number,default:0},url:{required:!0,type:String},size:{type:[Number,Object],default:function(){return{maxFileSize:5,maxImgSize:1}}},handleResCode:{type:Function,default:function(e){return 0===e.code}},header:[Array,Object],tip:{type:String,default:""},validateName:{type:RegExp},withCredentials:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{dragText:"支持的附件格式：txt，log，pdf，doc，ppt，xls，docx，pptx，xlsx，zip，jpg，png，每个文件不超过200Mb",clickText:"点击上传",showDialog:!0,fileList:[],width:0,barEl:null,fileIndex:null,speed:0,total:0,unit:"kb/s",isdrag:!1,progress:0,uploadIcon:o.default}},watch:{fileIndex:function(e){null!==e&&e<this.fileList.length&&this.uploadFile(this.fileList[e],e)}},methods:{filesize:function(e){var t=e/1e3;if(t<1)return e.toFixed(3)+" KB";var n=t.toString().indexOf(".");return t.toString().slice(0,n+2)+" MB"},selectFile:function(e){var t=this,n=(0,i.default)(e.target.files);if(n.length){n.forEach((function(e,n){var i={name:e.name,originSize:e.size,size:e.size/1e3,maxFileSize:null,maxImgSize:null,type:e.type,fileHeader:"",origin:e,base64:"",status:"",done:!1,responseData:"",speed:null,errorMsg:"",progress:""},a=i.type.indexOf("/"),r=i.type.slice(0,a),o=i.type.indexOf("application/x-photoshop")>-1;i.fileHeader=r,"number"==typeof t.size?(i.maxFileSize=t.size,i.maxImgSize=t.size):(i.maxFileSize=t.size.maxFileSize,i.maxImgSize=t.size.maxImgSize),("image"===r||o)&&t.handleImage(i,e),("image"!==r||!o)&&i.size>1e3*i.maxFileSize&&(i.errorMsg="文件不能超过"+i.maxFileSize+"MB"),t.validateName&&(t.validateName.test(i.name)||(i.errorMsg="文件名不合法")),t.fileList.push(i)}));var a=this.fileList.length,r=this.fileIndex;a-1===r?this.uploadFile(this.fileList[r],r):this.fileIndex=0,e.target.value=""}},hideFileList:function(){var e=this;this.delayTime&&setTimeout((function(){e.fileList=[]}),this.delayTime)},uploadFile:function(e){var t=this;if(e.errorMsg)return this.fileIndex+=1,void(e.progress="100%");var n=new FormData,i=new XMLHttpRequest;n.append(this.name,e.origin),this.isdrag=!1,e.xhr=i,i.onreadystatechange=function(){if(4===i.readyState){try{var n=JSON.parse(i.responseText);200===i.status&&t.handleResCode(n)?(e.done=!0,e.responseData=n,t.$emit("on-success",t.fileList)):(e.errorMsg=n.message,t.$emit("on-error",e,t.fileList))}catch(t){e.progress="100%",e.errorMsg=error.message}t.fileIndex+=1,t.unit="kb/s",t.total=0,e.status="done",t.fileIndex===t.fileList.length&&(t.$emit("on-done",t.fileList),t.hideFileList())}};if(i.upload.addEventListener("progress",(function(n){if(n.lengthComputable){var i=Math.round(100*n.loaded/n.total),a=Math.round(n.loaded/1e3);e.progress=i+"%",t.speed=a-t.total,t.total=a,t.unit="kb/s",t.speed>1e3&&(t.speed=Math.round(t.speed/1e3),t.unit="mb/s"),t.$emit("on-progress",n,e,t.fileList)}e.status="running"}),!1),i.withCredentials=this.withCredentials,i.open("POST",this.url,!0),this.header)if(Array.isArray(this.header))this.header.forEach((function(e){var n=t.header.name,a=t.header.value;i.setRequestHeader(n,a)}));else{var a=this.header.name,r=this.header.value;i.setRequestHeader(a,r)}i.send(n)},handleImage:function(e,t){var n=this;if(!/image\/(jpg|png|jpeg)$/.test(e.type))return e.errorMsg="只允许上传JPG|PNG|JPEG格式的图片",!1;if(e.size>1e3*e.maxImgSize)return e.errorMsg="图片大小不能超过"+e.maxImgSize+"MB",!1;var i=new FileReader;return i.onload=function(t){n.smallImage(i.result,e)},i.readAsDataURL(t),!0},smallImage:function(e,t){var n=new Image,i=document.createElement("canvas"),a=i.getContext("2d");n.onload=function(){var e=n.width,r=n.height,o=e,s=r;(e>42||r>42)&&(e/r>1?(o=42,s=Math.round(r/e*42)):(o=42,s=42)),i.width=o,i.height=s,a.clearRect(0,0,o,s),a.drawImage(n,0,0,o,s),t.base64=i.toDataURL()},n.src=e},getIcon:function(e){if(e.base64)return e.base64;for(var t=!1,n=["zip","rar","tar","gz"],i=0;i<n.length;i++)if(e.type.indexOf(n[i])>-1){t=!0;break}return t?a.default:r.default},deleteFile:function(e,t){t.xhr&&t.xhr.abort(),this.fileList.splice(e,1);var n=this.fileList.length;n||(this.fileIndex=null),0===e&&n&&(this.fileIndex=0,this.uploadFile(this.fileList[0]))}},mounted:function(){var e=this,t=this.$refs.uploadel;t.addEventListener("dragenter",(function(t){e.isdrag=!0})),t.addEventListener("dragleave",(function(t){e.isdrag=!1})),t.addEventListener("dragend",(function(t){e.isdrag=!1}))}}},mOxC:function(e,t,n){"use strict";n("aRCN")},mVIP:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},["CUSTOM-FORM"===e.item.type?t("p",{staticClass:"mt5 mb0 f12",staticStyle:{color:"#c4c6cc"},attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.$t('m["当前字段为自定义表单"]')))]):e._e(),e._v(" "),t("render-view",{attrs:{"form-data":e.formData,context:e.context}})],1),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2):e._e()},a=[];i._withStripped=!0},mW7z:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("P2sY"),r=(i=a)&&i.__esModule?i:{default:i},o=n("CeR/");t.default={name:"dataSource",components:{},mixins:[],props:{formInfo:{type:Object,default:function(){return{}}},prcData:{type:Object,default:function(){return{}}},dictionaryData:{type:Object,default:function(){return{}}},apiInfo:{type:Object,default:function(){return{}}},changeInfo:{type:Object,default:function(){return{}}}},data:function(){return{typeClass:"",isApiLoading:!1,isSystemLoading:!1,sourceList:[],apiSysList:[],apiPortList:[]}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo},dataSourceDisable:function(){return(this.changeInfo.is_builtin||"TABLE"===this.changeInfo.source||this.changeInfo.meta&&"APPROVE_RESULT"===this.changeInfo.meta.code)&&"bk_biz_id"!==this.formInfo.key}},watch:{"formInfo.type":function(){this.initData(),this.getSourceList()}},mounted:function(){this.initData(),this.getSourceList()},methods:{initData:function(){this.typeClass="API"===this.formInfo.source_type?"bk-threeline-item bk-halfline-margin":"bk-halfline-item bk-halfline-margin",this.getApiSystemList(),"API"===this.formInfo.source_type&&this.apiInfo.remote_system_id&&this.getApiPortList(this.apiInfo.remote_system_id)},getSourceList:function(){var e=this.globalChoise.source_type.filter((function(e){return"CUSTOM_API"!==e.typeName}));"TABLE"===this.formInfo.type?this.sourceList=e.filter((function(e){return"CUSTOM"===e.typeName})):"TREESELECT"===this.formInfo.type?this.sourceList=e.filter((function(e){return"DATADICT"===e.typeName||"RPC"===e.typeName})):this.sourceList=e},getApiSystemList:function(){var e=this,t={project_key:this.$store.state.project.id||"public"};this.isSystemLoading=!0,this.$store.dispatch("apiRemote/get_all_remote_system",t).then((function(t){e.apiSysList=t.data.filter((function(e){return e.is_activated}))})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.isSystemLoading=!1}))},getApiPortList:function(e){var t=this,n={remote_system:e||""};this.isApiLoading=!0,this.$store.dispatch("apiRemote/get_remote_api",n).then((function(e){t.apiPortList=e.data.filter((function(e){return e.is_activated}));var n=t.apiPortList.filter((function(e){return String(e.id)===String(t.apiInfo.remote_api_id)}))[0],i=(0,r.default)({},n);t.$emit("changeApiInfo",i)})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.isApiLoading=!1}))},changeApiPort:function(e){this.apiInfo.rsp_data="",this.apiInfo.req_params={},this.apiInfo.req_body={};var t=this.apiPortList.filter((function(t){return String(t.id)===String(e)}))[0],n=(0,r.default)({},t);this.$emit("changeApiInfo",n)},changeSource:function(){this.typeClass="API"===this.formInfo.source_type?"bk-threeline-item bk-halfline-margin":"bk-halfline-item bk-halfline-margin"},changeApiSystem:function(e){this.apiInfo.remote_api_id="",this.apiInfo.rsp_data="",this.apiInfo.req_params={},this.apiInfo.req_body={},this.getApiPortList(e)},changeRpc:function(e){var t=this.prcData.list.filter((function(t){return t.key===e}))[0].req_params;this.$emit("getRpcData",t)},checkSouce:function(){var e=!1;return"DATADICT"===this.formInfo.source_type?e=!this.dictionaryData.check:"API"===this.formInfo.source_type?e=!this.apiInfo.remote_system_id||!this.apiInfo.remote_api_id:"RPC"===this.formInfo.source_type&&(e=!this.prcData.check),e&&this.$bkMessage({theme:"warning",message:this.$t('m.treeinfo["请选择正确的数据源"]')}),e}}}},ml2i:function(e,t,n){},ml4i:function(e,t,n){"use strict";n.r(t);var i=n("hHxK"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},n43x:function(e,t,n){},n5mh:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("ul",{staticClass:"child-node"},e._l(e.treeDataList,(function(n,i){return t("li",{key:i,staticClass:"vue-tree-item"},[t("div",{class:["tree-node",{down:n.showChildren,"set-frist-pLeft":e.treeIndex+1===1,active:n.checkInfo}],style:e.pLeft,on:{click:function(t){return e.toggle(n)}}},[n.showChildren?t("i",{staticClass:"bk-icon icon-down-shape",class:{"bk-padding":!n.has_children},on:{click:function(t){return t.stopPropagation(),e.toggleChildren(n)}}}):t("i",{staticClass:"bk-icon icon-right-shape",class:{"bk-padding":!n.has_children},on:{click:function(t){return t.stopPropagation(),e.toggleChildren(n)}}}),e._v(" "),t("i",{staticClass:"bk-icon icon-folder-open-shape"}),e._v(" "),t("span",{staticClass:"name-text"},[e._v(e._s(n.name))]),e._v(" "),n.checkInfo?t("i",{staticClass:"bk-icon icon-check-1",staticStyle:{float:"right","margin-top":"11px"}}):e._e()]),e._v(" "),t("collapse-transition",[n.showChildren&&n.children?[t("exportTree",{attrs:{"tree-data-list":n.children,"tree-index":e.treeIndex+1},on:{selectItem:e.selectItem,toggle:e.toggle,toggleChildren:e.toggleChildren}})]:e._e()],2)],1)})),0)},a=[];i._withStripped=!0},n6O2:function(e,t,n){},nCLG:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("div",{staticStyle:{position:"relative"}},[t("div",{staticClass:"bk-form-content",staticStyle:{position:"relative"}},[t("custom-upload",{ref:"upload",attrs:{name:"field_file",multiple:!0,"with-credentials":!0,disabled:e.disabled,tip:"",size:200,url:e.url},on:{"on-success":e.uploadSuccess,"on-error":e.uploadErr,"on-progress":e.uploadProgress,"on-done":e.uploadDone}}),e._v(" "),t("ul",e._l(e.datas,(function(n,i){return t("li",{directives:[{name:"show",rawName:"v-show",value:!n.errorMsg,expression:"!file.errorMsg"}],key:i,staticClass:"upload_p",staticStyle:{"word-break":"break-word"}},[t("span",[e._v(e._s(n.name))]),e._v(" "),t("span",{staticClass:"bk-icon icon-delete",staticStyle:{color:"#3c96ff","margin-left":"10px",cursor:"pointer"},on:{click:function(t){return e.deleteFile(n)}}})])})),0)],1)]),e._v(" "),e.tempFileList.length>0?t("div",{staticClass:"bk-form-item"},[t("label",{staticClass:"bk-label"},[e._v(e._s(e.$t('m.newCommon["模板下载"]'))+"：")]),e._v(" "),t("div",{staticClass:"bk-form-content"},e._l(e.tempFileList,(function(n,i){return t("ul",{key:i},[t("li",{staticClass:"bk-icon icon-download bk-tab-cursor fa-file",on:{click:function(t){return e.downloadFile(n)}}},[e._v(" "+e._s(n.name)+"\n          ")])])})),0)]):e._e(),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},nDi6:function(e,t,n){},nTEs:function(e,t,n){},nVin:function(e,t,n){"use strict";n.r(t);var i=n("nmi9"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},ni6I:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("bk-dialog",{attrs:{"data-test-id":"service_dialog_serviceChoiceDialog","render-directive":"if","ext-cls":"choose-service-template-dialog",width:980,value:e.isShow,"auto-close":!1,"show-footer":!1},on:{"value-change":e.onDialogClose}},[t("div",{staticClass:"choose-service-template"},[t("h3",{staticClass:"dialog-header"},[t("span",{staticClass:"dialog-name"},[e._v(e._s(e.createInfo.name))]),e._v(" "),"created"===e.createWay?t("bk-input",{staticClass:"search-input",attrs:{"right-icon":"bk-icon icon-search",placeholder:e.$t("m.common['请输入服务名称']"),clearable:!0},on:{change:e.searchHandler}}):e._e()],1),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.loading},expression:"{ isLoading: loading }"}],staticClass:"dialog-body"},[e.templateList.length?t("ul",{staticClass:"template-list"},e._l(e.templateList,(function(n,i){return t("li",{key:i,staticClass:"template-item",attrs:{"data-test-id":"serviceTemplateList-li-"+n.id},on:{click:function(t){return e.onTemplateClick(n)}}},[t("p",{staticClass:"template-name",domProps:{innerHTML:e._s(n.name)}}),e._v(" "),"recom"===e.createWay?t("p",{staticClass:"template-time"},[e._v(e._s(n.time))]):e._e()])})),0):t("div",{staticClass:"service-empty"},[t("div",[t("i",{staticClass:"bk-icon icon-empty"}),e._v(" "),t("p",{staticClass:"text"},[e.searchModel?t("span",[e._v(e._s(e.$t("m.common['无匹配服务']")))]):t("span",[e._v("暂无服务")])])])])])])])},a=[];i._withStripped=!0},nmi9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("QbLZ")),a=s(n("NPk7")),r=s(n("hftF")),o=n("ygAv");function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ViewItem",components:{TagText:a.default,TagTable:r.default,RenderView:function(){return Promise.resolve().then(n.bind(null,"FCVG"))}},inject:["getContext"],props:{scheme:{type:Object,default:function(){return{}}},form:{type:Object,default:function(){return{}}},isTop:{type:Boolean,default:!1},topIndex:{type:Number}},data:function(){return{crumbsList:[],childrenViewConfig:{form_data:[]}}},computed:{componentType:function(){return"Tag"+this.scheme.type.replace(/^[a-z]/,(function(e){return e.toUpperCase()}))},currentDisplatCrumbs:function(){return this.crumbsList[this.crumbsList.length-1]||{label:"默认",form_data:[]}}},created:function(){this.appendCrumbsItem(this.form.label,this.form)},methods:{getAttrs:function(e){return(0,i.default)({},this.scheme.attrs,e)},appendCrumbsItem:function(e,t){this.crumbsList.push({label:e,form_data:(0,o.deepClone)(t)}),this.updateChildViewConfig()},getScheme:function(e){var t=this.getContext().schemes;return t[e.scheme]?t[e.scheme]:{}},onCrumbsClick:function(e){this.crumbsList=this.crumbsList.filter((function(t,n){return n<=e})),this.updateChildViewConfig()},updateChildViewConfig:function(){this.childrenViewConfig={form_data:(0,o.deepClone)(this.currentDisplatCrumbs.form_data)}}}}},nrD6:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("14Xm")),a=o(n("D3Ub")),r=o(n("efIh"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"RADIO",mixins:[r.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{}},watch:{"item.val":function(){this.conditionField(this.item,this.fields)}},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.item.value&&!e.item.val&&(e.item.val=e.item.value),t.next=3,e.getFieldOptions(e.item);case 3:e.item.choice=t.sent,n=e.judgeValue(e.item.val,e.item.choice),e.item.val=n?e.item.val:"",e.conditionField(e.item,e.fields);case 7:case"end":return t.stop()}}),t,e)})))()},methods:{}}},nuXq:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("2eEL"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"BasicCard",components:{collapseTransition:r.default},props:{showFoldTitle:{type:Boolean,default:!1},foldTitle:{type:String,default:""},firstUnfold:{type:Boolean,default:!0},cardLabel:{type:String,default:""},cardDesc:{type:String,default:""}},data:function(){return{showMore:!0}},watch:{isFold:{handler:function(){this.showMore=this.firstUnfold},immediate:!0}}}},nveJ:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeNode,expression:"closeNode"},{name:"bk-tooltips",rawName:"v-bk-tooltips",value:{placement:"auto",content:e.node.name,theme:"light"},expression:"{\n    placement: 'auto',\n    content: node.name,\n    theme: 'light'\n  }"}],staticClass:"bk-flow-location",class:{"bk-error-flow":e.node.nodeInfo&&e.node.nodeInfo.errorInfo},on:{mousedown:function(t){return e.moveDoneFn(e.node)},mousemove:e.moveFn,mouseup:function(t){return e.onNodeClick(e.node,t)},contextmenu:function(t){return t.preventDefault(),e.rightClickNode(e.node,t)},mouseout:function(t){return e.hoverNode(e.node)}}},["START"===e.node.type?t("div",{staticClass:"startpoint",attrs:{"data-test-id":"startNode"}},[e._v("\n    "+e._s(e.$t("m.treeinfo['开始']"))+"\n  ")]):e._e(),e._v(" "),"END"===e.node.type?t("div",{staticClass:"endpoint",attrs:{"data-test-id":"endNode"}},[e._v("\n    "+e._s(e.$t('m.treeinfo["结束"]'))+"\n  ")]):e._e(),e._v(" "),e._l(e.typeList,(function(n,i){return[e.node.type===n.type?[t("div",{key:i,staticClass:"common-node",attrs:{"data-test-id":`nodeTemplate-common-node-${i}-${n.type}`},on:{click:function(t){return e.clickNode(e.node,t)}}},[t("span",{staticClass:"common-auto-icon",class:{"bk-is-draft":e.node.nodeInfo&&e.node.nodeInfo.is_draft},on:{click:function(t){return t.stopPropagation(),e.openconfigu.apply(null,arguments)}}},["TASK"!==n.type?t("i",{staticClass:"bk-itsm-icon",class:n.iconStyle}):t("span",{staticStyle:{"font-size":"11px","font-weight":"bold",display:"block"}},[e._v("API")])]),e._v(" "),t("span",{staticClass:"bk-more-word",attrs:{title:e.node.name||e.$t("m.treeinfo['新增节点']")}},[e._v(e._s(e.node.name||e.$t("m.treeinfo['新增节点']")))]),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-edit-bold"}),e._v(" "),e.node.nodeInfo&&e.node.nodeInfo.is_builtin?e._e():t("span",{staticClass:"bk-node-delete",on:{click:function(t){return t.stopPropagation(),e.clickDelete(e.node)},mouseup:function(e){e.stopPropagation()},mousedown:function(e){e.stopPropagation()}}},[e._v("×")]),e._v(" "),!e.toolStatus&&e.node.nodeInfo&&e.node.nodeInfo.is_builtin?t("div",{staticClass:"bk-toop-info"},[t("p",[t("span",[e._v(e._s(e.$t("m.treeinfo['单击：']")))]),e._v(e._s(e.$t("m.treeinfo['快速配置节点']")))]),e._v(" "),t("p",[t("span",[e._v(e._s(e.$t("m.treeinfo['右键：']")))]),e._v(e._s(e.$t("m.treeinfo['调出快速添加节点菜单']")))]),e._v(" "),t("i",{staticClass:"bk-icon icon-close",on:{click:function(t){return t.stopPropagation(),e.closeTool.apply(null,arguments)}}}),e._v(" "),t("i",{staticClass:"bk-squrae"})]):e._e()])]:e._e()]})),e._v(" "),"ROUTER-P"===e.node.type?t("div",{staticClass:"common-branch"},[t("i",{staticClass:"bk-itsm-icon icon-flow-convergence"}),e._v(" "),t("span",{staticClass:"bk-node-delete",on:{click:function(t){return t.stopPropagation(),e.clickDelete(e.node)}}},[e._v("×")])]):e._e(),e._v(" "),"COVERAGE"===e.node.type?t("div",{staticClass:"common-branch"},[t("i",{staticClass:"bk-itsm-icon icon-flow-branch"}),e._v(" "),t("span",{staticClass:"bk-node-delete",on:{click:function(t){return t.stopPropagation(),e.clickDelete(e.node)}}},[e._v("×")])]):e._e(),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:e.node.showMore&&"START"!==e.node.type&&"END"!==e.node.type,expression:"node.showMore && node.type !== 'START' && node.type !== 'END'"}],staticClass:"bk-flow-fast"},[t("div",{staticClass:"bk-engine-node"},[t("ul",e._l(e.clickList,(function(n,i){return t("li",{key:i,staticClass:"tool",attrs:{"data-test-id":"nodeTemplate-li-addNodeTemplate"+i,title:n.name},on:{click:function(t){return t.stopPropagation(),e.addNormal(e.node,n)}}},[t("i",{staticClass:"bk-itsm-icon",class:[n.iconStyle,{"bk-font-style":["icon-icon-artificial","icon-api-node","icon-task-icon","con-copy-new","icon-webhookjiedian","icon-approval-node","icon-devops-task-icon"].includes(n.iconStyle)}],style:{display:"open"!==e.nodeDisabled||"TASK-DEVOPS"!==n.type&&"BK-PLUGIN"!==n.type?"inline-block":"none"}})])})),0)]),e._v(" "),t("div",{staticClass:"bk-engine-word"},[t("span",{staticClass:"bk-canvas-span bk-engine-configur",class:{"bk-engine-builtin":"ROUTER-P"===e.node.type||"COVERAGE"===e.node.type},on:{click:function(t){return t.stopPropagation(),e.openconfigu.apply(null,arguments)}}},[e._v(e._s(e.$t('m.treeinfo["配置"]')))]),e._v(" "),t("span",{staticClass:"bk-canvas-span bk-engine-delete",class:{"bk-engine-builtin":e.node.nodeInfo&&e.node.nodeInfo.is_builtin},on:{click:function(t){return t.stopPropagation(),e.clickDelete(e.node)}}},[e._v(e._s(e.$t('m.treeinfo["删除"]')))])])])],2)},a=[];i._withStripped=!0},nxpg:function(e,t,n){"use strict";n.r(t);var i=n("29mx"),a=n("Ha+5");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},"o1/R":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=c(n("14Xm")),a=c(n("D3Ub")),r=c(n("efIh")),o=c(n("u8Ap")),s=c(n("EP+X"));function c(e){return e&&e.__esModule?e:{default:e}}t.default={name:"MEMBER",components:{memberSelect:o.default,businessCard:s.default},mixins:[r.default],props:{item:{type:Object,default:function(){return{}}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1}},data:function(){return{selectedItems:[]}},watch:{"item.val":function(){this.item.val&&(this.selectedItems=this.item.val?[this.item.val]:[]),this.conditionField(this.item,this.fields)},selectedItems:{handler:function(){this.item.val=this.selectedItems.join(",")}}},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.selectedItems=e.item.val?[e.item.val]:[],e.conditionField(e.item,e.fields);case 2:case"end":return t.stop()}}),t,e)})))()}}},oBdi:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"Palette",data:function(){return{nodeDisabled:window.RUN_VER}}}},ohl0:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("14Xm")),a=o(n("D3Ub")),r=o(n("efIh"));function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"CHECKBOX",mixins:[r.default],props:{item:{type:Object,required:!0,default:function(){}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{loading:!1,selects:[]}},watch:{"item.val":function(e){this.selects=""===e?[]:e.split(","),this.conditionField(this.item,this.fields)},"item.choice":{handler:function(){this.resetCheckboxGroupData()},deep:!0}},created:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getFieldOptions(e.item,e.isPreview);case 2:e.item.choice=t.sent,n=e.judgeValue(e.item.val,e.item.choice),e.item.val=n?e.item.val:"",e.selects=""===e.item.val?[]:e.item.val.split(","),e.conditionField(e.item,e.fields),e.item.value&&!e.item.val&&(e.item.val=e.item.value);case 8:case"end":return t.stop()}}),t,e)})))()},methods:{selected:function(e){this.item.val=e.join(","),this.item.checkValue=!1},resetCheckboxGroupData:function(){var e=this,t=this.item.key;this.$refs[t]&&(this.$refs[t].checkboxItems=[],this.loading=!0,this.$nextTick((function(){e.loading=!1})))}}}},p9GS:function(e,t,n){},pIur:function(e,t,n){"use strict";n.r(t);var i=n("h42h"),a=n("d88Z");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("4855");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"66cb2bb8",null);t.default=s.exports},pLkd:function(e,t,n){"use strict";n("Z/e7")},pRDg:function(e,t,n){},pRHh:function(e,t,n){"use strict";n.r(t);var i=n("CBo5"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},pV0w:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n("4d7F")),a=p(n("14Xm")),r=p(n("QbLZ")),o=p(n("gDS+")),s=p(n("D3Ub")),c=p(n("PRQd")),l=p(n("u8Ap")),u=p(n("bcjM")),d=p(n("s4tT")),f=n("CeR/");function p(e){return e&&e.__esModule?e:{default:e}}t.default={name:"signNode",components:{BasicCard:d.default,fieldConfig:c.default,memberSelect:l.default,commonTriggerList:u.default},props:{flowInfo:{type:Object,default:function(){return{}}},configur:{type:Object,default:function(){return{}}}},data:function(){return{secondClick:!1,getConditionFlag:!1,formInfo:{name:"",is_sequential:!1,processors:[]},finishCondition:{expressions:[{expressions:[],type:"and"}],type:"or"},allCondition:[],betweenList:[{id:1,name:">=",key:">="},{id:2,name:">",key:">"},{id:3,name:"=",key:"=="},{id:4,name:"<=",key:"<="},{id:5,name:"<",key:"<"}],passRateExpression:{key:"",condition:">=",value:"",source:"global",type:"INT",meta:{code:"PROCESS_COUNT",unit:"INT"},tooltipInfo:{disabled:!0,content:"",placements:["top"]}},emptyExpression:{key:"",condition:">=",value:"",source:"global",type:"INT",meta:{code:"",unit:"INT"},tooltipInfo:{disabled:!1,content:this.$t("m.treeinfo['请先选择条件']"),placements:["top"]}},nodeInfoRule:{name:[{required:!0,message:this.$t("m.newCommon['请输入节点名称']"),trigger:"blur"}],processors:[{validator:function(e){return e.length},message:this.$t("m.newCommon['请选择处理人']"),trigger:"blur"}]},finishConditionRule:{key:[{required:!0,message:this.$t("m.systemConfig['请输入']"),trigger:"blur"}],value:[{required:!0,message:this.$t("m.systemConfig['请输入']"),trigger:"blur"}]}}},computed:{globalChoise:function(){return this.$store.state.cdeploy.configurInfo},openFunction:function(){return this.$store.state.openFunction}},watch:{"formInfo.processors":function(){this.setAllTooltip()}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return(0,s.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.getAllConditions();case 2:e.formInfo.name=e.configur.name,e.formInfo.is_sequential=e.configur.is_sequential,e.formInfo.processors=e.configur.processors?e.configur.processors.split(","):[],e.configur.finish_condition&&e.configur.finish_condition.expressions?(e.finishCondition=JSON.parse((0,o.default)(e.configur.finish_condition)),e.finishCondition.expressions.forEach((function(e){e.expressions=e.expressions.map((function(e){return(0,r.default)({},e,{tooltipInfo:{disabled:!0,content:"",placements:["top"]}})}))}))):(e.passRateExpression.key=e.allCondition.find((function(e){return"PROCESS_COUNT"===e.meta.code})).key,e.finishCondition.expressions[0].expressions.push(JSON.parse((0,o.default)(e.passRateExpression))),e.giveTooltip(e.passRateExpression));case 6:case"end":return t.stop()}}),t,e)})))()},setAllTooltip:function(){var e=this;this.finishCondition.expressions.forEach((function(t){t.expressions.forEach((function(t){e.giveTooltip(t)}))}))},getAllConditions:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.configur.id,e.getConditionFlag=!0,t.next=4,e.$store.dispatch("apiRemote/get_sign_conditions",n).then((function(t){e.allCondition=t.data})).catch((function(t){(0,f.errorHandler)(t,e)})).finally((function(){e.getConditionFlag=!1}));case 4:case"end":return t.stop()}}),t,e)})))()},selectCondition:function(e,t,n,i){var a=this;0===i&&0===n&&"PROCESS_COUNT"===t.meta.code?this.$bkInfo({type:"warning",title:this.$t("m.treeinfo['确定更改“处理人数”？']"),subTitle:this.$t("m.treeinfo['若更改该条件，则忽略处理人数，条件满足即结束']"),cancelFn:function(){t.key=a.allCondition.find((function(e){return"PROCESS_COUNT"===e.meta.code})).key},confirmFn:function(){a.changeCondition(t)}}):this.changeCondition(t)},changeCondition:function(e){e.meta.code=this.allCondition.find((function(t){return t.key===e.key})).meta.code,e.meta.unit=this.allCondition.find((function(t){return t.key===e.key})).meta.unit||"INT",this.giveTooltip(e)},giveTooltip:function(e){return e.key?"PASS_RATE"===e.meta.code||"REJECT_RATE"===e.meta.code||this.formInfo.processors.length?(e.tooltipInfo.disabled=!0,void(e.tooltipInfo.content="")):(e.tooltipInfo.disabled=!1,void(e.tooltipInfo.content=this.$t("m.treeinfo['请先选择处理人']"))):(e.tooltipInfo.disabled=!1,void(e.tooltipInfo.content=this.$t("m.treeinfo['请先选择条件']")))},submitNode:function(){var e=this;return(0,s.default)(a.default.mark((function t(){var n;return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[e.$refs.nodeInfoForm.validate()],e.$refs.finishConditionForms&&e.$refs.finishConditionForms.length&&(n=n.concat(e.$refs.finishConditionForms.map((function(e){return e.validate()})))),t.next=4,i.default.all(n).then((function(){var t={is_draft:!1,workflow:e.flowInfo.id,type:e.configur.type,is_terminable:!1,processors_type:"PERSON"};t.name=e.formInfo.name,t.is_sequential=e.formInfo.is_sequential,t.processors=e.formInfo.processors.join(",");var n=e.$refs.field.showTabList;t.fields=n.map((function(e){return e.id})),e.finishCondition.expressions.forEach((function(e){e.expressions.forEach((function(e){delete e.tooltipInfo}))})),t.finish_condition=e.finishCondition;var i=e.configur.id;e.secondClick||(e.secondClick=!0,e.$store.dispatch("deployCommon/updateNode",{params:t,id:i}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$emit("closeConfigur",!0)})).catch((function(t){(0,f.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))})).catch((function(e){console.log(e)}));case 4:case"end":return t.stop()}}),t,e)})))()},closeNode:function(){this.$emit("closeConfigur",!1)},operateExpression:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"add",n=arguments[2],i=arguments[3],a=arguments[4];if("del"===t){if(1===e.expressions.length)return;0===i&&0===n&&"PROCESS_COUNT"===a.meta.code?this.$bkInfo({type:"warning",title:this.$t("m.treeinfo['确定删除“处理人数”？']"),subTitle:this.$t("m.treeinfo['若删除该条件，则忽略处理人数，条件满足即结束']"),confirmFn:function(){e.expressions.splice(n,1)}}):e.expressions.splice(n,1)}else e.expressions.push(JSON.parse((0,o.default)(this.emptyExpression)))},operateGroup:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"add",n=arguments[1];"del"===t?1===this.finishCondition.expressions.length?this.$bkInfo({type:"warning",title:this.$t("m.treeinfo['确定删除唯一的条件组？']"),subTitle:this.$t("m.treeinfo['若删除，则必须所有人处理完成才结束']"),confirmFn:function(){e.finishCondition.expressions.splice(n,1)}}):this.finishCondition.expressions.splice(n,1):this.finishCondition.expressions.push({expressions:[JSON.parse((0,o.default)(this.emptyExpression))],type:"and"})}}}},phV7:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-get-param"},[t("bk-table",{attrs:{data:e.tableList,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['名称']"),"min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticClass:"bk-more"},[t("span",{style:{paddingLeft:20*n.row.level+"px"}},[n.row.has_children?t("span",{class:["bk-icon","tree-expanded-icon",n.row.showChildren?"icon-down-shape":"icon-right-shape"],on:{click:function(t){return e.changeState(n.row)}}}):t("span",{staticClass:"bk-icon bk-more-icon"}),e._v(" "),t("span",[e._v(e._s(n.row.key||"--"))])])])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['类型']"),prop:"type"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['是否必须']")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.is_necessary?e.$t('m.treeinfo["是"]'):e.$t('m.treeinfo["否"]'))+"\n            ")]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['备注']"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",{attrs:{title:n.row.desc}},[e._v(e._s(n.row.desc||"--"))])]}}])}),e._v(" "),e.isStatic?t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"270"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s(t.row.customValue||"--")+"\n            ")]}}],null,!1,4172783685)}):e.isCustom?t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"270"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{staticClass:"bk-respone-input",attrs:{clearable:!0,type:"text",placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.customValue,callback:function(t){e.$set(n.row,"customValue",t)},expression:"props.row.customValue"}})]}}])}):t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['引用为全局变量']"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(n){return[n.row.isSelectAbled?[t("bk-checkbox",{staticStyle:{width:"40px",position:"absolute",top:"12px",left:"15px"},attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus,disabled:n.row.isSelectedKeyDisabled},on:{change:function(t){return e.selectOneKey(n.row)}},model:{value:n.row.isSelectedKey,callback:function(t){e.$set(n.row,"isSelectedKey",t)},expression:"props.row.isSelectedKey"}}),e._v(" "),t("bk-input",{staticClass:"bk-respone-input",class:{"bk-border-error":n.row.isCheck&&!n.row.isSelectedValue.toString()},attrs:{clearable:!0,type:"text",placeholder:e.$t("m.treeinfo['请输入变量名']"),disabled:n.row.isSelectedValueDisabled},model:{value:n.row.isSelectedValue,callback:function(t){e.$set(n.row,"isSelectedValue",t)},expression:"props.row.isSelectedValue"}})]:[t("span",[e._v("--")])]]}}])})],1)],1)},a=[];i._withStripped=!0},pnfo:function(e,t,n){"use strict";n.r(t);var i=n("ucVW"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},ptjD:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"customTableData",props:{customTableInfo:{type:Object,default:function(){return{}}}},data:function(){return{typeList:[{id:"input",name:this.$t('m.treeinfo["输入框"]')},{id:"select",name:this.$t('m.treeinfo["单选框"]')},{id:"multiselect",name:this.$t('m.treeinfo["多选框"]')},{id:"datetime",name:this.$t('m.treeinfo["时间"]')},{id:"date",name:this.$t('m.treeinfo["日期"]')}],trueStatus:!0,falseStatus:!1}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},mounted:function(){},methods:{addTableData:function(e,t){this.customTableInfo.list.splice(t+1,0,{name:"",display:"input",choice:"",required:!1})},reduceTableData:function(e,t){1!==this.customTableInfo.list.length&&this.customTableInfo.list.splice(t,1)}}}},"q+QX":function(e,t,n){"use strict";n.r(t);var i=n("Ox22"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},q4Iw:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{class:["tag-text",{"active-link":e.hasChildren}],on:{click:e.onClick}},[Array.isArray(e.value)?t("div",e._l(e.value,(function(n,i){return t("p",{key:i,staticClass:"text-block"},[n.label?t("label",{staticClass:"label"},[e._v("\n        "+e._s(n.label)+"\n        "),n.desc||e.desc?t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:n.desc||e.desc,expression:"item.desc || desc"}],staticClass:"bk-itsm-icon icon-itsm-icon-help"}):e._e()]):e._e(),e._v(" "),t("span",{staticClass:"value"},[e._v(e._s(n.value))])])})),0):t("p",[e.label?t("label",{staticClass:"label"},[e._v("\n      "+e._s(e.label)+"\n      "),e.desc?t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips",value:e.desc,expression:"desc"}],staticClass:"bk-itsm-icon icon-itsm-icon-help"}):e._e()]):e._e(),e._v(" "),t("span",{staticClass:"value"},[e._v(e._s(e.value))])])])},a=[];i._withStripped=!0},q9fp:function(e,t,n){"use strict";n.r(t);var i=n("UljE"),a=n("5Pf/");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("wSaC");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"165fa2cc",null);t.default=s.exports},qCK4:function(e,t,n){"use strict";n.r(t);var i=n("hmS1"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},qCVH:function(e,t,n){},qFWE:function(e,t,n){"use strict";n.r(t);var i=n("oBdi"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},qJoz:function(e,t,n){"use strict";n.r(t);var i=n("SioU"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},qVGl:function(e,t,n){"use strict";n.r(t);var i=n("dwEX"),a=n("LJsK");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("v4/x");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"7bd4ee96",null);t.default=s.exports},qgII:function(e,t,n){"use strict";n.r(t);var i=n("FbwU"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},qk9t:function(e,t,n){"use strict";n("tEH6")},qkdU:function(e,t,n){"use strict";n("xBbh")},qmm4:function(e,t,n){},qyUP:function(e,t,n){"use strict";n.r(t);var i=n("7V2o"),a=n("XUL0");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},"r+Sh":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],staticClass:"bk-basic-node"},[t("basic-card",[t("bk-form",{ref:"webForm",attrs:{"label-width":150,model:e.formData,rules:e.rules,"form-type":"vertical"}},[e.isStatus?t("bk-form-item",{attrs:{label:e.$t("m['节点名称']"),"ext-cls":"bk-form-width bk-form-display",property:"name","error-display-type":"normal",required:""}},[t("bk-input",{model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1):e._e(),e._v(" "),t("desc-info",{model:{value:e.formData.desc,callback:function(t){e.$set(e.formData,"desc",t)},expression:"formData.desc"}}),e._v(" "),e.isStatus?t("bk-form-item",{attrs:{"data-test-id":"devops-component-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{value:e.processorsInfo,"show-overbook":!0,"node-info":e.configur,"exclude-role-type-list":e.excludeProcessor}})],1)]):e._e(),e._v(" "),t("bk-form-item",{attrs:{label:"URL","ext-cls":"bk-form-display",required:"",property:"url","error-display-type":"normal"}},[t("bk-input",{ref:"urlInput",attrs:{clearable:!0,"font-size":"medium",placeholder:e.isStatus?e.$t("m['以http://或https://开头(引用变量忽略), 输入“{{”可选择引用变量']"):e.$t("m['请输入']"),disabled:e.disable},on:{change:e.handleUrlChange},model:{value:e.formData.url,callback:function(t){e.$set(e.formData,"url",t)},expression:"formData.url"}},[t("bk-dropdown-menu",{ref:"dropdown",staticClass:"group-text",attrs:{slot:"prepend","font-size":"medium"},on:{show:function(t){e.isDropdownShow=!0},hide:function(t){e.isDropdownShow=!1}},slot:"prepend"},[t("bk-button",{attrs:{slot:"dropdown-trigger",type:"primary"},slot:"dropdown-trigger"},[e._l(e.requestOptions,(function(n,i){return[e.curEq===n?t("span",{key:i},[e._v(e._s(n))]):e._e()]})),e._v(" "),t("i",{class:["bk-icon icon-angle-down",{"icon-flip":e.isDropdownShow}]})],2),e._v(" "),t("ul",{staticClass:"bk-dropdown-list",attrs:{slot:"dropdown-content"},slot:"dropdown-content"},e._l(e.requestOptions,(function(n,i){return t("li",{key:i},[t("a",{attrs:{href:"javascript:;"},on:{click:function(t){return e.selectRequsetOpt(n)}}},[e._v(e._s(n))])])})),0)],1)],1),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:0!==e.filterVariableList.length,expression:"filterVariableList.length !== 0"}],staticClass:"select-variables"},[t("ul",e._l(e.filterVariableList,(function(n,i){return t("li",{key:i,on:{click:function(t){return e.handleSelectContent(n)}}},[e._v("\n              "+e._s(n.name)+"\n              "),t("span",{staticClass:"variable-key"},[e._v("("+e._s(n.key)+")")])])})),0)])],1),e._v(" "),t("bk-form-item",{attrs:{"ext-cls":"bk-form-display"}},[t("div",{staticClass:"requset-config"},[t("request-config",{ref:"requestConfig",attrs:{type:e.curEq,configur:e.configur,"is-status":e.isStatus,"state-list":e.stateList,disable:e.disable},on:{changeFormStatus:e.changeFormStatus}}),e._v(" "),e.errorTip?t("p",{staticClass:"error-tip"},[e._v(e._s(e.$t("m['已选参数的字段名和值不能为空']")))]):e._e()],1)]),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m['成功条件']"),"ext-cls":"bk-form-display"}},[t("bk-input",{attrs:{disabled:e.disable,placeholder:e.$t("m['输入你所要的条件，如： resp.result==ture 或者 false']")},model:{value:e.formData.success_exp,callback:function(t){e.$set(e.formData,"success_exp",t)},expression:"formData.success_exp"}})],1),e._v(" "),e.isStatus?t("bk-form-item",{attrs:{label:e.$t("m['返回变量']"),"ext-cls":"bk-form-display"}},[t("bk-table",{attrs:{data:e.returnReslut,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m['变量名称']")},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable},on:{change:function(t){return e.changeReturnInput(n.row,n.$index)}},model:{value:n.row.name,callback:function(t){e.$set(n.row,"name",t)},expression:"props.row.name"}})]}}],null,!1,1214002578)}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['来源']")},scopedSlots:e._u([{key:"default",fn:function(n){return[t("bk-input",{attrs:{behavior:"simplicity",disabled:e.disable,placeholder:e.$t("m['输入变量来源，如：resp.message']")},on:{change:function(t){return e.changeReturnInput(n.row,n.$index)}},model:{value:n.row.ref_path,callback:function(t){e.$set(n.row,"ref_path",t)},expression:"props.row.ref_path"}})]}}],null,!1,183365448)}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['操作']"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(n){return e.disable||e.isShowDelete===e.returnReslut.indexOf(n.row)?void 0:[t("i",{staticClass:"bk-itsm-icon icon-flow-other-add result-icon",on:{click:e.addReturnReslut}}),e._v(" "),t("i",{staticClass:"bk-itsm-icon icon-flow-other-reduc result-icon",class:{"no-delete":e.retrunResultIsEmtry},on:{click:function(t){return e.deleteReturnReslut(n.row)}}})]}}],null,!0)})],1)],1):e._e()],1),e._v(" "),e.isStatus?t("common-trigger-list",{ref:"commonTriggerList",attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}):e._e(),e._v(" "),e.isStatus?t("div",{staticClass:"mt20",staticStyle:{"font-size":"0"}},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"devops-button-submit",title:e.$t("m.treeinfo['确定']"),loading:e.secondClick},on:{click:e.submit}},[e._v("\n        "+e._s(e.$t("m.treeinfo['确定']"))+"\n      ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"devops-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['取消']"))+"\n      ")])],1):e._e()],1)],1)},a=[];i._withStripped=!0},"r/L1":function(e,t,n){"use strict";n("/7qM")},rGm2:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-template-node"},["START"===e.node.type?t("div",{staticClass:"startpoint"},[e._v("\n    "+e._s(e.$t('m.treeinfo["开始"]'))+"\n  ")]):e._e(),e._v(" "),"END"===e.node.type?t("div",{staticClass:"endpoint"},[e._v("\n    "+e._s(e.$t('m.treeinfo["结束"]'))+"\n  ")]):e._e(),e._v(" "),e._l(e.typeList,(function(n,i){return[e.node.type===n.type?[t("div",{key:i,staticClass:"common-node",class:{"common-auto":"TASK"===n.type}},[t("span",{staticClass:"common-auto-icon",class:{"bk-is-draft":e.node.nodeInfo&&e.node.nodeInfo.is_draft}},["TASK"!==n.type?t("i",{staticClass:"bk-itsm-icon",class:n.iconStyle}):t("span",{staticStyle:{"font-size":"12px","font-weight":"bold"}},[e._v("API")])]),e._v(" "),t("span",{staticClass:"bk-more-word"},[e._v(e._s(e.node.name||e.$t('m.treeinfo["新增节点"]')))])])]:e._e()]})),e._v(" "),"ROUTER-P"===e.node.type?t("div",{staticClass:"common-branch"},[t("i",{staticClass:"bk-itsm-icon icon-flow-convergence"})]):e._e(),e._v(" "),"COVERAGE"===e.node.type?t("div",{staticClass:"common-branch"},[t("i",{staticClass:"bk-itsm-icon icon-flow-branch"})]):e._e()],2)},a=[];i._withStripped=!0},rLYG:function(e,t,n){"use strict";n.r(t);var i=n("tWYx"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},rMih:function(e,t,n){"use strict";n.r(t);var i=n("Om//"),a=n("ioCs");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("x+Aj");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"0efaed49",null);t.default=s.exports},rcsN:function(e,t,n){},ruTk:function(module,exports,__webpack_require__){(function(global){var factory;factory=function(exports,Vue){"use strict";function _interopDefaultLegacy(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var Vue__default=_interopDefaultLegacy(Vue);function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach((function(t){_defineProperty(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function _regeneratorRuntime(){
/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/facebook/regenerator/blob/main/LICENSE */
_regeneratorRuntime=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",r=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(e){s=function(e,t,n){return e[t]=n}}function c(e,t,n,i){var a=t&&t.prototype instanceof d?t:d,r=Object.create(a.prototype),o=new I(i||[]);return r._invoke=function(e,t,n){var i="suspendedStart";return function(a,r){if("executing"===i)throw new Error("Generator is already running");if("completed"===i){if("throw"===a)throw r;return{value:void 0,done:!0}}for(n.method=a,n.arg=r;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===u)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===i)throw i="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i="executing";var c=l(e,t,n);if("normal"===c.type){if(i=n.done?"completed":"suspendedYield",c.arg===u)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i="completed",n.method="throw",n.arg=c.arg)}}}(e,n,o),r}function l(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}e.wrap=c;var u={};function d(){}function f(){}function p(){}var m={};s(m,a,(function(){return this}));var h=Object.getPrototypeOf,v=h&&h(h($([])));v&&v!==t&&n.call(v,a)&&(m=v);var g=p.prototype=d.prototype=Object.create(m);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){var i;this._invoke=function(a,r){function o(){return new t((function(i,o){!function i(a,r,o,s){var c=l(e[a],e,r);if("throw"!==c.type){var u=c.arg,d=u.value;return d&&"object"==typeof d&&n.call(d,"__await")?t.resolve(d.__await).then((function(e){i("next",e,o,s)}),(function(e){i("throw",e,o,s)})):t.resolve(d).then((function(e){u.value=e,o(u)}),(function(e){return i("throw",e,o,s)}))}s(c.arg)}(a,r,i,o)}))}return i=i?i.then(o,o):o()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return u;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return u}var i=l(n,e.iterator,t.arg);if("throw"===i.type)return t.method="throw",t.arg=i.arg,t.delegate=null,u;var a=i.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,u):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,u)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function $(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,r=function t(){for(;++i<e.length;)if(n.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:S}}function S(){return{value:void 0,done:!0}}return f.prototype=p,s(g,"constructor",p),s(p,"constructor",f),f.displayName=s(p,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),s(b.prototype,r,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,i,a,r){void 0===r&&(r=Promise);var o=new b(c(t,n,i,a),r);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(g),s(g,o,"Generator"),s(g,a,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},e.values=$,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(n,i){return o.type="throw",o.arg=e,t.next=n,i&&(t.method="next",t.arg=void 0),!!i}for(var a=this.tryEntries.length-1;a>=0;--a){var r=this.tryEntries[a],o=r.completion;if("root"===r.tryLoc)return i("end");if(r.tryLoc<=this.prev){var s=n.call(r,"catchLoc"),c=n.call(r,"finallyLoc");if(s&&c){if(this.prev<r.catchLoc)return i(r.catchLoc,!0);if(this.prev<r.finallyLoc)return i(r.finallyLoc)}else if(s){if(this.prev<r.catchLoc)return i(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return i(r.finallyLoc)}}}},abrupt:function(e,t){for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var r=a;break}}r&&("break"===e||"continue"===e)&&r.tryLoc<=t&&t<=r.finallyLoc&&(r=null);var o=r?r.completion:{};return o.type=e,o.arg=t,r?(this.method="next",this.next=r.finallyLoc,u):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),u},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),u}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var a=i.arg;w(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:$(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),u}},e}function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function asyncGeneratorStep(e,t,n,i,a,r,o){try{var s=e[r](o),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function _asyncToGenerator(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var r=e.apply(t,n);function o(e){asyncGeneratorStep(r,i,a,o,s,"next",e)}function s(e){asyncGeneratorStep(r,i,a,o,s,"throw",e)}o(void 0)}))}}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function _createClass(e,t,n){return t&&_defineProperties(e.prototype,t),n&&_defineProperties(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _extends$1(){return(_extends$1=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,i,a={},r=Object.keys(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}function _objectWithoutProperties(e,t){if(null==e)return{};var n,i,a=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(i=0;i<r.length;i++)n=r[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var i,a,r=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(i=n.next()).done)&&(r.push(i.value),!t||r.length!==t);o=!0);}catch(e){s=!0,a=e}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return r}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _createForOfIteratorHelper(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,a=function(){};return{s:a,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,r=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw r}}}}var isRegExp=function(e){var t;return(null===(t=new Function("return ".concat(e,";"))())||void 0===t?void 0:t.constructor)===RegExp},isObj=function(e){return"[object Object]"===Object.prototype.toString.call(e)};!function(){try{if("undefined"!=typeof self)return self}catch(e){}try{if("undefined"!=typeof window)return window}catch(e){}try{if(void 0!==global)return global}catch(e){}Function("return this")()}();var hasOwnProperty=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},valueType=function(e){return Array.isArray(e)?"array":"string"==typeof e?"string":"boolean"==typeof e?"boolean":isNaN(e)?null===e?"null":"object"===_typeof(e)?"object":_typeof(e):"number"},merge=function e(t,n){return isObj(n)?Object.keys(n).reduce((function(i,a){var r;return i[a]=e((null===(r=t)||void 0===r?void 0:r[a])||{},n[a]),i}),JSON.parse(JSON.stringify(t))):Array.isArray(n)?(t=Array.isArray(t)?t:[],n.map((function(n,i){return t[i]?e(t[i],n):n}))):n};function initializationValue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{integer:void 0,number:void 0};switch(e){case"any":return;case"array":return[];case"boolean":return!1;case"integer":return t.integer;case"null":return null;case"number":return t.number;case"object":return{};case"string":return""}}function mergeDeep(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(!n.length)return e;var a=n.shift();if(isObj(e)&&isObj(a))for(var r in a)isObj(a[r])?(e[r]||Object.assign(e,_defineProperty({},r,{})),mergeDeep(e[r],a[r])):Object.assign(e,_defineProperty({},r,a[r]));return mergeDeep.apply(void 0,[e].concat(n))}function isArguments(e){return"[object Arguments]"===Object.prototype.toString.call(e)}function deepEquals(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];if(e===t)return!0;if("function"==typeof e||"function"==typeof t)return!0;if("object"!==_typeof(e)||"object"!==_typeof(t))return!1;if(null===e||null===t)return!1;if(e instanceof Date&&t instanceof Date)return e.getTime()===t.getTime();if(e instanceof RegExp&&t instanceof RegExp)return e.source===t.source&&e.global===t.global&&e.multiline===t.multiline&&e.lastIndex===t.lastIndex&&e.ignoreCase===t.ignoreCase;if(isArguments(e)||isArguments(t)){if(!isArguments(e)||!isArguments(t))return!1;var a=Array.prototype.slice;return deepEquals(a.call(e),a.call(t),n,i)}if(e.constructor!==t.constructor)return!1;var r=Object.keys(e),o=Object.keys(t);if(0===r.length&&0===o.length)return!0;if(r.length!==o.length)return!1;for(var s,c=n.length;c--;)if(n[c]===e)return i[c]===t;n.push(e),i.push(t),r.sort(),o.sort();for(var l=r.length-1;l>=0;l--)if(r[l]!==o[l])return!1;for(var u=r.length-1;u>=0;u--)if(!deepEquals(e[s=r[u]],t[s],n,i))return!1;return n.pop(),i.pop(),!0}function orderProperties(e,t){if(!Array.isArray(t)||!t.length)return e;var n,i=function(e){return e.reduce((function(e,t){return e[t]=!0,e}),{})},a=i(e),r=t.filter((function(e){return"*"===e||a[e]})),o=i(r),s=e.filter((function(e){return!o[e]})),c=r.indexOf("*");if(-1===c){if(s.length)throw new Error("uiSchema order list does not contain ".concat((n=s).length>1?"properties '".concat(n.join("', '"),"'"):"property '".concat(n[0],"'")));return r}if(c!==r.lastIndexOf("*"))throw new Error("uiSchema order list contains more than one wildcard item");var l=_toConsumableArray(r);return l.splice.apply(l,[c,1].concat(_toConsumableArray(s))),l}var Registry=function(){function e(){_classCallCheck(this,e),this.widgets=new Map,this.components=new Map,this.fields=new Map}return _createClass(e,[{key:"addComponentsMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addMap("components",e)}},{key:"getComponent",value:function(e){return this.components.get(e)}},{key:"addFieldsMap",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addMap("fields",e)}},{key:"getField",value:function(e){return this.fields.get(e)}},{key:"addBaseWidgets",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.addMap("widgets",e)}},{key:"getBaseWidget",value:function(t){return this.widgets.has(t)?this.widgets.get(t):t&&0!==t.indexOf(e.namespace)?"".concat(e.namespace,"-").concat(t):t}},{key:"addMap",value:function(e,t){var n=this;e&&t&&Object.entries(t).forEach((function(t){var i=_slicedToArray(t,2),a=i[0],r=i[1];n[e].has(a)?console.warn("repeat key",a):n[e].set(a,r)}))}}]),e}();Registry.namespace="bk",Registry.context={};var registry=new Registry,_excluded$6=["name"],_excluded2$1=["name"],Schema=function(){function e(t){_classCallCheck(this,e),e.rootSchema=t}return _createClass(e,null,[{key:"resolveRef",value:function(){}},{key:"resolveDependencies",value:function(){}},{key:"resolveAdditionalProperties",value:function(){}},{key:"resolveSchema",value:function(e){return isObj(e)?(hasOwnProperty(e,"allOf"),hasOwnProperty(e,"$ref"),e):{}}},{key:"getSchemaDefaultValue",value:function(e){var t=this,n=isObj(e)?e:{};switch(this.getSchemaType(n)){case"null":return null;case"object":return Object.keys(n.properties||{}).reduce((function(e,i){var a,r=t.getSchemaDefaultValue(null===(a=n.properties)||void 0===a?void 0:a[i]);return e[i]=r,e}),{});case"array":return n.default&&Array.isArray(n.default)?n.default:Array.isArray(n.items)?n.items.map((function(e){return t.getSchemaDefaultValue(e)})):[]}return void 0!==n.default?n.default:initializationValue(n.type||"any")}},{key:"getSchemaType",value:function(e){var t=e.type;return!t&&e.const?valueType(e.const):!t&&e.enum?"string":!t&&e.items?"array":t}},{key:"getUiProps",value:function(e,t){return e&&e.startsWith("ui:")||console.warn("ui props must start with ui:"),t[e]||{}}},{key:"getSchemaField",value:function(e){var t,n,i=e["ui:field"];if(i)return i;if(null!==(t=e.oneOf)&&void 0!==t&&t.length)return{name:registry.getField("composition"),props:{composition:"oneOf"}};if(null!==(n=e.anyOf)&&void 0!==n&&n.length)return{name:registry.getField("composition"),props:{composition:"anyOf"}};var a=registry.getField(this.getSchemaType(e));return a?{name:a}:{name:null}}},{key:"isMultiSelect",value:function(e){return!(!e.uniqueItems||!e.items)&&Array.isArray(e.items.enum)}},{key:"isTupleArray",value:function(e){var t;return Array.isArray(e.items)&&(null===(t=e.items)||void 0===t?void 0:t.length)>0&&e.items.every((function(e){return isObj(e)}))}},{key:"isCustomArrayWidget",value:function(e){var t,n=null===(t=e["ui:component"])||void 0===t?void 0:t.name;return"array"===e.type&&n}},{key:"getGroupWrap",value:function(e){var t=e["ui:group"]||{},n=t.name;return _objectSpread2(_objectSpread2({},_objectWithoutProperties(t,_excluded$6)),{},{name:registry.getComponent(n)||n||registry.getComponent("group")})}},{key:"getUiComponent",value:function(e){var t=e["ui:component"]||{},n=t.name,i=_objectWithoutProperties(t,_excluded2$1);return _objectSpread2({name:registry.getComponent(n)||n},i)}},{key:"getDefaultWidget",value:function(t){var n,i,a,r,o=this.getSchemaType(t),s=null;if("string"===o&&Array.isArray(t.enum)&&(s=registry.getComponent("select")),"array"===o&&e.isMultiSelect(t)&&(s=registry.getComponent("checkbox")),"object"!==_typeof(o)&&(null!==(n=t.oneOf)&&void 0!==n&&n.length&&null!==(i=t.oneOf)&&void 0!==i&&i.every((function(e){return e.const}))||null!==(a=t.anyOf)&&void 0!==a&&a.length&&null!==(r=t.anyOf)&&void 0!==r&&r.every((function(e){return e.const})))&&(s=registry.getComponent("select")),s)return s;var c={string:"input",number:"input",integer:"input",boolean:"switcher",null:""}[o],l=registry.getComponent(c)||registry.getBaseWidget(c);return l||(console.warn("未注册类型".concat(o,"对应的默认表单项")),null)}},{key:"isRequired",value:function(e,t){return Array.isArray(e.required)&&e.required.includes(t)}},{key:"getUiOptions",value:function(e){var t=_objectSpread2({showTitle:!0,label:e.title,desc:e.description,minLength:e.minLength,maxLength:e.maxLength},e["ui:props"]||{});return _objectSpread2(_objectSpread2({},t),{},{labelWidth:t.showTitle?t.labelWidth:.1})}},{key:"getDependencies",value:function(e,t){return Object.entries(e.dependencies||{}).find((function(e){return Array.isArray(e[1])&&e[1].includes(t)}))}},{key:"resolveDefaultDatasource",value:function(e){var t,n,i;return null!==(t=e["ui:component"])&&void 0!==t&&null!==(n=t.props)&&void 0!==n&&n.datasource?e["ui:component"].props.datasource:Array.isArray(e.enum)?e.enum.map((function(e){return{value:e,label:e}})):Array.isArray(null===(i=e.items)||void 0===i?void 0:i.enum)?(e.items.enum||[]).map((function(e){return{value:e,label:e}})):"object"!==_typeof(e.type)&&e.oneOf&&e.oneOf.every((function(e){return e.const}))?e.oneOf.map((function(e){return{value:e.const,label:e.title||e.const}})):"object"!==_typeof(e.type)&&e.anyOf&&e.anyOf.every((function(e){return e.const}))?e.anyOf.map((function(e){return{value:e.const,label:e.title||e.const}})):void 0}}]),e}();Schema.rootSchema=void 0;var Layout=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];_classCallCheck(this,e),this.layout=void 0,Array.isArray(t)?this.layout=this.parseLayout({prop:"",group:t}):this.layout=this.parseLayout(t)}return _createClass(e,[{key:"transformValueToPixel",value:function(e){return"number"==typeof e?"".concat(e,"px"):e}},{key:"parseLayout",value:function(e){var t=this,n=this.getLayoutDimension(e.group),i=this.parseGridTemplate(n),a=(e.group||[]).map((function(e){return Array.isArray(e)?e.map((function(e){return"string"==typeof e||"number"==typeof e?{prop:e,item:{gridArea:e,overflow:"hidden"}}:"object"===_typeof(e)&&Reflect.has(e,"group")?t.parseLayout(e):e})):(console.error("layout ".concat(JSON.stringify(e)," error, must be a array")),[])})),r=this.parseGridTemplateAreas(n,a);return{prop:e.prop||"",item:_objectSpread2({gridArea:e.prop,overflow:"hidden"},e.item),container:_objectSpread2(_objectSpread2({display:"grid",gridTemplateAreas:r,gridGap:"20px"},i),e.container),group:a}}},{key:"getLayoutDimension",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return e.reduce((function(e,t){return Array.isArray(t)||console.error("layout ".concat(JSON.stringify(t)," error, must be a array")),t&&(e.columns=Math.max(e.columns,t.length||0)),e.rows+=1,e}),{columns:0,rows:0})}},{key:"parseGridTemplate",value:function(e){return{gridTemplateColumns:this.repeatTemplate(e.columns,!1),gridTemplateRows:this.repeatTemplate(e.rows)}}},{key:"parseGridTemplateAreas",value:function(e,t){var n=this;return t.reduce((function(t,i){var a=n.autoFillColumns(i,e.columns);return t.push('"'.concat(a.join(" "),'"')),t}),[]).join("\n")}},{key:"autoFillColumns",value:function(e,t){if(e.length===t)return e.map((function(e){return e.prop}));var n=Math.floor((t-e.length)/e.length),i=e.reduce((function(e,t){e.push(t.prop);var i=new Array(n).fill(t.prop);return e.concat(i)}),[]);if(i.length<t){var a=new Array(t-i.length).fill(".");return i.concat(a)}return i}},{key:"repeatTemplate",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Array(e+1).join(t?"auto ":"1fr ").trim()}}],[{key:"findLayoutByProp",value:function(e,t){var n;return t.find((function(t){return n=t.find((function(t){return t.prop===e}))})),n}}]),e}();function createProxy(e,t){return new Proxy(e,{get:function(e,n,i){return"function"==typeof e[n]?e[n].apply(t):Reflect.get(e,n,i)}})}var Path=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getCurPath",value:function(e,t){return""===e?t:[e,t].join(this.separator)}},{key:"getPathVal",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!t)return e;for(var i=t.split(this.separator),a=0;a<i.length-n;a+=1){if(void 0===e)return;e=""===i[a]?e:e[i[a]]}return e}},{key:"setPathValue",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,i=JSON.parse(JSON.stringify(e)),a=t.split(this.separator),r=a.pop()||"",o=i;return a.forEach((function(e){o[e]||(o[e]={}),o=o[e]})),o[r]=n,i}},{key:"getSubPath",value:function(e,t){return t.replace("".concat(e,"."),"")}},{key:"getPathLastProp",value:function(e){return e.split(this.separator).pop()}},{key:"getParentPath",value:function(e){var t=e.split(this.separator);return t.length<=1?"":t.slice(0,t.length-1).join(this.separator)}}]),e}();Path.separator=".";var _excluded$5=["params","responseType","method","headers","responseParse"],methodsWithoutData=["GET","HEAD","OPTIONS","DELETE"],defaultConfig={responseType:"json",method:"GET",params:{},headers:{},cache:"no-cache"},request=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){var n,i,a,r,o,s,c,l,u,d,f,p,m,h,v,g,y,b,_,k,w=arguments;return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=w.length>1&&void 0!==w[1]?w[1]:{},i=mergeDeep(defaultConfig,n),a=i.params,r=i.responseType,o=void 0===r?"json":r,s=i.method,c=void 0===s?"GET":s,l=i.headers,u=void 0===l?{}:l,d=i.responseParse,f=_objectWithoutProperties(i,_excluded$5),m=t,methodsWithoutData.includes(c.toUpperCase())?m="".concat(m,"?").concat(isObj(a)?new URLSearchParams(a):a||""):isObj(a)?(u["Content-Type"]="application/json;charset=utf-8",p=JSON.stringify(a)):p=a,e.prev=4,e.next=7,fetch(m,_objectSpread2(_objectSpread2({},f),{},{method:c.toLocaleUpperCase(),headers:u,body:p}));case 7:if(!(h=e.sent).ok){e.next=21;break}return e.next=11,h[o]();case 11:if(v=e.sent,!d){e.next=20;break}if("function"!=typeof d){e.next=15;break}return e.abrupt("return",Promise.resolve(d(v)));case 15:if(!isObj(d)){e.next=19;break}return g=d.dataKey,y=void 0===g?"data":g,b=d.labelKey,_=d.valueKey,k=((null==v?void 0:v[y])||[]).map((function(e){return _objectSpread2(_objectSpread2({},e),{},{label:null==e?void 0:e[b],value:null==e?void 0:e[_]})})),e.abrupt("return",Promise.resolve(k));case 19:case 20:return e.abrupt("return",Promise.resolve(v));case 21:e.t0=h.status,e.next=400===e.t0?24:401===e.t0?25:403===e.t0||500===e.t0?26:27;break;case 24:case 25:case 26:return e.abrupt("break",27);case 27:e.next=33;break;case 29:e.prev=29,e.t1=e.catch(4),console.error("Request Failed",e.t1),Promise.reject(e.t1);case 33:case"end":return e.stop()}}),e,null,[[4,29]])})));return function(t){return e.apply(this,arguments)}}(),props$1={value:{type:Object,default:function(){return{}}},rules:{type:Object,default:function(){return{}}},schema:{type:Object,default:function(){return{}}},width:{type:[String,Number],default:"100%"},layout:{type:[Array,Object],default:function(){return[]}},formType:{type:String,default:"horizontal"},context:{type:Object,default:function(){return{}}},httpAdapter:{type:Object,default:function(){return{request:request,responseParse:function(e){return e}}}},readonly:{type:Boolean,default:!1},readonlyMode:{type:String,default:"value",validator:function(e){return["value","custom"].includes(e)}},labelWidth:{type:Number,default:150}},props={schema:{type:Object,default:function(){return{}}},path:{type:String,default:""},required:{type:Boolean,default:!1},rootData:{type:Object,default:function(){return{}}},value:{type:[String,Number,Array,Object,Boolean]},layout:{type:Object,default:function(){return{}}},context:{type:Object,default:function(){return{}}},removeable:{type:Boolean,default:!1},httpAdapter:{type:Object,default:function(){return{request:request,responseParse:function(e){return e}}}},visible:{type:Boolean,default:!0},error:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},readonlyMode:{type:String,default:"value",validator:function(e){return["value","custom"].includes(e)}}},SchemaField=Vue__default.default.extend({name:"SchemaField",functional:!0,props:props,render:function(e,t){var n=t.props,i=n.schema,a=n.rootData,r=n.path,o=Schema.resolveSchema(i);if(!Object.keys(i).length)return e();var s=Schema.getSchemaField(o),c=s.name,l=s.props;return c?e(c,_objectSpread2(_objectSpread2({},t.data),{},{props:_objectSpread2(_objectSpread2(_objectSpread2({},l),t.props),{},{value:Path.getPathVal(a,r),schema:createProxy(o,t)})})):e()}}),getContext=function(e){var t=e.context,n=e.loadDataSource,i=e.validate,a=e.schema,r=e.rootData,o=e.widgetNode;return{$self:e,$context:t,$schema:a,$rules:a.rules,$loadDataSource:n,$validate:i,$rootData:r,$widgetNode:o}},executeExpression=function executeExpression(expression,instance){var $dep=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],_getContext=getContext(instance),$self=_getContext.$self,$context=_getContext.$context,$schema=_getContext.$schema,$rules=_getContext.$rules,$loadDataSource=_getContext.$loadDataSource,$validate=_getContext.$validate,$rootData=_getContext.$rootData,$widgetNode=_getContext.$widgetNode,context={$self:$self,$context:$context,$schema:$schema,$rules:$rules,$loadDataSource:$loadDataSource,$validate:$validate,$rootData:$rootData,$widgetNode:$widgetNode,$dep:$dep};if("string"==typeof expression){if(!/^{{.+}}$/.test(expression.trim()))return expression;var expStr=expression.trim().replace(/(^{{)|(}}$)/g,"").trim(),innerFuncs=["$loadDataSource","$validate"],func=function func(_ref){_ref.$self,_ref.$context,_ref.$schema,_ref.$rules,_ref.$loadDataSource,_ref.$validate,_ref.$rootData,_ref.$widgetNode,_ref.$dep;try{return innerFuncs.includes(expStr)?eval("".concat(expStr,"()")):eval(expStr)}catch(e){console.error("execute ".concat(expStr," error, please check. \n"),e)}};return func(context)}if(isObj(expression))return Object.keys(expression).forEach((function(e){expression[e]=executeExpression(expression[e],instance)})),expression},isExpression=function(e){return"string"==typeof e&&/{{.*}}/.test(e)},WidgetNode=function(){function e(t){_classCallCheck(this,e),this.id=void 0,this.instance=void 0,this.parent=void 0,this.type=void 0,this.index=void 0,this.children=void 0;var n=t.id,i=t.instance,a=t.parent,r=t.index,o=t.type,s=t.children,c=void 0===s?[]:s;this.id=n,this.type=o,this.index=r,this.instance=i,this.parent=a,this.children=c}return _createClass(e,[{key:"value",get:function(){var e;return null===(e=this.instance)||void 0===e?void 0:e.value}},{key:"isChildrenVisible",get:function(){var e;return"node"===this.type?null===(e=this.instance)||void 0===e?void 0:e.state.visible:this.children.some((function(e){return e.isChildrenVisible}))}},{key:"parents",get:function(){return this.parent?[].concat(_toConsumableArray(this.parent.parents),[this.parent]):[]}},{key:"firstChild",get:function(){return this.children[0]||null}},{key:"lastChild",get:function(){return this.children[this.children.length-1]||null}},{key:"getSibling",value:function(e){var t,n=new RegExp("".concat(Path.getPathLastProp(this.id)||"","$")),i=this.id.replace(n,e);return null===(t=this.parent)||void 0===t?void 0:t.children.find((function(e){return e.id===i}))}},{key:"getSiblings",value:function(){var e,t=this;return(null===(e=this.parent)||void 0===e?void 0:e.children.filter((function(e){return e.instance!==t.instance})))||[]}},{key:"isLeaf",get:function(){return!this.children.length}},{key:"appendChild",value:function(e){var t,n=Array.isArray(e)?e:[e],i=void 0!==e.index?e.index:this.children.length;return(t=this.children).splice.apply(t,[i,0].concat(_toConsumableArray(n))),this.children.slice(i).forEach((function(e,t){e.index=i+t})),n}},{key:"removeChild",value:function(e){var t=this,n=Array.isArray(e)?e:[e],i=[];n.forEach((function(e){var n=e.index;i.push(n),t.children.splice(n,1)}));var a=Math.min.apply(Math,i);return this.children.slice(a).forEach((function(e,t){e.index=a+t})),n}}]),e}(),WidgetTree=function(){function e(){_classCallCheck(this,e),this.widgetMap={}}return _createClass(e,[{key:"addWidgetNode",value:function(e,t,n,i){if(""===e){var a=new WidgetNode({id:"",type:n,index:i,parent:null,instance:t,children:[]});this.widgetMap[e]=a}else{var r=Path.getParentPath(e),o=this.widgetMap[r];if(!o)return void console.warn("Unexpected parent id, add widget failed");var s=new WidgetNode({id:e,type:n,index:i,parent:o,instance:t,children:[]});o.appendChild(s),this.widgetMap[e]=s}}},{key:"removeWidgetNode",value:function(e,t){var n=this.widgetMap[e];if(n){if(n.parent){var i=n.parent.children,a=i.findIndex((function(e){return e.instance===t}));a>-1&&(i.splice(a,1),i.slice(a).forEach((function(e,t){e.index=a+t})))}n.instance===t&&delete this.widgetMap[e]}}}]),e}(),widgetTree=new WidgetTree,reactionsMap={},subscribe=function(e,t,n){if(reactionsMap[e]||(reactionsMap[e]={lifetime:{},effect:{},fns:[]}),"valChange"===t)reactionsMap[e].fns.push(n);else{var i=_slicedToArray(t.split("/"),2),a=i[0],r=i[1];reactionsMap[e][a][r]?reactionsMap[e][a][r].push(n):reactionsMap[e][a][r]=[n]}},resolveReaction=function(e,t,n){return function(){var i=(widgetTree.widgetMap[e]||{}).instance,a=(widgetTree.widgetMap[t]||{}).instance,r=!0,o=[];n.source&&(Array.isArray(n.source)?n.source:[n.source]).forEach((function(t){var n=widgetTree.widgetMap[parsePath(t,e)].instance;o.push(n)})),"string"==typeof n.if&&(r=executeExpression(n.if,i,o));var s=r?n.then:n.else;executeOperations(s,a,o)}},executeOperations=function(e,t,n){e&&(e.state&&Object.keys(e.state).forEach((function(i){var a=e.state[i];"string"==typeof a&&/^{{.+}}$/.test(a.trim())&&(a=executeExpression(a,t,n)),t.setState(i,a)})),Array.isArray(e.actions)&&e.actions.forEach((function(e){executeExpression(e,t,n)})))},parsePath=function(e,t){return isExpression(e)?executeExpression(e,t):e},reactionRegister=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=widgetTree.widgetMap[e]||{},i=n.instance;t&&Array.isArray(t)&&t.forEach((function(t){var n=t.source?Array.isArray(t.source)?t.source:[t.source]:[e],a=parsePath("string"==typeof t.target?t.target:e,i);n.forEach((function(n){var r=parsePath(n,i);"string"==typeof t.lifetime&&subscribe(r,"lifetime/".concat(t.lifetime),resolveReaction(e,a,t)),"string"==typeof t.effect&&subscribe(r,"effect/".concat(t.effect),resolveReaction(e,a,t)),t.lifetime||t.effect||subscribe(r,"valChange",resolveReaction(e,a,t))}))}))},reactionUnRegister=function(e){delete reactionsMap[e]},reactionDispatch=function(e,t){var n,i,a=_slicedToArray(t.split("/"),2),r=a[0],o=void 0===r?"":r,s=a[1],c=void 0===s?"":s,l=[];reactionsMap[e]&&("valChange"===o?l=reactionsMap[e].fns:null!==(n=reactionsMap[e])&&void 0!==n&&null!==(i=n[o])&&void 0!==i&&i[c]&&(l=reactionsMap[e][o][c]),l.forEach((function(e){e()})))},commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var ajv$1={exports:{}},core$2={},validate$1={},boolSchema={},errors={},codegen={},code$1={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class n extends t{constructor(t){if(super(),!e.IDENTIFIER.test(t))throw new Error("CodeGen: name must be a valid identifier");this.str=t}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=n;class i extends t{constructor(e){super(),this._items="string"==typeof e?[e]:e}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const e=this._items[0];return""===e||'""'===e}get str(){var e;return null!==(e=this._str)&&void 0!==e?e:this._str=this._items.reduce((e,t)=>`${e}${t}`,"")}get names(){var e;return null!==(e=this._names)&&void 0!==e?e:this._names=this._items.reduce((e,t)=>(t instanceof n&&(e[t.str]=(e[t.str]||0)+1),e),{})}}function a(e,...t){const n=[e[0]];let a=0;for(;a<t.length;)s(n,t[a]),n.push(e[++a]);return new i(n)}e._Code=i,e.nil=new i(""),e._=a;const r=new i("+");function o(e,...t){const n=[l(e[0])];let a=0;for(;a<t.length;)n.push(r),s(n,t[a]),n.push(r,l(e[++a]));return function(e){let t=1;for(;t<e.length-1;){if(e[t]===r){const n=c(e[t-1],e[t+1]);if(void 0!==n){e.splice(t-1,3,n);continue}e[t++]="+"}t++}}(n),new i(n)}function s(e,t){var a;t instanceof i?e.push(...t._items):t instanceof n?e.push(t):e.push("number"==typeof(a=t)||"boolean"==typeof a||null===a?a:l(Array.isArray(a)?a.join(","):a))}function c(e,t){if('""'===t)return e;if('""'===e)return t;if("string"==typeof e){if(t instanceof n||'"'!==e[e.length-1])return;return"string"!=typeof t?`${e.slice(0,-1)}${t}"`:'"'===t[0]?e.slice(0,-1)+t.slice(1):void 0}return"string"!=typeof t||'"'!==t[0]||e instanceof n?void 0:`"${e}${t.slice(1)}`}function l(e){return JSON.stringify(e).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.str=o,e.addCodeArg=s,e.strConcat=function(e,t){return t.emptyStr()?e:e.emptyStr()?t:o`${e}${t}`},e.stringify=function(e){return new i(l(e))},e.safeStringify=l,e.getProperty=function(t){return"string"==typeof t&&e.IDENTIFIER.test(t)?new i("."+t):a`[${t}]`},e.getEsmExportName=function(t){if("string"==typeof t&&e.IDENTIFIER.test(t))return new i(""+t);throw new Error(`CodeGen: invalid export name: ${t}, use explicit $id name mapping`)},e.regexpCode=function(e){return new i(e.toString())}}(code$1);var scope={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=code$1;class n extends Error{constructor(e){super(`CodeGen: "code" for ${e} not defined`),this.value=e.value}}var i;!function(e){e[e.Started=0]="Started",e[e.Completed=1]="Completed"}(i=e.UsedValueState||(e.UsedValueState={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class a{constructor({prefixes:e,parent:t}={}){this._names={},this._prefixes=e,this._parent=t}toName(e){return e instanceof t.Name?e:this.name(e)}name(e){return new t.Name(this._newName(e))}_newName(e){return`${e}${(this._names[e]||this._nameGroup(e)).index++}`}_nameGroup(e){var t,n;if((null===(n=null===(t=this._parent)||void 0===t?void 0:t._prefixes)||void 0===n?void 0:n.has(e))||this._prefixes&&!this._prefixes.has(e))throw new Error(`CodeGen: prefix "${e}" is not allowed in this scope`);return this._names[e]={prefix:e,index:0}}}e.Scope=a;class r extends t.Name{constructor(e,t){super(t),this.prefix=e}setValue(e,{property:n,itemIndex:i}){this.value=e,this.scopePath=t._`.${new t.Name(n)}[${i}]`}}e.ValueScopeName=r;const o=t._`\n`;e.ValueScope=class extends a{constructor(e){super(e),this._values={},this._scope=e.scope,this.opts={...e,_n:e.lines?o:t.nil}}get(){return this._scope}name(e){return new r(e,this._newName(e))}value(e,t){var n;if(void 0===t.ref)throw new Error("CodeGen: ref must be passed in value");const i=this.toName(e),{prefix:a}=i,r=null!==(n=t.key)&&void 0!==n?n:t.ref;let o=this._values[a];if(o){const e=o.get(r);if(e)return e}else o=this._values[a]=new Map;o.set(r,i);const s=this._scope[a]||(this._scope[a]=[]),c=s.length;return s[c]=t.ref,i.setValue(t,{property:a,itemIndex:c}),i}getValue(e,t){const n=this._values[e];if(n)return n.get(t)}scopeRefs(e,n=this._values){return this._reduceValues(n,n=>{if(void 0===n.scopePath)throw new Error(`CodeGen: name "${n}" has no value`);return t._`${e}${n.scopePath}`})}scopeCode(e=this._values,t,n){return this._reduceValues(e,e=>{if(void 0===e.value)throw new Error(`CodeGen: name "${e}" has no value`);return e.value.code},t,n)}_reduceValues(a,r,o={},s){let c=t.nil;for(const l in a){const u=a[l];if(!u)continue;const d=o[l]=o[l]||new Map;u.forEach(a=>{if(d.has(a))return;d.set(a,i.Started);let o=r(a);if(o){const n=this.opts.es5?e.varKinds.var:e.varKinds.const;c=t._`${c}${n} ${a} = ${o};${this.opts._n}`}else{if(!(o=null==s?void 0:s(a)))throw new n(a);c=t._`${c}${o}${this.opts._n}`}d.set(a,i.Completed)})}return c}}}(scope),function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=code$1,n=scope;var i=code$1;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return i._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return i.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return i.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return i.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return i.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return i.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return i.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return i.Name}});var a=scope;Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return a.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return a.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return a.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return a.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class r{optimizeNodes(){return this}optimizeNames(e,t){return this}}class o extends r{constructor(e,t,n){super(),this.varKind=e,this.name=t,this.rhs=n}render({es5:e,_n:t}){const i=e?n.varKinds.var:this.varKind,a=void 0===this.rhs?"":" = "+this.rhs;return`${i} ${this.name}${a};`+t}optimizeNames(e,t){if(e[this.name.str])return this.rhs&&(this.rhs=T(this.rhs,e,t)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class s extends r{constructor(e,t,n){super(),this.lhs=e,this.rhs=t,this.sideEffects=n}render({_n:e}){return`${this.lhs} = ${this.rhs};`+e}optimizeNames(e,n){if(!(this.lhs instanceof t.Name)||e[this.lhs.str]||this.sideEffects)return this.rhs=T(this.rhs,e,n),this}get names(){return L(this.lhs instanceof t.Name?{}:{...this.lhs.names},this.rhs)}}class c extends s{constructor(e,t,n,i){super(e,n,i),this.op=t}render({_n:e}){return`${this.lhs} ${this.op}= ${this.rhs};`+e}}class l extends r{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return this.label+":"+e}}class u extends r{constructor(e){super(),this.label=e,this.names={}}render({_n:e}){return`break${this.label?" "+this.label:""};`+e}}class d extends r{constructor(e){super(),this.error=e}render({_n:e}){return`throw ${this.error};`+e}get names(){return this.error.names}}class f extends r{constructor(e){super(),this.code=e}render({_n:e}){return this.code+";"+e}optimizeNodes(){return""+this.code?this:void 0}optimizeNames(e,t){return this.code=T(this.code,e,t),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class p extends r{constructor(e=[]){super(),this.nodes=e}render(e){return this.nodes.reduce((t,n)=>t+n.render(e),"")}optimizeNodes(){const{nodes:e}=this;let t=e.length;for(;t--;){const n=e[t].optimizeNodes();Array.isArray(n)?e.splice(t,1,...n):n?e[t]=n:e.splice(t,1)}return e.length>0?this:void 0}optimizeNames(e,t){const{nodes:n}=this;let i=n.length;for(;i--;){const a=n[i];a.optimizeNames(e,t)||(E(e,a.names),n.splice(i,1))}return n.length>0?this:void 0}get names(){return this.nodes.reduce((e,t)=>x(e,t.names),{})}}class m extends p{render(e){return"{"+e._n+super.render(e)+"}"+e._n}}class h extends p{}class v extends m{}v.kind="else";class g extends m{constructor(e,t){super(t),this.condition=e}render(e){let t=`if(${this.condition})`+super.render(e);return this.else&&(t+="else "+this.else.render(e)),t}optimizeNodes(){super.optimizeNodes();const e=this.condition;if(!0===e)return this.nodes;let t=this.else;if(t){const e=t.optimizeNodes();t=this.else=Array.isArray(e)?new v(e):e}return t?!1===e?t instanceof g?t:t.nodes:this.nodes.length?this:new g(O(e),t instanceof g?[t]:t.nodes):!1!==e&&this.nodes.length?this:void 0}optimizeNames(e,t){var n;if(this.else=null===(n=this.else)||void 0===n?void 0:n.optimizeNames(e,t),super.optimizeNames(e,t)||this.else)return this.condition=T(this.condition,e,t),this}get names(){const e=super.names;return L(e,this.condition),this.else&&x(e,this.else.names),e}}g.kind="if";class y extends m{}y.kind="for";class b extends y{constructor(e){super(),this.iteration=e}render(e){return`for(${this.iteration})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iteration=T(this.iteration,e,t),this}get names(){return x(super.names,this.iteration.names)}}class _ extends y{constructor(e,t,n,i){super(),this.varKind=e,this.name=t,this.from=n,this.to=i}render(e){const t=e.es5?n.varKinds.var:this.varKind,{name:i,from:a,to:r}=this;return`for(${t} ${i}=${a}; ${i}<${r}; ${i}++)`+super.render(e)}get names(){const e=L(super.names,this.from);return L(e,this.to)}}class k extends y{constructor(e,t,n,i){super(),this.loop=e,this.varKind=t,this.name=n,this.iterable=i}render(e){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(e)}optimizeNames(e,t){if(super.optimizeNames(e,t))return this.iterable=T(this.iterable,e,t),this}get names(){return x(super.names,this.iterable.names)}}class w extends m{constructor(e,t,n){super(),this.name=e,this.args=t,this.async=n}render(e){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(e)}}w.kind="func";class I extends p{render(e){return"return "+super.render(e)}}I.kind="return";class $ extends m{render(e){let t="try"+super.render(e);return this.catch&&(t+=this.catch.render(e)),this.finally&&(t+=this.finally.render(e)),t}optimizeNodes(){var e,t;return super.optimizeNodes(),null===(e=this.catch)||void 0===e||e.optimizeNodes(),null===(t=this.finally)||void 0===t||t.optimizeNodes(),this}optimizeNames(e,t){var n,i;return super.optimizeNames(e,t),null===(n=this.catch)||void 0===n||n.optimizeNames(e,t),null===(i=this.finally)||void 0===i||i.optimizeNames(e,t),this}get names(){const e=super.names;return this.catch&&x(e,this.catch.names),this.finally&&x(e,this.finally.names),e}}class S extends m{constructor(e){super(),this.error=e}render(e){return`catch(${this.error})`+super.render(e)}}S.kind="catch";class C extends m{render(e){return"finally"+super.render(e)}}function x(e,t){for(const n in t)e[n]=(e[n]||0)+(t[n]||0);return e}function L(e,n){return n instanceof t._CodeOrName?x(e,n.names):e}function T(e,n,i){return e instanceof t.Name?r(e):(a=e)instanceof t._Code&&a._items.some(e=>e instanceof t.Name&&1===n[e.str]&&void 0!==i[e.str])?new t._Code(e._items.reduce((e,n)=>(n instanceof t.Name&&(n=r(n)),n instanceof t._Code?e.push(...n._items):e.push(n),e),[])):e;var a;function r(e){const t=i[e.str];return void 0===t||1!==n[e.str]?e:(delete n[e.str],t)}}function E(e,t){for(const n in t)e[n]=(e[n]||0)-(t[n]||0)}function O(e){return"boolean"==typeof e||"number"==typeof e||null===e?!e:t._`!${P(e)}`}C.kind="finally",e.CodeGen=class{constructor(e,t={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...t,_n:t.lines?"\n":""},this._extScope=e,this._scope=new n.Scope({parent:e}),this._nodes=[new h]}toString(){return this._root.render(this.opts)}name(e){return this._scope.name(e)}scopeName(e){return this._extScope.name(e)}scopeValue(e,t){const n=this._extScope.value(e,t);return(this._values[n.prefix]||(this._values[n.prefix]=new Set)).add(n),n}getScopeValue(e,t){return this._extScope.getValue(e,t)}scopeRefs(e){return this._extScope.scopeRefs(e,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(e,t,n,i){const a=this._scope.toName(t);return void 0!==n&&i&&(this._constants[a.str]=n),this._leafNode(new o(e,a,n)),a}const(e,t,i){return this._def(n.varKinds.const,e,t,i)}let(e,t,i){return this._def(n.varKinds.let,e,t,i)}var(e,t,i){return this._def(n.varKinds.var,e,t,i)}assign(e,t,n){return this._leafNode(new s(e,t,n))}add(t,n){return this._leafNode(new c(t,e.operators.ADD,n))}code(e){return"function"==typeof e?e():e!==t.nil&&this._leafNode(new f(e)),this}object(...e){const n=["{"];for(const[i,a]of e)n.length>1&&n.push(","),n.push(i),(i!==a||this.opts.es5)&&(n.push(":"),(0,t.addCodeArg)(n,a));return n.push("}"),new t._Code(n)}if(e,t,n){if(this._blockNode(new g(e)),t&&n)this.code(t).else().code(n).endIf();else if(t)this.code(t).endIf();else if(n)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(e){return this._elseNode(new g(e))}else(){return this._elseNode(new v)}endIf(){return this._endBlockNode(g,v)}_for(e,t){return this._blockNode(e),t&&this.code(t).endFor(),this}for(e,t){return this._for(new b(e),t)}forRange(e,t,i,a,r=(this.opts.es5?n.varKinds.var:n.varKinds.let)){const o=this._scope.toName(e);return this._for(new _(r,o,t,i),()=>a(o))}forOf(e,i,a,r=n.varKinds.const){const o=this._scope.toName(e);if(this.opts.es5){const e=i instanceof t.Name?i:this.var("_arr",i);return this.forRange("_i",0,t._`${e}.length`,n=>{this.var(o,t._`${e}[${n}]`),a(o)})}return this._for(new k("of",r,o,i),()=>a(o))}forIn(e,i,a,r=(this.opts.es5?n.varKinds.var:n.varKinds.const)){if(this.opts.ownProperties)return this.forOf(e,t._`Object.keys(${i})`,a);const o=this._scope.toName(e);return this._for(new k("in",r,o,i),()=>a(o))}endFor(){return this._endBlockNode(y)}label(e){return this._leafNode(new l(e))}break(e){return this._leafNode(new u(e))}return(e){const t=new I;if(this._blockNode(t),this.code(e),1!==t.nodes.length)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(I)}try(e,t,n){if(!t&&!n)throw new Error('CodeGen: "try" without "catch" and "finally"');const i=new $;if(this._blockNode(i),this.code(e),t){const e=this.name("e");this._currNode=i.catch=new S(e),t(e)}return n&&(this._currNode=i.finally=new C,this.code(n)),this._endBlockNode(S,C)}throw(e){return this._leafNode(new d(e))}block(e,t){return this._blockStarts.push(this._nodes.length),e&&this.code(e).endBlock(t),this}endBlock(e){const t=this._blockStarts.pop();if(void 0===t)throw new Error("CodeGen: not in self-balancing block");const n=this._nodes.length-t;if(n<0||void 0!==e&&n!==e)throw new Error(`CodeGen: wrong number of nodes: ${n} vs ${e} expected`);return this._nodes.length=t,this}func(e,n=t.nil,i,a){return this._blockNode(new w(e,n,i)),a&&this.code(a).endFunc(),this}endFunc(){return this._endBlockNode(w)}optimize(e=1){for(;e-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(e){return this._currNode.nodes.push(e),this}_blockNode(e){this._currNode.nodes.push(e),this._nodes.push(e)}_endBlockNode(e,t){const n=this._currNode;if(n instanceof e||t&&n instanceof t)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${t?`${e.kind}/${t.kind}`:e.kind}"`)}_elseNode(e){const t=this._currNode;if(!(t instanceof g))throw new Error('CodeGen: "else" without "if"');return this._currNode=t.else=e,this}get _root(){return this._nodes[0]}get _currNode(){const e=this._nodes;return e[e.length-1]}set _currNode(e){const t=this._nodes;t[t.length-1]=e}},e.not=O;const D=j(e.operators.AND);e.and=function(...e){return e.reduce(D)};const N=j(e.operators.OR);function j(e){return(n,i)=>n===t.nil?i:i===t.nil?n:t._`${P(n)} ${e} ${P(i)}`}function P(e){return e instanceof t.Name?e:t._`(${e})`}e.or=function(...e){return e.reduce(N)}}(codegen);var util={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.checkStrictMode=e.getErrorPath=e.Type=e.useFunc=e.setEvaluated=e.evaluatedPropsToName=e.mergeEvaluated=e.eachItem=e.unescapeJsonPointer=e.escapeJsonPointer=e.escapeFragment=e.unescapeFragment=e.schemaRefOrVal=e.schemaHasRulesButRef=e.schemaHasRules=e.checkUnknownRules=e.alwaysValidSchema=e.toHash=void 0;const t=codegen,n=code$1;function i(e,t=e.schema){const{opts:n,self:i}=e;if(!n.strictSchema)return;if("boolean"==typeof t)return;const a=i.RULES.keywords;for(const n in t)a[n]||f(e,`unknown keyword: "${n}"`)}function a(e,t){if("boolean"==typeof e)return!e;for(const n in e)if(t[n])return!0;return!1}function r(e){return"number"==typeof e?""+e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function o(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function s({mergeNames:e,mergeToName:n,mergeValues:i,resultToName:a}){return(r,o,s,c)=>{const l=void 0===s?o:s instanceof t.Name?(o instanceof t.Name?e(r,o,s):n(r,o,s),s):o instanceof t.Name?(n(r,s,o),o):i(o,s);return c!==t.Name||l instanceof t.Name?l:a(r,l)}}function c(e,n){if(!0===n)return e.var("props",!0);const i=e.var("props",t._`{}`);return void 0!==n&&l(e,i,n),i}function l(e,n,i){Object.keys(i).forEach(i=>e.assign(t._`${n}${(0,t.getProperty)(i)}`,!0))}e.toHash=function(e){const t={};for(const n of e)t[n]=!0;return t},e.alwaysValidSchema=function(e,t){return"boolean"==typeof t?t:0===Object.keys(t).length||(i(e,t),!a(t,e.self.RULES.all))},e.checkUnknownRules=i,e.schemaHasRules=a,e.schemaHasRulesButRef=function(e,t){if("boolean"==typeof e)return!e;for(const n in e)if("$ref"!==n&&t.all[n])return!0;return!1},e.schemaRefOrVal=function({topSchemaRef:e,schemaPath:n},i,a,r){if(!r){if("number"==typeof i||"boolean"==typeof i)return i;if("string"==typeof i)return t._`${i}`}return t._`${e}${n}${(0,t.getProperty)(a)}`},e.unescapeFragment=function(e){return o(decodeURIComponent(e))},e.escapeFragment=function(e){return encodeURIComponent(r(e))},e.escapeJsonPointer=r,e.unescapeJsonPointer=o,e.eachItem=function(e,t){if(Array.isArray(e))for(const n of e)t(n);else t(e)},e.mergeEvaluated={props:s({mergeNames:(e,n,i)=>e.if(t._`${i} !== true && ${n} !== undefined`,()=>{e.if(t._`${n} === true`,()=>e.assign(i,!0),()=>e.assign(i,t._`${i} || {}`).code(t._`Object.assign(${i}, ${n})`))}),mergeToName:(e,n,i)=>e.if(t._`${i} !== true`,()=>{!0===n?e.assign(i,!0):(e.assign(i,t._`${i} || {}`),l(e,i,n))}),mergeValues:(e,t)=>!0===e||{...e,...t},resultToName:c}),items:s({mergeNames:(e,n,i)=>e.if(t._`${i} !== true && ${n} !== undefined`,()=>e.assign(i,t._`${n} === true ? true : ${i} > ${n} ? ${i} : ${n}`)),mergeToName:(e,n,i)=>e.if(t._`${i} !== true`,()=>e.assign(i,!0===n||t._`${i} > ${n} ? ${i} : ${n}`)),mergeValues:(e,t)=>!0===e||Math.max(e,t),resultToName:(e,t)=>e.var("items",t)})},e.evaluatedPropsToName=c,e.setEvaluated=l;const u={};var d;function f(e,t,n=e.opts.strictSchema){if(n){if(t="strict mode: "+t,!0===n)throw new Error(t);e.self.logger.warn(t)}}e.useFunc=function(e,t){return e.scopeValue("func",{ref:t,code:u[t.code]||(u[t.code]=new n._Code(t.code))})},function(e){e[e.Num=0]="Num",e[e.Str=1]="Str"}(d=e.Type||(e.Type={})),e.getErrorPath=function(e,n,i){if(e instanceof t.Name){const a=n===d.Num;return i?a?t._`"[" + ${e} + "]"`:t._`"['" + ${e} + "']"`:a?t._`"/" + ${e}`:t._`"/" + ${e}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return i?(0,t.getProperty)(e).toString():"/"+r(e)},e.checkStrictMode=f}(util);var names$1={};Object.defineProperty(names$1,"__esModule",{value:!0});const codegen_1$t=codegen,names={data:new codegen_1$t.Name("data"),valCxt:new codegen_1$t.Name("valCxt"),instancePath:new codegen_1$t.Name("instancePath"),parentData:new codegen_1$t.Name("parentData"),parentDataProperty:new codegen_1$t.Name("parentDataProperty"),rootData:new codegen_1$t.Name("rootData"),dynamicAnchors:new codegen_1$t.Name("dynamicAnchors"),vErrors:new codegen_1$t.Name("vErrors"),errors:new codegen_1$t.Name("errors"),this:new codegen_1$t.Name("this"),self:new codegen_1$t.Name("self"),scope:new codegen_1$t.Name("scope"),json:new codegen_1$t.Name("json"),jsonPos:new codegen_1$t.Name("jsonPos"),jsonLen:new codegen_1$t.Name("jsonLen"),jsonPart:new codegen_1$t.Name("jsonPart")};names$1.default=names,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=codegen,n=util,i=names$1;function a(e,n){const a=e.const("err",n);e.if(t._`${i.default.vErrors} === null`,()=>e.assign(i.default.vErrors,t._`[${a}]`),t._`${i.default.vErrors}.push(${a})`),e.code(t._`${i.default.errors}++`)}function r(e,n){const{gen:i,validateName:a,schemaEnv:r}=e;r.$async?i.throw(t._`new ${e.ValidationError}(${n})`):(i.assign(t._`${a}.errors`,n),i.return(!1))}e.keywordError={message:({keyword:e})=>t.str`must pass "${e}" keyword validation`},e.keyword$DataError={message:({keyword:e,schemaType:n})=>n?t.str`"${e}" keyword must be ${n} ($data)`:t.str`"${e}" keyword is invalid ($data)`},e.reportError=function(n,i=e.keywordError,o,c){const{it:l}=n,{gen:u,compositeRule:d,allErrors:f}=l,p=s(n,i,o);(null!=c?c:d||f)?a(u,p):r(l,t._`[${p}]`)},e.reportExtraError=function(t,n=e.keywordError,o){const{it:c}=t,{gen:l,compositeRule:u,allErrors:d}=c;a(l,s(t,n,o)),u||d||r(c,i.default.vErrors)},e.resetErrorsCount=function(e,n){e.assign(i.default.errors,n),e.if(t._`${i.default.vErrors} !== null`,()=>e.if(n,()=>e.assign(t._`${i.default.vErrors}.length`,n),()=>e.assign(i.default.vErrors,null)))},e.extendErrors=function({gen:e,keyword:n,schemaValue:a,data:r,errsCount:o,it:s}){if(void 0===o)throw new Error("ajv implementation error");const c=e.name("err");e.forRange("i",o,i.default.errors,o=>{e.const(c,t._`${i.default.vErrors}[${o}]`),e.if(t._`${c}.instancePath === undefined`,()=>e.assign(t._`${c}.instancePath`,(0,t.strConcat)(i.default.instancePath,s.errorPath))),e.assign(t._`${c}.schemaPath`,t.str`${s.errSchemaPath}/${n}`),s.opts.verbose&&(e.assign(t._`${c}.schema`,a),e.assign(t._`${c}.data`,r))})};const o={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function s(e,n,a){const{createErrors:r}=e.it;return!1===r?t._`{}`:function(e,n,a={}){const{gen:r,it:s}=e,u=[c(s,a),l(e,a)];return function(e,{params:n,message:a},r){const{keyword:s,data:c,schemaValue:l,it:u}=e,{opts:d,propertyName:f,topSchemaRef:p,schemaPath:m}=u;r.push([o.keyword,s],[o.params,"function"==typeof n?n(e):n||t._`{}`]),d.messages&&r.push([o.message,"function"==typeof a?a(e):a]),d.verbose&&r.push([o.schema,l],[o.parentSchema,t._`${p}${m}`],[i.default.data,c]),f&&r.push([o.propertyName,f])}(e,n,u),r.object(...u)}(e,n,a)}function c({errorPath:e},{instancePath:a}){const r=a?t.str`${e}${(0,n.getErrorPath)(a,n.Type.Str)}`:e;return[i.default.instancePath,(0,t.strConcat)(i.default.instancePath,r)]}function l({keyword:e,it:{errSchemaPath:i}},{schemaPath:a,parentSchema:r}){let s=r?i:t.str`${i}/${e}`;return a&&(s=t.str`${s}${(0,n.getErrorPath)(a,n.Type.Str)}`),[o.schemaPath,s]}}(errors),Object.defineProperty(boolSchema,"__esModule",{value:!0}),boolSchema.boolOrEmptySchema=boolSchema.topBoolOrEmptySchema=void 0;const errors_1$2=errors,codegen_1$s=codegen,names_1$6=names$1,boolError={message:"boolean schema is false"};function topBoolOrEmptySchema(e){const{gen:t,schema:n,validateName:i}=e;!1===n?falseSchemaError(e,!1):"object"==typeof n&&!0===n.$async?t.return(names_1$6.default.data):(t.assign(codegen_1$s._`${i}.errors`,null),t.return(!0))}function boolOrEmptySchema(e,t){const{gen:n,schema:i}=e;!1===i?(n.var(t,!1),falseSchemaError(e)):n.var(t,!0)}function falseSchemaError(e,t){const{gen:n,data:i}=e,a={gen:n,keyword:"false schema",data:i,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};(0,errors_1$2.reportError)(a,boolError,void 0,t)}boolSchema.topBoolOrEmptySchema=topBoolOrEmptySchema,boolSchema.boolOrEmptySchema=boolOrEmptySchema;var dataType={},rules={};Object.defineProperty(rules,"__esModule",{value:!0}),rules.getRules=rules.isJSONType=void 0;const _jsonTypes=["string","number","integer","boolean","null","object","array"],jsonTypes=new Set(_jsonTypes);function isJSONType(e){return"string"==typeof e&&jsonTypes.has(e)}function getRules(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}rules.isJSONType=isJSONType,rules.getRules=getRules;var applicability={};function schemaHasRulesForType({schema:e,self:t},n){const i=t.RULES.types[n];return i&&!0!==i&&shouldUseGroup(e,i)}function shouldUseGroup(e,t){return t.rules.some(t=>shouldUseRule(e,t))}function shouldUseRule(e,t){var n;return void 0!==e[t.keyword]||(null===(n=t.definition.implements)||void 0===n?void 0:n.some(t=>void 0!==e[t]))}Object.defineProperty(applicability,"__esModule",{value:!0}),applicability.shouldUseRule=applicability.shouldUseGroup=applicability.schemaHasRulesForType=void 0,applicability.schemaHasRulesForType=schemaHasRulesForType,applicability.shouldUseGroup=shouldUseGroup,applicability.shouldUseRule=shouldUseRule,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.reportTypeError=e.checkDataTypes=e.checkDataType=e.coerceAndCheckDataType=e.getJSONTypes=e.getSchemaTypes=e.DataType=void 0;const t=rules,n=applicability,i=errors,a=codegen,r=util;var o;function s(e){const n=Array.isArray(e)?e:e?[e]:[];if(n.every(t.isJSONType))return n;throw new Error("type must be JSONType or JSONType[]: "+n.join(","))}!function(e){e[e.Correct=0]="Correct",e[e.Wrong=1]="Wrong"}(o=e.DataType||(e.DataType={})),e.getSchemaTypes=function(e){const t=s(e.type);if(t.includes("null")){if(!1===e.nullable)throw new Error("type: null contradicts nullable: false")}else{if(!t.length&&void 0!==e.nullable)throw new Error('"nullable" cannot be used without "type"');!0===e.nullable&&t.push("null")}return t},e.getJSONTypes=s,e.coerceAndCheckDataType=function(e,t){const{gen:i,data:r,opts:s}=e,l=function(e,t){return t?e.filter(e=>c.has(e)||"array"===t&&"array"===e):[]}(t,s.coerceTypes),d=t.length>0&&!(0===l.length&&1===t.length&&(0,n.schemaHasRulesForType)(e,t[0]));if(d){const n=u(t,r,s.strictNumbers,o.Wrong);i.if(n,()=>{l.length?function(e,t,n){const{gen:i,data:r,opts:o}=e,s=i.let("dataType",a._`typeof ${r}`),l=i.let("coerced",a._`undefined`);"array"===o.coerceTypes&&i.if(a._`${s} == 'object' && Array.isArray(${r}) && ${r}.length == 1`,()=>i.assign(r,a._`${r}[0]`).assign(s,a._`typeof ${r}`).if(u(t,r,o.strictNumbers),()=>i.assign(l,r))),i.if(a._`${l} !== undefined`);for(const e of n)(c.has(e)||"array"===e&&"array"===o.coerceTypes)&&d(e);function d(e){switch(e){case"string":return void i.elseIf(a._`${s} == "number" || ${s} == "boolean"`).assign(l,a._`"" + ${r}`).elseIf(a._`${r} === null`).assign(l,a._`""`);case"number":return void i.elseIf(a._`${s} == "boolean" || ${r} === null
              || (${s} == "string" && ${r} && ${r} == +${r})`).assign(l,a._`+${r}`);case"integer":return void i.elseIf(a._`${s} === "boolean" || ${r} === null
              || (${s} === "string" && ${r} && ${r} == +${r} && !(${r} % 1))`).assign(l,a._`+${r}`);case"boolean":return void i.elseIf(a._`${r} === "false" || ${r} === 0 || ${r} === null`).assign(l,!1).elseIf(a._`${r} === "true" || ${r} === 1`).assign(l,!0);case"null":return i.elseIf(a._`${r} === "" || ${r} === 0 || ${r} === false`),void i.assign(l,null);case"array":i.elseIf(a._`${s} === "string" || ${s} === "number"
              || ${s} === "boolean" || ${r} === null`).assign(l,a._`[${r}]`)}}i.else(),f(e),i.endIf(),i.if(a._`${l} !== undefined`,()=>{i.assign(r,l),function({gen:e,parentData:t,parentDataProperty:n},i){e.if(a._`${t} !== undefined`,()=>e.assign(a._`${t}[${n}]`,i))}(e,l)})}(e,t,l):f(e)})}return d};const c=new Set(["string","number","integer","boolean","null"]);function l(e,t,n,i=o.Correct){const r=i===o.Correct?a.operators.EQ:a.operators.NEQ;let s;switch(e){case"null":return a._`${t} ${r} null`;case"array":s=a._`Array.isArray(${t})`;break;case"object":s=a._`${t} && typeof ${t} == "object" && !Array.isArray(${t})`;break;case"integer":s=c(a._`!(${t} % 1) && !isNaN(${t})`);break;case"number":s=c();break;default:return a._`typeof ${t} ${r} ${e}`}return i===o.Correct?s:(0,a.not)(s);function c(e=a.nil){return(0,a.and)(a._`typeof ${t} == "number"`,e,n?a._`isFinite(${t})`:a.nil)}}function u(e,t,n,i){if(1===e.length)return l(e[0],t,n,i);let o;const s=(0,r.toHash)(e);if(s.array&&s.object){const e=a._`typeof ${t} != "object"`;o=s.null?e:a._`!${t} || ${e}`,delete s.null,delete s.array,delete s.object}else o=a.nil;s.number&&delete s.integer;for(const e in s)o=(0,a.and)(o,l(e,t,n,i));return o}e.checkDataType=l,e.checkDataTypes=u;const d={message:({schema:e})=>"must be "+e,params:({schema:e,schemaValue:t})=>"string"==typeof e?a._`{type: ${e}}`:a._`{type: ${t}}`};function f(e){const t=function(e){const{gen:t,data:n,schema:i}=e,a=(0,r.schemaRefOrVal)(e,i,"type");return{gen:t,keyword:"type",data:n,schema:i.type,schemaCode:a,schemaValue:a,parentSchema:i,params:{},it:e}}(e);(0,i.reportError)(t,d)}e.reportTypeError=f}(dataType);var defaults={};Object.defineProperty(defaults,"__esModule",{value:!0}),defaults.assignDefaults=void 0;const codegen_1$r=codegen,util_1$p=util;function assignDefaults(e,t){const{properties:n,items:i}=e.schema;if("object"===t&&n)for(const t in n)assignDefault(e,t,n[t].default);else"array"===t&&Array.isArray(i)&&i.forEach((t,n)=>assignDefault(e,n,t.default))}function assignDefault(e,t,n){const{gen:i,compositeRule:a,data:r,opts:o}=e;if(void 0===n)return;const s=codegen_1$r._`${r}${(0,codegen_1$r.getProperty)(t)}`;if(a)return void(0,util_1$p.checkStrictMode)(e,"default is ignored for: "+s);let c=codegen_1$r._`${s} === undefined`;"empty"===o.useDefaults&&(c=codegen_1$r._`${c} || ${s} === null || ${s} === ""`),i.if(c,codegen_1$r._`${s} = ${(0,codegen_1$r.stringify)(n)}`)}defaults.assignDefaults=assignDefaults;var keyword={},code={};Object.defineProperty(code,"__esModule",{value:!0}),code.validateUnion=code.validateArray=code.usePattern=code.callValidateCode=code.schemaProperties=code.allSchemaProperties=code.noPropertyInData=code.propertyInData=code.isOwnProperty=code.hasPropFunc=code.reportMissingProp=code.checkMissingProp=code.checkReportMissingProp=void 0;const codegen_1$q=codegen,util_1$o=util,names_1$5=names$1,util_2$1=util;function checkReportMissingProp(e,t){const{gen:n,data:i,it:a}=e;n.if(noPropertyInData(n,i,t,a.opts.ownProperties),()=>{e.setParams({missingProperty:codegen_1$q._`${t}`},!0),e.error()})}function checkMissingProp({gen:e,data:t,it:{opts:n}},i,a){return(0,codegen_1$q.or)(...i.map(i=>(0,codegen_1$q.and)(noPropertyInData(e,t,i,n.ownProperties),codegen_1$q._`${a} = ${i}`)))}function reportMissingProp(e,t){e.setParams({missingProperty:t},!0),e.error()}function hasPropFunc(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:codegen_1$q._`Object.prototype.hasOwnProperty`})}function isOwnProperty(e,t,n){return codegen_1$q._`${hasPropFunc(e)}.call(${t}, ${n})`}function propertyInData(e,t,n,i){const a=codegen_1$q._`${t}${(0,codegen_1$q.getProperty)(n)} !== undefined`;return i?codegen_1$q._`${a} && ${isOwnProperty(e,t,n)}`:a}function noPropertyInData(e,t,n,i){const a=codegen_1$q._`${t}${(0,codegen_1$q.getProperty)(n)} === undefined`;return i?(0,codegen_1$q.or)(a,(0,codegen_1$q.not)(isOwnProperty(e,t,n))):a}function allSchemaProperties(e){return e?Object.keys(e).filter(e=>"__proto__"!==e):[]}function schemaProperties(e,t){return allSchemaProperties(t).filter(n=>!(0,util_1$o.alwaysValidSchema)(e,t[n]))}function callValidateCode({schemaCode:e,data:t,it:{gen:n,topSchemaRef:i,schemaPath:a,errorPath:r},it:o},s,c,l){const u=l?codegen_1$q._`${e}, ${t}, ${i}${a}`:t,d=[[names_1$5.default.instancePath,(0,codegen_1$q.strConcat)(names_1$5.default.instancePath,r)],[names_1$5.default.parentData,o.parentData],[names_1$5.default.parentDataProperty,o.parentDataProperty],[names_1$5.default.rootData,names_1$5.default.rootData]];o.opts.dynamicRef&&d.push([names_1$5.default.dynamicAnchors,names_1$5.default.dynamicAnchors]);const f=codegen_1$q._`${u}, ${n.object(...d)}`;return c!==codegen_1$q.nil?codegen_1$q._`${s}.call(${c}, ${f})`:codegen_1$q._`${s}(${f})`}code.checkReportMissingProp=checkReportMissingProp,code.checkMissingProp=checkMissingProp,code.reportMissingProp=reportMissingProp,code.hasPropFunc=hasPropFunc,code.isOwnProperty=isOwnProperty,code.propertyInData=propertyInData,code.noPropertyInData=noPropertyInData,code.allSchemaProperties=allSchemaProperties,code.schemaProperties=schemaProperties,code.callValidateCode=callValidateCode;const newRegExp=codegen_1$q._`new RegExp`;function usePattern({gen:e,it:{opts:t}},n){const i=t.unicodeRegExp?"u":"",{regExp:a}=t.code,r=a(n,i);return e.scopeValue("pattern",{key:r.toString(),ref:r,code:codegen_1$q._`${"new RegExp"===a.code?newRegExp:(0,util_2$1.useFunc)(e,a)}(${n}, ${i})`})}function validateArray(e){const{gen:t,data:n,keyword:i,it:a}=e,r=t.name("valid");if(a.allErrors){const e=t.let("valid",!0);return o(()=>t.assign(e,!1)),e}return t.var(r,!0),o(()=>t.break()),r;function o(a){const o=t.const("len",codegen_1$q._`${n}.length`);t.forRange("i",0,o,n=>{e.subschema({keyword:i,dataProp:n,dataPropType:util_1$o.Type.Num},r),t.if((0,codegen_1$q.not)(r),a)})}}function validateUnion(e){const{gen:t,schema:n,keyword:i,it:a}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");if(n.some(e=>(0,util_1$o.alwaysValidSchema)(a,e))&&!a.opts.unevaluated)return;const r=t.let("valid",!1),o=t.name("_valid");t.block(()=>n.forEach((n,a)=>{const s=e.subschema({keyword:i,schemaProp:a,compositeRule:!0},o);t.assign(r,codegen_1$q._`${r} || ${o}`),e.mergeValidEvaluated(s,o)||t.if((0,codegen_1$q.not)(r))})),e.result(r,()=>e.reset(),()=>e.error(!0))}code.usePattern=usePattern,code.validateArray=validateArray,code.validateUnion=validateUnion,Object.defineProperty(keyword,"__esModule",{value:!0}),keyword.validateKeywordUsage=keyword.validSchemaType=keyword.funcKeywordCode=keyword.macroKeywordCode=void 0;const codegen_1$p=codegen,names_1$4=names$1,code_1$9=code,errors_1$1=errors;function macroKeywordCode(e,t){const{gen:n,keyword:i,schema:a,parentSchema:r,it:o}=e,s=t.macro.call(o.self,a,r,o),c=useKeyword(n,i,s);!1!==o.opts.validateSchema&&o.self.validateSchema(s,!0);const l=n.name("valid");e.subschema({schema:s,schemaPath:codegen_1$p.nil,errSchemaPath:`${o.errSchemaPath}/${i}`,topSchemaRef:c,compositeRule:!0},l),e.pass(l,()=>e.error(!0))}function funcKeywordCode(e,t){var n;const{gen:i,keyword:a,schema:r,parentSchema:o,$data:s,it:c}=e;checkAsyncKeyword(c,t);const l=!s&&t.compile?t.compile.call(c.self,r,o,c):t.validate,u=useKeyword(i,a,l),d=i.let("valid");function f(n=(t.async?codegen_1$p._`await `:codegen_1$p.nil)){const a=c.opts.passContext?names_1$4.default.this:names_1$4.default.self,r=!("compile"in t&&!s||!1===t.schema);i.assign(d,codegen_1$p._`${n}${(0,code_1$9.callValidateCode)(e,u,a,r)}`,t.modifying)}function p(e){var n;i.if((0,codegen_1$p.not)(null!==(n=t.valid)&&void 0!==n?n:d),e)}e.block$data(d,(function(){if(!1===t.errors)f(),t.modifying&&modifyData(e),p(()=>e.error());else{const n=t.async?function(){const e=i.let("ruleErrs",null);return i.try(()=>f(codegen_1$p._`await `),t=>i.assign(d,!1).if(codegen_1$p._`${t} instanceof ${c.ValidationError}`,()=>i.assign(e,codegen_1$p._`${t}.errors`),()=>i.throw(t))),e}():function(){const e=codegen_1$p._`${u}.errors`;return i.assign(e,null),f(codegen_1$p.nil),e}();t.modifying&&modifyData(e),p(()=>addErrs(e,n))}})),e.ok(null!==(n=t.valid)&&void 0!==n?n:d)}function modifyData(e){const{gen:t,data:n,it:i}=e;t.if(i.parentData,()=>t.assign(n,codegen_1$p._`${i.parentData}[${i.parentDataProperty}]`))}function addErrs(e,t){const{gen:n}=e;n.if(codegen_1$p._`Array.isArray(${t})`,()=>{n.assign(names_1$4.default.vErrors,codegen_1$p._`${names_1$4.default.vErrors} === null ? ${t} : ${names_1$4.default.vErrors}.concat(${t})`).assign(names_1$4.default.errors,codegen_1$p._`${names_1$4.default.vErrors}.length`),(0,errors_1$1.extendErrors)(e)},()=>e.error())}function checkAsyncKeyword({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}function useKeyword(e,t,n){if(void 0===n)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword","function"==typeof n?{ref:n}:{ref:n,code:(0,codegen_1$p.stringify)(n)})}function validSchemaType(e,t,n=!1){return!t.length||t.some(t=>"array"===t?Array.isArray(e):"object"===t?e&&"object"==typeof e&&!Array.isArray(e):typeof e==t||n&&void 0===e)}function validateKeywordUsage({schema:e,opts:t,self:n,errSchemaPath:i},a,r){if(Array.isArray(a.keyword)?!a.keyword.includes(r):a.keyword!==r)throw new Error("ajv implementation error");const o=a.dependencies;if(null==o?void 0:o.some(t=>!Object.prototype.hasOwnProperty.call(e,t)))throw new Error(`parent schema must have dependencies of ${r}: ${o.join(",")}`);if(a.validateSchema&&!a.validateSchema(e[r])){const e=`keyword "${r}" value is invalid at path "${i}": `+n.errorsText(a.validateSchema.errors);if("log"!==t.validateSchema)throw new Error(e);n.logger.error(e)}}keyword.macroKeywordCode=macroKeywordCode,keyword.funcKeywordCode=funcKeywordCode,keyword.validSchemaType=validSchemaType,keyword.validateKeywordUsage=validateKeywordUsage;var subschema={};Object.defineProperty(subschema,"__esModule",{value:!0}),subschema.extendSubschemaMode=subschema.extendSubschemaData=subschema.getSubschema=void 0;const codegen_1$o=codegen,util_1$n=util;function getSubschema(e,{keyword:t,schemaProp:n,schema:i,schemaPath:a,errSchemaPath:r,topSchemaRef:o}){if(void 0!==t&&void 0!==i)throw new Error('both "keyword" and "schema" passed, only one allowed');if(void 0!==t){const i=e.schema[t];return void 0===n?{schema:i,schemaPath:codegen_1$o._`${e.schemaPath}${(0,codegen_1$o.getProperty)(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:i[n],schemaPath:codegen_1$o._`${e.schemaPath}${(0,codegen_1$o.getProperty)(t)}${(0,codegen_1$o.getProperty)(n)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${(0,util_1$n.escapeFragment)(n)}`}}if(void 0!==i){if(void 0===a||void 0===r||void 0===o)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:i,schemaPath:a,topSchemaRef:o,errSchemaPath:r}}throw new Error('either "keyword" or "schema" must be passed')}function extendSubschemaData(e,t,{dataProp:n,dataPropType:i,data:a,dataTypes:r,propertyName:o}){if(void 0!==a&&void 0!==n)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:s}=t;if(void 0!==n){const{errorPath:a,dataPathArr:r,opts:o}=t;c(s.let("data",codegen_1$o._`${t.data}${(0,codegen_1$o.getProperty)(n)}`,!0)),e.errorPath=codegen_1$o.str`${a}${(0,util_1$n.getErrorPath)(n,i,o.jsPropertySyntax)}`,e.parentDataProperty=codegen_1$o._`${n}`,e.dataPathArr=[...r,e.parentDataProperty]}function c(n){e.data=n,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,n]}void 0!==a&&(c(a instanceof codegen_1$o.Name?a:s.let("data",a,!0)),void 0!==o&&(e.propertyName=o)),r&&(e.dataTypes=r)}function extendSubschemaMode(e,{jtdDiscriminator:t,jtdMetadata:n,compositeRule:i,createErrors:a,allErrors:r}){void 0!==i&&(e.compositeRule=i),void 0!==a&&(e.createErrors=a),void 0!==r&&(e.allErrors=r),e.jtdDiscriminator=t,e.jtdMetadata=n}subschema.getSubschema=getSubschema,subschema.extendSubschemaData=extendSubschemaData,subschema.extendSubschemaMode=extendSubschemaMode;var resolve$1={},fastDeepEqual=function e(t,n){if(t===n)return!0;if(t&&n&&"object"==typeof t&&"object"==typeof n){if(t.constructor!==n.constructor)return!1;var i,a,r;if(Array.isArray(t)){if((i=t.length)!=n.length)return!1;for(a=i;0!=a--;)if(!e(t[a],n[a]))return!1;return!0}if(t.constructor===RegExp)return t.source===n.source&&t.flags===n.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===n.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===n.toString();if((i=(r=Object.keys(t)).length)!==Object.keys(n).length)return!1;for(a=i;0!=a--;)if(!Object.prototype.hasOwnProperty.call(n,r[a]))return!1;for(a=i;0!=a--;){var o=r[a];if(!e(t[o],n[o]))return!1}return!0}return t!=t&&n!=n},jsonSchemaTraverse={exports:{}},traverse$1=jsonSchemaTraverse.exports=function(e,t,n){"function"==typeof t&&(n=t,t={}),_traverse(t,"function"==typeof(n=t.cb||n)?n:n.pre||function(){},n.post||function(){},e,"",e)};function _traverse(e,t,n,i,a,r,o,s,c,l){if(i&&"object"==typeof i&&!Array.isArray(i)){for(var u in t(i,a,r,o,s,c,l),i){var d=i[u];if(Array.isArray(d)){if(u in traverse$1.arrayKeywords)for(var f=0;f<d.length;f++)_traverse(e,t,n,d[f],a+"/"+u+"/"+f,r,a,u,i,f)}else if(u in traverse$1.propsKeywords){if(d&&"object"==typeof d)for(var p in d)_traverse(e,t,n,d[p],a+"/"+u+"/"+escapeJsonPtr(p),r,a,u,i,p)}else(u in traverse$1.keywords||e.allKeys&&!(u in traverse$1.skipKeywords))&&_traverse(e,t,n,d,a+"/"+u,r,a,u,i)}n(i,a,r,o,s,c,l)}}function escapeJsonPtr(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}traverse$1.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0},traverse$1.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0},traverse$1.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0},traverse$1.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0},Object.defineProperty(resolve$1,"__esModule",{value:!0}),resolve$1.getSchemaRefs=resolve$1.resolveUrl=resolve$1.normalizeId=resolve$1._getFullPath=resolve$1.getFullPath=resolve$1.inlineRef=void 0;const util_1$m=util,equal$2=fastDeepEqual,traverse=jsonSchemaTraverse.exports,SIMPLE_INLINED=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function inlineRef(e,t=!0){return"boolean"==typeof e||(!0===t?!hasRef(e):!!t&&countKeys(e)<=t)}resolve$1.inlineRef=inlineRef;const REF_KEYWORDS=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function hasRef(e){for(const t in e){if(REF_KEYWORDS.has(t))return!0;const n=e[t];if(Array.isArray(n)&&n.some(hasRef))return!0;if("object"==typeof n&&hasRef(n))return!0}return!1}function countKeys(e){let t=0;for(const n in e){if("$ref"===n)return 1/0;if(t++,!SIMPLE_INLINED.has(n)&&("object"==typeof e[n]&&(0,util_1$m.eachItem)(e[n],e=>t+=countKeys(e)),t===1/0))return 1/0}return t}function getFullPath(e,t="",n){!1!==n&&(t=normalizeId(t));const i=e.parse(t);return _getFullPath(e,i)}function _getFullPath(e,t){return e.serialize(t).split("#")[0]+"#"}resolve$1.getFullPath=getFullPath,resolve$1._getFullPath=_getFullPath;const TRAILING_SLASH_HASH=/#\/?$/;function normalizeId(e){return e?e.replace(TRAILING_SLASH_HASH,""):""}function resolveUrl(e,t,n){return n=normalizeId(n),e.resolve(t,n)}resolve$1.normalizeId=normalizeId,resolve$1.resolveUrl=resolveUrl;const ANCHOR=/^[a-z_][-a-z0-9._]*$/i;function getSchemaRefs(e,t){if("boolean"==typeof e)return{};const{schemaId:n,uriResolver:i}=this.opts,a=normalizeId(e[n]||t),r={"":a},o=getFullPath(i,a,!1),s={},c=new Set;return traverse(e,{allKeys:!0},(e,t,i,a)=>{if(void 0===a)return;const d=o+t;let f=r[a];function p(t){const n=this.opts.uriResolver.resolve;if(t=normalizeId(f?n(f,t):t),c.has(t))throw u(t);c.add(t);let i=this.refs[t];return"string"==typeof i&&(i=this.refs[i]),"object"==typeof i?l(e,i.schema,t):t!==normalizeId(d)&&("#"===t[0]?(l(e,s[t],t),s[t]=e):this.refs[t]=d),t}function m(e){if("string"==typeof e){if(!ANCHOR.test(e))throw new Error(`invalid anchor "${e}"`);p.call(this,"#"+e)}}"string"==typeof e[n]&&(f=p.call(this,e[n])),m.call(this,e.$anchor),m.call(this,e.$dynamicAnchor),r[t]=f}),s;function l(e,t,n){if(void 0!==t&&!equal$2(e,t))throw u(n)}function u(e){return new Error(`reference "${e}" resolves to more than one schema`)}}resolve$1.getSchemaRefs=getSchemaRefs,Object.defineProperty(validate$1,"__esModule",{value:!0}),validate$1.getData=validate$1.KeywordCxt=validate$1.validateFunctionCode=void 0;const boolSchema_1=boolSchema,dataType_1$1=dataType,applicability_1=applicability,dataType_2=dataType,defaults_1=defaults,keyword_1=keyword,subschema_1=subschema,codegen_1$n=codegen,names_1$3=names$1,resolve_1$2=resolve$1,util_1$l=util,errors_1=errors;function validateFunctionCode(e){isSchemaObj(e)&&(checkKeywords(e),schemaCxtHasRules(e))?topSchemaObjCode(e):validateFunction(e,()=>(0,boolSchema_1.topBoolOrEmptySchema)(e))}function validateFunction({gen:e,validateName:t,schema:n,schemaEnv:i,opts:a},r){a.code.es5?e.func(t,codegen_1$n._`${names_1$3.default.data}, ${names_1$3.default.valCxt}`,i.$async,()=>{e.code(codegen_1$n._`"use strict"; ${funcSourceUrl(n,a)}`),destructureValCxtES5(e,a),e.code(r)}):e.func(t,codegen_1$n._`${names_1$3.default.data}, ${destructureValCxt(a)}`,i.$async,()=>e.code(funcSourceUrl(n,a)).code(r))}function destructureValCxt(e){return codegen_1$n._`{${names_1$3.default.instancePath}="", ${names_1$3.default.parentData}, ${names_1$3.default.parentDataProperty}, ${names_1$3.default.rootData}=${names_1$3.default.data}${e.dynamicRef?codegen_1$n._`, ${names_1$3.default.dynamicAnchors}={}`:codegen_1$n.nil}}={}`}function destructureValCxtES5(e,t){e.if(names_1$3.default.valCxt,()=>{e.var(names_1$3.default.instancePath,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.instancePath}`),e.var(names_1$3.default.parentData,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.parentData}`),e.var(names_1$3.default.parentDataProperty,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.parentDataProperty}`),e.var(names_1$3.default.rootData,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.rootData}`),t.dynamicRef&&e.var(names_1$3.default.dynamicAnchors,codegen_1$n._`${names_1$3.default.valCxt}.${names_1$3.default.dynamicAnchors}`)},()=>{e.var(names_1$3.default.instancePath,codegen_1$n._`""`),e.var(names_1$3.default.parentData,codegen_1$n._`undefined`),e.var(names_1$3.default.parentDataProperty,codegen_1$n._`undefined`),e.var(names_1$3.default.rootData,names_1$3.default.data),t.dynamicRef&&e.var(names_1$3.default.dynamicAnchors,codegen_1$n._`{}`)})}function topSchemaObjCode(e){const{schema:t,opts:n,gen:i}=e;validateFunction(e,()=>{n.$comment&&t.$comment&&commentKeyword(e),checkNoDefault(e),i.let(names_1$3.default.vErrors,null),i.let(names_1$3.default.errors,0),n.unevaluated&&resetEvaluated(e),typeAndKeywords(e),returnResults(e)})}function resetEvaluated(e){const{gen:t,validateName:n}=e;e.evaluated=t.const("evaluated",codegen_1$n._`${n}.evaluated`),t.if(codegen_1$n._`${e.evaluated}.dynamicProps`,()=>t.assign(codegen_1$n._`${e.evaluated}.props`,codegen_1$n._`undefined`)),t.if(codegen_1$n._`${e.evaluated}.dynamicItems`,()=>t.assign(codegen_1$n._`${e.evaluated}.items`,codegen_1$n._`undefined`))}function funcSourceUrl(e,t){const n="object"==typeof e&&e[t.schemaId];return n&&(t.code.source||t.code.process)?codegen_1$n._`/*# sourceURL=${n} */`:codegen_1$n.nil}function subschemaCode(e,t){isSchemaObj(e)&&(checkKeywords(e),schemaCxtHasRules(e))?subSchemaObjCode(e,t):(0,boolSchema_1.boolOrEmptySchema)(e,t)}function schemaCxtHasRules({schema:e,self:t}){if("boolean"==typeof e)return!e;for(const n in e)if(t.RULES.all[n])return!0;return!1}function isSchemaObj(e){return"boolean"!=typeof e.schema}function subSchemaObjCode(e,t){const{schema:n,gen:i,opts:a}=e;a.$comment&&n.$comment&&commentKeyword(e),updateContext(e),checkAsyncSchema(e);const r=i.const("_errs",names_1$3.default.errors);typeAndKeywords(e,r),i.var(t,codegen_1$n._`${r} === ${names_1$3.default.errors}`)}function checkKeywords(e){(0,util_1$l.checkUnknownRules)(e),checkRefsAndKeywords(e)}function typeAndKeywords(e,t){if(e.opts.jtd)return schemaKeywords(e,[],!1,t);const n=(0,dataType_1$1.getSchemaTypes)(e.schema);schemaKeywords(e,n,!(0,dataType_1$1.coerceAndCheckDataType)(e,n),t)}function checkRefsAndKeywords(e){const{schema:t,errSchemaPath:n,opts:i,self:a}=e;t.$ref&&i.ignoreKeywordsWithRef&&(0,util_1$l.schemaHasRulesButRef)(t,a.RULES)&&a.logger.warn(`$ref: keywords ignored in schema at path "${n}"`)}function checkNoDefault(e){const{schema:t,opts:n}=e;void 0!==t.default&&n.useDefaults&&n.strictSchema&&(0,util_1$l.checkStrictMode)(e,"default is ignored in the schema root")}function updateContext(e){const t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,resolve_1$2.resolveUrl)(e.opts.uriResolver,e.baseId,t))}function checkAsyncSchema(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}function commentKeyword({gen:e,schemaEnv:t,schema:n,errSchemaPath:i,opts:a}){const r=n.$comment;if(!0===a.$comment)e.code(codegen_1$n._`${names_1$3.default.self}.logger.log(${r})`);else if("function"==typeof a.$comment){const n=codegen_1$n.str`${i}/$comment`,a=e.scopeValue("root",{ref:t.root});e.code(codegen_1$n._`${names_1$3.default.self}.opts.$comment(${r}, ${n}, ${a}.schema)`)}}function returnResults(e){const{gen:t,schemaEnv:n,validateName:i,ValidationError:a,opts:r}=e;n.$async?t.if(codegen_1$n._`${names_1$3.default.errors} === 0`,()=>t.return(names_1$3.default.data),()=>t.throw(codegen_1$n._`new ${a}(${names_1$3.default.vErrors})`)):(t.assign(codegen_1$n._`${i}.errors`,names_1$3.default.vErrors),r.unevaluated&&assignEvaluated(e),t.return(codegen_1$n._`${names_1$3.default.errors} === 0`))}function assignEvaluated({gen:e,evaluated:t,props:n,items:i}){n instanceof codegen_1$n.Name&&e.assign(codegen_1$n._`${t}.props`,n),i instanceof codegen_1$n.Name&&e.assign(codegen_1$n._`${t}.items`,i)}function schemaKeywords(e,t,n,i){const{gen:a,schema:r,data:o,allErrors:s,opts:c,self:l}=e,{RULES:u}=l;function d(l){(0,applicability_1.shouldUseGroup)(r,l)&&(l.type?(a.if((0,dataType_2.checkDataType)(l.type,o,c.strictNumbers)),iterateKeywords(e,l),1===t.length&&t[0]===l.type&&n&&(a.else(),(0,dataType_2.reportTypeError)(e)),a.endIf()):iterateKeywords(e,l),s||a.if(codegen_1$n._`${names_1$3.default.errors} === ${i||0}`))}!r.$ref||!c.ignoreKeywordsWithRef&&(0,util_1$l.schemaHasRulesButRef)(r,u)?(c.jtd||checkStrictTypes(e,t),a.block(()=>{for(const e of u.rules)d(e);d(u.post)})):a.block(()=>keywordCode(e,"$ref",u.all.$ref.definition))}function iterateKeywords(e,t){const{gen:n,schema:i,opts:{useDefaults:a}}=e;a&&(0,defaults_1.assignDefaults)(e,t.type),n.block(()=>{for(const n of t.rules)(0,applicability_1.shouldUseRule)(i,n)&&keywordCode(e,n.keyword,n.definition,t.type)})}function checkStrictTypes(e,t){!e.schemaEnv.meta&&e.opts.strictTypes&&(checkContextTypes(e,t),e.opts.allowUnionTypes||checkMultipleTypes(e,t),checkKeywordTypes(e,e.dataTypes))}function checkContextTypes(e,t){t.length&&(e.dataTypes.length?(t.forEach(t=>{includesType(e.dataTypes,t)||strictTypesError(e,`type "${t}" not allowed by context "${e.dataTypes.join(",")}"`)}),e.dataTypes=e.dataTypes.filter(e=>includesType(t,e))):e.dataTypes=t)}function checkMultipleTypes(e,t){t.length>1&&(2!==t.length||!t.includes("null"))&&strictTypesError(e,"use allowUnionTypes to allow union type keyword")}function checkKeywordTypes(e,t){const n=e.self.RULES.all;for(const i in n){const a=n[i];if("object"==typeof a&&(0,applicability_1.shouldUseRule)(e.schema,a)){const{type:n}=a.definition;n.length&&!n.some(e=>hasApplicableType(t,e))&&strictTypesError(e,`missing type "${n.join(",")}" for keyword "${i}"`)}}}function hasApplicableType(e,t){return e.includes(t)||"number"===t&&e.includes("integer")}function includesType(e,t){return e.includes(t)||"integer"===t&&e.includes("number")}function strictTypesError(e,t){t+=` at "${e.schemaEnv.baseId+e.errSchemaPath}" (strictTypes)`,(0,util_1$l.checkStrictMode)(e,t,e.opts.strictTypes)}validate$1.validateFunctionCode=validateFunctionCode;class KeywordCxt{constructor(e,t,n){if((0,keyword_1.validateKeywordUsage)(e,t,n),this.gen=e.gen,this.allErrors=e.allErrors,this.keyword=n,this.data=e.data,this.schema=e.schema[n],this.$data=t.$data&&e.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,util_1$l.schemaRefOrVal)(e,this.schema,n,this.$data),this.schemaType=t.schemaType,this.parentSchema=e.schema,this.params={},this.it=e,this.def=t,this.$data)this.schemaCode=e.gen.const("vSchema",getData(this.$data,e));else if(this.schemaCode=this.schemaValue,!(0,keyword_1.validSchemaType)(this.schema,t.schemaType,t.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(t.schemaType)}`);("code"in t?t.trackErrors:!1!==t.errors)&&(this.errsCount=e.gen.const("_errs",names_1$3.default.errors))}result(e,t,n){this.failResult((0,codegen_1$n.not)(e),t,n)}failResult(e,t,n){this.gen.if(e),n?n():this.error(),t?(this.gen.else(),t(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(e,t){this.failResult((0,codegen_1$n.not)(e),void 0,t)}fail(e){if(void 0===e)return this.error(),void(this.allErrors||this.gen.if(!1));this.gen.if(e),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(e){if(!this.$data)return this.fail(e);const{schemaCode:t}=this;this.fail(codegen_1$n._`${t} !== undefined && (${(0,codegen_1$n.or)(this.invalid$data(),e)})`)}error(e,t,n){if(t)return this.setParams(t),this._error(e,n),void this.setParams({});this._error(e,n)}_error(e,t){(e?errors_1.reportExtraError:errors_1.reportError)(this,this.def.error,t)}$dataError(){(0,errors_1.reportError)(this,this.def.$dataError||errors_1.keyword$DataError)}reset(){if(void 0===this.errsCount)throw new Error('add "trackErrors" to keyword definition');(0,errors_1.resetErrorsCount)(this.gen,this.errsCount)}ok(e){this.allErrors||this.gen.if(e)}setParams(e,t){t?Object.assign(this.params,e):this.params=e}block$data(e,t,n=codegen_1$n.nil){this.gen.block(()=>{this.check$data(e,n),t()})}check$data(e=codegen_1$n.nil,t=codegen_1$n.nil){if(!this.$data)return;const{gen:n,schemaCode:i,schemaType:a,def:r}=this;n.if((0,codegen_1$n.or)(codegen_1$n._`${i} === undefined`,t)),e!==codegen_1$n.nil&&n.assign(e,!0),(a.length||r.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),e!==codegen_1$n.nil&&n.assign(e,!1)),n.else()}invalid$data(){const{gen:e,schemaCode:t,schemaType:n,def:i,it:a}=this;return(0,codegen_1$n.or)(function(){if(n.length){if(!(t instanceof codegen_1$n.Name))throw new Error("ajv implementation error");const e=Array.isArray(n)?n:[n];return codegen_1$n._`${(0,dataType_2.checkDataTypes)(e,t,a.opts.strictNumbers,dataType_2.DataType.Wrong)}`}return codegen_1$n.nil}(),function(){if(i.validateSchema){const n=e.scopeValue("validate$data",{ref:i.validateSchema});return codegen_1$n._`!${n}(${t})`}return codegen_1$n.nil}())}subschema(e,t){const n=(0,subschema_1.getSubschema)(this.it,e);(0,subschema_1.extendSubschemaData)(n,this.it,e),(0,subschema_1.extendSubschemaMode)(n,e);const i={...this.it,...n,items:void 0,props:void 0};return subschemaCode(i,t),i}mergeEvaluated(e,t){const{it:n,gen:i}=this;n.opts.unevaluated&&(!0!==n.props&&void 0!==e.props&&(n.props=util_1$l.mergeEvaluated.props(i,e.props,n.props,t)),!0!==n.items&&void 0!==e.items&&(n.items=util_1$l.mergeEvaluated.items(i,e.items,n.items,t)))}mergeValidEvaluated(e,t){const{it:n,gen:i}=this;if(n.opts.unevaluated&&(!0!==n.props||!0!==n.items))return i.if(t,()=>this.mergeEvaluated(e,codegen_1$n.Name)),!0}}function keywordCode(e,t,n,i){const a=new KeywordCxt(e,n,t);"code"in n?n.code(a,i):a.$data&&n.validate?(0,keyword_1.funcKeywordCode)(a,n):"macro"in n?(0,keyword_1.macroKeywordCode)(a,n):(n.compile||n.validate)&&(0,keyword_1.funcKeywordCode)(a,n)}validate$1.KeywordCxt=KeywordCxt;const JSON_POINTER=/^\/(?:[^~]|~0|~1)*$/,RELATIVE_JSON_POINTER=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function getData(e,{dataLevel:t,dataNames:n,dataPathArr:i}){let a,r;if(""===e)return names_1$3.default.rootData;if("/"===e[0]){if(!JSON_POINTER.test(e))throw new Error("Invalid JSON-pointer: "+e);a=e,r=names_1$3.default.rootData}else{const o=RELATIVE_JSON_POINTER.exec(e);if(!o)throw new Error("Invalid JSON-pointer: "+e);const s=+o[1];if(a=o[2],"#"===a){if(s>=t)throw new Error(c("property/index",s));return i[t-s]}if(s>t)throw new Error(c("data",s));if(r=n[t-s],!a)return r}let o=r;const s=a.split("/");for(const e of s)e&&(r=codegen_1$n._`${r}${(0,codegen_1$n.getProperty)((0,util_1$l.unescapeJsonPointer)(e))}`,o=codegen_1$n._`${o} && ${r}`);return o;function c(e,n){return`Cannot access ${e} ${n} levels up, current level is ${t}`}}validate$1.getData=getData;var validation_error={};Object.defineProperty(validation_error,"__esModule",{value:!0});class ValidationError extends Error{constructor(e){super("validation failed"),this.errors=e,this.ajv=this.validation=!0}}validation_error.default=ValidationError;var ref_error={};Object.defineProperty(ref_error,"__esModule",{value:!0});const resolve_1$1=resolve$1;class MissingRefError extends Error{constructor(e,t,n,i){super(i||`can't resolve reference ${n} from id ${t}`),this.missingRef=(0,resolve_1$1.resolveUrl)(e,t,n),this.missingSchema=(0,resolve_1$1.normalizeId)((0,resolve_1$1.getFullPath)(e,this.missingRef))}}ref_error.default=MissingRefError;var compile={};Object.defineProperty(compile,"__esModule",{value:!0}),compile.resolveSchema=compile.getCompilingSchema=compile.resolveRef=compile.compileSchema=compile.SchemaEnv=void 0;const codegen_1$m=codegen,validation_error_1=validation_error,names_1$2=names$1,resolve_1=resolve$1,util_1$k=util,validate_1$1=validate$1;class SchemaEnv{constructor(e){var t;let n;this.refs={},this.dynamicAnchors={},"object"==typeof e.schema&&(n=e.schema),this.schema=e.schema,this.schemaId=e.schemaId,this.root=e.root||this,this.baseId=null!==(t=e.baseId)&&void 0!==t?t:(0,resolve_1.normalizeId)(null==n?void 0:n[e.schemaId||"$id"]),this.schemaPath=e.schemaPath,this.localRefs=e.localRefs,this.meta=e.meta,this.$async=null==n?void 0:n.$async,this.refs={}}}function compileSchema(e){const t=getCompilingSchema.call(this,e);if(t)return t;const n=(0,resolve_1.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:i,lines:a}=this.opts.code,{ownProperties:r}=this.opts,o=new codegen_1$m.CodeGen(this.scope,{es5:i,lines:a,ownProperties:r});let s;e.$async&&(s=o.scopeValue("Error",{ref:validation_error_1.default,code:codegen_1$m._`require("ajv/dist/runtime/validation_error").default`}));const c=o.scopeName("validate");e.validateName=c;const l={gen:o,allErrors:this.opts.allErrors,data:names_1$2.default.data,parentData:names_1$2.default.parentData,parentDataProperty:names_1$2.default.parentDataProperty,dataNames:[names_1$2.default.data],dataPathArr:[codegen_1$m.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:o.scopeValue("schema",!0===this.opts.code.source?{ref:e.schema,code:(0,codegen_1$m.stringify)(e.schema)}:{ref:e.schema}),validateName:c,ValidationError:s,schema:e.schema,schemaEnv:e,rootId:n,baseId:e.baseId||n,schemaPath:codegen_1$m.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:codegen_1$m._`""`,opts:this.opts,self:this};let u;try{this._compilations.add(e),(0,validate_1$1.validateFunctionCode)(l),o.optimize(this.opts.code.optimize);const t=o.toString();u=`${o.scopeRefs(names_1$2.default.scope)}return ${t}`,this.opts.code.process&&(u=this.opts.code.process(u,e));const n=new Function(""+names_1$2.default.self,""+names_1$2.default.scope,u)(this,this.scope.get());if(this.scope.value(c,{ref:n}),n.errors=null,n.schema=e.schema,n.schemaEnv=e,e.$async&&(n.$async=!0),!0===this.opts.code.source&&(n.source={validateName:c,validateCode:t,scopeValues:o._values}),this.opts.unevaluated){const{props:e,items:t}=l;n.evaluated={props:e instanceof codegen_1$m.Name?void 0:e,items:t instanceof codegen_1$m.Name?void 0:t,dynamicProps:e instanceof codegen_1$m.Name,dynamicItems:t instanceof codegen_1$m.Name},n.source&&(n.source.evaluated=(0,codegen_1$m.stringify)(n.evaluated))}return e.validate=n,e}catch(t){throw delete e.validate,delete e.validateName,u&&this.logger.error("Error compiling schema, function code:",u),t}finally{this._compilations.delete(e)}}function resolveRef(e,t,n){var i;n=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,n);const a=e.refs[n];if(a)return a;let r=resolve.call(this,e,n);if(void 0===r){const a=null===(i=e.localRefs)||void 0===i?void 0:i[n],{schemaId:o}=this.opts;a&&(r=new SchemaEnv({schema:a,schemaId:o,root:e,baseId:t}))}return void 0!==r?e.refs[n]=inlineOrCompile.call(this,r):void 0}function inlineOrCompile(e){return(0,resolve_1.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:compileSchema.call(this,e)}function getCompilingSchema(e){for(const t of this._compilations)if(sameSchemaEnv(t,e))return t}function sameSchemaEnv(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function resolve(e,t){let n;for(;"string"==typeof(n=this.refs[t]);)t=n;return n||this.schemas[t]||resolveSchema.call(this,e,t)}function resolveSchema(e,t){const n=this.opts.uriResolver.parse(t),i=(0,resolve_1._getFullPath)(this.opts.uriResolver,n);let a=(0,resolve_1.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&i===a)return getJsonPointer.call(this,n,e);const r=(0,resolve_1.normalizeId)(i),o=this.refs[r]||this.schemas[r];if("string"==typeof o){const t=resolveSchema.call(this,e,o);if("object"!=typeof(null==t?void 0:t.schema))return;return getJsonPointer.call(this,n,t)}if("object"==typeof(null==o?void 0:o.schema)){if(o.validate||compileSchema.call(this,o),r===(0,resolve_1.normalizeId)(t)){const{schema:t}=o,{schemaId:n}=this.opts,i=t[n];return i&&(a=(0,resolve_1.resolveUrl)(this.opts.uriResolver,a,i)),new SchemaEnv({schema:t,schemaId:n,root:e,baseId:a})}return getJsonPointer.call(this,n,o)}}compile.SchemaEnv=SchemaEnv,compile.compileSchema=compileSchema,compile.resolveRef=resolveRef,compile.getCompilingSchema=getCompilingSchema,compile.resolveSchema=resolveSchema;const PREVENT_SCOPE_CHANGE=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function getJsonPointer(e,{baseId:t,schema:n,root:i}){var a;if("/"!==(null===(a=e.fragment)||void 0===a?void 0:a[0]))return;for(const i of e.fragment.slice(1).split("/")){if("boolean"==typeof n)return;const e=n[(0,util_1$k.unescapeFragment)(i)];if(void 0===e)return;const a="object"==typeof(n=e)&&n[this.opts.schemaId];!PREVENT_SCOPE_CHANGE.has(i)&&a&&(t=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,a))}let r;if("boolean"!=typeof n&&n.$ref&&!(0,util_1$k.schemaHasRulesButRef)(n,this.RULES)){const e=(0,resolve_1.resolveUrl)(this.opts.uriResolver,t,n.$ref);r=resolveSchema.call(this,i,e)}const{schemaId:o}=this.opts;return r=r||new SchemaEnv({schema:n,schemaId:o,root:i,baseId:t}),r.schema!==r.root.schema?r:void 0}var $id$1="https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#",description="Meta-schema for $data reference (JSON AnySchema extension proposal)",type$1="object",required$1=["$data"],properties$2={$data:{type:"string",anyOf:[{format:"relative-json-pointer"},{format:"json-pointer"}]}},additionalProperties$1=!1,require$$9={$id:$id$1,description:description,type:type$1,required:required$1,properties:properties$2,additionalProperties:additionalProperties$1},uri$1={},uri_all={exports:{}};
/** @license URI.js v4.4.1 (c) 2011 Gary Court. License: http://github.com/garycourt/uri-js */
!function(e,t){!function(e){function t(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.length>1){t[0]=t[0].slice(0,-1);for(var i=t.length-1,a=1;a<i;++a)t[a]=t[a].slice(1,-1);return t[i]=t[i].slice(1),t.join("")}return t[0]}function n(e){return"(?:"+e+")"}function i(e){return void 0===e?"undefined":null===e?"null":Object.prototype.toString.call(e).split(" ").pop().split("]").shift().toLowerCase()}function a(e){return e.toUpperCase()}function r(e){var i=t("[0-9]","[A-Fa-f]"),a=n(n("%[EFef]"+i+"%"+i+i+"%"+i+i)+"|"+n("%[89A-Fa-f]"+i+"%"+i+i)+"|"+n("%"+i+i)),r="[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",o=t("[\\:\\/\\?\\#\\[\\]\\@]",r),s=e?"[\\uE000-\\uF8FF]":"[]",c=t("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]",e?"[\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]":"[]");n("[A-Za-z]"+t("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),n(n(a+"|"+t(c,r,"[\\:]"))+"*");var l=n(n("25[0-5]")+"|"+n("2[0-4][0-9]")+"|"+n("1[0-9][0-9]")+"|"+n("0?[1-9][0-9]")+"|0?0?[0-9]"),u=n(l+"\\."+l+"\\."+l+"\\."+l),d=n(i+"{1,4}"),f=n(n(d+"\\:"+d)+"|"+u),p=n(n(d+"\\:")+"{6}"+f),m=n("\\:\\:"+n(d+"\\:")+"{5}"+f),h=n(n(d)+"?\\:\\:"+n(d+"\\:")+"{4}"+f),v=n(n(n(d+"\\:")+"{0,1}"+d)+"?\\:\\:"+n(d+"\\:")+"{3}"+f),g=n(n(n(d+"\\:")+"{0,2}"+d)+"?\\:\\:"+n(d+"\\:")+"{2}"+f),y=n(n(n(d+"\\:")+"{0,3}"+d)+"?\\:\\:"+d+"\\:"+f),b=n(n(n(d+"\\:")+"{0,4}"+d)+"?\\:\\:"+f),_=n(n(n(d+"\\:")+"{0,5}"+d)+"?\\:\\:"+d),k=n(n(n(d+"\\:")+"{0,6}"+d)+"?\\:\\:"),w=n([p,m,h,v,g,y,b,_,k].join("|")),I=n(n(c+"|"+a)+"+");n("[vV]"+i+"+\\."+t(c,r,"[\\:]")+"+"),n(n(a+"|"+t(c,r))+"*");var $=n(a+"|"+t(c,r,"[\\:\\@]"));return n(n(a+"|"+t(c,r,"[\\@]"))+"+"),n(n($+"|"+t("[\\/\\?]",s))+"*"),{NOT_SCHEME:new RegExp(t("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),NOT_USERINFO:new RegExp(t("[^\\%\\:]",c,r),"g"),NOT_HOST:new RegExp(t("[^\\%\\[\\]\\:]",c,r),"g"),NOT_PATH:new RegExp(t("[^\\%\\/\\:\\@]",c,r),"g"),NOT_PATH_NOSCHEME:new RegExp(t("[^\\%\\/\\@]",c,r),"g"),NOT_QUERY:new RegExp(t("[^\\%]",c,r,"[\\:\\@\\/\\?]",s),"g"),NOT_FRAGMENT:new RegExp(t("[^\\%]",c,r,"[\\:\\@\\/\\?]"),"g"),ESCAPE:new RegExp(t("[^]",c,r),"g"),UNRESERVED:new RegExp(c,"g"),OTHER_CHARS:new RegExp(t("[^\\%]",c,o),"g"),PCT_ENCODED:new RegExp(a,"g"),IPV4ADDRESS:new RegExp("^("+u+")$"),IPV6ADDRESS:new RegExp("^\\[?("+w+")"+n(n("\\%25|\\%(?!"+i+"{2})")+"("+I+")")+"?\\]?$")}}var o=r(!1),s=r(!0),c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var n=[],i=!0,a=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);i=!0);}catch(e){a=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(a)throw r}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=2147483647,u=/^xn--/,d=/[^\0-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},m=Math.floor,h=String.fromCharCode;function v(e){throw new RangeError(p[e])}function g(e,t){var n=e.split("@"),i="";n.length>1&&(i=n[0]+"@",e=n[1]);var a=function(e,t){for(var n=[],i=e.length;i--;)n[i]=t(e[i]);return n}((e=e.replace(f,".")).split("."),t).join(".");return i+a}function y(e){for(var t=[],n=0,i=e.length;n<i;){var a=e.charCodeAt(n++);if(a>=55296&&a<=56319&&n<i){var r=e.charCodeAt(n++);56320==(64512&r)?t.push(((1023&a)<<10)+(1023&r)+65536):(t.push(a),n--)}else t.push(a)}return t}var b=function(e,t){return e+22+75*(e<26)-((0!=t)<<5)},_=function(e,t,n){var i=0;for(e=n?m(e/700):e>>1,e+=m(e/t);e>455;i+=36)e=m(e/35);return m(i+36*e/(e+38))},k=function(e){var t,n=[],i=e.length,a=0,r=128,o=72,s=e.lastIndexOf("-");s<0&&(s=0);for(var c=0;c<s;++c)e.charCodeAt(c)>=128&&v("not-basic"),n.push(e.charCodeAt(c));for(var u=s>0?s+1:0;u<i;){for(var d=a,f=1,p=36;;p+=36){u>=i&&v("invalid-input");var h=(t=e.charCodeAt(u++))-48<10?t-22:t-65<26?t-65:t-97<26?t-97:36;(h>=36||h>m((l-a)/f))&&v("overflow"),a+=h*f;var g=p<=o?1:p>=o+26?26:p-o;if(h<g)break;var y=36-g;f>m(l/y)&&v("overflow"),f*=y}var b=n.length+1;o=_(a-d,b,0==d),m(a/b)>l-r&&v("overflow"),r+=m(a/b),a%=b,n.splice(a++,0,r)}return String.fromCodePoint.apply(String,n)},w=function(e){var t=[],n=(e=y(e)).length,i=128,a=0,r=72,o=!0,s=!1,c=void 0;try{for(var u,d=e[Symbol.iterator]();!(o=(u=d.next()).done);o=!0){var f=u.value;f<128&&t.push(h(f))}}catch(e){s=!0,c=e}finally{try{!o&&d.return&&d.return()}finally{if(s)throw c}}var p=t.length,g=p;for(p&&t.push("-");g<n;){var k=l,w=!0,I=!1,$=void 0;try{for(var S,C=e[Symbol.iterator]();!(w=(S=C.next()).done);w=!0){var x=S.value;x>=i&&x<k&&(k=x)}}catch(e){I=!0,$=e}finally{try{!w&&C.return&&C.return()}finally{if(I)throw $}}var L=g+1;k-i>m((l-a)/L)&&v("overflow"),a+=(k-i)*L,i=k;var T=!0,E=!1,O=void 0;try{for(var D,N=e[Symbol.iterator]();!(T=(D=N.next()).done);T=!0){var j=D.value;if(j<i&&++a>l&&v("overflow"),j==i){for(var P=a,R=36;;R+=36){var M=R<=r?1:R>=r+26?26:R-r;if(P<M)break;var A=P-M,F=36-M;t.push(h(b(M+A%F,0))),P=m(A/F)}t.push(h(b(P,0))),r=_(a,L,g==p),a=0,++g}}}catch(e){E=!0,O=e}finally{try{!T&&N.return&&N.return()}finally{if(E)throw O}}++a,++i}return t.join("")},I=function(e){return g(e,(function(e){return d.test(e)?"xn--"+w(e):e}))},$=function(e){return g(e,(function(e){return u.test(e)?k(e.slice(4).toLowerCase()):e}))},S={};function C(e){var t=e.charCodeAt(0);return t<16?"%0"+t.toString(16).toUpperCase():t<128?"%"+t.toString(16).toUpperCase():t<2048?"%"+(t>>6|192).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase():"%"+(t>>12|224).toString(16).toUpperCase()+"%"+(t>>6&63|128).toString(16).toUpperCase()+"%"+(63&t|128).toString(16).toUpperCase()}function x(e){for(var t="",n=0,i=e.length;n<i;){var a=parseInt(e.substr(n+1,2),16);if(a<128)t+=String.fromCharCode(a),n+=3;else if(a>=194&&a<224){if(i-n>=6){var r=parseInt(e.substr(n+4,2),16);t+=String.fromCharCode((31&a)<<6|63&r)}else t+=e.substr(n,6);n+=6}else if(a>=224){if(i-n>=9){var o=parseInt(e.substr(n+4,2),16),s=parseInt(e.substr(n+7,2),16);t+=String.fromCharCode((15&a)<<12|(63&o)<<6|63&s)}else t+=e.substr(n,9);n+=9}else t+=e.substr(n,3),n+=3}return t}function L(e,t){function n(e){var n=x(e);return n.match(t.UNRESERVED)?n:e}return e.scheme&&(e.scheme=String(e.scheme).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_SCHEME,"")),void 0!==e.userinfo&&(e.userinfo=String(e.userinfo).replace(t.PCT_ENCODED,n).replace(t.NOT_USERINFO,C).replace(t.PCT_ENCODED,a)),void 0!==e.host&&(e.host=String(e.host).replace(t.PCT_ENCODED,n).toLowerCase().replace(t.NOT_HOST,C).replace(t.PCT_ENCODED,a)),void 0!==e.path&&(e.path=String(e.path).replace(t.PCT_ENCODED,n).replace(e.scheme?t.NOT_PATH:t.NOT_PATH_NOSCHEME,C).replace(t.PCT_ENCODED,a)),void 0!==e.query&&(e.query=String(e.query).replace(t.PCT_ENCODED,n).replace(t.NOT_QUERY,C).replace(t.PCT_ENCODED,a)),void 0!==e.fragment&&(e.fragment=String(e.fragment).replace(t.PCT_ENCODED,n).replace(t.NOT_FRAGMENT,C).replace(t.PCT_ENCODED,a)),e}function T(e){return e.replace(/^0*(.*)/,"$1")||"0"}function E(e,t){var n=e.match(t.IPV4ADDRESS)||[],i=c(n,2)[1];return i?i.split(".").map(T).join("."):e}function O(e,t){var n=e.match(t.IPV6ADDRESS)||[],i=c(n,3),a=i[1],r=i[2];if(a){for(var o=a.toLowerCase().split("::").reverse(),s=c(o,2),l=s[0],u=s[1],d=u?u.split(":").map(T):[],f=l.split(":").map(T),p=t.IPV4ADDRESS.test(f[f.length-1]),m=p?7:8,h=f.length-m,v=Array(m),g=0;g<m;++g)v[g]=d[g]||f[h+g]||"";p&&(v[m-1]=E(v[m-1],t));var y=v.reduce((function(e,t,n){if(!t||"0"===t){var i=e[e.length-1];i&&i.index+i.length===n?i.length++:e.push({index:n,length:1})}return e}),[]).sort((function(e,t){return t.length-e.length}))[0],b=void 0;if(y&&y.length>1){var _=v.slice(0,y.index),k=v.slice(y.index+y.length);b=_.join(":")+"::"+k.join(":")}else b=v.join(":");return r&&(b+="%"+r),b}return e}var D=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?(\[[^\/?#\]]+\]|[^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#((?:.|\n|\r)*))?/i,N=void 0==="".match(/(){0}/)[1];function j(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n={},i=!1!==t.iri?s:o;"suffix"===t.reference&&(e=(t.scheme?t.scheme+":":"")+"//"+e);var a=e.match(D);if(a){N?(n.scheme=a[1],n.userinfo=a[3],n.host=a[4],n.port=parseInt(a[5],10),n.path=a[6]||"",n.query=a[7],n.fragment=a[8],isNaN(n.port)&&(n.port=a[5])):(n.scheme=a[1]||void 0,n.userinfo=-1!==e.indexOf("@")?a[3]:void 0,n.host=-1!==e.indexOf("//")?a[4]:void 0,n.port=parseInt(a[5],10),n.path=a[6]||"",n.query=-1!==e.indexOf("?")?a[7]:void 0,n.fragment=-1!==e.indexOf("#")?a[8]:void 0,isNaN(n.port)&&(n.port=e.match(/\/\/(?:.|\n)*\:(?:\/|\?|\#|$)/)?a[4]:void 0)),n.host&&(n.host=O(E(n.host,i),i)),void 0!==n.scheme||void 0!==n.userinfo||void 0!==n.host||void 0!==n.port||n.path||void 0!==n.query?void 0===n.scheme?n.reference="relative":void 0===n.fragment?n.reference="absolute":n.reference="uri":n.reference="same-document",t.reference&&"suffix"!==t.reference&&t.reference!==n.reference&&(n.error=n.error||"URI is not a "+t.reference+" reference.");var r=S[(t.scheme||n.scheme||"").toLowerCase()];if(t.unicodeSupport||r&&r.unicodeSupport)L(n,i);else{if(n.host&&(t.domainHost||r&&r.domainHost))try{n.host=I(n.host.replace(i.PCT_ENCODED,x).toLowerCase())}catch(e){n.error=n.error||"Host's domain name can not be converted to ASCII via punycode: "+e}L(n,o)}r&&r.parse&&r.parse(n,t)}else n.error=n.error||"URI can not be parsed.";return n}function P(e,t){var n=!1!==t.iri?s:o,i=[];return void 0!==e.userinfo&&(i.push(e.userinfo),i.push("@")),void 0!==e.host&&i.push(O(E(String(e.host),n),n).replace(n.IPV6ADDRESS,(function(e,t,n){return"["+t+(n?"%25"+n:"")+"]"}))),"number"!=typeof e.port&&"string"!=typeof e.port||(i.push(":"),i.push(String(e.port))),i.length?i.join(""):void 0}var R=/^\.\.?\//,M=/^\/\.(\/|$)/,A=/^\/\.\.(\/|$)/,F=/^\/?(?:.|\n)*?(?=\/|$)/;function V(e){for(var t=[];e.length;)if(e.match(R))e=e.replace(R,"");else if(e.match(M))e=e.replace(M,"/");else if(e.match(A))e=e.replace(A,"/"),t.pop();else if("."===e||".."===e)e="";else{var n=e.match(F);if(!n)throw new Error("Unexpected dot segment condition");var i=n[0];e=e.slice(i.length),t.push(i)}return t.join("")}function B(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.iri?s:o,i=[],a=S[(t.scheme||e.scheme||"").toLowerCase()];if(a&&a.serialize&&a.serialize(e,t),e.host)if(n.IPV6ADDRESS.test(e.host));else if(t.domainHost||a&&a.domainHost)try{e.host=t.iri?$(e.host):I(e.host.replace(n.PCT_ENCODED,x).toLowerCase())}catch(n){e.error=e.error||"Host's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+n}L(e,n),"suffix"!==t.reference&&e.scheme&&(i.push(e.scheme),i.push(":"));var r=P(e,t);if(void 0!==r&&("suffix"!==t.reference&&i.push("//"),i.push(r),e.path&&"/"!==e.path.charAt(0)&&i.push("/")),void 0!==e.path){var c=e.path;t.absolutePath||a&&a.absolutePath||(c=V(c)),void 0===r&&(c=c.replace(/^\/\//,"/%2F")),i.push(c)}return void 0!==e.query&&(i.push("?"),i.push(e.query)),void 0!==e.fragment&&(i.push("#"),i.push(e.fragment)),i.join("")}function q(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments[3],a={};return i||(e=j(B(e,n),n),t=j(B(t,n),n)),!(n=n||{}).tolerant&&t.scheme?(a.scheme=t.scheme,a.userinfo=t.userinfo,a.host=t.host,a.port=t.port,a.path=V(t.path||""),a.query=t.query):(void 0!==t.userinfo||void 0!==t.host||void 0!==t.port?(a.userinfo=t.userinfo,a.host=t.host,a.port=t.port,a.path=V(t.path||""),a.query=t.query):(t.path?("/"===t.path.charAt(0)?a.path=V(t.path):(void 0===e.userinfo&&void 0===e.host&&void 0===e.port||e.path?e.path?a.path=e.path.slice(0,e.path.lastIndexOf("/")+1)+t.path:a.path=t.path:a.path="/"+t.path,a.path=V(a.path)),a.query=t.query):(a.path=e.path,void 0!==t.query?a.query=t.query:a.query=e.query),a.userinfo=e.userinfo,a.host=e.host,a.port=e.port),a.scheme=e.scheme),a.fragment=t.fragment,a}function U(e,t){return e&&e.toString().replace(t&&t.iri?s.PCT_ENCODED:o.PCT_ENCODED,x)}var z={scheme:"http",domainHost:!0,parse:function(e,t){return e.host||(e.error=e.error||"HTTP URIs must have a host."),e},serialize:function(e,t){var n="https"===String(e.scheme).toLowerCase();return e.port!==(n?443:80)&&""!==e.port||(e.port=void 0),e.path||(e.path="/"),e}},H={scheme:"https",domainHost:z.domainHost,parse:z.parse,serialize:z.serialize};function K(e){return"boolean"==typeof e.secure?e.secure:"wss"===String(e.scheme).toLowerCase()}var W={scheme:"ws",domainHost:!0,parse:function(e,t){var n=e;return n.secure=K(n),n.resourceName=(n.path||"/")+(n.query?"?"+n.query:""),n.path=void 0,n.query=void 0,n},serialize:function(e,t){if(e.port!==(K(e)?443:80)&&""!==e.port||(e.port=void 0),"boolean"==typeof e.secure&&(e.scheme=e.secure?"wss":"ws",e.secure=void 0),e.resourceName){var n=e.resourceName.split("?"),i=c(n,2),a=i[0],r=i[1];e.path=a&&"/"!==a?a:void 0,e.query=r,e.resourceName=void 0}return e.fragment=void 0,e}},G={scheme:"wss",domainHost:W.domainHost,parse:W.parse,serialize:W.serialize},J={},Q="[A-Za-z0-9\\-\\.\\_\\~\\xA0-\\u200D\\u2010-\\u2029\\u202F-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFEF]",Y="[0-9A-Fa-f]",X=n(n("%[EFef]"+Y+"%"+Y+Y+"%"+Y+Y)+"|"+n("%[89A-Fa-f]"+Y+"%"+Y+Y)+"|"+n("%"+Y+Y)),Z=t("[\\!\\$\\%\\'\\(\\)\\*\\+\\,\\-\\.0-9\\<\\>A-Z\\x5E-\\x7E]",'[\\"\\\\]'),ee=new RegExp(Q,"g"),te=new RegExp(X,"g"),ne=new RegExp(t("[^]","[A-Za-z0-9\\!\\$\\%\\'\\*\\+\\-\\^\\_\\`\\{\\|\\}\\~]","[\\.]",'[\\"]',Z),"g"),ie=new RegExp(t("[^]",Q,"[\\!\\$\\'\\(\\)\\*\\+\\,\\;\\:\\@]"),"g"),ae=ie;function re(e){var t=x(e);return t.match(ee)?t:e}var oe={scheme:"mailto",parse:function(e,t){var n=e,i=n.to=n.path?n.path.split(","):[];if(n.path=void 0,n.query){for(var a=!1,r={},o=n.query.split("&"),s=0,c=o.length;s<c;++s){var l=o[s].split("=");switch(l[0]){case"to":for(var u=l[1].split(","),d=0,f=u.length;d<f;++d)i.push(u[d]);break;case"subject":n.subject=U(l[1],t);break;case"body":n.body=U(l[1],t);break;default:a=!0,r[U(l[0],t)]=U(l[1],t)}}a&&(n.headers=r)}n.query=void 0;for(var p=0,m=i.length;p<m;++p){var h=i[p].split("@");if(h[0]=U(h[0]),t.unicodeSupport)h[1]=U(h[1],t).toLowerCase();else try{h[1]=I(U(h[1],t).toLowerCase())}catch(e){n.error=n.error||"Email address's domain name can not be converted to ASCII via punycode: "+e}i[p]=h.join("@")}return n},serialize:function(e,t){var n,i=e,r=null!=(n=e.to)?n instanceof Array?n:"number"!=typeof n.length||n.split||n.setInterval||n.call?[n]:Array.prototype.slice.call(n):[];if(r){for(var o=0,s=r.length;o<s;++o){var c=String(r[o]),l=c.lastIndexOf("@"),u=c.slice(0,l).replace(te,re).replace(te,a).replace(ne,C),d=c.slice(l+1);try{d=t.iri?$(d):I(U(d,t).toLowerCase())}catch(e){i.error=i.error||"Email address's domain name can not be converted to "+(t.iri?"Unicode":"ASCII")+" via punycode: "+e}r[o]=u+"@"+d}i.path=r.join(",")}var f=e.headers=e.headers||{};e.subject&&(f.subject=e.subject),e.body&&(f.body=e.body);var p=[];for(var m in f)f[m]!==J[m]&&p.push(m.replace(te,re).replace(te,a).replace(ie,C)+"="+f[m].replace(te,re).replace(te,a).replace(ae,C));return p.length&&(i.query=p.join("&")),i}},se=/^([^\:]+)\:(.*)/,ce={scheme:"urn",parse:function(e,t){var n=e.path&&e.path.match(se),i=e;if(n){var a=t.scheme||i.scheme||"urn",r=n[1].toLowerCase(),o=n[2],s=a+":"+(t.nid||r),c=S[s];i.nid=r,i.nss=o,i.path=void 0,c&&(i=c.parse(i,t))}else i.error=i.error||"URN can not be parsed.";return i},serialize:function(e,t){var n=t.scheme||e.scheme||"urn",i=e.nid,a=n+":"+(t.nid||i),r=S[a];r&&(e=r.serialize(e,t));var o=e,s=e.nss;return o.path=(i||t.nid)+":"+s,o}},le=/^[0-9A-Fa-f]{8}(?:\-[0-9A-Fa-f]{4}){3}\-[0-9A-Fa-f]{12}$/,ue={scheme:"urn:uuid",parse:function(e,t){var n=e;return n.uuid=n.nss,n.nss=void 0,t.tolerant||n.uuid&&n.uuid.match(le)||(n.error=n.error||"UUID is not valid."),n},serialize:function(e,t){var n=e;return n.nss=(e.uuid||"").toLowerCase(),n}};S[z.scheme]=z,S[H.scheme]=H,S[W.scheme]=W,S[G.scheme]=G,S[oe.scheme]=oe,S[ce.scheme]=ce,S[ue.scheme]=ue,e.SCHEMES=S,e.pctEncChar=C,e.pctDecChars=x,e.parse=j,e.removeDotSegments=V,e.serialize=B,e.resolveComponents=q,e.resolve=function(e,t,n){var i=function(e,t){var n=e;if(t)for(var i in t)n[i]=t[i];return n}({scheme:"null"},n);return B(q(j(e,i),j(t,i),i,!0),i)},e.normalize=function(e,t){return"string"==typeof e?e=B(j(e,t),t):"object"===i(e)&&(e=j(B(e,t),t)),e},e.equal=function(e,t,n){return"string"==typeof e?e=B(j(e,n),n):"object"===i(e)&&(e=B(e,n)),"string"==typeof t?t=B(j(t,n),n):"object"===i(t)&&(t=B(t,n)),e===t},e.escapeComponent=function(e,t){return e&&e.toString().replace(t&&t.iri?s.ESCAPE:o.ESCAPE,C)},e.unescapeComponent=U,Object.defineProperty(e,"__esModule",{value:!0})}(t)}(0,uri_all.exports),Object.defineProperty(uri$1,"__esModule",{value:!0});const uri=uri_all.exports;uri.code='require("ajv/dist/runtime/uri").default',uri$1.default=uri,function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CodeGen=e.Name=e.nil=e.stringify=e.str=e._=e.KeywordCxt=void 0;var t=validate$1;Object.defineProperty(e,"KeywordCxt",{enumerable:!0,get:function(){return t.KeywordCxt}});var n=codegen;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}}),Object.defineProperty(e,"CodeGen",{enumerable:!0,get:function(){return n.CodeGen}});const i=validation_error,a=ref_error,r=rules,o=compile,s=codegen,c=resolve$1,l=dataType,u=util,d=require$$9,f=uri$1,p=(e,t)=>new RegExp(e,t);p.code="new RegExp";const m=["removeAdditional","useDefaults","coerceTypes"],h=new Set(["validate","serialize","parse","wrapper","root","schema","keyword","pattern","formats","validate$data","func","obj","Error"]),v={errorDataPath:"",format:"`validateFormats: false` can be used instead.",nullable:'"nullable" keyword is supported by default.',jsonPointers:"Deprecated jsPropertySyntax can be used instead.",extendRefs:"Deprecated ignoreKeywordsWithRef can be used instead.",missingRefs:"Pass empty schema with $id that should be ignored to ajv.addSchema.",processCode:"Use option `code: {process: (code, schemaEnv: object) => string}`",sourceCode:"Use option `code: {source: true}`",strictDefaults:"It is default now, see option `strict`.",strictKeywords:"It is default now, see option `strict`.",uniqueItems:'"uniqueItems" keyword is always validated.',unknownFormats:"Disable strict mode or pass `true` to `ajv.addFormat` (or `formats` option).",cache:"Map is used as cache, schema object as key.",serialize:"Map is used as cache, schema object as key.",ajvErrors:"It is default now."},g={ignoreKeywordsWithRef:"",jsPropertySyntax:"",unicode:'"minLength"/"maxLength" account for unicode characters by default.'};function y(e){var t,n,i,a,r,o,s,c,l,u,d,m,h,v,g,y,b,_,k,w,I,$,S,C,x;const L=e.strict,T=null===(t=e.code)||void 0===t?void 0:t.optimize,E=!0===T||void 0===T?1:T||0,O=null!==(i=null===(n=e.code)||void 0===n?void 0:n.regExp)&&void 0!==i?i:p,D=null!==(a=e.uriResolver)&&void 0!==a?a:f.default;return{strictSchema:null===(o=null!==(r=e.strictSchema)&&void 0!==r?r:L)||void 0===o||o,strictNumbers:null===(c=null!==(s=e.strictNumbers)&&void 0!==s?s:L)||void 0===c||c,strictTypes:null!==(u=null!==(l=e.strictTypes)&&void 0!==l?l:L)&&void 0!==u?u:"log",strictTuples:null!==(m=null!==(d=e.strictTuples)&&void 0!==d?d:L)&&void 0!==m?m:"log",strictRequired:null!==(v=null!==(h=e.strictRequired)&&void 0!==h?h:L)&&void 0!==v&&v,code:e.code?{...e.code,optimize:E,regExp:O}:{optimize:E,regExp:O},loopRequired:null!==(g=e.loopRequired)&&void 0!==g?g:200,loopEnum:null!==(y=e.loopEnum)&&void 0!==y?y:200,meta:null===(b=e.meta)||void 0===b||b,messages:null===(_=e.messages)||void 0===_||_,inlineRefs:null===(k=e.inlineRefs)||void 0===k||k,schemaId:null!==(w=e.schemaId)&&void 0!==w?w:"$id",addUsedSchema:null===(I=e.addUsedSchema)||void 0===I||I,validateSchema:null===($=e.validateSchema)||void 0===$||$,validateFormats:null===(S=e.validateFormats)||void 0===S||S,unicodeRegExp:null===(C=e.unicodeRegExp)||void 0===C||C,int32range:null===(x=e.int32range)||void 0===x||x,uriResolver:D}}class b{constructor(e={}){this.schemas={},this.refs={},this.formats={},this._compilations=new Set,this._loading={},this._cache=new Map,e=this.opts={...e,...y(e)};const{es5:t,lines:n}=this.opts.code;this.scope=new s.ValueScope({scope:{},prefixes:h,es5:t,lines:n}),this.logger=function(e){if(!1===e)return C;if(void 0===e)return console;if(e.log&&e.warn&&e.error)return e;throw new Error("logger must implement log, warn and error methods")}(e.logger);const i=e.validateFormats;e.validateFormats=!1,this.RULES=(0,r.getRules)(),_.call(this,v,e,"NOT SUPPORTED"),_.call(this,g,e,"DEPRECATED","warn"),this._metaOpts=S.call(this),e.formats&&I.call(this),this._addVocabularies(),this._addDefaultMetaSchema(),e.keywords&&$.call(this,e.keywords),"object"==typeof e.meta&&this.addMetaSchema(e.meta),w.call(this),e.validateFormats=i}_addVocabularies(){this.addKeyword("$async")}_addDefaultMetaSchema(){const{$data:e,meta:t,schemaId:n}=this.opts;let i=d;"id"===n&&(i={...d},i.id=i.$id,delete i.$id),t&&e&&this.addMetaSchema(i,i[n],!1)}defaultMeta(){const{meta:e,schemaId:t}=this.opts;return this.opts.defaultMeta="object"==typeof e?e[t]||e:void 0}validate(e,t){let n;if("string"==typeof e){if(n=this.getSchema(e),!n)throw new Error(`no schema with key or ref "${e}"`)}else n=this.compile(e);const i=n(t);return"$async"in n||(this.errors=n.errors),i}compile(e,t){const n=this._addSchema(e,t);return n.validate||this._compileSchemaEnv(n)}compileAsync(e,t){if("function"!=typeof this.opts.loadSchema)throw new Error("options.loadSchema should be a function");const{loadSchema:n}=this.opts;return i.call(this,e,t);async function i(e,t){await r.call(this,e.$schema);const n=this._addSchema(e,t);return n.validate||o.call(this,n)}async function r(e){e&&!this.getSchema(e)&&await i.call(this,{$ref:e},!0)}async function o(e){try{return this._compileSchemaEnv(e)}catch(t){if(!(t instanceof a.default))throw t;return s.call(this,t),await c.call(this,t.missingSchema),o.call(this,e)}}function s({missingSchema:e,missingRef:t}){if(this.refs[e])throw new Error(`AnySchema ${e} is loaded but ${t} cannot be resolved`)}async function c(e){const n=await l.call(this,e);this.refs[e]||await r.call(this,n.$schema),this.refs[e]||this.addSchema(n,e,t)}async function l(e){const t=this._loading[e];if(t)return t;try{return await(this._loading[e]=n(e))}finally{delete this._loading[e]}}}addSchema(e,t,n,i=this.opts.validateSchema){if(Array.isArray(e)){for(const t of e)this.addSchema(t,void 0,n,i);return this}let a;if("object"==typeof e){const{schemaId:t}=this.opts;if(a=e[t],void 0!==a&&"string"!=typeof a)throw new Error(`schema ${t} must be string`)}return t=(0,c.normalizeId)(t||a),this._checkUnique(t),this.schemas[t]=this._addSchema(e,n,t,i,!0),this}addMetaSchema(e,t,n=this.opts.validateSchema){return this.addSchema(e,t,!0,n),this}validateSchema(e,t){if("boolean"==typeof e)return!0;let n;if(n=e.$schema,void 0!==n&&"string"!=typeof n)throw new Error("$schema must be a string");if(n=n||this.opts.defaultMeta||this.defaultMeta(),!n)return this.logger.warn("meta-schema not available"),this.errors=null,!0;const i=this.validate(n,e);if(!i&&t){const e="schema is invalid: "+this.errorsText();if("log"!==this.opts.validateSchema)throw new Error(e);this.logger.error(e)}return i}getSchema(e){let t;for(;"string"==typeof(t=k.call(this,e));)e=t;if(void 0===t){const{schemaId:n}=this.opts,i=new o.SchemaEnv({schema:{},schemaId:n});if(t=o.resolveSchema.call(this,i,e),!t)return;this.refs[e]=t}return t.validate||this._compileSchemaEnv(t)}removeSchema(e){if(e instanceof RegExp)return this._removeAllSchemas(this.schemas,e),this._removeAllSchemas(this.refs,e),this;switch(typeof e){case"undefined":return this._removeAllSchemas(this.schemas),this._removeAllSchemas(this.refs),this._cache.clear(),this;case"string":{const t=k.call(this,e);return"object"==typeof t&&this._cache.delete(t.schema),delete this.schemas[e],delete this.refs[e],this}case"object":{const t=e;this._cache.delete(t);let n=e[this.opts.schemaId];return n&&(n=(0,c.normalizeId)(n),delete this.schemas[n],delete this.refs[n]),this}default:throw new Error("ajv.removeSchema: invalid parameter")}}addVocabulary(e){for(const t of e)this.addKeyword(t);return this}addKeyword(e,t){let n;if("string"==typeof e)n=e,"object"==typeof t&&(this.logger.warn("these parameters are deprecated, see docs for addKeyword"),t.keyword=n);else{if("object"!=typeof e||void 0!==t)throw new Error("invalid addKeywords parameters");if(n=(t=e).keyword,Array.isArray(n)&&!n.length)throw new Error("addKeywords: keyword must be string or non-empty array")}if(L.call(this,n,t),!t)return(0,u.eachItem)(n,e=>T.call(this,e)),this;O.call(this,t);const i={...t,type:(0,l.getJSONTypes)(t.type),schemaType:(0,l.getJSONTypes)(t.schemaType)};return(0,u.eachItem)(n,0===i.type.length?e=>T.call(this,e,i):e=>i.type.forEach(t=>T.call(this,e,i,t))),this}getKeyword(e){const t=this.RULES.all[e];return"object"==typeof t?t.definition:!!t}removeKeyword(e){const{RULES:t}=this;delete t.keywords[e],delete t.all[e];for(const n of t.rules){const t=n.rules.findIndex(t=>t.keyword===e);t>=0&&n.rules.splice(t,1)}return this}addFormat(e,t){return"string"==typeof t&&(t=new RegExp(t)),this.formats[e]=t,this}errorsText(e=this.errors,{separator:t=", ",dataVar:n="data"}={}){return e&&0!==e.length?e.map(e=>`${n}${e.instancePath} ${e.message}`).reduce((e,n)=>e+t+n):"No errors"}$dataMetaSchema(e,t){const n=this.RULES.all;e=JSON.parse(JSON.stringify(e));for(const i of t){const t=i.split("/").slice(1);let a=e;for(const e of t)a=a[e];for(const e in n){const t=n[e];if("object"!=typeof t)continue;const{$data:i}=t.definition,r=a[e];i&&r&&(a[e]=N(r))}}return e}_removeAllSchemas(e,t){for(const n in e){const i=e[n];t&&!t.test(n)||("string"==typeof i?delete e[n]:i&&!i.meta&&(this._cache.delete(i.schema),delete e[n]))}}_addSchema(e,t,n,i=this.opts.validateSchema,a=this.opts.addUsedSchema){let r;const{schemaId:s}=this.opts;if("object"==typeof e)r=e[s];else{if(this.opts.jtd)throw new Error("schema must be object");if("boolean"!=typeof e)throw new Error("schema must be object or boolean")}let l=this._cache.get(e);if(void 0!==l)return l;n=(0,c.normalizeId)(r||n);const u=c.getSchemaRefs.call(this,e,n);return l=new o.SchemaEnv({schema:e,schemaId:s,meta:t,baseId:n,localRefs:u}),this._cache.set(l.schema,l),a&&!n.startsWith("#")&&(n&&this._checkUnique(n),this.refs[n]=l),i&&this.validateSchema(e,!0),l}_checkUnique(e){if(this.schemas[e]||this.refs[e])throw new Error(`schema with key or id "${e}" already exists`)}_compileSchemaEnv(e){if(e.meta?this._compileMetaSchema(e):o.compileSchema.call(this,e),!e.validate)throw new Error("ajv implementation error");return e.validate}_compileMetaSchema(e){const t=this.opts;this.opts=this._metaOpts;try{o.compileSchema.call(this,e)}finally{this.opts=t}}}function _(e,t,n,i="error"){for(const a in e){const r=a;r in t&&this.logger[i](`${n}: option ${a}. ${e[r]}`)}}function k(e){return e=(0,c.normalizeId)(e),this.schemas[e]||this.refs[e]}function w(){const e=this.opts.schemas;if(e)if(Array.isArray(e))this.addSchema(e);else for(const t in e)this.addSchema(e[t],t)}function I(){for(const e in this.opts.formats){const t=this.opts.formats[e];t&&this.addFormat(e,t)}}function $(e){if(Array.isArray(e))this.addVocabulary(e);else{this.logger.warn("keywords option as map is deprecated, pass array");for(const t in e){const n=e[t];n.keyword||(n.keyword=t),this.addKeyword(n)}}}function S(){const e={...this.opts};for(const t of m)delete e[t];return e}e.default=b,b.ValidationError=i.default,b.MissingRefError=a.default;const C={log(){},warn(){},error(){}},x=/^[a-z_$][a-z0-9_$:-]*$/i;function L(e,t){const{RULES:n}=this;if((0,u.eachItem)(e,e=>{if(n.keywords[e])throw new Error(`Keyword ${e} is already defined`);if(!x.test(e))throw new Error(`Keyword ${e} has invalid name`)}),t&&t.$data&&!("code"in t)&&!("validate"in t))throw new Error('$data keyword must have "code" or "validate" function')}function T(e,t,n){var i;const a=null==t?void 0:t.post;if(n&&a)throw new Error('keyword with "post" flag cannot have "type"');const{RULES:r}=this;let o=a?r.post:r.rules.find(({type:e})=>e===n);if(o||(o={type:n,rules:[]},r.rules.push(o)),r.keywords[e]=!0,!t)return;const s={keyword:e,definition:{...t,type:(0,l.getJSONTypes)(t.type),schemaType:(0,l.getJSONTypes)(t.schemaType)}};t.before?E.call(this,o,s,t.before):o.rules.push(s),r.all[e]=s,null===(i=t.implements)||void 0===i||i.forEach(e=>this.addKeyword(e))}function E(e,t,n){const i=e.rules.findIndex(e=>e.keyword===n);i>=0?e.rules.splice(i,0,t):(e.rules.push(t),this.logger.warn(`rule ${n} is not defined`))}function O(e){let{metaSchema:t}=e;void 0!==t&&(e.$data&&this.opts.$data&&(t=N(t)),e.validateSchema=this.compile(t,!0))}const D={$ref:"https://raw.githubusercontent.com/ajv-validator/ajv/master/lib/refs/data.json#"};function N(e){return{anyOf:[e,D]}}}(core$2);var draft7={},core$1={},id={};Object.defineProperty(id,"__esModule",{value:!0});const def$s={keyword:"id",code(){throw new Error('NOT SUPPORTED: keyword "id", use "$id" for schema ID')}};id.default=def$s;var ref={};Object.defineProperty(ref,"__esModule",{value:!0}),ref.callRef=ref.getValidate=void 0;const ref_error_1=ref_error,code_1$8=code,codegen_1$l=codegen,names_1$1=names$1,compile_1$1=compile,util_1$j=util,def$r={keyword:"$ref",schemaType:"string",code(e){const{gen:t,schema:n,it:i}=e,{baseId:a,schemaEnv:r,validateName:o,opts:s,self:c}=i,{root:l}=r;if(("#"===n||"#/"===n)&&a===l.baseId)return function(){if(r===l)return callRef(e,o,r,r.$async);const n=t.scopeValue("root",{ref:l});return callRef(e,codegen_1$l._`${n}.validate`,l,l.$async)}();const u=compile_1$1.resolveRef.call(c,l,a,n);if(void 0===u)throw new ref_error_1.default(i.opts.uriResolver,a,n);return u instanceof compile_1$1.SchemaEnv?function(t){const n=getValidate(e,t);callRef(e,n,t,t.$async)}(u):function(i){const a=t.scopeValue("schema",!0===s.code.source?{ref:i,code:(0,codegen_1$l.stringify)(i)}:{ref:i}),r=t.name("valid"),o=e.subschema({schema:i,dataTypes:[],schemaPath:codegen_1$l.nil,topSchemaRef:a,errSchemaPath:n},r);e.mergeEvaluated(o),e.ok(r)}(u)}};function getValidate(e,t){const{gen:n}=e;return t.validate?n.scopeValue("validate",{ref:t.validate}):codegen_1$l._`${n.scopeValue("wrapper",{ref:t})}.validate`}function callRef(e,t,n,i){const{gen:a,it:r}=e,{allErrors:o,schemaEnv:s,opts:c}=r,l=c.passContext?names_1$1.default.this:codegen_1$l.nil;function u(e){const t=codegen_1$l._`${e}.errors`;a.assign(names_1$1.default.vErrors,codegen_1$l._`${names_1$1.default.vErrors} === null ? ${t} : ${names_1$1.default.vErrors}.concat(${t})`),a.assign(names_1$1.default.errors,codegen_1$l._`${names_1$1.default.vErrors}.length`)}function d(e){var t;if(!r.opts.unevaluated)return;const i=null===(t=null==n?void 0:n.validate)||void 0===t?void 0:t.evaluated;if(!0!==r.props)if(i&&!i.dynamicProps)void 0!==i.props&&(r.props=util_1$j.mergeEvaluated.props(a,i.props,r.props));else{const t=a.var("props",codegen_1$l._`${e}.evaluated.props`);r.props=util_1$j.mergeEvaluated.props(a,t,r.props,codegen_1$l.Name)}if(!0!==r.items)if(i&&!i.dynamicItems)void 0!==i.items&&(r.items=util_1$j.mergeEvaluated.items(a,i.items,r.items));else{const t=a.var("items",codegen_1$l._`${e}.evaluated.items`);r.items=util_1$j.mergeEvaluated.items(a,t,r.items,codegen_1$l.Name)}}i?function(){if(!s.$async)throw new Error("async schema referenced by sync schema");const n=a.let("valid");a.try(()=>{a.code(codegen_1$l._`await ${(0,code_1$8.callValidateCode)(e,t,l)}`),d(t),o||a.assign(n,!0)},e=>{a.if(codegen_1$l._`!(${e} instanceof ${r.ValidationError})`,()=>a.throw(e)),u(e),o||a.assign(n,!1)}),e.ok(n)}():e.result((0,code_1$8.callValidateCode)(e,t,l),()=>d(t),()=>u(t))}ref.getValidate=getValidate,ref.callRef=callRef,ref.default=def$r,Object.defineProperty(core$1,"__esModule",{value:!0});const id_1=id,ref_1=ref,core=["$schema","$id","$defs","$vocabulary",{keyword:"$comment"},"definitions",id_1.default,ref_1.default];core$1.default=core;var validation$1={},limitNumber={};Object.defineProperty(limitNumber,"__esModule",{value:!0});const codegen_1$k=codegen,ops=codegen_1$k.operators,KWDs={maximum:{okStr:"<=",ok:ops.LTE,fail:ops.GT},minimum:{okStr:">=",ok:ops.GTE,fail:ops.LT},exclusiveMaximum:{okStr:"<",ok:ops.LT,fail:ops.GTE},exclusiveMinimum:{okStr:">",ok:ops.GT,fail:ops.LTE}},error$i={message:({keyword:e,schemaCode:t})=>codegen_1$k.str`must be ${KWDs[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>codegen_1$k._`{comparison: ${KWDs[e].okStr}, limit: ${t}}`},def$q={keyword:Object.keys(KWDs),type:"number",schemaType:"number",$data:!0,error:error$i,code(e){const{keyword:t,data:n,schemaCode:i}=e;e.fail$data(codegen_1$k._`${n} ${KWDs[t].fail} ${i} || isNaN(${n})`)}};limitNumber.default=def$q;var multipleOf={};Object.defineProperty(multipleOf,"__esModule",{value:!0});const codegen_1$j=codegen,error$h={message:({schemaCode:e})=>codegen_1$j.str`must be multiple of ${e}`,params:({schemaCode:e})=>codegen_1$j._`{multipleOf: ${e}}`},def$p={keyword:"multipleOf",type:"number",schemaType:"number",$data:!0,error:error$h,code(e){const{gen:t,data:n,schemaCode:i,it:a}=e,r=a.opts.multipleOfPrecision,o=t.let("res"),s=r?codegen_1$j._`Math.abs(Math.round(${o}) - ${o}) > 1e-${r}`:codegen_1$j._`${o} !== parseInt(${o})`;e.fail$data(codegen_1$j._`(${i} === 0 || (${o} = ${n}/${i}, ${s}))`)}};multipleOf.default=def$p;var limitLength={},ucs2length$1={};function ucs2length(e){const t=e.length;let n,i=0,a=0;for(;a<t;)i++,n=e.charCodeAt(a++),n>=55296&&n<=56319&&a<t&&(n=e.charCodeAt(a),56320==(64512&n)&&a++);return i}Object.defineProperty(ucs2length$1,"__esModule",{value:!0}),ucs2length$1.default=ucs2length,ucs2length.code='require("ajv/dist/runtime/ucs2length").default',Object.defineProperty(limitLength,"__esModule",{value:!0});const codegen_1$i=codegen,util_1$i=util,ucs2length_1=ucs2length$1,error$g={message({keyword:e,schemaCode:t}){const n="maxLength"===e?"more":"fewer";return codegen_1$i.str`must NOT have ${n} than ${t} characters`},params:({schemaCode:e})=>codegen_1$i._`{limit: ${e}}`},def$o={keyword:["maxLength","minLength"],type:"string",schemaType:"number",$data:!0,error:error$g,code(e){const{keyword:t,data:n,schemaCode:i,it:a}=e,r="maxLength"===t?codegen_1$i.operators.GT:codegen_1$i.operators.LT,o=!1===a.opts.unicode?codegen_1$i._`${n}.length`:codegen_1$i._`${(0,util_1$i.useFunc)(e.gen,ucs2length_1.default)}(${n})`;e.fail$data(codegen_1$i._`${o} ${r} ${i}`)}};limitLength.default=def$o;var pattern={};Object.defineProperty(pattern,"__esModule",{value:!0});const code_1$7=code,codegen_1$h=codegen,error$f={message:({schemaCode:e})=>codegen_1$h.str`must match pattern "${e}"`,params:({schemaCode:e})=>codegen_1$h._`{pattern: ${e}}`},def$n={keyword:"pattern",type:"string",schemaType:"string",$data:!0,error:error$f,code(e){const{data:t,$data:n,schema:i,schemaCode:a,it:r}=e,o=r.opts.unicodeRegExp?"u":"",s=n?codegen_1$h._`(new RegExp(${a}, ${o}))`:(0,code_1$7.usePattern)(e,i);e.fail$data(codegen_1$h._`!${s}.test(${t})`)}};pattern.default=def$n;var limitProperties={};Object.defineProperty(limitProperties,"__esModule",{value:!0});const codegen_1$g=codegen,error$e={message({keyword:e,schemaCode:t}){const n="maxProperties"===e?"more":"fewer";return codegen_1$g.str`must NOT have ${n} than ${t} properties`},params:({schemaCode:e})=>codegen_1$g._`{limit: ${e}}`},def$m={keyword:["maxProperties","minProperties"],type:"object",schemaType:"number",$data:!0,error:error$e,code(e){const{keyword:t,data:n,schemaCode:i}=e,a="maxProperties"===t?codegen_1$g.operators.GT:codegen_1$g.operators.LT;e.fail$data(codegen_1$g._`Object.keys(${n}).length ${a} ${i}`)}};limitProperties.default=def$m;var required={};Object.defineProperty(required,"__esModule",{value:!0});const code_1$6=code,codegen_1$f=codegen,util_1$h=util,error$d={message:({params:{missingProperty:e}})=>codegen_1$f.str`must have required property '${e}'`,params:({params:{missingProperty:e}})=>codegen_1$f._`{missingProperty: ${e}}`},def$l={keyword:"required",type:"object",schemaType:"array",$data:!0,error:error$d,code(e){const{gen:t,schema:n,schemaCode:i,data:a,$data:r,it:o}=e,{opts:s}=o;if(!r&&0===n.length)return;const c=n.length>=s.loopRequired;if(o.allErrors?function(){if(c||r)e.block$data(codegen_1$f.nil,l);else for(const t of n)(0,code_1$6.checkReportMissingProp)(e,t)}():function(){const o=t.let("missing");if(c||r){const n=t.let("valid",!0);e.block$data(n,()=>function(n,r){e.setParams({missingProperty:n}),t.forOf(n,i,()=>{t.assign(r,(0,code_1$6.propertyInData)(t,a,n,s.ownProperties)),t.if((0,codegen_1$f.not)(r),()=>{e.error(),t.break()})},codegen_1$f.nil)}(o,n)),e.ok(n)}else t.if((0,code_1$6.checkMissingProp)(e,n,o)),(0,code_1$6.reportMissingProp)(e,o),t.else()}(),s.strictRequired){const t=e.parentSchema.properties,{definedProperties:i}=e.it;for(const e of n)if(void 0===(null==t?void 0:t[e])&&!i.has(e)){const t=`required property "${e}" is not defined at "${o.schemaEnv.baseId+o.errSchemaPath}" (strictRequired)`;(0,util_1$h.checkStrictMode)(o,t,o.opts.strictRequired)}}function l(){t.forOf("prop",i,n=>{e.setParams({missingProperty:n}),t.if((0,code_1$6.noPropertyInData)(t,a,n,s.ownProperties),()=>e.error())})}}};required.default=def$l;var limitItems={};Object.defineProperty(limitItems,"__esModule",{value:!0});const codegen_1$e=codegen,error$c={message({keyword:e,schemaCode:t}){const n="maxItems"===e?"more":"fewer";return codegen_1$e.str`must NOT have ${n} than ${t} items`},params:({schemaCode:e})=>codegen_1$e._`{limit: ${e}}`},def$k={keyword:["maxItems","minItems"],type:"array",schemaType:"number",$data:!0,error:error$c,code(e){const{keyword:t,data:n,schemaCode:i}=e,a="maxItems"===t?codegen_1$e.operators.GT:codegen_1$e.operators.LT;e.fail$data(codegen_1$e._`${n}.length ${a} ${i}`)}};limitItems.default=def$k;var uniqueItems={},equal$1={};Object.defineProperty(equal$1,"__esModule",{value:!0});const equal=fastDeepEqual;equal.code='require("ajv/dist/runtime/equal").default',equal$1.default=equal,Object.defineProperty(uniqueItems,"__esModule",{value:!0});const dataType_1=dataType,codegen_1$d=codegen,util_1$g=util,equal_1$2=equal$1,error$b={message:({params:{i:e,j:t}})=>codegen_1$d.str`must NOT have duplicate items (items ## ${t} and ${e} are identical)`,params:({params:{i:e,j:t}})=>codegen_1$d._`{i: ${e}, j: ${t}}`},def$j={keyword:"uniqueItems",type:"array",schemaType:"boolean",$data:!0,error:error$b,code(e){const{gen:t,data:n,$data:i,schema:a,parentSchema:r,schemaCode:o,it:s}=e;if(!i&&!a)return;const c=t.let("valid"),l=r.items?(0,dataType_1.getSchemaTypes)(r.items):[];function u(i,a){const r=t.name("item"),o=(0,dataType_1.checkDataTypes)(l,r,s.opts.strictNumbers,dataType_1.DataType.Wrong),u=t.const("indices",codegen_1$d._`{}`);t.for(codegen_1$d._`;${i}--;`,()=>{t.let(r,codegen_1$d._`${n}[${i}]`),t.if(o,codegen_1$d._`continue`),l.length>1&&t.if(codegen_1$d._`typeof ${r} == "string"`,codegen_1$d._`${r} += "_"`),t.if(codegen_1$d._`typeof ${u}[${r}] == "number"`,()=>{t.assign(a,codegen_1$d._`${u}[${r}]`),e.error(),t.assign(c,!1).break()}).code(codegen_1$d._`${u}[${r}] = ${i}`)})}function d(i,a){const r=(0,util_1$g.useFunc)(t,equal_1$2.default),o=t.name("outer");t.label(o).for(codegen_1$d._`;${i}--;`,()=>t.for(codegen_1$d._`${a} = ${i}; ${a}--;`,()=>t.if(codegen_1$d._`${r}(${n}[${i}], ${n}[${a}])`,()=>{e.error(),t.assign(c,!1).break(o)})))}e.block$data(c,(function(){const i=t.let("i",codegen_1$d._`${n}.length`),a=t.let("j");e.setParams({i:i,j:a}),t.assign(c,!0),t.if(codegen_1$d._`${i} > 1`,()=>(l.length>0&&!l.some(e=>"object"===e||"array"===e)?u:d)(i,a))}),codegen_1$d._`${o} === false`),e.ok(c)}};uniqueItems.default=def$j;var _const={};Object.defineProperty(_const,"__esModule",{value:!0});const codegen_1$c=codegen,util_1$f=util,equal_1$1=equal$1,error$a={message:"must be equal to constant",params:({schemaCode:e})=>codegen_1$c._`{allowedValue: ${e}}`},def$i={keyword:"const",$data:!0,error:error$a,code(e){const{gen:t,data:n,$data:i,schemaCode:a,schema:r}=e;i||r&&"object"==typeof r?e.fail$data(codegen_1$c._`!${(0,util_1$f.useFunc)(t,equal_1$1.default)}(${n}, ${a})`):e.fail(codegen_1$c._`${r} !== ${n}`)}};_const.default=def$i;var _enum={};Object.defineProperty(_enum,"__esModule",{value:!0});const codegen_1$b=codegen,util_1$e=util,equal_1=equal$1,error$9={message:"must be equal to one of the allowed values",params:({schemaCode:e})=>codegen_1$b._`{allowedValues: ${e}}`},def$h={keyword:"enum",schemaType:"array",$data:!0,error:error$9,code(e){const{gen:t,data:n,$data:i,schema:a,schemaCode:r,it:o}=e;if(!i&&0===a.length)throw new Error("enum must have non-empty array");const s=a.length>=o.opts.loopEnum;let c;const l=()=>null!=c?c:c=(0,util_1$e.useFunc)(t,equal_1.default);let u;if(s||i)u=t.let("valid"),e.block$data(u,(function(){t.assign(u,!1),t.forOf("v",r,e=>t.if(codegen_1$b._`${l()}(${n}, ${e})`,()=>t.assign(u,!0).break()))}));else{if(!Array.isArray(a))throw new Error("ajv implementation error");const e=t.const("vSchema",r);u=(0,codegen_1$b.or)(...a.map((t,i)=>function(e,t){const i=a[t];return"object"==typeof i&&null!==i?codegen_1$b._`${l()}(${n}, ${e}[${t}])`:codegen_1$b._`${n} === ${i}`}(e,i)))}e.pass(u)}};_enum.default=def$h,Object.defineProperty(validation$1,"__esModule",{value:!0});const limitNumber_1=limitNumber,multipleOf_1=multipleOf,limitLength_1=limitLength,pattern_1=pattern,limitProperties_1=limitProperties,required_1=required,limitItems_1=limitItems,uniqueItems_1=uniqueItems,const_1=_const,enum_1=_enum,validation=[limitNumber_1.default,multipleOf_1.default,limitLength_1.default,pattern_1.default,limitProperties_1.default,required_1.default,limitItems_1.default,uniqueItems_1.default,{keyword:"type",schemaType:["string","array"]},{keyword:"nullable",schemaType:"boolean"},const_1.default,enum_1.default];validation$1.default=validation;var applicator={},additionalItems={};Object.defineProperty(additionalItems,"__esModule",{value:!0}),additionalItems.validateAdditionalItems=void 0;const codegen_1$a=codegen,util_1$d=util,error$8={message:({params:{len:e}})=>codegen_1$a.str`must NOT have more than ${e} items`,params:({params:{len:e}})=>codegen_1$a._`{limit: ${e}}`},def$g={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:error$8,code(e){const{parentSchema:t,it:n}=e,{items:i}=t;Array.isArray(i)?validateAdditionalItems(e,i):(0,util_1$d.checkStrictMode)(n,'"additionalItems" is ignored when "items" is not an array of schemas')}};function validateAdditionalItems(e,t){const{gen:n,schema:i,data:a,keyword:r,it:o}=e;o.items=!0;const s=n.const("len",codegen_1$a._`${a}.length`);if(!1===i)e.setParams({len:t.length}),e.pass(codegen_1$a._`${s} <= ${t.length}`);else if("object"==typeof i&&!(0,util_1$d.alwaysValidSchema)(o,i)){const i=n.var("valid",codegen_1$a._`${s} <= ${t.length}`);n.if((0,codegen_1$a.not)(i),()=>function(i){n.forRange("i",t.length,s,t=>{e.subschema({keyword:r,dataProp:t,dataPropType:util_1$d.Type.Num},i),o.allErrors||n.if((0,codegen_1$a.not)(i),()=>n.break())})}(i)),e.ok(i)}}additionalItems.validateAdditionalItems=validateAdditionalItems,additionalItems.default=def$g;var prefixItems={},items={};Object.defineProperty(items,"__esModule",{value:!0}),items.validateTuple=void 0;const codegen_1$9=codegen,util_1$c=util,code_1$5=code,def$f={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:t,it:n}=e;if(Array.isArray(t))return validateTuple(e,"additionalItems",t);n.items=!0,(0,util_1$c.alwaysValidSchema)(n,t)||e.ok((0,code_1$5.validateArray)(e))}};function validateTuple(e,t,n=e.schema){const{gen:i,parentSchema:a,data:r,keyword:o,it:s}=e;!function(e){const{opts:i,errSchemaPath:a}=s,r=n.length,c=r===e.minItems&&(r===e.maxItems||!1===e[t]);if(i.strictTuples&&!c){const e=`"${o}" is ${r}-tuple, but minItems or maxItems/${t} are not specified or different at path "${a}"`;(0,util_1$c.checkStrictMode)(s,e,i.strictTuples)}}(a),s.opts.unevaluated&&n.length&&!0!==s.items&&(s.items=util_1$c.mergeEvaluated.items(i,n.length,s.items));const c=i.name("valid"),l=i.const("len",codegen_1$9._`${r}.length`);n.forEach((t,n)=>{(0,util_1$c.alwaysValidSchema)(s,t)||(i.if(codegen_1$9._`${l} > ${n}`,()=>e.subschema({keyword:o,schemaProp:n,dataProp:n},c)),e.ok(c))})}items.validateTuple=validateTuple,items.default=def$f,Object.defineProperty(prefixItems,"__esModule",{value:!0});const items_1$1=items,def$e={keyword:"prefixItems",type:"array",schemaType:["array"],before:"uniqueItems",code:e=>(0,items_1$1.validateTuple)(e,"items")};prefixItems.default=def$e;var items2020={};Object.defineProperty(items2020,"__esModule",{value:!0});const codegen_1$8=codegen,util_1$b=util,code_1$4=code,additionalItems_1$1=additionalItems,error$7={message:({params:{len:e}})=>codegen_1$8.str`must NOT have more than ${e} items`,params:({params:{len:e}})=>codegen_1$8._`{limit: ${e}}`},def$d={keyword:"items",type:"array",schemaType:["object","boolean"],before:"uniqueItems",error:error$7,code(e){const{schema:t,parentSchema:n,it:i}=e,{prefixItems:a}=n;i.items=!0,(0,util_1$b.alwaysValidSchema)(i,t)||(a?(0,additionalItems_1$1.validateAdditionalItems)(e,a):e.ok((0,code_1$4.validateArray)(e)))}};items2020.default=def$d;var contains={};Object.defineProperty(contains,"__esModule",{value:!0});const codegen_1$7=codegen,util_1$a=util,error$6={message:({params:{min:e,max:t}})=>void 0===t?codegen_1$7.str`must contain at least ${e} valid item(s)`:codegen_1$7.str`must contain at least ${e} and no more than ${t} valid item(s)`,params:({params:{min:e,max:t}})=>void 0===t?codegen_1$7._`{minContains: ${e}}`:codegen_1$7._`{minContains: ${e}, maxContains: ${t}}`},def$c={keyword:"contains",type:"array",schemaType:["object","boolean"],before:"uniqueItems",trackErrors:!0,error:error$6,code(e){const{gen:t,schema:n,parentSchema:i,data:a,it:r}=e;let o,s;const{minContains:c,maxContains:l}=i;r.opts.next?(o=void 0===c?1:c,s=l):o=1;const u=t.const("len",codegen_1$7._`${a}.length`);if(e.setParams({min:o,max:s}),void 0===s&&0===o)return void(0,util_1$a.checkStrictMode)(r,'"minContains" == 0 without "maxContains": "contains" keyword ignored');if(void 0!==s&&o>s)return(0,util_1$a.checkStrictMode)(r,'"minContains" > "maxContains" is always invalid'),void e.fail();if((0,util_1$a.alwaysValidSchema)(r,n)){let t=codegen_1$7._`${u} >= ${o}`;return void 0!==s&&(t=codegen_1$7._`${t} && ${u} <= ${s}`),void e.pass(t)}r.items=!0;const d=t.name("valid");function f(){const e=t.name("_valid"),n=t.let("count",0);p(e,()=>t.if(e,()=>function(e){t.code(codegen_1$7._`${e}++`),void 0===s?t.if(codegen_1$7._`${e} >= ${o}`,()=>t.assign(d,!0).break()):(t.if(codegen_1$7._`${e} > ${s}`,()=>t.assign(d,!1).break()),1===o?t.assign(d,!0):t.if(codegen_1$7._`${e} >= ${o}`,()=>t.assign(d,!0)))}(n)))}function p(n,i){t.forRange("i",0,u,t=>{e.subschema({keyword:"contains",dataProp:t,dataPropType:util_1$a.Type.Num,compositeRule:!0},n),i()})}void 0===s&&1===o?p(d,()=>t.if(d,()=>t.break())):0===o?(t.let(d,!0),void 0!==s&&t.if(codegen_1$7._`${a}.length > 0`,f)):(t.let(d,!1),f()),e.result(d,()=>e.reset())}};contains.default=def$c;var dependencies={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.validateSchemaDeps=e.validatePropertyDeps=e.error=void 0;const t=codegen,n=util,i=code;e.error={message:({params:{property:e,depsCount:n,deps:i}})=>{const a=1===n?"property":"properties";return t.str`must have ${a} ${i} when property ${e} is present`},params:({params:{property:e,depsCount:n,deps:i,missingProperty:a}})=>t._`{property: ${e},
    missingProperty: ${a},
    depsCount: ${n},
    deps: ${i}}`};const a={keyword:"dependencies",type:"object",schemaType:"object",error:e.error,code(e){const[t,n]=function({schema:e}){const t={},n={};for(const i in e)"__proto__"!==i&&((Array.isArray(e[i])?t:n)[i]=e[i]);return[t,n]}(e);r(e,t),o(e,n)}};function r(e,n=e.schema){const{gen:a,data:r,it:o}=e;if(0===Object.keys(n).length)return;const s=a.let("missing");for(const c in n){const l=n[c];if(0===l.length)continue;const u=(0,i.propertyInData)(a,r,c,o.opts.ownProperties);e.setParams({property:c,depsCount:l.length,deps:l.join(", ")}),o.allErrors?a.if(u,()=>{for(const t of l)(0,i.checkReportMissingProp)(e,t)}):(a.if(t._`${u} && (${(0,i.checkMissingProp)(e,l,s)})`),(0,i.reportMissingProp)(e,s),a.else())}}function o(e,t=e.schema){const{gen:a,data:r,keyword:o,it:s}=e,c=a.name("valid");for(const l in t)(0,n.alwaysValidSchema)(s,t[l])||(a.if((0,i.propertyInData)(a,r,l,s.opts.ownProperties),()=>{const t=e.subschema({keyword:o,schemaProp:l},c);e.mergeValidEvaluated(t,c)},()=>a.var(c,!0)),e.ok(c))}e.validatePropertyDeps=r,e.validateSchemaDeps=o,e.default=a}(dependencies);var propertyNames={};Object.defineProperty(propertyNames,"__esModule",{value:!0});const codegen_1$6=codegen,util_1$9=util,error$5={message:"property name must be valid",params:({params:e})=>codegen_1$6._`{propertyName: ${e.propertyName}}`},def$b={keyword:"propertyNames",type:"object",schemaType:["object","boolean"],error:error$5,code(e){const{gen:t,schema:n,data:i,it:a}=e;if((0,util_1$9.alwaysValidSchema)(a,n))return;const r=t.name("valid");t.forIn("key",i,n=>{e.setParams({propertyName:n}),e.subschema({keyword:"propertyNames",data:n,dataTypes:["string"],propertyName:n,compositeRule:!0},r),t.if((0,codegen_1$6.not)(r),()=>{e.error(!0),a.allErrors||t.break()})}),e.ok(r)}};propertyNames.default=def$b;var additionalProperties={};Object.defineProperty(additionalProperties,"__esModule",{value:!0});const code_1$3=code,codegen_1$5=codegen,names_1=names$1,util_1$8=util,error$4={message:"must NOT have additional properties",params:({params:e})=>codegen_1$5._`{additionalProperty: ${e.additionalProperty}}`},def$a={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:error$4,code(e){const{gen:t,schema:n,parentSchema:i,data:a,errsCount:r,it:o}=e;if(!r)throw new Error("ajv implementation error");const{allErrors:s,opts:c}=o;if(o.props=!0,"all"!==c.removeAdditional&&(0,util_1$8.alwaysValidSchema)(o,n))return;const l=(0,code_1$3.allSchemaProperties)(i.properties),u=(0,code_1$3.allSchemaProperties)(i.patternProperties);function d(e){t.code(codegen_1$5._`delete ${a}[${e}]`)}function f(i){if("all"===c.removeAdditional||c.removeAdditional&&!1===n)d(i);else{if(!1===n)return e.setParams({additionalProperty:i}),e.error(),void(s||t.break());if("object"==typeof n&&!(0,util_1$8.alwaysValidSchema)(o,n)){const n=t.name("valid");"failing"===c.removeAdditional?(p(i,n,!1),t.if((0,codegen_1$5.not)(n),()=>{e.reset(),d(i)})):(p(i,n),s||t.if((0,codegen_1$5.not)(n),()=>t.break()))}}}function p(t,n,i){const a={keyword:"additionalProperties",dataProp:t,dataPropType:util_1$8.Type.Str};!1===i&&Object.assign(a,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(a,n)}t.forIn("key",a,n=>{l.length||u.length?t.if(function(n){let a;if(l.length>8){const e=(0,util_1$8.schemaRefOrVal)(o,i.properties,"properties");a=(0,code_1$3.isOwnProperty)(t,e,n)}else a=l.length?(0,codegen_1$5.or)(...l.map(e=>codegen_1$5._`${n} === ${e}`)):codegen_1$5.nil;return u.length&&(a=(0,codegen_1$5.or)(a,...u.map(t=>codegen_1$5._`${(0,code_1$3.usePattern)(e,t)}.test(${n})`))),(0,codegen_1$5.not)(a)}(n),()=>f(n)):f(n)}),e.ok(codegen_1$5._`${r} === ${names_1.default.errors}`)}};additionalProperties.default=def$a;var properties$1={};Object.defineProperty(properties$1,"__esModule",{value:!0});const validate_1=validate$1,code_1$2=code,util_1$7=util,additionalProperties_1$1=additionalProperties,def$9={keyword:"properties",type:"object",schemaType:"object",code(e){const{gen:t,schema:n,parentSchema:i,data:a,it:r}=e;"all"===r.opts.removeAdditional&&void 0===i.additionalProperties&&additionalProperties_1$1.default.code(new validate_1.KeywordCxt(r,additionalProperties_1$1.default,"additionalProperties"));const o=(0,code_1$2.allSchemaProperties)(n);for(const e of o)r.definedProperties.add(e);r.opts.unevaluated&&o.length&&!0!==r.props&&(r.props=util_1$7.mergeEvaluated.props(t,(0,util_1$7.toHash)(o),r.props));const s=o.filter(e=>!(0,util_1$7.alwaysValidSchema)(r,n[e]));if(0===s.length)return;const c=t.name("valid");for(const n of s)l(n)?u(n):(t.if((0,code_1$2.propertyInData)(t,a,n,r.opts.ownProperties)),u(n),r.allErrors||t.else().var(c,!0),t.endIf()),e.it.definedProperties.add(n),e.ok(c);function l(e){return r.opts.useDefaults&&!r.compositeRule&&void 0!==n[e].default}function u(t){e.subschema({keyword:"properties",schemaProp:t,dataProp:t},c)}}};properties$1.default=def$9;var patternProperties={};Object.defineProperty(patternProperties,"__esModule",{value:!0});const code_1$1=code,codegen_1$4=codegen,util_1$6=util,util_2=util,def$8={keyword:"patternProperties",type:"object",schemaType:"object",code(e){const{gen:t,schema:n,data:i,parentSchema:a,it:r}=e,{opts:o}=r,s=(0,code_1$1.allSchemaProperties)(n),c=s.filter(e=>(0,util_1$6.alwaysValidSchema)(r,n[e]));if(0===s.length||c.length===s.length&&(!r.opts.unevaluated||!0===r.props))return;const l=o.strictSchema&&!o.allowMatchingProperties&&a.properties,u=t.name("valid");!0===r.props||r.props instanceof codegen_1$4.Name||(r.props=(0,util_2.evaluatedPropsToName)(t,r.props));const{props:d}=r;function f(e){for(const t in l)new RegExp(e).test(t)&&(0,util_1$6.checkStrictMode)(r,`property ${t} matches pattern ${e} (use allowMatchingProperties)`)}function p(n){t.forIn("key",i,i=>{t.if(codegen_1$4._`${(0,code_1$1.usePattern)(e,n)}.test(${i})`,()=>{const a=c.includes(n);a||e.subschema({keyword:"patternProperties",schemaProp:n,dataProp:i,dataPropType:util_2.Type.Str},u),r.opts.unevaluated&&!0!==d?t.assign(codegen_1$4._`${d}[${i}]`,!0):a||r.allErrors||t.if((0,codegen_1$4.not)(u),()=>t.break())})})}!function(){for(const e of s)l&&f(e),r.allErrors?p(e):(t.var(u,!0),p(e),t.if(u))}()}};patternProperties.default=def$8;var not={};Object.defineProperty(not,"__esModule",{value:!0});const util_1$5=util,def$7={keyword:"not",schemaType:["object","boolean"],trackErrors:!0,code(e){const{gen:t,schema:n,it:i}=e;if((0,util_1$5.alwaysValidSchema)(i,n))return void e.fail();const a=t.name("valid");e.subschema({keyword:"not",compositeRule:!0,createErrors:!1,allErrors:!1},a),e.failResult(a,()=>e.reset(),()=>e.error())},error:{message:"must NOT be valid"}};not.default=def$7;var anyOf={};Object.defineProperty(anyOf,"__esModule",{value:!0});const code_1=code,def$6={keyword:"anyOf",schemaType:"array",trackErrors:!0,code:code_1.validateUnion,error:{message:"must match a schema in anyOf"}};anyOf.default=def$6;var oneOf={};Object.defineProperty(oneOf,"__esModule",{value:!0});const codegen_1$3=codegen,util_1$4=util,error$3={message:"must match exactly one schema in oneOf",params:({params:e})=>codegen_1$3._`{passingSchemas: ${e.passing}}`},def$5={keyword:"oneOf",schemaType:"array",trackErrors:!0,error:error$3,code(e){const{gen:t,schema:n,parentSchema:i,it:a}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");if(a.opts.discriminator&&i.discriminator)return;const r=n,o=t.let("valid",!1),s=t.let("passing",null),c=t.name("_valid");e.setParams({passing:s}),t.block((function(){r.forEach((n,i)=>{let r;(0,util_1$4.alwaysValidSchema)(a,n)?t.var(c,!0):r=e.subschema({keyword:"oneOf",schemaProp:i,compositeRule:!0},c),i>0&&t.if(codegen_1$3._`${c} && ${o}`).assign(o,!1).assign(s,codegen_1$3._`[${s}, ${i}]`).else(),t.if(c,()=>{t.assign(o,!0),t.assign(s,i),r&&e.mergeEvaluated(r,codegen_1$3.Name)})})})),e.result(o,()=>e.reset(),()=>e.error(!0))}};oneOf.default=def$5;var allOf={};Object.defineProperty(allOf,"__esModule",{value:!0});const util_1$3=util,def$4={keyword:"allOf",schemaType:"array",code(e){const{gen:t,schema:n,it:i}=e;if(!Array.isArray(n))throw new Error("ajv implementation error");const a=t.name("valid");n.forEach((t,n)=>{if((0,util_1$3.alwaysValidSchema)(i,t))return;const r=e.subschema({keyword:"allOf",schemaProp:n},a);e.ok(a),e.mergeEvaluated(r)})}};allOf.default=def$4;var _if={};Object.defineProperty(_if,"__esModule",{value:!0});const codegen_1$2=codegen,util_1$2=util,error$2={message:({params:e})=>codegen_1$2.str`must match "${e.ifClause}" schema`,params:({params:e})=>codegen_1$2._`{failingKeyword: ${e.ifClause}}`},def$3={keyword:"if",schemaType:["object","boolean"],trackErrors:!0,error:error$2,code(e){const{gen:t,parentSchema:n,it:i}=e;void 0===n.then&&void 0===n.else&&(0,util_1$2.checkStrictMode)(i,'"if" without "then" and "else" is ignored');const a=hasSchema(i,"then"),r=hasSchema(i,"else");if(!a&&!r)return;const o=t.let("valid",!0),s=t.name("_valid");if(function(){const t=e.subschema({keyword:"if",compositeRule:!0,createErrors:!1,allErrors:!1},s);e.mergeEvaluated(t)}(),e.reset(),a&&r){const n=t.let("ifClause");e.setParams({ifClause:n}),t.if(s,c("then",n),c("else",n))}else a?t.if(s,c("then")):t.if((0,codegen_1$2.not)(s),c("else"));function c(n,i){return()=>{const a=e.subschema({keyword:n},s);t.assign(o,s),e.mergeValidEvaluated(a,o),i?t.assign(i,codegen_1$2._`${n}`):e.setParams({ifClause:n})}}e.pass(o,()=>e.error(!0))}};function hasSchema(e,t){const n=e.schema[t];return void 0!==n&&!(0,util_1$2.alwaysValidSchema)(e,n)}_if.default=def$3;var thenElse={};Object.defineProperty(thenElse,"__esModule",{value:!0});const util_1$1=util,def$2={keyword:["then","else"],schemaType:["object","boolean"],code({keyword:e,parentSchema:t,it:n}){void 0===t.if&&(0,util_1$1.checkStrictMode)(n,`"${e}" without "if" is ignored`)}};thenElse.default=def$2,Object.defineProperty(applicator,"__esModule",{value:!0});const additionalItems_1=additionalItems,prefixItems_1=prefixItems,items_1=items,items2020_1=items2020,contains_1=contains,dependencies_1=dependencies,propertyNames_1=propertyNames,additionalProperties_1=additionalProperties,properties_1=properties$1,patternProperties_1=patternProperties,not_1=not,anyOf_1=anyOf,oneOf_1=oneOf,allOf_1=allOf,if_1=_if,thenElse_1=thenElse;function getApplicator(e=!1){const t=[not_1.default,anyOf_1.default,oneOf_1.default,allOf_1.default,if_1.default,thenElse_1.default,propertyNames_1.default,additionalProperties_1.default,dependencies_1.default,properties_1.default,patternProperties_1.default];return e?t.push(prefixItems_1.default,items2020_1.default):t.push(additionalItems_1.default,items_1.default),t.push(contains_1.default),t}applicator.default=getApplicator;var format$2={},format$1={};Object.defineProperty(format$1,"__esModule",{value:!0});const codegen_1$1=codegen,error$1={message:({schemaCode:e})=>codegen_1$1.str`must match format "${e}"`,params:({schemaCode:e})=>codegen_1$1._`{format: ${e}}`},def$1={keyword:"format",type:["number","string"],schemaType:"string",$data:!0,error:error$1,code(e,t){const{gen:n,data:i,$data:a,schema:r,schemaCode:o,it:s}=e,{opts:c,errSchemaPath:l,schemaEnv:u,self:d}=s;c.validateFormats&&(a?function(){const a=n.scopeValue("formats",{ref:d.formats,code:c.code.formats}),r=n.const("fDef",codegen_1$1._`${a}[${o}]`),s=n.let("fType"),l=n.let("format");n.if(codegen_1$1._`typeof ${r} == "object" && !(${r} instanceof RegExp)`,()=>n.assign(s,codegen_1$1._`${r}.type || "string"`).assign(l,codegen_1$1._`${r}.validate`),()=>n.assign(s,codegen_1$1._`"string"`).assign(l,r)),e.fail$data((0,codegen_1$1.or)(!1===c.strictSchema?codegen_1$1.nil:codegen_1$1._`${o} && !${l}`,function(){const e=u.$async?codegen_1$1._`(${r}.async ? await ${l}(${i}) : ${l}(${i}))`:codegen_1$1._`${l}(${i})`,n=codegen_1$1._`(typeof ${l} == "function" ? ${e} : ${l}.test(${i}))`;return codegen_1$1._`${l} && ${l} !== true && ${s} === ${t} && !${n}`}()))}():function(){const a=d.formats[r];if(!a)return void function(){if(!1!==c.strictSchema)throw new Error(e());function e(){return`unknown format "${r}" ignored in schema at path "${l}"`}d.logger.warn(e())}();if(!0===a)return;const[o,s,f]=function(e){const t=e instanceof RegExp?(0,codegen_1$1.regexpCode)(e):c.code.formats?codegen_1$1._`${c.code.formats}${(0,codegen_1$1.getProperty)(r)}`:void 0,i=n.scopeValue("formats",{key:r,ref:e,code:t});return"object"!=typeof e||e instanceof RegExp?["string",e,i]:[e.type||"string",e.validate,codegen_1$1._`${i}.validate`]}(a);o===t&&e.pass(function(){if("object"==typeof a&&!(a instanceof RegExp)&&a.async){if(!u.$async)throw new Error("async format in sync schema");return codegen_1$1._`await ${f}(${i})`}return"function"==typeof s?codegen_1$1._`${f}(${i})`:codegen_1$1._`${f}.test(${i})`}())}())}};format$1.default=def$1,Object.defineProperty(format$2,"__esModule",{value:!0});const format_1$1=format$1,format=[format_1$1.default];format$2.default=format;var metadata={};Object.defineProperty(metadata,"__esModule",{value:!0}),metadata.contentVocabulary=metadata.metadataVocabulary=void 0,metadata.metadataVocabulary=["title","description","default","deprecated","readOnly","writeOnly","examples"],metadata.contentVocabulary=["contentMediaType","contentEncoding","contentSchema"],Object.defineProperty(draft7,"__esModule",{value:!0});const core_1=core$1,validation_1=validation$1,applicator_1=applicator,format_1=format$2,metadata_1=metadata,draft7Vocabularies=[core_1.default,validation_1.default,(0,applicator_1.default)(),format_1.default,metadata_1.metadataVocabulary,metadata_1.contentVocabulary];draft7.default=draft7Vocabularies;var discriminator={},types={};!function(e){var t;Object.defineProperty(e,"__esModule",{value:!0}),e.DiscrError=void 0,(t=e.DiscrError||(e.DiscrError={})).Tag="tag",t.Mapping="mapping"}(types),Object.defineProperty(discriminator,"__esModule",{value:!0});const codegen_1=codegen,types_1=types,compile_1=compile,util_1=util,error={message:({params:{discrError:e,tagName:t}})=>e===types_1.DiscrError.Tag?`tag "${t}" must be string`:`value of tag "${t}" must be in oneOf`,params:({params:{discrError:e,tag:t,tagName:n}})=>codegen_1._`{error: ${e}, tag: ${n}, tagValue: ${t}}`},def={keyword:"discriminator",type:"object",schemaType:"object",error:error,code(e){const{gen:t,data:n,schema:i,parentSchema:a,it:r}=e,{oneOf:o}=a;if(!r.opts.discriminator)throw new Error("discriminator: requires discriminator option");const s=i.propertyName;if("string"!=typeof s)throw new Error("discriminator: requires propertyName");if(i.mapping)throw new Error("discriminator: mapping is not supported");if(!o)throw new Error("discriminator: requires oneOf keyword");const c=t.let("valid",!1),l=t.const("tag",codegen_1._`${n}${(0,codegen_1.getProperty)(s)}`);function u(n){const i=t.name("valid"),a=e.subschema({keyword:"oneOf",schemaProp:n},i);return e.mergeEvaluated(a,codegen_1.Name),i}t.if(codegen_1._`typeof ${l} == "string"`,()=>function(){const n=function(){var e;const t={},n=c(a);let i=!0;for(let t=0;t<o.length;t++){let a=o[t];(null==a?void 0:a.$ref)&&!(0,util_1.schemaHasRulesButRef)(a,r.self.RULES)&&(a=compile_1.resolveRef.call(r.self,r.schemaEnv.root,r.baseId,null==a?void 0:a.$ref),a instanceof compile_1.SchemaEnv&&(a=a.schema));const u=null===(e=null==a?void 0:a.properties)||void 0===e?void 0:e[s];if("object"!=typeof u)throw new Error(`discriminator: oneOf subschemas (or referenced schemas) must have "properties/${s}"`);i=i&&(n||c(a)),l(u,t)}if(!i)throw new Error(`discriminator: "${s}" must be required`);return t;function c({required:e}){return Array.isArray(e)&&e.includes(s)}function l(e,t){if(e.const)u(e.const,t);else{if(!e.enum)throw new Error(`discriminator: "properties/${s}" must have "const" or "enum"`);for(const n of e.enum)u(n,t)}}function u(e,n){if("string"!=typeof e||e in t)throw new Error(`discriminator: "${s}" values must be unique strings`);t[e]=n}}();t.if(!1);for(const e in n)t.elseIf(codegen_1._`${l} === ${e}`),t.assign(c,u(n[e]));t.else(),e.error(!1,{discrError:types_1.DiscrError.Mapping,tag:l,tagName:s}),t.endIf()}(),()=>e.error(!1,{discrError:types_1.DiscrError.Tag,tag:l,tagName:s})),e.ok(c)}};discriminator.default=def;var $schema="http://json-schema.org/draft-07/schema#",$id="http://json-schema.org/draft-07/schema#",title="Core schema meta-schema",definitions={schemaArray:{type:"array",minItems:1,items:{$ref:"#"}},nonNegativeInteger:{type:"integer",minimum:0},nonNegativeIntegerDefault0:{allOf:[{$ref:"#/definitions/nonNegativeInteger"},{default:0}]},simpleTypes:{enum:["array","boolean","integer","null","number","object","string"]},stringArray:{type:"array",items:{type:"string"},uniqueItems:!0,default:[]}},type=["object","boolean"],properties={$id:{type:"string",format:"uri-reference"},$schema:{type:"string",format:"uri"},$ref:{type:"string",format:"uri-reference"},$comment:{type:"string"},title:{type:"string"},description:{type:"string"},default:!0,readOnly:{type:"boolean",default:!1},examples:{type:"array",items:!0},multipleOf:{type:"number",exclusiveMinimum:0},maximum:{type:"number"},exclusiveMaximum:{type:"number"},minimum:{type:"number"},exclusiveMinimum:{type:"number"},maxLength:{$ref:"#/definitions/nonNegativeInteger"},minLength:{$ref:"#/definitions/nonNegativeIntegerDefault0"},pattern:{type:"string",format:"regex"},additionalItems:{$ref:"#"},items:{anyOf:[{$ref:"#"},{$ref:"#/definitions/schemaArray"}],default:!0},maxItems:{$ref:"#/definitions/nonNegativeInteger"},minItems:{$ref:"#/definitions/nonNegativeIntegerDefault0"},uniqueItems:{type:"boolean",default:!1},contains:{$ref:"#"},maxProperties:{$ref:"#/definitions/nonNegativeInteger"},minProperties:{$ref:"#/definitions/nonNegativeIntegerDefault0"},required:{$ref:"#/definitions/stringArray"},additionalProperties:{$ref:"#"},definitions:{type:"object",additionalProperties:{$ref:"#"},default:{}},properties:{type:"object",additionalProperties:{$ref:"#"},default:{}},patternProperties:{type:"object",additionalProperties:{$ref:"#"},propertyNames:{format:"regex"},default:{}},dependencies:{type:"object",additionalProperties:{anyOf:[{$ref:"#"},{$ref:"#/definitions/stringArray"}]}},propertyNames:{$ref:"#"},const:!0,enum:{type:"array",items:!0,minItems:1,uniqueItems:!0},type:{anyOf:[{$ref:"#/definitions/simpleTypes"},{type:"array",items:{$ref:"#/definitions/simpleTypes"},minItems:1,uniqueItems:!0}]},format:{type:"string"},contentMediaType:{type:"string"},contentEncoding:{type:"string"},if:{$ref:"#"},then:{$ref:"#"},else:{$ref:"#"},allOf:{$ref:"#/definitions/schemaArray"},anyOf:{$ref:"#/definitions/schemaArray"},oneOf:{$ref:"#/definitions/schemaArray"},not:{$ref:"#"}},require$$3={$schema:$schema,$id:$id,title:title,definitions:definitions,type:type,properties:properties,default:!0};!function(e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.CodeGen=t.Name=t.nil=t.stringify=t.str=t._=t.KeywordCxt=void 0;const n=core$2,i=draft7,a=discriminator,r=require$$3,o=["/properties"],s="http://json-schema.org/draft-07/schema";class c extends n.default{_addVocabularies(){super._addVocabularies(),i.default.forEach(e=>this.addVocabulary(e)),this.opts.discriminator&&this.addKeyword(a.default)}_addDefaultMetaSchema(){if(super._addDefaultMetaSchema(),!this.opts.meta)return;const e=this.opts.$data?this.$dataMetaSchema(r,o):r;this.addMetaSchema(e,s,!1),this.refs["http://json-schema.org/schema"]=s}defaultMeta(){return this.opts.defaultMeta=super.defaultMeta()||(this.getSchema(s)?s:void 0)}}e.exports=t=c,Object.defineProperty(t,"__esModule",{value:!0}),t.default=c;var l=validate$1;Object.defineProperty(t,"KeywordCxt",{enumerable:!0,get:function(){return l.KeywordCxt}});var u=codegen;Object.defineProperty(t,"_",{enumerable:!0,get:function(){return u._}}),Object.defineProperty(t,"str",{enumerable:!0,get:function(){return u.str}}),Object.defineProperty(t,"stringify",{enumerable:!0,get:function(){return u.stringify}}),Object.defineProperty(t,"nil",{enumerable:!0,get:function(){return u.nil}}),Object.defineProperty(t,"Name",{enumerable:!0,get:function(){return u.Name}}),Object.defineProperty(t,"CodeGen",{enumerable:!0,get:function(){return u.CodeGen}})}(ajv$1,ajv$1.exports);var Ajv=getDefaultExportFromCjs(ajv$1.exports),dist={exports:{}},formats={};!function(e){function t(e,t){return{validate:e,compare:t}}Object.defineProperty(e,"__esModule",{value:!0}),e.formatNames=e.fastFormats=e.fullFormats=void 0,e.fullFormats={date:t(a,r),time:t(s,c),"date-time":t((function(e){const t=e.split(l);return 2===t.length&&a(t[0])&&s(t[1],!0)}),u),duration:/^P(?!$)((\d+Y)?(\d+M)?(\d+D)?(T(?=\d)(\d+H)?(\d+M)?(\d+S)?)?|(\d+W)?)$/,uri:function(e){return d.test(e)&&f.test(e)},"uri-reference":/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,"uri-template":/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i,url:/^(?:https?|ftp):\/\/(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)(?:\.(?:[a-z0-9\u{00a1}-\u{ffff}]+-)*[a-z0-9\u{00a1}-\u{ffff}]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu,email:/^[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,hostname:/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i,ipv4:/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/,ipv6:/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i,regex:function(e){if(h.test(e))return!1;try{return new RegExp(e),!0}catch(e){return!1}},uuid:/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i,"json-pointer":/^(?:\/(?:[^~/]|~0|~1)*)*$/,"json-pointer-uri-fragment":/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i,"relative-json-pointer":/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/,byte:function(e){return p.lastIndex=0,p.test(e)},int32:{type:"number",validate:function(e){return Number.isInteger(e)&&e<=2**31-1&&e>=-(2**31)}},int64:{type:"number",validate:function(e){return Number.isInteger(e)}},float:{type:"number",validate:m},double:{type:"number",validate:m},password:!0,binary:!0},e.fastFormats={...e.fullFormats,date:t(/^\d\d\d\d-[0-1]\d-[0-3]\d$/,r),time:t(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i,c),"date-time":t(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i,u),uri:/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/)?[^\s]*$/i,"uri-reference":/^(?:(?:[a-z][a-z0-9+\-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i,email:/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)*$/i},e.formatNames=Object.keys(e.fullFormats);const n=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,i=[0,31,28,31,30,31,30,31,31,30,31,30,31];function a(e){const t=n.exec(e);if(!t)return!1;const a=+t[1],r=+t[2],o=+t[3];return r>=1&&r<=12&&o>=1&&o<=(2===r&&function(e){return e%4==0&&(e%100!=0||e%400==0)}(a)?29:i[r])}function r(e,t){if(e&&t)return e>t?1:e<t?-1:0}const o=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function s(e,t){const n=o.exec(e);if(!n)return!1;const i=+n[1],a=+n[2],r=+n[3],s=n[5];return(i<=23&&a<=59&&r<=59||23===i&&59===a&&60===r)&&(!t||""!==s)}function c(e,t){if(!e||!t)return;const n=o.exec(e),i=o.exec(t);return n&&i?(e=n[1]+n[2]+n[3]+(n[4]||""))>(t=i[1]+i[2]+i[3]+(i[4]||""))?1:e<t?-1:0:void 0}const l=/t|\s/i;function u(e,t){if(!e||!t)return;const[n,i]=e.split(l),[a,o]=t.split(l),s=r(n,a);return void 0!==s?s||c(i,o):void 0}const d=/\/|:/,f=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i,p=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/gm;function m(){return!0}const h=/[^\\]\\Z/}(formats);var limit={};!function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.formatLimitDefinition=void 0;const t=ajv$1.exports,n=codegen,i=n.operators,a={formatMaximum:{okStr:"<=",ok:i.LTE,fail:i.GT},formatMinimum:{okStr:">=",ok:i.GTE,fail:i.LT},formatExclusiveMaximum:{okStr:"<",ok:i.LT,fail:i.GTE},formatExclusiveMinimum:{okStr:">",ok:i.GT,fail:i.LTE}},r={message:({keyword:e,schemaCode:t})=>n.str`should be ${a[e].okStr} ${t}`,params:({keyword:e,schemaCode:t})=>n._`{comparison: ${a[e].okStr}, limit: ${t}}`};e.formatLimitDefinition={keyword:Object.keys(a),type:"string",schemaType:"string",$data:!0,error:r,code(e){const{gen:i,data:r,schemaCode:o,keyword:s,it:c}=e,{opts:l,self:u}=c;if(!l.validateFormats)return;const d=new t.KeywordCxt(c,u.RULES.all.format.definition,"format");function f(e){return n._`${e}.compare(${r}, ${o}) ${a[s].fail} 0`}d.$data?function(){const t=i.scopeValue("formats",{ref:u.formats,code:l.code.formats}),a=i.const("fmt",n._`${t}[${d.schemaCode}]`);e.fail$data(n.or(n._`typeof ${a} != "object"`,n._`${a} instanceof RegExp`,n._`typeof ${a}.compare != "function"`,f(a)))}():function(){const t=d.schema,a=u.formats[t];if(!a||!0===a)return;if("object"!=typeof a||a instanceof RegExp||"function"!=typeof a.compare)throw new Error(`"${s}": format "${t}" does not define "compare" function`);const r=i.scopeValue("formats",{key:t,ref:a,code:l.code.formats?n._`${l.code.formats}${n.getProperty(t)}`:void 0});e.fail$data(f(r))}()},dependencies:["format"]},e.default=t=>(t.addKeyword(e.formatLimitDefinition),t)}(limit),function(e,t){Object.defineProperty(t,"__esModule",{value:!0});const n=formats,i=limit,a=codegen,r=new a.Name("fullFormats"),o=new a.Name("fastFormats"),s=(e,t={keywords:!0})=>{if(Array.isArray(t))return c(e,t,n.fullFormats,r),e;const[a,s]="fast"===t.mode?[n.fastFormats,o]:[n.fullFormats,r];return c(e,t.formats||n.formatNames,a,s),t.keywords&&i.default(e),e};function c(e,t,n,i){var r,o;null!==(r=(o=e.opts.code).formats)&&void 0!==r||(o.formats=a._`require("ajv-formats/dist/formats").${i}`);for(const i of t)e.addFormat(i,n[i])}s.get=(e,t="full")=>{const i=("fast"===t?n.fastFormats:n.fullFormats)[e];if(!i)throw new Error(`Unknown format "${e}"`);return i},e.exports=t=s,Object.defineProperty(t,"__esModule",{value:!0}),t.default=s}(dist,dist.exports);var addFormats=getDefaultExportFromCjs(dist.exports),zh=function(e){if(e&&e.length)for(const t of e){let e;switch(t.keyword){case"additionalItems":case"items":e="",e+="不允许超过"+t.params.limit+"个元素";break;case"additionalProperties":e="不允许有额外的属性";break;case"anyOf":e="数据应为 anyOf 所指定的其中一个";break;case"const":e="应当等于常量";break;case"contains":e="应当包含一个有效项";break;case"dependencies":case"dependentRequired":e="",t.params.depsCount,e+="应当拥有属性"+t.params.property+"的依赖属性"+t.params.deps;break;case"discriminator":switch(t.params.error){case"tag":e='标签 "'+t.params.tag+'" 的类型必须为字符串';break;case"mapping":e='标签 "'+t.params.tag+'" 的值必须在 oneOf 之中';break;default:e='应当通过 "'+t.keyword+' 关键词校验"'}break;case"enum":e="应当是预设定的枚举值之一";break;case"false schema":e="布尔模式出错";break;case"format":e='应当匹配格式 "'+t.params.format+'"';break;case"formatMaximum":case"formatExclusiveMaximum":e="",e+="应当是 "+t.params.comparison+" "+t.params.limit;break;case"formatMinimum":case"formatExclusiveMinimum":e="",e+="应当是 "+t.params.comparison+" "+t.params.limit;break;case"if":e='应当匹配模式 "'+t.params.failingKeyword+'" ';break;case"maximum":case"exclusiveMaximum":e="",e+="应当为 "+t.params.comparison+" "+t.params.limit;break;case"maxItems":e="",e+="不应多于 "+t.params.limit+" 个项";break;case"maxLength":e="",e+="不应多于 "+t.params.limit+" 个字符";break;case"maxProperties":e="",e+="不应有多于 "+t.params.limit+" 个属性";break;case"minimum":case"exclusiveMinimum":e="",e+="应当为 "+t.params.comparison+" "+t.params.limit;break;case"minItems":e="",e+="不应少于 "+t.params.limit+" 个项";break;case"minLength":e="",e+="不应少于 "+t.params.limit+" 个字符";break;case"minProperties":e="",e+="不应有少于 "+t.params.limit+" 个属性";break;case"multipleOf":e="应当是 "+t.params.multipleOf+" 的整数倍";break;case"not":e='不应当匹配 "not" schema';break;case"oneOf":e='只能匹配一个 "oneOf" 中的 schema';break;case"pattern":e='应当匹配模式 "'+t.params.pattern+'"';break;case"patternRequired":e="应当有属性匹配模式 "+t.params.missingPattern;break;case"propertyNames":e="属性名 无效";break;case"required":e="应当有必需属性 "+t.params.missingProperty;break;case"type":e="应当是 "+t.params.type+" 类型";break;case"unevaluatedItems":e="",e+=" 不允许有超过 "+t.params.len+" 个元素";break;case"unevaluatedProperties":e="不允许存在未求值的属性";break;case"uniqueItems":e="不应当含有重复项 (第 "+t.params.j+" 项与第 "+t.params.i+" 项是重复的)";break;default:e='应当通过 "'+t.keyword+' 关键词校验"'}t.message=e}},ajv=new Ajv({strict:!1});addFormats(ajv);var VALIDATOR="validator",OWN_RULE_PROPERTY="ui:rules",DEBUG_PREFIX="[bk-schema-form-validator]",DEFAULT_RULES={required:{message:"必填项",validator:"{{ $self.value !== '' }}"}},throwErr=function(e){throw new Error("".concat(DEBUG_PREFIX," ").concat(e))},globalRules=new Map,registryGlobalRules=function(e){try{if(!e)return;(null==e?void 0:e.constructor)!==Object&&throwErr("global rules must be an object"),Object.keys(e).forEach((function(t){var n=e[t];hasOwnProperty(n,VALIDATOR)||throwErr("'".concat(t,"' rule must have a validator property"));var i=n[VALIDATOR];isExpression(i)||isRegExp(i)||(null==i?void 0:i.constructor)===Function||throwErr("'".concat(t,"' must be one of expression or regexp or function")),globalRules.set(t,n)}))}catch(e){throwErr(e)}},validate=function validate(rule,instance){var theRule=rule;"string"==typeof rule&&(theRule=globalRules.get(rule),theRule||throwErr("'".concat(rule," is not a valid global rule, you can registry it to global rules node or use form item own custom rules")));var _theRule=theRule,validator=_theRule.validator,message=_theRule.message,valid=!0;return isExpression(validator)?valid=executeExpression(validator,instance):"function"==typeof validator?valid=validator(instance):eval(validator)instanceof RegExp&&(valid=new RegExp(eval(validator)).test(instance.value)),{valid:valid,message:message}},setWidgetErrorTips=function(e,t,n){var i=widgetTree.widgetMap[e],a=i.instance;"node"===i.type&&(null==a||a.setState("error",!0),null==a||a.setErrorTips(n));var r=e.split("."),o=[];r.forEach((function(i,a){var s=r.slice(0,r.length-a),c=s.join("."),l=widgetTree.widgetMap[c],u="array"===l.instance.schema.type||!l.instance.schema.title;if(o.push(u?s.pop():l.instance.schema.title),l.instance.verifiable&&"group"===l.type)if(t){var d="".concat(o.reverse().join("-"),": ").concat(n);l.instance.setGroupErrorTips(e,d)}else l.instance.removeGroupErrorTips(e)}))},validateFormItem=function(e){var t,n=widgetTree.widgetMap[e];if(!n)return{result:!0,message:"",path:""};var i=n.instance;if("group"===n.type)null==i||i.clearGroupErrorTips();else{null==i||i.setState("error",!1),null==i||i.setErrorTips("");var a=e.split(".");a.forEach((function(t,n){var i=a.slice(0,a.length-n).join("."),r=widgetTree.widgetMap[i];r.instance.verifiable&&"group"===r.type&&r.instance.removeGroupErrorTips(e)}))}var r=i.schema,o=ajv.compile(r);if(!o(void 0===i.value?initializationValue(r.type,{integer:0,number:0}):i.value)){zh(o.errors);var s=ajv.errorsText(o.errors,{separator:"\n"});return setWidgetErrorTips(e,!0,s),{result:!1,message:s,path:e}}var c,l=!1,u="",d=_createForOfIteratorHelper((null===(t=i.schema)||void 0===t?void 0:t[OWN_RULE_PROPERTY])||[]);try{for(d.s();!(c=d.n()).done;){var f=c.value,p=validate(f,i);if(!p.valid){l=!0,u=p.message;break}}}catch(e){d.e(e)}finally{d.f()}return l?(setWidgetErrorTips(e,!0,u),{result:!1,message:u,path:e}):{result:!0,message:u,path:e}},validateForm=function(){var e=!0;return Object.keys(widgetTree.widgetMap).forEach((function(t){var n;null!==(n=validateFormItem(t))&&void 0!==n&&n.result||(e=!1)})),e},validateFormWithResult=function(){return new Promise((function(e,t){var n=Object.keys(widgetTree.widgetMap).filter((function(e){var t;return"node"===(null===(t=widgetTree.widgetMap[e])||void 0===t?void 0:t.type)})).reduce((function(e,t){var n=validateFormItem(t);return null!=n&&n.result||e.push(n),e}),[]);n.length?t(n):e([])}))},validateSchema=function(){var e=_asyncToGenerator(_regeneratorRuntime().mark((function e(t){return _regeneratorRuntime().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ajv.validateSchema(t,!0);case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),console.error("Schema不符合规范, 请检查",e.t0),e.abrupt("return",!1);case 10:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}(),dispatchValidate=function(e){return validateFormItem(e)},FormEvent=function(){function e(){_classCallCheck(this,e),this.callbacks=void 0,this.callbacks=Object.create(null)}return _createClass(e,[{key:"on",value:function(e,t,n){return e in this.callbacks||(this.callbacks[e]={}),t in this.callbacks[e]||(this.callbacks[e][t]=[]),this.callbacks[e][t].push(n),this}},{key:"off",value:function(e,t,n){if(e&&t)if(e&&!t)delete this.callbacks[e];else if(e&&t&&!n)delete this.callbacks[e][t];else{var i=this.callbacks[e][t];for(var a in i)n===i[a]&&i.splice(Number(a),1)}else this.callbacks=Object.create(null);return this}},{key:"once",value:function(e,t,n){var i=this;function a(){n.apply(void 0,arguments),i.off(e,t,a)}return a.fn=n,this.on(e,t,a),this}},{key:"emit",value:function(e,t){if(this.callbacks[e]&&t in this.callbacks[e]){for(var n=_toConsumableArray(this.callbacks[e][t]),i=arguments.length,a=new Array(i>2?i-2:0),r=2;r<i;r++)a[r-2]=arguments[r];var o,s=_createForOfIteratorHelper(n);try{for(s.s();!(o=s.n()).done;){var c=o.value;c.apply(void 0,a)}}catch(e){s.e(e)}finally{s.f()}}}}]),e}(),events=new FormEvent,_excluded$4=["url","params"],_excluded2=["name"],Widget=Vue__default.default.extend({name:"Widget",props:props,data:function(){return{loading:!1,datasource:Schema.resolveDefaultDatasource(this.schema),formItemProps:{},state:{visible:this.visible,disabled:this.disabled,readonly:this.readonly,error:this.error},errorTips:""}},computed:{widgetNode:function(){return widgetTree.widgetMap[this.path]},parent:function(){var e;return null===(e=this.widgetNode)||void 0===e?void 0:e.parent}},watch:{value:{handler:function(e,t){var n=this;deepEquals(e,t)||setTimeout((function(){reactionDispatch(n.path,"valChange"),dispatchValidate(n.path)}),0)}}},created:function(){var e=this,t=Schema.getUiOptions(this.schema);this.formItemProps=_objectSpread2(_objectSpread2({},t),{},{label:t.showTitle?t.label||Path.getPathLastProp(this.path):"",required:this.required});var n=Schema.getUiComponent(this.schema),i=Object.assign({},this.formItemProps,n.props||{});Object.keys(i).forEach((function(t){Reflect.has(e.state,t)&&e.setState(t,i[t])})),widgetTree.addWidgetNode(this.path,this,"node")},mounted:function(){reactionRegister(this.path,this.schema["ui:reactions"]),reactionDispatch(this.path,"valChange"),reactionDispatch(this.path,"lifetime/init")},beforeDestroy:function(){widgetTree.removeWidgetNode(this.path,this),reactionUnRegister(this.path)},methods:{setState:function(e,t){Reflect.has(this.state,e)?this.state[e]=t:"value"===e?this.$emit("input",{path:this.path,value:t}):console.warn("Widget unsupported ".concat(e," state, please check"))},loadDataSource:function(){var e=this;return _asyncToGenerator(_regeneratorRuntime().mark((function t(){var n,i,a,r,o,s,c,l,u,d,f,p,m;return _regeneratorRuntime().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=null===(n=e.schema)||void 0===n||null===(i=n["ui:component"])||void 0===i||null===(a=i.props)||void 0===a?void 0:a.remoteConfig)){t.next=18;break}return o=r.url,s=r.params,c=_objectWithoutProperties(r,_excluded$4),l=e.httpAdapter,u=l.request,d=void 0===u?request:u,f=l.responseParse,t.prev=4,e.loading=!0,p=executeExpression(o,e),m=isObj(s)?executeExpression(s,e):s,t.next=10,d(p,_objectSpread2(_objectSpread2({},c),{},{params:m,responseParse:f}));case 10:e.datasource=t.sent,e.loading=!1,t.next=18;break;case 14:t.prev=14,t.t0=t.catch(4),e.loading=!1,console.error(t.t0);case 18:case"end":return t.stop()}}),t,null,[[4,14]])})))()},setErrorTips:function(e){this.errorTips=e},getValue:function(e){return Path.getPathVal(this.rootData,e)}},render:function(e){var t,n,i,a,r,o,s,c,l=this,u=Schema.getUiComponent(this.schema),d=u.name,f=_objectWithoutProperties(u,_excluded2),p=_objectSpread2(_objectSpread2({},this.$props),{},{loading:this.loading,value:this.value}),m=this,h=registry.getComponent(d)||d||Schema.getDefaultWidget(this.schema),v=(null===(t=events.callbacks)||void 0===t?void 0:t[this.path])||{},g=null!==(n=null===(i=(a=this.$scopedSlots).default)||void 0===i?void 0:i.call(a,{path:this.path}))&&void 0!==n?n:e(h,mergeDeep({props:_objectSpread2({},p),attrs:_objectSpread2({},f.props||{}),class:{pr20:this.removeable},on:_objectSpread2(_objectSpread2({},v),{},{input:[].concat(_toConsumableArray(v.input||[]),[function(e){m.$emit("input",{path:m.path,value:e})}]),click:function(){reactionDispatch(m.path,"effect/click")}})},mergeDeep(f,{props:_objectSpread2(_objectSpread2({},this.state),{},{datasource:this.datasource,readonly:this.readonly,readonlyMode:this.readonlyMode}),attrs:_objectSpread2({},this.state)}))),y=(null===(r=this.datasource)||void 0===r||null===(o=r.find((function(e){return e.value===l.value})))||void 0===o?void 0:o.label)||this.value,b=e("div",[""===y?"--":String(y)]);return e(registry.getBaseWidget("form-item"),{props:this.formItemProps,style:_objectSpread2(_objectSpread2(_objectSpread2({},this.layout.item||{}),this.layout.container||{}),{},{display:this.state.visible?"":"none"}),class:{"bk-schema-form-item--error":this.state.error}},[this.state.readonly&&"value"===this.readonlyMode?b:g,null===(s=(c=this.$scopedSlots).suffix)||void 0===s?void 0:s.call(c,{path:this.path,schema:this.schema}),this.removeable&&e("span",{class:["bk-schema-form-group-delete"],style:{right:"0px",top:"0px"},on:{click:function(){m.$emit("remove",m.path)}}},[e("i",{class:["bk-icon icon-close3-shape"]})]),this.state.error?e("p",{class:"bk-schema-form-item__error-tips"},this.errorTips):null,this.formItemProps.tips?e("p",{slot:"tip",class:["mt5","mb0","f12"],style:{color:"#5e6d82",lineHeight:"1.5em"}},this.formItemProps.tips):null])}}),_excluded$3=["name"],ObjectField=Vue__default.default.extend({name:"ObjectField",functional:!0,props:props,render:function(e,t){var n=t.props,i=n.schema,a=n.path,r=n.layout,o=n.rootData,s=orderProperties(Object.keys(i.properties||{}),i["ui:order"]),c=[];s.length?c=s.map((function(n){var o=Path.getCurPath(a,n),s=o.split(".").pop(),c=Layout.findLayoutByProp(s,r.group||[])||{};return e(SchemaField,_objectSpread2(_objectSpread2({},t.data),{},{key:o,props:_objectSpread2(_objectSpread2({},t.props),{},{schema:i.properties[n],required:Schema.isRequired(i,n),path:o,layout:c,removeable:!1})}))})):Schema.getUiComponent(i)&&(c=[e(Widget,_objectSpread2({},t.data))]);var l=Schema.getGroupWrap(i),u=l.name,d=_objectWithoutProperties(l,_excluded$3);return e(u,mergeDeep({props:_objectSpread2(_objectSpread2({},t.props),{},{value:Path.getPathVal(o,a),path:a}),style:_objectSpread2({},t.data.style||{}),on:_objectSpread2({},t.data.on||{})},d),_toConsumableArray(c))}}),StringField=Vue__default.default.extend({name:"StringField",functional:!0,props:props,render:function(e,t){return e(Widget,_objectSpread2({},t.data))}}),NumberField=Vue__default.default.extend({name:"NumberField",functional:!0,props:props,render:function(e,t){var n;return e(StringField,_objectSpread2(_objectSpread2({},t.data),{},{props:_objectSpread2(_objectSpread2({},t.props),{},{schema:mergeDeep({"ui:component":{props:{type:"number",min:"integer"===(null===(n=t.props.schema)||void 0===n?void 0:n.type)?0:-1/0}}},t.props.schema)}),on:_objectSpread2({},t.data.on||{})}))}}),_excluded$2=["name"],ArrayWidget=Vue__default.default.extend({name:"ArrayWidget",props:props,mounted:function(){this.handleFillItem()},methods:{handleFillItem:function(){var e=this.schema.minItems,t=void 0===e?0:e,n=this.value?this.value.length:0;if(n<t){var i=Schema.getSchemaDefaultValue(this.schema.items),a=new Array(t-n).fill(i);this.$emit("input",{path:this.path,value:[].concat(_toConsumableArray(this.value||[]),_toConsumableArray(a))})}},handleAddItem:function(){var e=Schema.getSchemaDefaultValue(this.schema.items),t=JSON.parse(JSON.stringify(this.value||[]));t.push(e),this.$emit("input",{path:this.path,value:t})},handleDeleteItem:function(e){var t=Number(Path.getPathLastProp(e)),n=JSON.parse(JSON.stringify(this.value||[]));n.splice(t,1),this.$emit("input",{path:this.path,value:n})}},render:function(e){var t=this,n=this,i=(Array.isArray(this.value)?this.value:[]).map((function(i,a){var r=Path.getCurPath(t.path,a);return e(SchemaField,{key:"".concat(r,"-").concat(t.value.length),props:_objectSpread2(_objectSpread2({},t.$props),{},{schema:t.schema.items,path:r,layout:_objectSpread2(_objectSpread2({},t.layout),{},{item:{}}),removeable:!0}),on:_objectSpread2(_objectSpread2({},t.$listeners),{},{remove:function(e){n.handleDeleteItem(e)}})})})),a=Schema.getGroupWrap(this.schema),r=a.name,o=_objectWithoutProperties(a,_excluded$2);return e(r,mergeDeep({props:_objectSpread2(_objectSpread2({},this.$props),{},{layout:{},showTitle:!0}),style:_objectSpread2({},this.layout.item||{})},o),[].concat(_toConsumableArray(i),[e(registry.getBaseWidget("form-item"),{class:{"bk-schema-form-item-auto-height":!0}},[e("span",{class:["bk-schema-form-group-add"],on:{click:function(){n.handleAddItem()}}},[e("i",{class:["bk-icon icon-plus-circle-shape mr5"]}),"添加"])])]))}}),_excluded$1=["name"],ArrayField=Vue__default.default.extend({name:"ArrayField",functional:!0,props:props,render:function(e,t){var n=t.props,i=n.schema,a=n.path;if(Schema.isMultiSelect(i)||Schema.isCustomArrayWidget(i))return e(Widget,_objectSpread2(_objectSpread2({},t.data),{},{key:a,props:_objectSpread2(_objectSpread2({},t.props),{},{schema:mergeDeep({"ui:component":{props:{multiple:!0}}},t.props.schema)})}));if(Schema.isTupleArray(i)){var r=Schema.getGroupWrap(i),o=r.name,s=_objectWithoutProperties(r,_excluded$1),c=i.items.map((function(n,i){return e(SchemaField,_objectSpread2(_objectSpread2({},t.data),{},{key:Path.getCurPath(a,i),props:_objectSpread2(_objectSpread2({},t.props),{},{schema:n,path:Path.getCurPath(a,i)})}))}));return e(o,mergeDeep({props:_objectSpread2(_objectSpread2({},t.props),{},{path:a,showTitle:!0})},s),_toConsumableArray(c))}return e(ArrayWidget,_objectSpread2({},t.data))}}),BooleanField=Vue__default.default.extend({name:"BooleanField",functional:!0,props:props,render:function(e,t){var n=(t.props.schema["ui:component"]||{}).name,i={};if(["radio","select"].includes(n))i={datasource:[{label:"False",value:!1},{label:"True",value:!0}]};else if("checkbox"===n){var a;i={label:null===(a=t.props.schema)||void 0===a?void 0:a.title}}return e(Widget,_objectSpread2(_objectSpread2({},t.data),{},{props:_objectSpread2(_objectSpread2({},t.props),{},{schema:mergeDeep({"ui:component":{props:i}},t.props.schema)})}))}}),_excluded=["name"],CompositionField=Vue__default.default.extend({name:"CompositionField",props:_objectSpread2(_objectSpread2({},props),{},{composition:{type:String,default:"oneOf",validator:function(e){return["oneOf","anyOf"].includes(e)}}}),data:function(){return{activeIndex:-1}},created:function(){var e=this,t=(this.schema[this.composition]||[]).findIndex((function(t){return ajv.validate(t,e.value)}));this.activeIndex=t>-1?t:0},render:function(e){var t,n=this,i=this.schema[this.composition]||[],a=i.map((function(e){var t=mergeDeep({},n.schema,e);return delete t[n.composition],t})),r=Schema.getUiProps("ui:".concat(this.composition),this.schema),o=r.name,s=void 0===o?"radio":o,c=_objectWithoutProperties(r,_excluded);if("object"!==_typeof(this.schema.type)&&a.every((function(e){return e.const})))return e(Widget,{props:_objectSpread2({},this.$props),scopedSlots:_objectSpread2({},this.$scopedSlots),on:_objectSpread2({},this.$listeners)});var l=_extends$1({},Schema.getUiProps("ui:composition",this.schema));return e(registry.getComponent("group"),mergeDeep({props:_objectSpread2(_objectSpread2({},this.$props),{},{rootData:this.rootData,schema:this.schema,value:Path.getPathVal(this.rootData,this.path),path:this.path}),on:{remove:function(){n.$emit("remove",n.path)}}},l),[e(registry.getBaseWidget("form-item"),{props:{label:null===(t=c.props)||void 0===t?void 0:t.title}},[e(registry.getComponent(s),mergeDeep({props:{value:this.activeIndex,datasource:a.map((function(e,t){return{label:e.title||"",value:t}}))},attrs:{clearable:!1},on:{input:function(e){if(n.activeIndex=e,isObj(n.value)){var t=JSON.parse(JSON.stringify(n.value));i.filter((function(e,t){return t!==n.activeIndex})).reduce((function(e,t){var n=t.properties,i=void 0===n?{}:n;return e.push.apply(e,_toConsumableArray(Object.keys(i))),e}),[]).forEach((function(e){delete t[e]})),n.$emit("input",{path:n.path,value:t})}}}},c||{}))]),e(SchemaField,{key:this.activeIndex,props:_objectSpread2(_objectSpread2({},this.$props),{},{removeable:!1,schema:a[this.activeIndex]}),scopedSlots:_objectSpread2({},this.$scopedSlots),on:_objectSpread2({},this.$listeners)})])}}),CheckboxWidget=Vue__default.default.extend({name:"CheckboxWidget",props:{datasource:{type:Array,default:function(){return[]}},value:{type:[Array,Boolean],default:function(){return[]}},label:{type:String,default:""}},methods:{handleChange:function(e){this.$emit("input",e)}},render:function(e){var t=this;return Array.isArray(this.value)?e(registry.getBaseWidget("checkbox-group"),{on:{change:this.handleChange},props:{value:this.value}},this.datasource.map((function(n){return e(registry.getBaseWidget("checkbox"),{key:n.value,class:["mr24"],props:_objectSpread2({value:n.value},t.$attrs)},n.label)}))):e(registry.getBaseWidget("checkbox"),{props:{value:this.value},on:{change:this.handleChange}},this.label)}}),SelectWidget=Vue__default.default.extend({name:"SelectWidget",props:{datasource:{type:Array,default:function(){return[]}},value:{type:[Array,String,Number,Boolean],default:""},loading:{type:Boolean,default:!1}},methods:{handleSelectChange:function(e){this.$emit("input",e)}},render:function(e){return e(registry.getBaseWidget("select"),{props:_objectSpread2({loading:this.loading,value:this.value},this.$attrs),on:{change:this.handleSelectChange}},this.datasource.map((function(t){return e(registry.getBaseWidget("option"),{key:t.value,props:{name:t.label,id:t.value,disabled:t.disabled},directives:[{name:"bk-tooltips",value:{content:t.tips,disabled:!t.tips,placement:"right",boundary:"window"}}]})})))}}),RadioWidget=Vue__default.default.extend({name:"RadioWidget",props:{datasource:{type:Array,default:function(){return[]}},value:{type:[String,Number,Boolean],default:""},disabled:{type:Boolean,default:!1}},methods:{handleChange:function(e){this.$emit("input",e)}},render:function(e){var t=this;return e(registry.getBaseWidget("radio-group"),{props:_objectSpread2({value:this.value},this.$attrs),on:{change:this.handleChange}},this.datasource.map((function(n){return e(registry.getBaseWidget("radio"),{key:n.value,class:["mr24"],props:{value:n.value,label:n.label,disabled:t.disabled},attrs:{disabled:t.disabled}},n.label)})))}}),ButtonWidget=Vue__default.default.extend({name:"ButtonWidget",props:{word:{type:String,default:""}},methods:{handleClick:function(){this.$emit("click")}},render:function(e){var t=this;return e(registry.getBaseWidget("button"),{props:_objectSpread2({},this.$attrs),on:{click:function(){t.handleClick()}}},this.word)}}),getRowDefaultData=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Object.keys(e),n={};return t.forEach((function(t){n[t]=Schema.getSchemaDefaultValue(e[t])})),[n]},TableWidget=Vue__default.default.extend({name:"TableWidget",props:props,methods:{handleCellValChange:function(e){var t=e.path,n=e.value,i=Path.getSubPath(this.path,t),a=Path.setPathValue(this.value,i,n);this.$emit("input",a)},handleAddRow:function(e){var t,n=this.value.slice(0);n.splice.apply(n,[e+1,0].concat(_toConsumableArray(getRowDefaultData(null===(t=this.$props.schema.items)||void 0===t?void 0:t.properties)))),this.$emit("input",n)},handleDelRow:function(e){var t=this.value.slice(0);t.splice(e,1),this.$emit("input",t)}},render:function(e){var t,n,i=this,a=this,r=this.$props,o=r.schema,s=r.readonly,c=r.readonlyMode,l=r.path,u=r.context,d=r.rootData,f=r.value,p=Object.keys((null===(t=o.items)||void 0===t?void 0:t.properties)||[]);return e(registry.getBaseWidget("table"),{props:_objectSpread2(_objectSpread2({},o["ui:component"].props||{}),{},{data:f}),on:{input:function(e){var t=e.path,n=e.value;a.$emit("input",{path:t,value:n})}},scopedSlots:{empty:function(){return i.readonly?null:e("div",{style:{color:"#3a84ff",cursor:"pointer"},on:{click:function(){a.handleAddRow(0)}}},"点击添加数据")}}},(n=p.map((function(t){var n=o.items.properties[t];return e(registry.getBaseWidget("table-column"),{props:{label:n.title},scopedSlots:{default:function(i){return e(SchemaField,{props:{context:u,rootData:d,readonly:s,readonlyMode:c,schema:mergeDeep(n,{"ui:props":{showTitle:!1,labelWidth:.1}}),path:Path.getCurPath(l,"".concat(i.$index,".").concat(t)),value:i.row[t]},on:{input:function(e){a.handleCellValChange(e)}}},[i.row])}}})})),i.readonly||n.push(e(registry.getBaseWidget("table-column"),{props:{label:"操作",width:100},scopedSlots:{default:function(t){return e("div",{class:"table-widget-actions"},[e("i",{class:"bk-icon icon-plus-circle action-btn",on:{click:function(){a.handleAddRow(t.$index)}}}),e("i",{class:"bk-icon icon-minus-circle action-btn",on:{click:function(){a.handleDelRow(t.$index)}}})])}}})),n))}}),FieldGroupWrap=Vue__default.default.extend({name:"FieldGroupWrap",props:_objectSpread2(_objectSpread2({},props),{},{type:{type:String,default:"default",validator:function(e){return["default","normal","card"].includes(e)}},showTitle:{type:Boolean,default:!1},border:{type:Boolean,default:!1},verifiable:{type:Boolean,default:!1},hideEmptyRow:{type:Boolean,default:!1}}),data:function(){return{groupErrorTips:{},state:{visible:!0}}},created:function(){widgetTree.addWidgetNode(this.path,this,"group")},mounted:function(){this.$forceUpdate()},beforeDestroy:function(){widgetTree.removeWidgetNode(this.path,this)},methods:{setState:function(e,t){Reflect.has(this.state,e)?this.state[e]=t:console.warn("Group unsupported ".concat(e," state, please check"))},setGroupErrorTips:function(e,t){this.$set(this.groupErrorTips,e,t)},removeGroupErrorTips:function(e){this.$delete(this.groupErrorTips,e)},clearGroupErrorTips:function(){this.groupErrorTips={}}},render:function(e){var t,n,i,a,r=this,o=_objectSpread2({position:"relative",border:this.border?"1px solid #dcdee5":"none",display:this.state.visible?"":"none"},(null===(t=this.layout)||void 0===t?void 0:t.item)||{}),s=_objectSpread2({},(null===(n=this.layout)||void 0===n?void 0:n.container)||{display:"grid",gridGap:"20px"}),c=this,l=(null===(i=this.schema)||void 0===i?void 0:i.title)||(null===(a=this.layout)||void 0===a?void 0:a.prop),u=Object.keys(this.groupErrorTips).map((function(t){return e("p",[r.groupErrorTips[t]])})),d="{}"!==JSON.stringify(this.groupErrorTips);return e("div",{class:["bk-schema-form-group",this.type,{"hide-empty-row":this.hideEmptyRow},{"bk-schema-form-group--error":d}],style:o},[l&&this.showTitle?e("span",{class:["bk-schema-form-group-title",this.type]},[l,d?e("span",{class:"bk-schema-form-group__error-tips"},[e("span",{class:"bk-schema-form-group__error-tips-popover"},[u])]):null]):null,e("div",{style:s,class:"bk-schema-form-group-content"},[this.$slots.default]),this.removeable&&e("span",{class:["bk-schema-form-group-delete"],style:{right:"10px",top:"10px"},on:{click:function(){c.$emit("remove",c.path)}}},[e("i",{class:["bk-icon icon-close3-shape"]})])])}});function _extends(){return(_extends=Object.assign||function(e){for(var t,n=1;n<arguments.length;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)}var normalMerge=["attrs","props","domProps"],toArrayMerge=["class","style","directives"],functionalMerge=["on","nativeOn"],mergeJsxProps=function(e){return e.reduce((function(e,t){for(var n in t)if(e[n])if(-1!==normalMerge.indexOf(n))e[n]=_extends({},e[n],t[n]);else if(-1!==toArrayMerge.indexOf(n)){var i=e[n]instanceof Array?e[n]:[e[n]],a=t[n]instanceof Array?t[n]:[t[n]];e[n]=i.concat(a)}else if(-1!==functionalMerge.indexOf(n))for(var r in t[n])if(e[n][r]){var o=e[n][r]instanceof Array?e[n][r]:[e[n][r]],s=t[n][r]instanceof Array?t[n][r]:[t[n][r]];e[n][r]=o.concat(s)}else e[n][r]=t[n][r];else if("hook"==n)for(var c in t[n])e[n][c]=e[n][c]?mergeFn(e[n][c],t[n][c]):t[n][c];else e[n]=t[n];else e[n]=t[n];return e}),{})},mergeFn=function(e,t){return function(){e&&e.apply(this,arguments),t&&t.apply(this,arguments)}},helper=mergeJsxProps,KeyValueArrayWidget=Vue__default.default.extend({name:"KeyValueArrayWidget",props:_objectSpread2({},props),mounted:function(){var e,t=this.schema.minItems,n=void 0===t?0:t;if((null===(e=this.value)||void 0===e?void 0:e.length)<n){var i=Schema.getSchemaDefaultValue(this.schema.items),a=new Array(n-this.value.length).fill(i);this.$emit("input",[].concat(_toConsumableArray(this.value),_toConsumableArray(a)))}},methods:{handleAddItem:function(){if(!this.disabled){var e=Schema.getSchemaDefaultValue(this.schema.items);this.$emit("input",[].concat(_toConsumableArray(this.value),[e]))}},handleRemoveItem:function(e){if(!this.disabled){var t=JSON.parse(JSON.stringify(this.value));t.splice(e,1),this.$emit("input",t)}},handleInput:function(e){var t=e.path,n=e.value,i=Path.getSubPath(this.path,t),a=Path.setPathValue(this.value,i,n);this.$emit("input",a)}},render:function(e){var t,n,i,a,r,o=this,s={"font-size":"16px",color:"#979ba5",cursor:this.disabled?"not-allowed":"pointer",display:"inline-block"},c=null===(t=this.schema)||void 0===t||null===(n=t.items)||void 0===n?void 0:n.properties,l=orderProperties(Object.keys(c||{}),null===(i=this.schema)||void 0===i||null===(a=i.items)||void 0===a?void 0:a["ui:order"]),u=Object.keys(c||{}).length,d=c?new Array(u).fill("1fr").concat("20px").join(" "):"1fr 20px",f=_objectSpread2({},this.layout.container||{display:"grid",gridGap:"20px","grid-template-columns":d}),p=this,m=function(e){return mergeDeep({"ui:component":{props:{placeholder:e.title}},"ui:props":{showTitle:!1,labelWidth:.1}},e)},h=function(t){var n=t.path,i=t.schema,a=t.required,r=t.layout;return e(SchemaField,{key:n,props:_objectSpread2(_objectSpread2({},o.$props),{},{schema:i,required:a,path:n,layout:r}),on:{input:function(e){p.handleInput(e)}},style:{marginBottom:"10px"}})};return e("div",[null===(r=this.value)||void 0===r?void 0:r.map((function(t,n){var i,a=Path.getCurPath(o.path,"".concat(n));return e(FieldGroupWrap,helper([{},{props:_objectSpread2(_objectSpread2({},o.$props),{},{path:a,value:Path.getPathVal(o.rootData,a),schema:o.schema.items,layout:_objectSpread2(_objectSpread2({},o.layout),{},{container:_objectSpread2({},f)})})}]),[null!=l&&l.length?l.map((function(e){var t,i,a=null===(t=o.schema)||void 0===t||null===(i=t.items)||void 0===i?void 0:i.properties[e],r=Path.getCurPath(o.path,"".concat(n,".").concat(e)),s=r.split(".").pop(),c=Layout.findLayoutByProp(s,o.layout.group||[])||{};return h({path:r,schema:m(a),layout:c,required:Schema.isRequired(a,e)})})):h({path:Path.getCurPath(o.path,n),schema:m((null===(i=o.schema)||void 0===i?void 0:i.items)||{}),layout:{},required:!1}),e("span",{style:s,on:{click:function(){return o.handleRemoveItem(n)}}},[e("i",{class:"bk-icon icon-minus-line"})])])})),e("span",{on:{click:this.handleAddItem},style:s},[e("i",{class:"bk-icon icon-plus-line"})])])}}),TabGroupWidget=Vue__default.default.extend({name:"TabWidget",props:_objectSpread2(_objectSpread2({},props),{},{type:{type:String,default:"default",validator:function(e){return["default","normal","card"].includes(e)}},showTitle:{type:Boolean,default:!1},border:{type:Boolean,default:!1},verifiable:{type:Boolean,default:!1}}),render:function(e){var t,n=this,i=_objectSpread2(_objectSpread2({},this.$props),{},{layout:_objectSpread2(_objectSpread2({},this.layout),{},{container:{}}),title:this.schema.title}),a=this,r=orderProperties(Object.keys((null===(t=this.schema)||void 0===t?void 0:t.properties)||{}),this.schema["ui:order"]);return e(FieldGroupWrap,{props:_objectSpread2({},i),on:{remove:function(e){a.$emit("remove",e)}}},[e(registry.getBaseWidget("tab"),{},r.map((function(t){var i,a,r=null===(i=n.schema)||void 0===i||null===(a=i.properties)||void 0===a?void 0:a[t],o=Path.getCurPath(n.path,t),s=o.split(".").pop(),c=Layout.findLayoutByProp(s,n.layout.group||[])||{};return e(registry.getBaseWidget("tab-panel"),{key:t,props:{name:t,label:null==r?void 0:r.title}},[e(SchemaField,{key:o,props:_objectSpread2(_objectSpread2({},n.$props),{},{schema:r,required:Schema.isRequired(r,t),path:o,layout:c,removeable:!1}),on:_objectSpread2({},n.$listeners)})])})))])}}),CollapseGroupWidget=Vue__default.default.extend({name:"CollapseWidget",props:_objectSpread2(_objectSpread2({},props),{},{type:{type:String,default:"default",validator:function(e){return["default","normal","card"].includes(e)}},showTitle:{type:Boolean,default:!1},border:{type:Boolean,default:!1},defaultActiveName:{type:Array,default:function(){return[]}},verifiable:{type:Boolean,default:!1}}),data:function(){return{activeName:this.defaultActiveName}},render:function(e){var t,n=this,i={background:"#f5f7fa","border-radius":"2px",padding:"0 14px",height:"100%",display:"flex","align-items":"center"},a={"font-size":"16px",display:"inline-block",transition:"all 0.5s ease"},r=_objectSpread2(_objectSpread2({},this.$props),{},{layout:_objectSpread2(_objectSpread2({},this.layout),{},{container:{}}),title:this.schema.title}),o=orderProperties(Object.keys((null===(t=this.schema)||void 0===t?void 0:t.properties)||{}),this.schema["ui:order"]).map((function(t){var r,o,s=null===(r=n.schema)||void 0===r||null===(o=r.properties)||void 0===o?void 0:o[t],c=Path.getCurPath(n.path,t),l=c.split(".").pop(),u=Layout.findLayoutByProp(l,n.layout.group||[])||{};return e(registry.getBaseWidget("collapse-item"),{key:t,props:{hideArrow:!0,name:t},class:["mb15"]},[e("div",{style:i},[e("i",{class:["bk-icon icon-down-shape mr5"],style:_objectSpread2(_objectSpread2({},a),{},{transform:n.activeName.includes(t)?"rotate(0deg)":"rotate(-90deg)"})}),s.title]),e("template",{slot:"content"},[e(SchemaField,{key:c,props:_objectSpread2(_objectSpread2({},n.$props),{},{schema:s,required:Schema.isRequired(s,t),path:c,layout:u,removeable:!1}),on:_objectSpread2({},n.$listeners)})])])})),s=this;return e(FieldGroupWrap,{props:_objectSpread2({},r)},[e(registry.getBaseWidget("collapse"),{style:{},props:{value:this.activeName},on:{input:function(e){s.activeName=e}}},o)])}}),SwitcherWidget=Vue__default.default.extend({name:"SwitchWidget",props:{value:Boolean},methods:{handleChange:function(e){this.$emit("input",e)}},render:function(e){return e(registry.getBaseWidget("switcher"),{props:_objectSpread2({value:this.value},this.$attrs),on:{change:this.handleChange}})}}),ColorWidget=Vue__default.default.extend({name:"ColorPicker",props:{value:String},methods:{handleChange:function(e){this.$emit("input",e)}},render:function(e){return e(registry.getBaseWidget("color-picker"),{props:_objectSpread2({value:this.value},this.$attrs),on:{change:this.handleChange}})}}),InputWidget=Vue__default.default.extend({name:"InputWidget",props:{value:[String,Number],unit:{type:String,default:""},maxRows:{type:Number,default:0}},computed:{rows:function(){var e=String(this.value).split("\n").length;return e<=this.maxRows?e:this.maxRows}},methods:{handleInput:function(e){"number"===this.$attrs.type?this.$emit("input",isNaN(e)||""===e?e:Number(e)):this.$emit("input",e)},handleBlur:function(e){"number"===this.$attrs.type&&isNaN(e)&&this.$emit("input",this.$attrs.min||0)}},render:function(e){return e(registry.getBaseWidget("input"),{props:_objectSpread2({value:this.value,rows:this.rows,type:this.maxRows>1||Number(this.$attrs.rows)>1?"textarea":"text"},this.$attrs),on:{input:this.handleInput,blur:this.handleBlur},class:["bk-form-unit-input"]},[this.unit&&e("div",{slot:"append",class:["group-text"]},this.unit)])}});function styleInject(e,t){void 0===t&&(t={});var n=t.insertAt;if(e&&"undefined"!=typeof document){var i=document.head||document.getElementsByTagName("head")[0],a=document.createElement("style");a.type="text/css","top"===n&&i.firstChild?i.insertBefore(a,i.firstChild):i.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e))}}var css_248z="";styleInject(css_248z);var defaultOptions={namespace:"bk",components:{button:ButtonWidget,select:SelectWidget,radio:RadioWidget,checkbox:CheckboxWidget,table:TableWidget,group:FieldGroupWrap,bfArray:KeyValueArrayWidget,tab:TabGroupWidget,collapse:CollapseGroupWidget,switcher:SwitcherWidget,color:ColorWidget,bfInput:InputWidget,input:"bk-input"},fields:{object:ObjectField,string:StringField,any:"",array:ArrayField,boolean:BooleanField,null:"",integer:NumberField,number:NumberField,composition:CompositionField}};function createForm(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=mergeDeep(defaultOptions,e),n=t.namespace,i=t.components,a=t.fields,r=t.baseWidgets,o=void 0===r?{}:r;return Registry.namespace=n,registry.addComponentsMap(i),registry.addFieldsMap(a),registry.addBaseWidgets(o),Vue__default.default.extend({name:"BkuiForm",props:props$1,data:function(){return{rootData:{},formKey:"bk-ui-form"}},watch:{schema:function(e,t){JSON.stringify(e)!==JSON.stringify(t)&&(this.validateSchema(this.schema),this.initFormData(),this.formKey="bk-ui-form-".concat((new Date).getTime()))},context:{handler:function(e){Registry.context=e,hasOwnProperty(e,"rules")&&registryGlobalRules(e.rules)},immediate:!0},rules:{immediate:!0,handler:function(e){registryGlobalRules(e)}},value:function(){this.initFormData()}},beforeCreate:function(){registryGlobalRules(DEFAULT_RULES)},created:function(){this.validateSchema(this.schema),this.initFormData()},methods:{initFormData:function(){this.rootData=merge(Schema.getSchemaDefaultValue(createProxy(this.schema,this))||{},this.value),this.emitFormValueChange(this.rootData,this.value)},emitFormValueChange:function(e,t){deepEquals(e,t)||(this.rootData=e,this.$emit("input",e),this.$emit("change",e,t))},validateForm:validateForm,validateFormItem:validateFormItem,validate:validateFormWithResult,validateSchema:validateSchema},render:function(e){var t=this;return e(registry.getBaseWidget("form"),{ref:"bkui-form",key:this.formKey,props:{model:this.value,formType:this.formType,labelWidth:this.labelWidth},class:{"bk-schema-form":!0},style:{width:"number"==typeof this.width?"".concat(this.width,"px"):this.width}},[e(SchemaField,{props:_objectSpread2(_objectSpread2({},this.$props),{},{schema:createProxy(this.schema,this),rootData:this.rootData,value:this.value,layout:new Layout(this.layout).layout}),scopedSlots:_objectSpread2({},this.$scopedSlots),on:{input:function(e){var n=e.path,i=void 0===n?"":n,a=e.value;if(i){var r=Path.setPathValue(t.rootData,i,a);t.emitFormValueChange(r,t.value)}else t.emitFormValueChange(a,t.value)}}})])}})}Vue__default.default.config.devtools=!1,exports.Schema=Schema,exports.default=createForm,exports.events=events,Object.defineProperty(exports,"__esModule",{value:!0})},factory(exports,__webpack_require__("oCYn"))}).call(this,__webpack_require__("yLpj"))},s4tT:function(e,t,n){"use strict";n.r(t);var i=n("/JtJ"),a=n("b/Aw");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("/m8X");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"b8a5ec4c",null);t.default=s.exports},s8s0:function(e,t,n){"use strict";n.r(t);var i=n("5ghl"),a=n("u3L/");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("hocR");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"2746f443",null);t.default=s.exports},sAov:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-basic-node"},[t("basic-card",{attrs:{"card-label":e.$t("m.treeinfo['基本信息']")}},[t("bk-form",{attrs:{"data-test-id":"service-form-autoNode","label-width":150,model:e.formInfo,"form-type":"vertical"}},[t("bk-form-item",{attrs:{"data-test-id":"autoNode-input-nodeName",label:e.$t("m.treeinfo['节点名称：']"),required:!0}},[t("bk-input",{attrs:{"ext-cls":"bk-form-width",maxlength:"120"},model:{value:e.formInfo.name,callback:function(t){e.$set(e.formInfo,"name",t)},expression:"formInfo.name"}})],1),e._v(" "),t("desc-info",{model:{value:e.formInfo.desc,callback:function(t){e.$set(e.formInfo,"desc",t)},expression:"formInfo.desc"}}),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"autoNode-select-apiInterface",label:e.$t("m.treeinfo['API接口']"),required:!0}},[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",clearable:!1,placeholder:e.$t("m.treeinfo['请选择接入系统']"),searchable:""},on:{selected:e.changeCode},model:{value:e.formInfo.api_info.remote_system_id,callback:function(t){e.$set(e.formInfo.api_info,"remote_system_id",t)},expression:"formInfo.api_info.remote_system_id"}},e._l(e.apiSysList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),e.formInfo.api_info.remote_system_id?[t("bk-select",{attrs:{"ext-cls":"bk-form-width bk-form-display",loading:e.isLoading,clearable:!1,searchable:""},on:{selected:e.changeMethod},model:{value:e.formInfo.api_info.remote_api_id,callback:function(t){e.$set(e.formInfo.api_info,"remote_api_id",t)},expression:"formInfo.api_info.remote_api_id"}},e._l(e.apiList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]:e._e()],2),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"autoNode-select-processor",label:e.$t("m.treeinfo['处理人：']"),required:!0}},[t("div",{on:{click:function(t){e.checkStatus.processors=!1}}},[t("deal-person",{ref:"processors",attrs:{value:e.processorsInfo,"show-overbook":!0,"node-info":e.configur,"exclude-role-type-list":e.excludeRoleTypeList}})],1)])],1)],1),e._v(" "),e.formInfo.api_info.remote_api_id?[t("basic-card",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],attrs:{"card-label":e.$t("m.treeinfo['输入参数']"),"card-desc":e.$t("m.treeinfo['调用该API需要传递的参数信息']")}},[e.apiDetail.req_params&&e.apiDetail.req_params.length&&e.apiDetail.req_params[0].name?t("div",{staticClass:"bk-param"},[t("get-param",{ref:"getParam",attrs:{"change-info":e.configur,"state-list":e.stateList,"api-detail":e.apiDetail},on:{addNewItem:e.addNewItem}})],1):e._e(),e._v(" "),e.apiDetail.req_body&&Object.keys(e.apiDetail.req_body).length&&e.apiDetail.req_body.properties&&Object.keys(e.apiDetail.req_body.properties).length?t("div",{staticClass:"bk-param"},[t("post-param",{ref:"postParam",attrs:{"change-info":e.configur,"state-list":e.stateList,"api-detail":e.apiDetail},on:{addNewItem:e.addNewItem}})],1):e._e()]),e._v(" "),t("basic-card",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],attrs:{"card-label":e.$t("m.treeinfo['返回数据']"),"card-desc":e.$t("m.treeinfo['调用成功后API将会返回的参数信息']")}},[t("div",{staticClass:"bk-param"},[e.apiDetail.rsp_data&&Object.keys(e.apiDetail.rsp_data).length&&e.apiDetail.rsp_data.properties&&Object.keys(e.apiDetail.rsp_data.properties).length?t("response-data-node",{ref:"responseDataNode",attrs:{"change-info":e.configur,"state-list":e.stateList,"api-detail":e.apiDetail}}):e._e()],1)]),e._v(" "),t("basic-card",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isLoading},expression:"{ isLoading: isLoading }"}],attrs:{"card-label":e.$t("m.treeinfo['轮询配置']"),"card-desc":e.$t("m.treeinfo['当出现异常时，设置重试及结束的条件']")}},[t("nodeCondition",{attrs:{"form-info":e.formInfo,"line-info":e.lineInfo}})],1)]:e._e(),e._v(" "),t("basic-card",[t("bk-sideslider",{attrs:{"is-show":e.sliderInfo.show,title:e.sliderInfo.title,width:e.sliderInfo.width},on:{"update:isShow":function(t){return e.$set(e.sliderInfo,"show",t)},"update:is-show":function(t){return e.$set(e.sliderInfo,"show",t)}}},[e.sliderInfo.show?t("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},[t("add-field",{attrs:{"change-info":e.changeInfo,"sosp-info":e.showTabData,workflow:e.flowInfo.id,state:e.configur.id},on:{getRelatedFields:e.getRelatedFields,closeShade:e.closeShade}})],1):e._e()]),e._v(" "),t("common-trigger-list",{attrs:{origin:"state","node-type":e.configur.type,"source-id":e.flowInfo.id,sender:e.configur.id,table:e.flowInfo.table}}),e._v(" "),t("div",{staticClass:"mt20",staticStyle:{"font-size":"0"}},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"autoNode-button-submit",title:e.$t("m.treeinfo['确定']"),loading:e.secondClick,disabled:!e.formInfo.api_info.remote_api_id},on:{click:e.submitNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['确定']"))+"\n      ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"autoNode-button-close",title:e.$t("m.treeinfo['取消']")},on:{click:e.closeNode}},[e._v("\n        "+e._s(e.$t("m.treeinfo['取消']"))+"\n      ")])],1)],1)],2)},a=[];i._withStripped=!0},sHh5:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return e.item.showFeild?t("div",[t("bk-form-item",{attrs:{label:e.item.name,required:"REQUIRE"===e.item.validate_type,desc:e.item.tips,"desc-type":"icon"}},[t("bk-select",{class:{"bk-border-error":e.item.checkValue},attrs:{searchable:"","search-with-pinyin":!0,disabled:e.item.is_readonly&&!e.isCurrent||e.disabled,placeholder:e.item.desc,"font-size":"medium"},on:{selected:e.selected,toggle:function(t){e.item.checkValue=!1}},model:{value:e.item.val,callback:function(t){e.$set(e.item,"val",t)},expression:"item.val"}},[e._l(e.options,(function(n){return t("bk-option",{key:n.key,staticClass:"custom-option",attrs:{id:n.key,name:n.name}},[t("span",[e._v(e._s(n.name))]),e._v(" "),n.can_delete?t("i",{staticClass:"bk-icon icon-close",on:{click:function(t){return t.stopPropagation(),e.handleDeleteOption(n.key)}}}):e._e()])})),e._v(" "),t("div",{attrs:{slot:"extension"},slot:"extension"},[t("div",{staticClass:"plus-content",on:{click:function(t){e.addStatus=!e.addStatus}}},[t("i",{staticClass:"bk-icon icon-plus-circle"}),e._v("新增\n        ")]),e._v(" "),e.addStatus?t("div",{staticClass:"add-status"},[t("bk-form-item",{attrs:{label:"name"}},[t("bk-input",{on:{blur:e.giveDefaultKey},model:{value:e.tempChoice.name,callback:function(t){e.$set(e.tempChoice,"name",t)},expression:"tempChoice.name"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:"key"}},[t("bk-input",{model:{value:e.tempChoice.key,callback:function(t){e.$set(e.tempChoice,"key",t)},expression:"tempChoice.key"}})],1),e._v(" "),t("p",{staticClass:"operations"},[t("span",{class:{disabled:!e.tempChoice.name},on:{click:e.confirmAdd}},[e._v(e._s(e.$t("m.task['确认']")))]),e._v(" "),t("span",{on:{click:e.cancelAdd}},[e._v(e._s(e.$t("m.task['取消']")))])])],1):e._e()])],2),e._v(" "),e.item.checkValue?[e.item.checkMessage?t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.checkMessage))]):t("p",{staticClass:"bk-task-error"},[e._v(e._s(e.item.name)+e._s(e.$t('m.newCommon["为必填项！"]')))])]:e._e()],2)],1):e._e()},a=[];i._withStripped=!0},sJ3n:function(e,t,n){"use strict";n("lNfD")},sRDs:function(e,t,n){"use strict";n.r(t);var i=n("OkDz"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},serL:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"paramsTable",props:{list:{type:Array,defalut:function(){return[]}},disable:{type:Boolean,default:function(){return!1}},stateList:Array,isStatus:{type:Boolean,default:function(){return!0}}},data:function(){return{formData:[],wwwFormData:[],curCulum:"",curIndex:"",filterParams:""}},computed:{isShowDelete:function(){return this.list.length-1},isShowSelect:function(){return 0===this.wwwFormData.length||""===this.filterParams}},watch:{list:{handler:function(e){var t=this;this.isStatus&&e.forEach((function(e,n){""===e.value&&t.$nextTick((function(){t.$refs["inputParam"+n].hideHandler()}))}))},immediate:!0,deep:!0},wwwFormData:{handler:function(e){var t=this;if(0===e.length&&this.isStatus)for(var n=function(e){t.$nextTick((function(){t.$refs["inputParam"+e].hideHandler()}))},i=0;i<this.list.length;i++)n(i)},immediate:!0}},mounted:function(){var e=this;if(0!==this.list.length&&this.isStatus)for(var t=function(t){e.$nextTick((function(){e.$refs["inputParam"+t].hideHandler()}))},n=0;n<this.list.length;n++)t(n)},methods:{changeTab:function(e){this.acticeTab=e.key},handleDelete:function(e){var t=this.list.indexOf(e);-1!==t&&this.list.splice(t,1)},handleSelectContent:function(e){this.list[this.curIndex].value=this.list[this.curIndex].value.slice(0,-(this.filterParams.length+2))+"{{ "+e.key+"}}",this.$refs["inputParam"+this.curIndex].hideHandler(),this.filterParams="",this.wwwFormData=[]},changeInput:function(e,t){var n=this;if(this.isStatus){var i=e.value.lastIndexOf("{{");if(this.curIndex="",-1!==i){this.$refs["inputParam"+t].showHandler();var a=e.value.substring(i+2,e.value.length)||"";this.filterParams=a||"",this.wwwFormData=this.stateList.filter((function(e){return-1!==e.name.indexOf(n.filterParams)||-1!==e.key.indexOf(n.filterParams)})),this.curIndex=t}else this.$refs["inputParam"+t].hideHandler();this.curCulum=e}(this.$emit("changeFormStatus",!1),e.check)?[e.key,e.value,e.desc].every((function(e){return""===e}))&&(this.list.pop(),e.check=!1,e.select=!1):(e.check=!0,e.select=!0,this.list.push({check:!1,key:"",value:"",desc:"",select:!1}))}}}},sjGJ:function(e,t,n){"use strict";n.r(t);var i=n("HksE"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},sshH:function(e,t,n){"use strict";n.r(t);var i=n("PGA1"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"t9X+":function(e,t,n){var i={"./cascade.vue":"gy7N","./checkbox.vue":"/KdC","./complexMembers.vue":"g9b+","./customForm.vue":"IDfM","./customtable.vue":"Wl5c","./date.vue":"nxpg","./datetime.vue":"eOfU","./devopsTemplate.vue":"SUIt","./editor.vue":"0njq","./file.vue":"070I","./inputSelect.vue":"VrAx","./int.vue":"Za/z","./link.vue":"jub7","./member.vue":"MBfY","./members.vue":"/Hw/","./multiselect.vue":"4K0D","./radio.vue":"TNjk","./select.vue":"qyUP","./sopsTemplate.vue":"aYIO","./string.vue":"z1yn","./table.vue":"Q3ZP","./text.vue":"u14n","./tree.vue":"+QRE"};function a(e){var t=r(e);return n(t)}function r(e){if(!n.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=r,e.exports=a,a.id="t9X+"},t9cD:function(e,t,n){"use strict";n.r(t);var i=n("5/Zn"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},tEH6:function(e,t,n){},tNV3:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFsAAAA5CAYAAABZClfIAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMDY3IDc5LjE1Nzc0NywgMjAxNS8wMy8zMC0yMzo0MDo0MiAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKFdpbmRvd3MpIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkU1NzFFNzcxRjUzQzExRTdBMkU1QUQxMkE2RTNCRDUwIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkU1NzFFNzcyRjUzQzExRTdBMkU1QUQxMkE2RTNCRDUwIj4gPHhtcE1NOkRlcml2ZWRGcm9tIHN0UmVmOmluc3RhbmNlSUQ9InhtcC5paWQ6RTU3MUU3NkZGNTNDMTFFN0EyRTVBRDEyQTZFM0JENTAiIHN0UmVmOmRvY3VtZW50SUQ9InhtcC5kaWQ6RTU3MUU3NzBGNTNDMTFFN0EyRTVBRDEyQTZFM0JENTAiLz4gPC9yZGY6RGVzY3JpcHRpb24+IDwvcmRmOlJERj4gPC94OnhtcG1ldGE+IDw/eHBhY2tldCBlbmQ9InIiPz5558DUAAAHDUlEQVR42uycS2wbVRSGj9/vxInfsRMnsZu6DVBUXhIEVWwQgg1s6AYkBGIBEkVl1RXqigUgFq0qVNHCBpCg6mPBAomKDWyQAInSiDRJEzuOHceJ83BiO3H84Py3TpqWksaJp4md+aWra8+MZ3w/nznnzLkzVpTLZdqufv1z4Ch3x7gd4maixlCG21/cPu07HLpcix0qfvnjn/tuxAfbCPQp7t5raTKR1WIilUrZEKSLpRLNLWRpdn4Rb0899UjP+/faTqPe/HjV27TotwA60O4ij6OFGk1eZytNTM3Szejksd+uDQ4w8M+3s7+7Ya/6FMUmQD/B3Rm33Upo45Mpmpyep9xyvu4hK3j0ep2W3DYrtTlbKLuUB/TTDHyYgf9UK9ibtWgHdxctJr0OVj0wEqOZdIYcLU3kYvAKhaKuYSOOZXLLFI5PUTqTo1CXl5aW86rZdOYCA3+Ggfc/ENgMWsXddxq1qj3U7aNYcoZS7Nf28xeCz24ktTSZaSgSo7HEtBjf34ORZv4RrjDwpxn4VLX7U1ZcR3mdC6H/Wbaqj9lwnwt1eymfL1AkPs3+urXhQN+CbSKfy07RiWmaX8jQATYuNrIgzmoGrt0K7Gqs+lXuPuj0Osls0NON0RiZDDpqd9uoUdXGQbK12UyDkQkqlUt0MOCDm3yWV53bCmzFukbrAuQdyxj0Q9x9ZWe/jCg9PJaglWKRAh2euvfR91N3u5u0Gg39czNGBr2OevweLH6drftEzS2bQTdzd5mt2Njjd9Nkap6mZtPU5XWRXquhRpdKqaSezjbKFwo0GI6To7WJfLfO5o+Yzcu1hA2z/UatUgUPsJ9eZj89Ep0UmYfNaqG9IhhVkM/i2fQijbEP72xzkN1qEWwY+GNbga24R479IbeX9nd6SMsHHBiNk0ajJvjtvSYkAV4OmICdmltga/eQxWQw8qorDNx3X6vdqDbCO3iRux86PHYFN2HRiek5OhjsEIFxr2ooEqf5xSwd2t8pyhPXBsK0vFL4nVcd6TscylbtRhg0UpxvORIL0DOcS8f50rWdX+9l0LcDppoD5rjw5weDPlIqlY/zqq+Zm6Iq2PwBnBqXDDptswgMKwWR+lg573TbW2ivSwRM/+2AaeI0ONTVhlWvIGhWa9lf8g4fRkDEjm/wDpWc3gV8bpJVCZg67R0BE7k4gibrBBvra5uCzRse5+7oPs4ljewuUGBKs38K8KmjVqvqDgq+v6QB02lbC5hIB102ZMl0njn2bQibNzjC3Se4aLG3WEQRZmxiSlyON5mNdQd6MbtEMYaNXip5XTZh1UPsZlEdDHa4qdlixKX8pUrc+y/sSupygTdUIa0r8NXhDU7zzAYD+Vz1dTle4gwLRtI/PCbeo4/Ep8RySQImu1dNJWCWSmVRJWQ3A59yuXJBeBs2L8AvcVGn1TiwIa6+oxMpATzAv1S9XY4jvnR4HNTLKSqE3s/+VCnROJD+IWBy+kfRRArFKuoN+EitUqLE8X2lUrpWYj3DX+RJBERNxS/DBxn1OpFPViOL0UAGvXZXQDcb9eI0R1+NcuwOFrK5qo9n5HGDW6fXIRigBM1n1fN8Qp3m1e9iDvINFJj2+d3s3K1rH0ShCTWQaieE4YLW76ceNZmao3AsWfXn4AE8divn4a61ZRNTc3QzmsDLN2HZJ8UMy12A4OjRqhGfLg2V3m000b1ZeRxWWshkKTmTPgmf7a/HTKOeZDEJvh1KGcUDDNwyAhm2DFuWDFuGLUuGLcOWYcva3bBRG0CJsd6FMWCGalfDRnVtcQvVst0mjMEowaR2TWGjoDWbzojbbetV2aVlMQaMZVfDdjusoqY7GI5Rtg6B4ztjthxjwFhqLXVNfzn22b3BduofHqfrw2Pilluz0bDrn7MpFkvCdcCiARpjkGJWR13rHeLmlUdDflE0T87MiwlXPAy0m4VgiJmVLq9T1J+lmgZUS7FTfFk8i4ImS86zZdgybFky7HqUeicPjtskRmNJzDxToVCUdqAqFTltTSLj2KmbjnYUNkDPL+ao0+cWMKQU7u6aSKbEo4S4iWbPuRFYtMdpkxz0qmXjWInUnOyz5QApsZytTZRIzohTXGohJuBY7h28NQ4+O18ql3bkTkgEK/jtcDQhOfDVAOlvsz/wceLJYNYiYI/klvKhnYCNrKDb5xKtkYW7YlkRuJEf8W8x5XKZZEmT3lb+jecqYJ9fXikU8XyjrNoL/8QDvvzynLLvcOg6vzg7Mp6s+sZ3WRsLPEdj4m9JzoLzajZynM39av9QlOIcsWWXsn3XEU/OEnjy65/BV8SoVbCV52o+4/aOVqNW4gkoFNSlmGVuVGGSBMEQT0PnVwpIQb4AaLbq3B2wV8XQe7l7m9sL3Lq5aWSMmxb+CzCMYAgfXXHRa/pXgAEAdjq+qfD3Of4AAAAASUVORK5CYII="},tPsg:function(e,t,n){"use strict";n("Wew5")},tQ05:function(e,t,n){"use strict";n.r(t);var i=n("u0fD"),a=n("Abqk");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("sJ3n");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"c3012aea",null);t.default=s.exports},tWYx:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=v(n("4d7F")),a=v(n("P2sY")),r=v(n("gDS+")),o=v(n("14Xm")),s=v(n("D3Ub")),c=n("CeR/"),l=v(n("PaSM")),u=n("ygAv"),d=v(n("db1v")),f=v(n("SAMo")),p=v(n("a6LX")),m=v(n("O4mU")),h=v(n("EstQ"));function v(e){return e&&e.__esModule?e:{default:e}}var g=[{name:h.default.t("m['单行文本']"),icon:"icon-apps",type:"STRING"},{name:h.default.t("m['多行文本']"),icon:"icon-apps",type:"TEXT"},{name:h.default.t("m['数字']"),icon:"icon-apps",type:"INT"},{name:h.default.t("m['日期']"),icon:"icon-apps",type:"DATE"},{name:h.default.t("m['时间']"),icon:"icon-apps",type:"DATETIME"},{name:h.default.t("m['表格']"),icon:"icon-apps",type:"TABLE"},{name:h.default.t("m['单选下拉框']"),icon:"icon-apps",type:"SELECT"},{name:h.default.t("m['可输入单选下拉框']"),icon:"icon-apps",type:"INPUTSELECT"},{name:h.default.t("m['多选下拉框']"),icon:"icon-apps",type:"MULTISELECT"},{name:h.default.t("m['复选框']"),icon:"icon-apps",type:"CHECKBOX"},{name:h.default.t("m['单选框']"),icon:"icon-apps",type:"RADIO"},{name:h.default.t("m['单选人员选择']"),icon:"icon-apps",type:"MEMBER"},{name:h.default.t("m['多选人员选择']"),icon:"icon-apps",type:"MEMBERS"},{name:h.default.t("m['富文本']"),icon:"icon-apps",type:"RICHTEXT"},{name:h.default.t("m['附件上传']"),icon:"icon-apps",type:"FILE"},{name:h.default.t("m['自定义表格']"),icon:"icon-apps",type:"CUSTOMTABLE"},{name:h.default.t("m['树形选择']"),icon:"icon-apps",type:"TREESELECT"},{name:h.default.t("m['链接']"),icon:"icon-apps",type:"LINK"},{name:h.default.t("m['自定义表单']"),icon:"icon-apps",type:"CUSTOM-FORM"}],y=[{name:h.default.t("m['选择推荐服务模板']"),key:"recom",icon:"icon-apps"},{name:h.default.t("m['从已有的服务复制']"),key:"created",icon:"icon-apps"},{name:h.default.t("m['自定义表单']"),key:"custom",icon:"icon-apps"}];t.default={name:"ServiceFormStep",components:{SelectTree:d.default,ServiceForm:f.default,ChooseServiceTemplateDialog:p.default,FormEditItem:m.default},mixins:[l.default],props:{type:{type:String,default:"new"},serviceId:{type:[String,Number],default:""},serviceInfo:{type:Object,default:function(){return{}}},createTicketNodeId:Number},data:function(){return{isCreateService:!1,fieldsLibrary:g,serviceFormCreateWays:y,publicFields:[],isSubmitting:!1,isDropdownShow:!1,showFieldOption:!1,isBasicFormEditting:!0,isShowChooseSerTempDialog:!1,currCreateFormWay:{},ticketNodeForm:[],ticketNodeDetail:{},formLoading:!1,detailLoading:!1,crtForm:"",active:"library-fields",formData:{name:"",desc:"",key:"",catalog_id:""},rules:{},dirList:[],serviceTypeList:[],pending:{deleteField:!1,saveField:!1},serviceTemplateDisable:!1,isShowField:!1,isShowRightEdit:!1,addFieldStatus:!0,dragLine:{base:0,move:0,startX:null,maxLength:0,canMove:!1},fieldIndex:"",fieldlist:[],fieldsLibrarylist:g,servcieList:[]}},computed:{catalogDisplayName:function(){return this.serviceInfo.bounded_catalogs?this.serviceInfo.bounded_catalogs.join("/"):""}},watch:{isBasicFormEditting:{handler:function(e){e&&this.getServiceDirectory()},immediate:!0}},created:function(){var e=[{required:!0,message:this.$t('m.treeinfo["字段必填"]'),trigger:"blur"},{validator:this.handleRepeatServiceName,message:this.$t("m['服务名称重复，请重新输入']"),trigger:"blur"}];this.rules.name=e,this.rules.directory_id=this.checkCommonRules("required").required,this.rules.key=this.checkCommonRules("required").required,this.showFieldOption="edit"===this.type&&!!this.serviceInfo.source,this.isBasicFormEditting="new"===this.type,this.serviceTemplateDisable=""!==this.serviceId},mounted:function(){var e=this;return(0,s.default)(o.default.mark((function t(){var n,i,a,r,s;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.getAllServcie(),e.getPublicFieldList(),e.getServiceTypes(),n=e.serviceInfo,i=n.name,a=n.desc,r=n.catalog_id,s=n.key,e.formData.name=i,e.formData.desc=a,e.formData.catalog_id=r,e.formData.key=s,"edit"===e.type?(e.getCreateTicketNodeForm(),e.getCreateTicketNodeDetail()):(e.isCreateService=!0,e.formData.catalog_id=e.$route.query.catalog_id||"");case 9:case"end":return t.stop()}}),t,e)})))()},methods:{getAllServcie:function(){var e=this,t={project_key:this.$store.state.project.id,catalog_id:1};this.$store.dispatch("catalogService/getServices",t).then((function(t){e.servcieList=t.data||[]}))},handleRepeatServiceName:function(e){var t=this;return(0,s.default)(o.default.mark((function n(){return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.abrupt("return",!t.servcieList.find((function(t){return t.name===e})));case 1:case"end":return n.stop()}}),n,t)})))()},handleDragLine:function(e){document.addEventListener("mouseup",this.handleMouseUp,!1),document.addEventListener("mousemove",this.handleLineMouseMove,!1);var t=document.querySelector(".edit-service-field");this.dragLine.maxLength=t.clientWidth,this.dragLine.startX=e.pageX,this.dragLine.canMove=!0},handleMouseUp:function(){document.removeEventListener("mouseup",this.handleMouseUp,!1),document.removeEventListener("mousemove",this.handleLineMouseMove,!1),this.dragLine.base=this.dragLine.move,this.dragLine.canMove=!1},handleLineMouseMove:function(e){var t=this;if(this.dragLine.canMove){var n=document.querySelector(".edit-service-field"),i=this.dragLine,a=i.startX,r=i.base,o=e.pageX-a,s=r+o;o>0&&600-s<=500||window.requestAnimationFrame((function(){t.dragLine.move=s,n.style.width="calc(600px - "+s+"px)"}))}},onFormEditClick:function(e){this.isShowRightEdit=!0,this.crtForm=e.id},onEditConfirm:function(e){this.$refs.serviceForm.onEditConfirm(e),this.isShowRightEdit=!1},onEditCancel:function(){this.cancelAddField(),this.crtForm="",this.isShowRightEdit=!1},getAddFieldStatus:function(e){this.addFieldStatus=e},getPublicFieldList:function(){var e=this;this.$store.dispatch("publicField/get_template_common_fields",{project_key:this.$store.state.project.id}).then((function(t){e.fieldlist=t.data,e.publicFields=t.data})).catch((function(t){(0,c.errorHandler)(t,e)}))},filterFiled:function(e,t,n){if(""!==e){var i=t.filter((function(t){var n=RegExp(e);if(t.name.match(n))return t}));this[""+n]=i}else this[""+n]=t},handleSearchLibrary:function(e){this.filterFiled(e,this.fieldsLibrarylist,"fieldsLibrary")},handleSearchField:function(e){this.filterFiled(e,this.fieldlist,"publicFields")},getServiceTypes:function(){var e=this;this.$store.dispatch("getCustom").then((function(t){e.serviceTypeList=t.data})).catch((function(t){(0,c.errorHandler)(t,e)}))},getCreateTicketNodeForm:function(){var e=this;this.formLoading=!0,this.$store.dispatch("deployCommon/getFieldList",{workflow:this.serviceInfo.workflow_id,state:this.createTicketNodeId}).then((function(t){t.data.forEach((function(e){e.checkValue=!1,e.val=Object.prototype.hasOwnProperty.call(e,"default")?(0,u.deepClone)(e.default):"",e.showFeild=!0})),e.ticketNodeForm=t.data})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.formLoading=!1}))},getCreateTicketNodeDetail:function(){var e=this;this.detailLoading=!0,this.$store.dispatch("deployCommon/getOneStateInfo",{id:this.createTicketNodeId}).then((function(t){e.ticketNodeDetail=t.data})).finally((function(){e.detailLoading=!1}))},onBasicFormSubmit:function(){var e=this;this.isSubmitting||this.$refs.basicForm.validate().then((0,s.default)(o.default.mark((function t(){var n;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if((n=JSON.parse((0,r.default)(e.formData))).id=e.serviceId||void 0,n.project_key=e.$store.state.project.id,e.isSubmitting=!0,"edit"!==e.type){t.next=9;break}return t.next=7,e.updateServiceInfo(n);case 7:t.next=11;break;case 9:return t.next=11,e.createService(n);case 11:e.isSubmitting=!1;case 12:case"end":return t.stop()}}),t,e)}))))},onBasicFormCancel:function(){var e=this;"new"===this.type?(this.isCreateService=!1,this.$bkInfo({type:"warning",title:this.$t('m.slaContent["确认返回？"]'),confirmFn:function(){e.goBackToServiceList()},cancelFn:function(){e.isCreateService=!0}})):this.isBasicFormEditting=!1},goBackToServiceList:function(){this.$router.push({name:"projectServiceList",query:{project_id:this.$store.state.project.id,catalog_id:this.$route.query.catalog_id}})},createService:function(e){var t=this;this.$store.dispatch("serviceEntry/createService",e).then((function(e){t.$bkMessage({message:t.$t('m.deployPage["保存成功"]'),theme:"success"}),t.$router.push({name:"projectServiceEdit",params:{type:"edit",step:"basic"},query:{serviceId:e.data.id,project_id:t.$store.state.project.id}}),t.isBasicFormEditting=!1})).catch((function(e){(0,c.errorHandler)(e,t)}))},updateServiceInfo:function(e){var t=this;this.$store.dispatch("serviceEntry/updateService",e).then((function(e){t.$bkMessage({message:t.$t('m.serviceConfig["修改成功"]'),theme:"success"}),t.isBasicFormEditting=!1,t.$emit("updateServiceInfo",e.data)})).catch((function(e){(0,c.errorHandler)(e,t)}))},getServiceDirectory:function(){var e=this;return(0,s.default)(o.default.mark((function t(){return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("serviceCatalog/getTreeData",{show_deleted:!0,project_key:e.$store.state.project.id}).then((function(t){e.dirList=t.data[0]&&t.data[0].children?t.data[0].children:t.data})).catch((function(t){(0,c.errorHandler)(t,e)}));case 2:case"end":return t.stop()}}),t,e)})))()},onCreateFormWayCLick:function(e){var t=this;return(0,s.default)(o.default.mark((function n(){var i;return o.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.isBasicFormEditting){n.next=9;break}return n.prev=1,n.next=4,t.$refs.basicForm.validate();case 4:n.next=9;break;case 6:return n.prev=6,n.t0=n.catch(1),n.abrupt("return",console.warn(n.t0));case 9:"recom"===(i=e.key)||"created"===i?(t.isShowChooseSerTempDialog=!0,t.currCreateFormWay=e):t.updateServiceSource("custom");case 11:case"end":return n.stop()}}),n,t,[[1,6]])})))()},createServicePopoverShow:function(){this.isDropdownShow=!0},createServicePopoverHide:function(){this.isDropdownShow=!1},dragUpdateList:function(e,t){if(t){var n=this.ticketNodeForm.findIndex((function(e){return e.id===t.id}));this.ticketNodeForm.splice(n,1),this.ticketNodeForm.splice(e,0,t),"COL_6"===t.layout&&this.saveHalfRowDragPos(t)}else this.$bkMessage({message:this.$t('m["请先保存字段"]'),offsetY:80})},onAddFormClick:function(e){var t={workflow:"",id:"",key:"",name:"",type:e.type,desc:"",layout:"COL_12",validate_type:"REQUIRE",choice:[],is_builtin:!1,source_type:"CUSTOM",source_uri:"",regex:"EMPTY",custom_regex:"",is_tips:!1,tips:"",meta:{},default:""};this.addField(t)},addField:function(e){if(""===this.crtForm){this.isShowRightEdit=!0;var t=(0,a.default)((0,u.deepClone)(e),{id:"add"});this.ticketNodeForm.push(t),this.crtForm="add"}else this.$bkMessage({message:this.$t('m["请先将字段属性关闭"]')})},cancelAddField:function(){var e=this.ticketNodeForm.findIndex((function(e){return"add"===e.id}));-1!==e&&this.ticketNodeForm.splice(e,1),this.crtForm=""},fieldClone:function(e){var t=this.ticketNodeForm.findIndex((function(t){return t.id===e.id})),n=(0,a.default)((0,u.deepClone)(e),{id:"add"});this.ticketNodeForm.splice(t+1,0,n),this.crtForm="add"},fieldDelete:function(e){var t=this;this.crtForm?this.$bkMessage({message:this.$t('m["请先将当前字段属性关闭再进行操作"]'),theme:"warning"}):"add"!==e.id?(this.$bkInfo({type:"warning",title:this.$t('m.treeinfo["确认删除此字段？"]'),subTitle:this.$t('m.treeinfo["字段一旦删除，此字段将不在可用。请谨慎操作。"]'),confirmFn:function(){if(!t.pending.deleteField){t.pending.deleteField=!0,t.crtForm="";var n={id:e.id,params:{state_id:t.createTicketNodeId}};t.$store.dispatch("deployCommon/deleteField",n).then((function(){t.$bkMessage({message:t.$t('m.systemConfig["删除成功"]'),theme:"success"});var n=t.ticketNodeForm.findIndex((function(t){return t.id===e.id}));t.ticketNodeForm.splice(n,1)})).catch((function(e){(0,c.errorHandler)(e,t)})).finally((function(){t.pending.deleteField=!1}))}}}),this.isShowRightEdit=!1):this.onEditCancel()},saveField:function(e){var t=this.ticketNodeForm.findIndex((function(t){return t.id===e.id}));e.checkValue=!1,e.showFeild=!0,e.val=Object.prototype.hasOwnProperty.call(e,"default")?(0,u.deepClone)(e.default):"",t>-1?this.ticketNodeForm.splice(t,1,e):this.ticketNodeForm.splice(-1,1,e),this.crtForm=""},saveHalfRowDragPos:function(e){var t="TABLE"===e.source?"cdeploy/changeNewModuleField":"cdeploy/changeNewField";this.$store.dispatch(t,{params:e,id:e.id})},updateServiceSource:function(e){var t=this;this.getCreateTicketNodeForm(),this.$store.dispatch("service/updateServiceSource",{id:this.serviceId,params:{source:e}}).then((function(){t.serviceInfo.source=e})).catch((function(e){(0,c.errorHandler)(e,t)}))},validate:function(){var e=this;return(0,s.default)(o.default.mark((function t(){var n,a,r,s,l,u,d,f,p,m,h,v,g,y,b,_,k,w;return o.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.isBasicFormEditting){t.next=3;break}return t.next=3,e.$refs.basicForm.validate();case 3:if(e.formLoading||e.detailLoading||!e.$refs.serviceForm){t.next=8;break}return n=e.ticketNodeDetail,a=n.assignors,r=n.assignors_type,s=n.can_deliver,l=n.delivers,u=n.delivers_type,d=n.distribute_type,f=n.extras,p=n.is_draft,m=n.is_terminable,h=n.name,v=n.processors,g=n.processors_type,y=n.tag,b=n.type,_=n.workflow,k=e.ticketNodeForm.filter((function(e){return"number"==typeof e.id})).map((function(e){return e.id})),w={assignors:a,assignors_type:r,can_deliver:s,delivers:l,delivers_type:u,distribute_type:d,extras:f,is_draft:p,is_terminable:m,name:h,processors:v,processors_type:g,tag:y,type:b,workflow:_,fields:k},t.abrupt("return",e.$store.dispatch("deployCommon/updateNode",{params:w,id:e.createTicketNodeId}).then((function(){e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"})}),(function(t){return(0,c.errorHandler)(t,e),i.default.reject(t)})));case 8:case"end":return t.stop()}}),t,e)})))()},handleShowField:function(){this.isShowField=!this.isShowField}}}},tZ7T:function(e,t,n){"use strict";n.r(t);var i=n("LWJh"),a=n("cydg");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("djC9");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"48487460",null);t.default=s.exports},tgnH:function(e,t,n){"use strict";n.r(t);var i=n("P2aA"),a=n("pnfo");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("JtQW");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"248e77f2",null);t.default=s.exports},tl4E:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-get-param"},[t("div",{staticClass:"bk-params-title"},[e._v("\n    "+e._s(e.$t('m.treeinfo["返回数据"]'))+"\n  ")]),e._v(" "),t("div",{staticClass:"bk-param-three"},[t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['选取数组']"),required:!0}},[t("div",{staticClass:"bk-form-content bk-dialog-input"},[t("div",{ref:"cascader"},[[t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeOther0,expression:"closeOther0"}],staticClass:"bk-search-tree",staticStyle:{width:"100%",float:"left"}},[[(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key?t("div",{staticClass:"bk-search-tree-wrapper",class:{"bk-border-red":e.checkInfo.assignors,"bk-back-color":(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key}},[t("span",{class:{"bk-color-tree":e.organization.assignorTree.name}},[e._v(e._s(e.organization.assignorTree.name||e.$t('m.treeinfo["请选择"]')))]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})]):t("div",{staticClass:"bk-search-tree-wrapper",class:{"bk-border-red":e.checkInfo.assignors,"bk-back-color":(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key},on:{click:function(t){return t.stopPropagation(),e.showTree(0)}}},[t("span",{class:{"bk-color-tree":e.organization.assignorTree.name}},[e._v(e._s(e.organization.assignorTree.name||e.$t('m.treeinfo["请选择"]')))]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})])],e._v(" "),t("transition",{attrs:{name:"fade"}},[e.organizaInfo.assignorShow[0]?t("div",{staticClass:"bk-search-tree-content",style:{width:50*e.maxLevelTree[0]+"%"}},[t("export-tree",{attrs:{disabled:(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key,"tree-data-list":e.organization.assignorPerson,"is-key-value":0},on:{toggle:e.assignorToggle,toggleChildren:e.toggleChildren}})],1):e._e()])],2)]],2)])]),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['关键字字段']"),required:!0}},[t("div",{staticClass:"bk-form-content bk-dialog-input"},[t("div",{ref:"cascader"},[[t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeOther1,expression:"closeOther1"}],staticClass:"bk-search-tree",staticStyle:{width:"100%",float:"left"}},[[(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key?t("div",{staticClass:"bk-search-tree-wrapper",class:{"bk-back-color":(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key}},[t("span",{class:{"bk-color-tree":e.settingKeyName}},[e._v(e._s(e.settingKeyName||e.$t('m.treeinfo["请选择"]')))]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})]):t("div",{staticClass:"bk-search-tree-wrapper",class:{"bk-back-color":(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key},on:{click:function(t){return t.stopPropagation(),e.showTree(1)}}},[t("span",{class:{"bk-color-tree":e.settingKeyName}},[e._v(e._s(e.settingKeyName||e.$t('m.treeinfo["请选择"]')))]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})])],e._v(" "),t("transition",{attrs:{name:"fade"}},[e.organizaInfo.assignorShow[1]?t("div",{staticClass:"bk-search-tree-content",style:{width:50*e.maxLevelTree[1]+"%"}},[t("export-tree",{attrs:{disabled:(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key,"tree-data-list":e.selectInfo.selectkeylist,"is-key-value":1},on:{toggle:e.assignorToggle,toggleChildren:e.toggleChildren}})],1):e._e()])],2)]],2)])]),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.treeinfo['显示字段']"),required:!0}},[t("div",{staticClass:"bk-form-content bk-dialog-input"},[t("div",{ref:"cascader"},[[t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeOther2,expression:"closeOther2"}],staticClass:"bk-search-tree",staticStyle:{width:"100%",float:"left"}},[[(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key?t("div",{staticClass:"bk-search-tree-wrapper",class:{"bk-back-color":(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key}},[t("span",{class:{"bk-color-tree":e.settingValueName}},[e._v(e._s(e.settingValueName||e.$t('m.treeinfo["请选择"]')))]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})]):t("div",{staticClass:"bk-search-tree-wrapper",class:{"bk-back-color":(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key},on:{click:function(t){return t.stopPropagation(),e.showTree(2)}}},[t("span",{class:{"bk-color-tree":e.settingValueName}},[e._v(e._s(e.settingValueName||e.$t('m.treeinfo["请选择"]')))]),e._v(" "),t("i",{staticClass:"bk-select-angle bk-icon icon-framework"})])],e._v(" "),t("transition",{attrs:{name:"fade"}},[e.organizaInfo.assignorShow[2]?t("div",{staticClass:"bk-search-tree-content",style:{width:50*e.maxLevelTree[2]+"%"}},[t("export-tree",{attrs:{disabled:(e.changeInfo.is_builtin||e.formInfo.isModule)&&"bk_biz_id"!==e.formInfo.key,"tree-data-list":e.selectInfo.selectvaluelist,"is-key-value":2},on:{toggle:e.assignorToggle,toggleChildren:e.toggleChildren}})],1):e._e()])],2)]],2)])])],1)])},a=[];i._withStripped=!0},tnQB:function(e,t,n){},u0fD:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{ref:"fieldContent",staticClass:"bk-field-preview",attrs:{id:"bkPreview"}},[t("bk-form",{attrs:{"label-width":e.labelWidth,"form-type":"vertical","ext-cls":"bk-ext-form"}},[e._l(e.fields,(function(n,i){return[n.showFeild?t("div",{key:i,class:{"bk-field-line":"COL_12"===n.layout,"bk-field-half":"COL_6"===n.layout,"bk-field-trigger":"trigger"===e.origin}},[t("CW-"+n.type,{ref:"component"+i,refInFor:!0,tag:"component",attrs:{item:n,fields:e.fields,"basic-infomation":e.basicInfomation,"type-info":e.typeInfo,disabled:e.disabled}}),e._v(" "),"trigger"!==e.origin?["API"===n.source_type?t("i",{staticClass:"bk-icon icon-refresh bk-icon-refresh",class:{"not-rotate":!e.rotate,rotate:e.rotate},on:{click:function(t){return e.freshBtn(n)}}}):e._e(),e._v(" "),"RPC"===n.source_type?t("i",{staticClass:"bk-icon icon-refresh bk-icon-refresh",class:{"not-rotate":!e.rotate,rotate:e.rotate},on:{click:function(t){return e.freshRpc(n)}}}):e._e()]:e._e()],2):e._e()]}))],2)],1)},a=[];i._withStripped=!0},u14n:function(e,t,n){"use strict";n.r(t);var i=n("Axd5"),a=n("pRHh");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},"u3L/":function(e,t,n){"use strict";n.r(t);var i=n("9xhR"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},uK6t:function(e,t,n){"use strict";n.r(t);var i=n("phV7"),a=n("xpPb");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("5eUO");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"3a6d3529",null);t.default=s.exports},uR5J:function(e,t,n){"use strict";n.r(t);var i=n("xsd2"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},uThF:function(e,t,n){"use strict";n("DX1f")},ucVW:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={name:"DevopsPreview",components:{},props:{stages:{type:Array,default:function(){return[]}},loading:{type:Boolean,default:!1}},data:function(){return{isFullScreen:!1}},methods:{openFullScreen:function(){this.isFullScreen=!0,this.$bkMessage({message:this.$t('m.common["按 ESC 键退出全屏"]')}),document.addEventListener("keydown",this.handlerKeyDown)},onCloseFullScreen:function(){this.isFullScreen=!1},handlerKeyDown:function(e){27===e.keyCode&&(this.onCloseFullScreen(),document.removeEventListener("keydown",this.handlerKeyDown))},getPath:function(e,t){if(0===t)return"M 60 2 L 55 2 Q 50 2 50 7 L 50 60 Q 50 62 45 62 L 0 62";var n=56*(e.containers[t-1].elements.length+1);return"M 50 2 L 50 "+(n-10)+" Q 50 "+(n-5)+" 45 "+(n-5)+" L 0 "+(n-5)},getSvgStyle:function(e,t){if(0===t)return"";var n=56*(e.containers[t-1].elements.length+1)-27;return n?"top: "+-n+"px;":""},isElementCanExecute:function(e){if(!e.additionalOptions||!e.additionalOptions.runCondition)return!0;var t=e.additionalOptions,n=t.runCondition,i=t.customVariables;if(!t.enable)return!1;switch(n){case"CUSTOM_VARIABLE_MATCH":return i.every((function(e){return!!e.value}));case"CUSTOM_VARIABLE_MATCH_NOT_RUN":return!i.every((function(e){return!!e.value}));default:return!0}}}}},ughI:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CUSTOM_FORM_DEFAULT_VALUE=void 0;var i,a=n("gDS+"),r=(i=a)&&i.__esModule?i:{default:i};t.CUSTOM_FORM_DEFAULT_VALUE=(0,r.default)({schemes:{},form_data:[]},null,4)},ukIK:function(e,t,n){"use strict";n.r(t);var i=n("unyW"),a=n("ml4i");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("hj6f");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"fd4c2596",null);t.default=s.exports},unqN:function(e,t,n){},unyW:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-change-conductor"},["STRING"===e.itemInfo.type?[t("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"conductorId"+e.index,expression:"'conductorId' + index"}],staticStyle:{width:"260px"},attrs:{placeholder:e.$t("m.trigger['20个字符以内']")},model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}})]:e._e(),e._v(" "),"SELECT"===e.itemInfo.type?[t("bk-select",{staticStyle:{width:"260px"},attrs:{"ext-cls":"bk-insert-info",clearable:!1,searchable:""},model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}},e._l(e.itemInfo.choice,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e(),e._v(" "),"MULTISELECT"===e.itemInfo.type?[t("bk-select",{staticStyle:{width:"260px"},attrs:{"ext-cls":"bk-insert-info",clearable:!1,searchable:"",multiple:""},model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}},e._l(e.itemInfo.choice,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e(),e._v(" "),"MEMBERS"===e.itemInfo.type||"MULTI_MEMBERS"===e.itemInfo.type?e._l(e.itemInfo.value,(function(n,i){return t("div",{key:i,staticClass:"bk-send-recipient",class:{"bk-none-margin":e.itemInfo.value.length-1===i}},[t("member-info",{attrs:{"item-info":e.itemInfo,"recipient-item":n,"recipient-index":i}})],1)})):e._e(),e._v(" "),"TEXT"===e.itemInfo.type?[t("bk-input",{directives:[{name:"cursorIndex",rawName:"v-cursorIndex",value:"conductorId"+e.index,expression:"'conductorId' + index"}],attrs:{type:"textarea","ext-cls":"bk-remindway-form",rows:6},on:{blur:e.changeMessagePanel},model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}})]:e._e(),e._v(" "),"RADIO"===e.itemInfo.type?[t("bk-radio-group",{model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}},[e._l(e.itemInfo.choice,(function(n,i){return[t("bk-radio",{key:i,attrs:{value:n.key,"ext-cls":"mr50"}},[e._v(e._s(n.name))])]}))],2)]:e._e(),e._v(" "),"CHECKBOX"===e.itemInfo.type?[t("bk-checkbox-group",{model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}},[e._l(e.itemInfo.choice,(function(n,i){return[t("bk-checkbox",{key:i,attrs:{value:n.key,"ext-cls":"mr10"}},[e._v(e._s(n.name))])]}))],2)]:e._e(),e._v(" "),"INT"===e.itemInfo.type?[t("bk-input",{attrs:{clearable:!0,precision:e.precision,type:"number"},model:{value:e.itemInfo.value,callback:function(t){e.$set(e.itemInfo,"value",t)},expression:"itemInfo.value"}})]:e._e(),e._v(" "),!e.isShowVar||"STRING"!==e.itemInfo.type&&"TEXT"!==e.itemInfo.type?e._e():[t("div",{staticClass:"bk-select-btn"},[t("bk-button",{staticClass:"bk-form-btn plus-cus",attrs:{theme:"default",title:e.$t("m.slaContent['插入变量']"),icon:"plus"}},[e._v("\n        "+e._s(e.$t('m.slaContent["插入变量"]'))+"\n      ")]),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-select-btn-opacity",searchable:""},on:{selected:e.changeInsert},model:{value:e.insertValue,callback:function(t){e.insertValue=t},expression:"insertValue"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1)],e._v(" "),e.isShowVar&&"VARIABLE"===e.itemInfo.value?[t("bk-select",{staticStyle:{width:"260px"},attrs:{"ext-cls":"bk-insert-info",searchable:"",multiple:Array.isArray(e.itemInfo.insertValue)},on:{selected:e.changeImport},model:{value:e.itemInfo.insertValue,callback:function(t){e.$set(e.itemInfo,"insertValue",t)},expression:"itemInfo.insertValue"}},e._l(e.variableList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e()],2)},a=[];i._withStripped=!0},utoA:function(e,t,n){},"uv/p":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i,a=n("GQeE"),r=(i=a)&&i.__esModule?i:{default:i};t.default={name:"FormViewItem",props:{fields:Array,form:Object,crtForm:[String,Number],addFieldStatus:Boolean},computed:{deleteDisabled:function(){return this.form.is_builtin&&-1===["impact","urgency","priority","current_status"].indexOf(this.form.key)}},beforeCreate:function(){var e=this,t=function(){var e={},t=n("t9X+");return t.keys().forEach((function(n){var i=t(n).default;e["CW-"+i.name]=i})),e}();(0,r.default)(t).forEach((function(n){e.$options.components[n]=t[n]}))},methods:{onDeleteClick:function(e){this.deleteDisabled||this.$emit("onFormDeleteClick",e)}}}},uy81:function(e,t,n){"use strict";n.r(t);var i=n("VbaA"),a=n("qFWE");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("On6X");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"6a55cb6e",null);t.default=s.exports},uz2X:function(e,t,n){"use strict";n.r(t);var i=n("676K"),a=n("dU2m");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("iGEm");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"20fd9ae2",null);t.default=s.exports},v0Be:function(e,t,n){},"v4/x":function(e,t,n){"use strict";n("jfEP")},"v5D/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=d(n("QbLZ")),a=d(n("14Xm")),r=d(n("D3Ub")),o=d(n("+qVm")),s=d(n("MEtw")),c=d(n("UhCq")),l=d(n("BVcZ")),u=n("CeR/");function d(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ServiceEdit",components:{NavTitle:o.default,ServiceFormStep:s.default,ServiceProcessStep:c.default,ServiceSettingStep:l.default},props:{type:{type:String,default:"new"},step:{type:String,default:"basic"},serviceId:{type:[String,Number],default:""}},data:function(){return{serviceLoading:"edit"===this.type,flowInfoLoading:!1,isSubmitting:!1,serviceInfo:{},flowInfo:{},isShowNodeConfig:!1}},computed:{currStep:function(){return["basic","process","setting"].indexOf(this.step)+1},prevStepBtnName:function(){return 1===this.currStep?this.$t("m['返回']"):this.$t('m.treeinfo["上一步"]')},nextStepBtnName:function(){return this.currStep<3?this.$t("m.common['下一步']"):this.$t('m.newCommon["提交"]')},stepList:function(){var e=void 0,t=void 0,n=void 0;"new"!==this.type&&(e="done",t="done"),"new"!==this.type&&this.serviceInfo.is_valid&&(n="done");var i=[{title:this.$t("m.tickets['服务表单']"),icon:1,status:e},{title:this.$t("m.tickets['服务流程']"),icon:2,status:t},{title:this.$t("m.taskTemplate['高级配置']"),icon:3,status:n}];return i[this.currStep-1].status=void 0,i}},watch:{$route:function(e,t){e.params.type!==t.params.type&&this.initData()}},mounted:function(){this.initData()},methods:{initData:function(){var e=this;return(0,r.default)(a.default.mark((function t(){return a.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("edit"!==e.type){t.next=4;break}return t.next=3,e.getServiceDetail();case 3:e.getFlowDetailInfo();case 4:case"end":return t.stop()}}),t,e)})))()},getServiceDetail:function(){var e=this;return this.serviceLoading=!0,this.$store.dispatch("service/getServiceDetail",this.serviceId).then((function(t){e.serviceInfo=t.data})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.serviceLoading=!1}))},getFlowDetailInfo:function(){var e=this;this.flowInfoLoading=!0,this.$store.dispatch("design/getFlowDetail",{params:this.serviceInfo.workflow_id}).then((function(t){e.flowInfo=t.data})).catch((function(t){(0,u.errorHandler)(t,e)})).finally((function(){e.flowInfoLoading=!1}))},updateServiceInfo:function(e){this.serviceInfo=e},setConfigStatus:function(e){this.isShowNodeConfig=e},onBackIconClick:function(){this.$refs.serviceProcessStep&&this.$refs.serviceProcessStep.isShowNodeConfig?this.$refs.serviceProcessStep.isShowNodeConfig=!1:this.$router.push({name:"projectServiceList",query:{project_id:this.$store.state.project.id,catalog_id:this.$route.query.catalog_id}})},onStepChange:function(e){"new"!==this.type&&this.$router.push({name:"projectServiceEdit",params:{type:"edit",step:["basic","process","setting"][e-1]},query:{serviceId:this.serviceId,project_id:this.$store.state.project.id}})},onPrevStepClick:function(){1===this.currStep?this.$router.push({name:"projectServiceList",query:(0,i.default)({project_id:this.$store.state.project.id},this.$route.query)}):this.$router.push({name:"projectServiceEdit",params:{type:"edit",step:2===this.currStep?"basic":"process"},query:(0,i.default)({},this.$route.query)})},onNextStepClick:function(){var e=this;this.isSubmitting=!0;var t={basic:"serviceFormStep",process:"serviceProcessStep",setting:"serviceSettingStep"}[this.step];this.$refs[t].validate().then((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(!n.data||!1!==n.data.result)if("setting"!==e.step){var a="basic"===e.step?"process":"setting";"basic"!==e.step||e.serviceInfo.source||e.$refs[t].updateServiceSource("custom"),e.$router.push({name:"projectServiceEdit",params:{type:"edit",step:a},query:(0,i.default)({},e.$route.query)})}else e.$bkMessage({message:e.$t('m.treeinfo["保存成功"]'),theme:"success"}),e.$router.push({name:"projectServiceList",query:{project_id:e.$store.state.project.id,catalog_id:e.$route.query.catalog_id}})})).finally((function(){e.isSubmitting=!1}))}}}},vHDd:function(e,t,n){"use strict";n.r(t);var i=n("HiwQ"),a=n("OZnK");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("I4J2");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"5d143e15",null);t.default=s.exports},vLQ5:function(e,t,n){},vT7S:function(e,t,n){},vUrO:function(e,t,n){"use strict";n.r(t);var i=n("zO7g"),a=n("EJGV");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("A7pL");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"e0b09b76",null);t.default=s.exports},vXIu:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("GQeE")),a=l(n("QbLZ")),r=l(n("gDS+")),o=n("CeR/"),s=l(n("EstQ")),c=l(n("tgnH"));function l(e){return e&&e.__esModule?e:{default:e}}function u(){return{required:!0,message:s.default.t('m.treeinfo["字段必填"]'),trigger:"blur"}}var d={project_id:[u()],pipeline_id:[u()]};t.default={name:"DEVOPS_TEMPLATE",components:{DevopsPreview:c.default},props:{item:{type:Object,required:!0,default:function(){}},basicInfomation:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1}},data:function(){return{projectLoading:!1,pipelineLoading:!1,pipelineStartLoading:!1,pipelineDetailLoading:!1,showPipelineVariable:!0,showPipelineStages:!0,defaultRules:{project_id:[{required:!0,message:s.default.t('m.treeinfo["字段必填"]'),trigger:"blur"}],pipeline_id:[{required:!0,message:s.default.t('m.treeinfo["字段必填"]'),trigger:"blur"}]},rules:{project_id:[u()],pipeline_id:[u()]},projectList:[],pipelineList:[],pipelineStartInfo:{},pipelineVariableList:[],pipelineStages:[]}},created:function(){this.item.devopsContent||this.$set(this.item,"devopsContent",{project_id:"",pipeline_id:"",variables:{}})},mounted:function(){if(this.getDevopsUserProjectList(),this.item.value){var e=this.item.value,t=e.pipeline_id,n=e.project_id;this.item.devopsContent={project_id:n,pipeline_id:t,variables:JSON.parse((0,r.default)((0,a.default)({},this.item.value,{project_id:void 0,pipeline_id:void 0})))},this.getDevopsPipelineList(n),this.getDevopsPipelineStartInfo(),this.getDevopsPipelineDetail()}},methods:{getDevopsUserProjectList:function(){var e=this;this.projectLoading=!0,this.$store.dispatch("ticket/getDevopsUserProjectList",{ticket_id:this.basicInfomation.id}).then((function(t){e.projectList=t.data})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.projectLoading=!1}))},getDevopsPipelineList:function(e){var t=this;this.pipelineLoading=!0,this.$store.dispatch("ticket/getDevopsPipelineList",{project_id:e}).then((function(e){t.pipelineList=e.data})).catch((function(e){(0,o.errorHandler)(e,t)})).finally((function(){t.pipelineLoading=!1}))},getDevopsPipelineStartInfo:function(){var e=this;this.pipelineStartLoading=!0;var t=this.item.devopsContent,n=t.project_id,i=t.pipeline_id;this.$store.dispatch("ticket/getDevopsPipelineStartInfo",{project_id:n,pipeline_id:i}).then((function(t){e.pipelineStartInfo=t.data,e.pipelineVariableList=t.data.properties;var n=e.item.devopsContent.variables;t.data.properties.forEach((function(t){Object.prototype.hasOwnProperty.call(n,t.id)||e.$set(n,t.id,t.defaultValue||"")})),e.resetFormRules()})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.pipelineStartLoading=!1}))},getDevopsPipelineDetail:function(){var e=this;this.pipelineDetailLoading=!0;var t=this.item.devopsContent,n=t.project_id,i=t.pipeline_id;this.$store.dispatch("ticket/getDevopsPipelineDetail",{project_id:n,pipeline_id:i}).then((function(t){e.pipelineStages=t.data.stages||[]})).finally((function(){e.pipelineDetailLoading=!1}))},handleProjectChange:function(e){this.pipelineList=[],this.pipelineStartInfo={},this.pipelineVariableList=[],this.item.devopsContent.pipeline_id="",this.item.devopsContent.variables={},this.resetFormRules(),this.getDevopsPipelineList(e)},handlePipelineChange:function(){this.pipelineStartInfo={},this.pipelineVariableList=[],this.item.devopsContent.variables={},this.resetFormRules(),this.getDevopsPipelineStartInfo(),this.getDevopsPipelineDetail()},resetFormRules:function(){var e=this,t={};(0,i.default)(this.item.devopsContent.variables).forEach((function(n){e.pipelineVariableList.find((function(e){return e.id===n})).required&&(t[n]=[u()])})),this.rules=(0,a.default)({},d,t)},validate:function(){this.$refs.devopsForm.validate(),this.$refs.devopsVariable.validate();var e=this.item.devopsContent,t=e.project_id,n=e.pipeline_id,a=e.variables,r=(0,i.default)(a).every((function(e){return!!a[e]}));return r||(this.showPipelineVariable=!0),!!t&&!!n&&r}}}},vg5J:function(e,t,n){"use strict";n("k5mY")},vlfB:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-data-source"},[t("bk-select",{attrs:{"ext-cls":e.typeClass,clearable:!1,disabled:e.dataSourceDisable,searchable:""},on:{selected:e.changeSource},model:{value:e.formInfo.source_type,callback:function(t){e.$set(e.formInfo,"source_type",t)},expression:"formInfo.source_type"}},e._l(e.sourceList,(function(e){return t("bk-option",{key:e.typeName,attrs:{id:e.typeName,name:e.name}})})),1),e._v(" "),"DATADICT"===e.formInfo.source_type?[t("bk-select",{attrs:{"ext-cls":"bk-halfline-item",clearable:!1,disabled:e.dataSourceDisable,searchable:""},model:{value:e.dictionaryData.check,callback:function(t){e.$set(e.dictionaryData,"check",t)},expression:"dictionaryData.check"}},e._l(e.dictionaryData.list,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e(),e._v(" "),"API"===e.formInfo.source_type?[t("bk-select",{attrs:{"ext-cls":"bk-threeline-item bk-halfline-margin",placeholder:e.$t("m.treeinfo['请选择接入系统']"),clearable:!1,loading:e.isSystemLoading,searchable:""},on:{selected:e.changeApiSystem},model:{value:e.apiInfo.remote_system_id,callback:function(t){e.$set(e.apiInfo,"remote_system_id",t)},expression:"apiInfo.remote_system_id"}},e._l(e.apiSysList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1),e._v(" "),t("bk-select",{attrs:{"ext-cls":"bk-threeline-item",placeholder:e.$t("m.treeinfo['请选择接口']"),clearable:!1,loading:e.isApiLoading,searchable:""},on:{selected:e.changeApiPort},model:{value:e.apiInfo.remote_api_id,callback:function(t){e.$set(e.apiInfo,"remote_api_id",t)},expression:"apiInfo.remote_api_id"}},e._l(e.apiPortList,(function(e){return t("bk-option",{key:e.id,attrs:{id:e.id,name:e.name}})})),1)]:e._e(),e._v(" "),"RPC"===e.formInfo.source_type?[t("bk-select",{attrs:{"ext-cls":"bk-halfline-item",clearable:!1,searchable:""},on:{selected:e.changeRpc},model:{value:e.prcData.check,callback:function(t){e.$set(e.prcData,"check",t)},expression:"prcData.check"}},e._l(e.prcData.list,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)]:e._e()],2)},a=[];i._withStripped=!0},vvUq:function(e,t,n){"use strict";n("wqdL")},w5Ae:function(e,t,n){"use strict";n("zsCw")},wA6F:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-get-param"},[t("bk-table",{attrs:{data:e.tableList,size:"small"}},[t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['名称']"),"min-width":"200"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("div",{staticClass:"bk-more"},[t("span",{style:{paddingLeft:20*n.row.level+"px"}},[n.row.has_children?t("span",{class:["bk-icon","tree-expanded-icon",n.row.showChildren?"icon-down-shape":"icon-right-shape"],on:{click:function(t){return e.changeState(n.row)}}}):t("span",{staticClass:"bk-icon bk-more-icon"}),e._v(" "),t("span",[e._v(e._s(n.row.key||"--"))])])])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['类型']"),prop:"type"}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['是否必须']")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n        "+e._s(t.row.is_necessary?e.$t('m.treeinfo["是"]'):e.$t('m.treeinfo["否"]'))+"\n      ")]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['备注']"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(n){return[t("span",{attrs:{title:n.row.desc}},[e._v(e._s(n.row.desc||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.treeinfo['参数值']"),width:"300"},scopedSlots:e._u([{key:"default",fn:function(n){return[e.isStatic&&"object"!==n.row.type&&"array"!==n.row.type?[e._v("\n          "+e._s(n.row.customValue||"--")+"\n        ")]:e.isCustom&&"object"!==n.row.type&&"array"!==n.row.type?[t("bk-input",{attrs:{type:"string"===n.row.type?"text":"number",placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.customValue,callback:function(t){e.$set(n.row,"customValue",t)},expression:"props.row.customValue"}})]:["object"!==n.row.type&&"array"!==n.row.type?[t("div",{staticStyle:{width:"120px",position:"absolute",top:"5px",left:"15px"}},[t("bk-select",{attrs:{clearable:!1,searchable:"","font-size":"medium"},model:{value:n.row.source_type,callback:function(t){e.$set(n.row,"source_type",t)},expression:"props.row.source_type"}},e._l(e.sourceTypeList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)],1),e._v(" "),n.row.source_type&&"CUSTOM"!==n.row.source_type?t("div",{staticStyle:{width:"140px",position:"absolute",top:"4px",right:"15px"}},[t("bk-select",{class:{"bk-border-error":n.row.isCheck&&!n.row.value_key.toString()},attrs:{clearable:!1,searchable:"","font-size":"medium"},model:{value:n.row.value_key,callback:function(t){e.$set(n.row,"value_key",t)},expression:"props.row.value_key"}},[e._l(e.stateList,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),e._v(" "),"addField"!==e.entry?[t("div",{staticStyle:{cursor:"pointer"},attrs:{slot:"extension"},on:{click:function(t){return e.addNewItem(n.row)}},slot:"extension"},[t("i",{staticClass:"bk-icon icon-plus-circle"}),e._v(e._s(e.$t('m.treeinfo["添加变量"]'))+"\n                  ")])]:e._e()],2)],1):t("div",{staticStyle:{width:"140px",position:"absolute",top:"4px",right:"15px"}},["string"===n.row.type||"number"===n.row.type?[t("bk-input",{class:{"bk-border-error":n.row.isCheck&&!n.row.value.toString()},attrs:{type:"string"===n.row.type?"text":"number",placeholder:e.$t("m.treeinfo['请输入参数值']")},model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}})]:e._e(),e._v(" "),"boolean"===n.row.type?[t("bk-radio-group",{model:{value:n.row.value,callback:function(t){e.$set(n.row,"value",t)},expression:"props.row.value"}},[t("bk-radio",{attrs:{value:e.trueSatatus}},[e._v("true")]),e._v(" "),t("bk-radio",{attrs:{value:e.falseSatatus}},[e._v("false")])],1)]:e._e()],2)]:e._e(),e._v(" "),e.isStatic||"array"!==n.row.lastType?e._e():t("div",{staticClass:"bk-between-operat"},[t("i",{staticClass:"bk-itsm-icon icon-flow-add",on:{click:function(t){return e.addChildren(n.row)}}}),e._v(" "),"array"===n.row.lastType?t("i",{staticClass:"bk-itsm-icon icon-flow-reduce",class:{"bk-no-delete":e.countSon(n.row)},on:{click:function(t){return e.deletChildren(n.row)}}}):e._e()])]]}}])})],1)],1)},a=[];i._withStripped=!0},wSaC:function(e,t,n){"use strict";n("unqN")},wXXQ:function(e,t,n){},wegR:function(e,t,n){"use strict";n.r(t);var i=n("Jje2"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},wj23:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",[t("nav-title",{attrs:{"show-icon":!0,"title-name":e.serviceInfo.name||e.$t("m['新建服务']")},on:{goBack:e.onBackIconClick}},[t("div",{attrs:{slot:"step"},slot:"step"},[t("bk-steps",{attrs:{"ext-cls":"steps-icon","data-test-id":"service_steps_serviceEditStep",controllable:!0,"line-type":"solid","cur-step":e.currStep,steps:e.stepList},on:{"step-changed":e.onStepChange}})],1)]),e._v(" "),t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.serviceLoading||e.flowInfoLoading},expression:"{ isLoading: serviceLoading || flowInfoLoading }"}],class:["steps-content",{"steps-content-height":e.isShowNodeConfig}]},[e.serviceLoading||e.flowInfoLoading?e._e():[1===e.currStep?t("service-form-step",{ref:"serviceFormStep",attrs:{type:e.type,"service-id":e.serviceId,"service-info":e.serviceInfo,"create-ticket-node-id":e.serviceInfo.first_state_id},on:{updateServiceInfo:e.updateServiceInfo}}):2===e.currStep?t("service-process-step",{ref:"serviceProcessStep",attrs:{"service-info":e.serviceInfo,"flow-info":e.flowInfo},on:{updateFlowInfo:e.getFlowDetailInfo,setConfigStatus:e.setConfigStatus}}):3===e.currStep?t("service-setting-step",{ref:"serviceSettingStep",attrs:{"service-info":e.serviceInfo,"flow-info":e.flowInfo},on:{updateFlowInfo:e.getFlowDetailInfo}}):e._e()]],2),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:!e.isShowNodeConfig||2!==e.currStep,expression:"!isShowNodeConfig || currStep !== 2"}],staticClass:"submit-footer-bar"},[t("bk-button",{attrs:{"data-test-id":"service_button_prevStep","ext-cls":"button-item",theme:"default",disabled:e.isSubmitting},on:{click:e.onPrevStepClick}},[e._v("\n      "+e._s(e.prevStepBtnName)+"\n    ")]),e._v(" "),t("bk-button",{attrs:{"data-test-id":"service_button_nextStepAndSave","ext-cls":"button-item",theme:"primary",disabled:!e.serviceId&&0!==e.serviceId,loading:e.isSubmitting},on:{click:e.onNextStepClick}},[e._v("\n      "+e._s(e.nextStepBtnName)+"\n    ")])],1)],1)},a=[];i._withStripped=!0},wpaA:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"bk-clickoutside",rawName:"v-bk-clickoutside",value:e.closeTree,expression:"closeTree"}],staticClass:"bk-search-tree",class:e.extCls},[t("div",{staticClass:"bk-search-tree-wrapper",on:{click:function(t){return t.stopPropagation(),e.showTree("view")}}},[t("span",{class:{"bk-color-tree":e.displayName}},[e._v("\n      "+e._s(e.displayName||e.$t('m.serviceConfig["请选择"]'))+"\n    ")]),e._v(" "),e.organizationLoading?t("i",{staticClass:"bk-select-angle bk-itsm-icon icon-icon-loading"}):e._e()]),e._v(" "),t("transition",{attrs:{name:"common-fade"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowTree,expression:"isShowTree"}],staticClass:"bk-search-tree-content"},[t("bk-tree",{ref:"tree1",attrs:{"ext-cls":"bk-tree",data:e.displayList,"node-key":"id","show-icon":!1,"has-border":!1},on:{"on-click":e.nodeClickOne,"async-load-nodes":e.asyncLoadNodes}})],1)])],1)},a=[];i._withStripped=!0},wqdL:function(e,t,n){},"x+Aj":function(e,t,n){"use strict";n("e42N")},"x+JR":function(e,t,n){"use strict";n.r(t);var i=n("zCbU"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},x6yq:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){return(0,this._self._c)("section",{staticClass:"code-editor"})},a=[];i._withStripped=!0},"x9y/":function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-add-trigger"},[t("div",{staticClass:"bk-service-name"},[t("h1",[t("span",{staticClass:"is-outline"}),e._v(e._s(e.$t('m.trigger["基础信息"]')))])]),e._v(" "),t("div",{staticClass:"bk-trigger-basic"},[t("bk-form",{ref:"triggerBasic",attrs:{"label-width":170,model:e.formData,"ext-cls":"bk-basic-form","form-type":"vertical",rules:e.rules}},[t("bk-form-item",{attrs:{label:e.$t("m.trigger['触发器名称']"),"data-test-id":"trigger-input-name",required:!0,property:"name"}},[t("bk-input",{attrs:{placeholder:e.$t("m.trigger['请输入触发器名称']")},on:{change:function(t){return e.$emit("change")}},model:{value:e.formData.name,callback:function(t){e.$set(e.formData,"name",t)},expression:"formData.name"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.trigger['是否启用']")}},[t("bk-switcher",{attrs:{"data-test-id":"triggers_switcher_isUseTrigger",size:"small"},on:{change:function(t){return e.$emit("change")}},model:{value:e.formData.is_enabled,callback:function(t){e.$set(e.formData,"is_enabled",t)},expression:"formData.is_enabled"}})],1),e._v(" "),t("bk-form-item",{attrs:{label:e.$t("m.trigger['触发器描述']")}},[t("bk-input",{attrs:{placeholder:e.$t("m.trigger['请输入触发器描述']"),type:"textarea",rows:3,maxlength:100},on:{change:function(t){return e.$emit("change")}},model:{value:e.formData.desc,callback:function(t){e.$set(e.formData,"desc",t)},expression:"formData.desc"}})],1)],1)],1),e._v(" "),t("div",{staticClass:"bk-service-name"},[t("h1",[t("span",{staticClass:"is-outline"}),e._v(e._s(e.$t("m.trigger['触发机制']")))])]),e._v(" "),t("div",{staticClass:"bk-trigger-made"},[t("bk-form",{ref:"triggerMade",attrs:{"label-width":170,model:e.formData,"form-type":"vertical",rules:e.rules}},[t("bk-form-item",{staticStyle:{width:"300px"},attrs:{label:e.$t("m.trigger['触发事件']"),"data-test-id":"trigger-select-triggerEvent",required:!0,property:"signal"}},[t("bk-select",{attrs:{"data-test-id":"triggers_select_choiceEvent",placeholder:e.$t("m.trigger['请选择触发事件']")},on:{change:function(t){return e.$emit("change")}},model:{value:e.formData.signal,callback:function(t){e.$set(e.formData,"signal",t)},expression:"formData.signal"}},e._l(e.triggerEventList,(function(n,i){return t("bk-option-group",{key:i,attrs:{name:n.name}},e._l(n.children,(function(e){return t("bk-option",{key:e.key,attrs:{id:e.key,name:e.name}})})),1)})),1)],1),e._v(" "),t("bk-form-item",{attrs:{"data-test-id":"trigger-div-triggerRules",label:e.$t("m.trigger['触发规则']"),required:!0}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.contentLoading},expression:"{ isLoading: contentLoading }"}],staticStyle:{"min-height":"300px"}},[e._l(e.rulesList,(function(n,i){return t("div",{key:i,staticClass:"bk-trigger-rule mb10"},[t("div",{staticClass:"bk-rule-title"},[t("div",{staticStyle:{float:"left","margin-right":"10px"}},[n.showContent?t("i",{staticClass:"bk-icon icon-down-shape icon-cus",on:{click:function(t){return e.showContent(n)}}}):t("i",{staticClass:"bk-icon icon-right-shape icon-cus",on:{click:function(t){return e.showContent(n)}}})]),e._v(" "),n.nameChange?t("div",{staticClass:"bk-name-input"},[t("bk-input",{staticStyle:{width:"260px",display:"inline-block"},attrs:{clearable:!0},on:{change:function(t){return e.$emit("change")}},model:{value:n.name,callback:function(t){e.$set(n,"name",t)},expression:"item.name"}}),e._v(" "),t("span",{staticClass:"bk-input-submit",on:{click:function(t){return t.stopPropagation(),e.handleClickName(n,"submit")}}},[e._v(e._s(e.$t("m.trigger['确认']")))]),e._v(" "),t("span",{staticClass:"bk-input-submit",on:{click:function(t){return t.stopPropagation(),e.handleClickName(n,"close")}}},[e._v(e._s(e.$t("m.trigger['取消']")))])],1):t("span",{staticClass:"bk-title-name",on:{click:function(t){return t.stopPropagation(),e.changeName(n)}}},[e._v("\n                "+e._s(n.name||e.$t("m.trigger['规则']")+"-"+(i+1))+"\n              ")]),e._v(" "),1!==e.rulesList.length?[t("i",{staticClass:"bk-icon icon-close icon-nodelete",on:{click:function(t){return t.stopPropagation(),e.deleteRule(i)}}})]:[t("i",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top-start",value:e.$t("m.trigger['规则不能为空']"),expression:"$t(`m.trigger['规则不能为空']`)",modifiers:{"top-start":!0}}],staticClass:"bk-icon icon-close icon-nodelete",attrs:{"data-test-id":"trigger_i_closeTriggerRule"}})],e._v(" "),t("div",{staticClass:"bk-condition-switch"},[t("span",{staticClass:"mr5"},[e._v(e._s(e.$t("m.trigger['条件触发']")))]),e._v(" "),t("bk-switcher",{attrs:{"data-test-id":"triggers_switcher_conditionTriggered",size:"small"},on:{change:function(t){return e.$emit("change")}},model:{value:n.triggerStatus,callback:function(t){e.$set(n,"triggerStatus",t)},expression:"item.triggerStatus"}})],1)],2),e._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:n.showContent,expression:"item.showContent"}]},[n.triggerStatus?t("trigger-condition",{attrs:{"trigger-rules":n.triggerRules}}):e._e(),e._v(" "),t("response-condition",{attrs:{signal:e.formData.signal,"response-way-list":e.responseWayList,"response-list":n.responseList}})],1)])})),e._v(" "),t("p",{staticClass:"bk-add-rules",on:{click:e.addRule}},[t("i",{staticClass:"bk-icon icon-plus-circle"}),t("span",{attrs:{"data-test-id":"trigger_span_addTriggerRules"}},[e._v(e._s(e.$t("m.trigger['添加规则']")))])])],2)])],1)],1),e._v(" "),t("div",{staticClass:"bk-submit-trigger"},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary","data-test-id":"trigger_button_submitTrigger",title:e.$t("m.trigger['确认']"),disabled:e.btnLoading},on:{click:function(t){return e.submitTrigger(!1)}}},[e._v("\n      "+e._s(e.$t("m.trigger['确认']"))+"\n    ")]),e._v(" "),t("bk-button",{staticClass:"mr10",attrs:{theme:"default","data-test-id":"trigger_button_submitTrigger",title:e.$t("m.trigger['保持草稿']"),disabled:e.btnLoading},on:{click:function(t){return e.submitTrigger(!0)}}},[e._v("\n      "+e._s(e.$t("m.trigger['保持草稿']"))+"\n    ")]),e._v(" "),t("bk-button",{attrs:{theme:"default","data-test-id":"trigger_button_KeepDraft",disabled:e.btnLoading,title:e.$t("m.trigger['取消']")},on:{click:e.closeTrigger}},[e._v("\n      "+e._s(e.$t("m.trigger['取消']"))+"\n    ")])],1)])},a=[];i._withStripped=!0},xBbh:function(e,t,n){},xXNg:function(e,t,n){"use strict";n("n6O2")},xY5K:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=p(n("14Xm")),a=p(n("D3Ub")),r=p(n("QbLZ")),o=p(n("PIEm")),s=p(n("GtMo")),c=p(n("s4tT")),l=p(n("bcjM")),u=p(n("LEca")),d=n("CeR/"),f=n("L2JU");function p(e){return e&&e.__esModule?e:{default:e}}var m=[{id:0,name:"00:00"},{id:1,name:"01:00"},{id:2,name:"02:00"},{id:3,name:"03:00"},{id:4,name:"04:00"},{id:5,name:"05:00"},{id:6,name:"06:00"},{id:7,name:"07:00"},{id:8,name:"08:00"},{id:9,name:"09:00"},{id:10,name:"10:00"},{id:11,name:"11:00"},{id:12,name:"12:00"},{id:13,name:"13:00"},{id:14,name:"14:00"},{id:15,name:"15:00"},{id:16,name:"16:00"},{id:17,name:"17:00"},{id:18,name:"18:00"},{id:19,name:"19:00"},{id:20,name:"20:00"},{id:21,name:"21:00"},{id:22,name:"22:00"},{id:23,name:"23:00"}];t.default={name:"ServiceSettingStep",components:{DealPerson:o.default,BasicCard:c.default,collapseTransition:s.default,commonTriggerList:l.default,TaskConfigPanel:u.default},props:{serviceInfo:{type:Object,default:function(){return{}}},flowInfo:{type:Object,default:function(){return{}}}},data:function(){return{frequencyList:m,showMoreConfig:!1,revokeWayList:[{name:this.$t("m['不支持撤回']"),id:"not_support",key:0},{name:this.$t("m.treeinfo['提单后，单据未被处理流转前，提单人可以撤回']"),id:"before_flow",key:2},{name:this.$t("m.treeinfo['任何节点，提单人都可撤回单据']"),id:"all_node",key:1},{name:this.$t("m.treeinfo['指定节点前可以撤回']"),id:"specify_node",key:3}],displayRangeTypes:["OPEN","ORGANIZATION","GENERAL","API"],nodeListLoading:!1,nodeList:[],formData:{visibleRange:{type:"OPEN",value:""},revokeWay:"before_flow",revokeState:0,otherSettings:[],notify_rule:"ONCE",notify_freq:"",notify:["WEIXIN","EMAIL"],is_auto_approve:!1},superviseTypes:["PERSON","GENERAL","STARTER"],supervisePerson:{type:"STARTER",value:""},slaValidateMsg:[],slaValidateDialogShow:!1}},computed:(0,r.default)({openFunction:function(){return this.$store.state.openFunction},processId:function(){return this.serviceInfo.workflow_id}},(0,f.mapState)({noticeType:function(e){return e.common.configurInfo.notify_type}})),watch:{"formData.revokeWay":function(e){"specify_node"!==e||this.nodeList.length||this.getNodeList()}},mounted:function(){this.initData()},methods:{initData:function(){var e=this.serviceInfo,t=e.notify,n=e.display_type,i=e.display_role,a=e.supervisor,r=e.revoke_config,o=e.can_ticket_agency,s=e.is_supervise_needed,c=e.notify_rule,l=e.notify_freq,u=e.supervise_type;try{var d=this.revokeWayList.find((function(e){return e.key===r.type}));this.formData.revokeWay=d?d.id:"not_support",this.formData.revokeState=r.state}catch(e){console.log(e)}this.formData.is_auto_approve=this.flowInfo.is_auto_approve,this.formData.visibleRange={type:n,value:i},this.formData.otherSettings=[],o&&this.formData.otherSettings.push("can_ticket_agency"),s&&this.formData.otherSettings.push("is_supervise_needed"),this.formData.notify=(t||[]).map((function(e){return e.type})),this.formData.notify.length&&(this.formData.notify_rule=c,this.formData.notify_freq=Number(l)/3600),this.supervisePerson={type:"EMPTY"===u?"STARTER":u,value:a}},getNodeList:function(){var e=this;this.nodeListLoading=!0,this.$store.dispatch("deployCommon/getStates",{workflow:this.serviceInfo.workflow_id}).then((function(t){e.nodeList=t.data.filter((function(e){return!e.is_builtin&&"ROUTER-P"!==e.type&&"COVERAGE"!==e.type}))})).catch((function(t){(0,d.errorHandler)(t,e)})).finally((function(){e.nodeListLoading=!1}))},saveAndActionService:function(e){var t=this;return this.$store.dispatch("service/saveAndActionService",{id:this.serviceInfo.id,params:e}).catch((function(e){(0,d.errorHandler)(e,t)})).finally((function(){t.nodeListLoading=!1}))},goToServiceList:function(){this.$router.push({name:"projectServiceList",query:{project_id:this.$store.state.project.id}})},validate:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n,a,r,o,s,c,l,u,d,f,p,m,h,v;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.serviceInfo,a=n.supervisor,r=n.can_ticket_agency,o=n.is_supervise_needed,s=n.supervise_type,c={workflow_config:{supervise_type:s||"EMPTY",supervisor:a||"",revoke_config:{type:0,state:0},is_auto_approve:e.formData.is_auto_approve}},l=c.workflow_config,!e.$refs.displayRange||e.$refs.displayRange.verifyValue()){t.next=5;break}return t.abrupt("return",!1);case 5:if(!e.$refs.taskConfigPanel){t.next=8;break}return t.next=8,e.$refs.taskConfigPanel.validate();case 8:return e.$refs.displayRange&&(u=e.$refs.displayRange.getValue(),c.display_type=u.type,c.display_role=u.value||void 0),l.is_auto_approve=e.formData.is_auto_approve,d=e.formData,f=d.revokeWay,p=d.revokeState,m=d.notify,"not_support"===f?l.is_revocable=!1:(l.is_revocable=!0,h=e.revokeWayList.find((function(e){return e.id===f})).key,l.revoke_config={type:h,state:"specify_node"===f?p:0}),c.can_ticket_agency=r||!1,l.is_supervise_needed=o||!0,l.notify=e.noticeType.filter((function(e){return m.some((function(t){return e.typeName===t}))})),l.notify.forEach((function(e){e.type=e.typeName})),l.notify_freq=0,l.notify_rule="ONCE",e.$refs.taskConfigPanel&&(l.extras={},l.extras.task_settings=e.$refs.taskConfigPanel.getPostParams()),t.next=21,e.saveAndActionService(c);case 21:return v=t.sent,t.next=24,e.$store.dispatch("service/slaValidate",e.serviceInfo.id);case 24:if(v.result){t.next=28;break}return e.slaValidateMsg=v.data.messages,e.slaValidateDialogShow=!0,t.abrupt("return",{data:{result:!1}});case 28:return t.abrupt("return",!0);case 29:case"end":return t.stop()}}),t,e)})))()}}}},xgIe:function(e,t,n){"use strict";n("m4Da")},"xl+m":function(e,t,n){"use strict";n.r(t);var i=n("CPxG"),a=n("1hFm");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("yfOj");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"1dd614c2",null);t.default=s.exports},xpPb:function(e,t,n){"use strict";n.r(t);var i=n("HtfW"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},xsd2:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("jWXv")),a=u(n("rfXi")),r=u(n("m1cH")),o=u(n("vUrO")),s=u(n("PIEm")),c=u(n("PaSM")),l=n("CeR/");function u(e){return e&&e.__esModule?e:{default:e}}t.default={name:"basicInfo",components:{dealPerson:s.default,descInfo:o.default},mixins:[c.default],props:{flowInfo:{type:Object,default:function(){return{}}},nodeInfo:{type:Object,default:function(){return{}}},nodeTagList:{type:Array,default:function(){return[]}},isLoading:{type:Boolean,default:function(){return!1}}},data:function(){return{formInfo:{name:"",desc:"",tag:"",distribute_type:"",ticket_key:"",ticket_type:"",can_deliver:!1},trueStatus:!0,falseStatus:!1,assignorsInfo:{type:"",value:""},excludeProcessor:[],assignorExclude:["BY_ASSIGNOR","EMPTY","OPEN","VARIABLE","API"],deliversExclude:["BY_ASSIGNOR","EMPTY","STARTER","VARIABLE","API","ASSIGN_LEADER","STARTER_LEADER"],assignorsTypeList:["DISTRIBUTE_THEN_PROCESS","DISTRIBUTE_THEN_CLAIM"],processorsInfo:{type:"",value:""},deliversInfo:{type:"",value:""},billStatusList:[{type:"keep",name:this.$t('m.treeinfo["延续上个节点"]')},{type:"custom",name:this.$t('m.treeinfo["自定义"]')}],secondLevelList:[],ticketKeyLoading:!1,sceneList:[],prompt:[{id:"DISTRIBUTE_THEN_PROCESS",prompt:this.$t('m.treeinfo["指该节点动作需要通过派单人分派到指定处理人或者处理角色，被分派到的处理人再进行处理。"]')},{id:"PROCESS",prompt:this.$t('m.treeinfo["单据直接流入到配置好的处理人/角色处理。当有多个处理人时，任何一位处理完成即可流入下个环节。"]')},{id:"CLAIM_THEN_PROCESS",prompt:this.$t('m.treeinfo["指配置好的处理人/角色人员需要主动认领任务。当处理人只有1位时，会自动认领。处理人有2人及以上时，需要主动认领至自己的待办任务中。"]')},{id:"DISTRIBUTE_THEN_CLAIM",prompt:this.$t('m.treeinfo["单据需要派单人进行指派到组或者多人，然后被指派对象进行主动认领。认领完成后才会到自己的待办任务列表中。"]')}],rules:{},checkStatus:{name:!1,assignors:!1,processors:!1,delivers:!1}}},computed:{globalChoise:function(){return this.$store.state.common.configurInfo}},watch:{formInfo:{deep:!0,handler:function(e){this.$emit("baseFormInfoChange",e)}}},mounted:function(){this.initData(),this.getExcludeRoleTypeList(),this.rules.name=this.commonRules.name},methods:{initData:function(){var e=this;this.sceneList=[],this.globalChoise.distribute_type.forEach((function(t){e.nodeInfo.is_builtin?e.sceneList=[{typeName:"PROCESS",name:e.$t('m.treeinfo["直接处理"]')}]:e.sceneList.push({typeName:t.typeName,name:t.name})})),this.formInfo.name=this.nodeInfo.name,this.formInfo.desc=this.nodeInfo.desc,this.formInfo.tag=this.nodeInfo.tag||"",this.formInfo.distribute_type=this.nodeInfo.distribute_type,this.assignorsTypeList.some((function(t){return t===e.formInfo.distribute_type}))&&(this.assignorsInfo={type:this.nodeInfo.assignors_type,value:this.nodeInfo.assignors}),this.processorsInfo={type:this.nodeInfo.processors_type,value:this.nodeInfo.processors},this.formInfo.ticket_type=this.nodeInfo.extras.ticket_status?this.nodeInfo.extras.ticket_status.type:"keep",this.formInfo.ticket_key=this.nodeInfo.extras.ticket_status?this.nodeInfo.extras.ticket_status.name:"","custom"===this.formInfo.ticket_type&&this.getSecondLevelList(),this.formInfo.can_deliver=this.nodeInfo.can_deliver,this.formInfo.can_deliver&&(this.deliversInfo={type:this.nodeInfo.delivers_type,value:this.nodeInfo.delivers})},getExcludeRoleTypeList:function(){var e=[],t=this.nodeInfo.is_first_state;e=this.nodeInfo.is_builtin?["BY_ASSIGNOR","STARTER","VARIABLE"]:["OPEN"],t&&e.push("STARTER_LEADER"),"DISTRIBUTE_THEN_PROCESS"!==this.nodeInfo.distribute_type&&"DISTRIBUTE_THEN_CLAIM"!==this.nodeInfo.distribute_type&&e.push("BY_ASSIGNOR"),this.flowInfo.is_biz_needed||(e.push("CMDB"),this.deliversExclude.push("CMDB")),this.excludeProcessor=["EMPTY","API"].concat((0,r.default)(e))},changeDistribute:function(e){this.getExcludeRoleTypeList(),this.excludeProcessor=(0,a.default)(new i.default([].concat((0,r.default)(this.excludeProcessor),["BY_ASSIGNOR","VARIABLE"]))),"DISTRIBUTE_THEN_PROCESS"!==e&&"DISTRIBUTE_THEN_CLAIM"!==e||(this.excludeProcessor=this.excludeProcessor.filter((function(e){return"BY_ASSIGNOR"!==e}))),"PROCESS"===e&&(this.excludeProcessor=this.excludeProcessor.filter((function(e){return"VARIABLE"!==e}))),this.assignorsInfo={type:"",value:""}},handleTicket:function(e){this.formInfo.ticket_key="","custom"===e&&(this.secondLevelList.length||this.getSecondLevelList())},getSecondLevelList:function(){var e=this;this.ticketKeyLoading=!0,this.$store.dispatch("ticketStatus/getOverallTicketStatuses").then((function(t){e.secondLevelList=t.data})).catch((function(t){(0,l.errorHandler)(t,e)})).finally((function(){e.ticketKeyLoading=!1}))},backBasicInfo:function(){this.checkBasic();var e={};if(e.name=this.formInfo.name,e.desc=this.formInfo.desc||void 0,this.checkStatus.name=!this.formInfo.name,e.tag=this.formInfo.tag,e.distribute_type=this.formInfo.distribute_type,e.assignors_type="EMPTY",e.assignors="",this.$refs.assignors){var t=this.$refs.assignors.getValue();e.assignors_type=t.type,e.assignors=t.value,this.checkStatus.assignors=!this.$refs.assignors.verifyValue()}if(e.processors_type="",e.processors="",this.$refs.processors){var n=this.$refs.processors.getValue();e.processors_type=n.type,e.processors=n.value,this.checkStatus.processors=!this.$refs.processors.verifyValue()}if(e.ticket_type=this.formInfo.ticket_type,e.ticket_key="custom"===this.formInfo.ticket_type?this.formInfo.ticket_key:"",e.can_deliver=this.formInfo.can_deliver,e.delivers_type="EMPTY",e.delivers="",this.$refs.delivers){var i=this.$refs.delivers.getValue();e.delivers_type=i.type,e.delivers=i.value,this.checkStatus.delivers=!this.$refs.delivers.verifyValue()}return e},checkBasic:function(){this.$refs.basicForm.validate().then((function(){}),(function(e){console.error(e)}))}}}},y5Cw:function(e,t,n){"use strict";n("rcsN")},y7UH:function(e,t,n){"use strict";n.r(t);var i=n("SPZl"),a=n("gLev");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("JrgT");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"15f53f70",null);t.default=s.exports},"yX+q":function(e,t,n){"use strict";n.r(t);var i=n("fc+3"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},ybrk:function(e,t,n){"use strict";n.r(t);var i=n("/nBP"),a=n("iesT");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);n("UCAk");var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,"9d704a3e",null);t.default=s.exports},yfOj:function(e,t,n){"use strict";n("jK1o")},ymPp:function(e,t,n){"use strict";n.r(t);var i=n("7DqX"),a=n.n(i);for(var r in i)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return i[e]}))}(r);t.default=a.a},"z/5e":function(e,t,n){e.exports={default:n("Nxk6"),__esModule:!0}},"z/kA":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=l(n("gDS+")),a=l(n("u8Ap")),r=l(n("ybrk")),o=l(n("hk/f")),s=n("dGg1"),c=n("CeR/");function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"defaultValue",components:{memberSelect:a.default,RichTextEditor:r.default,CodeEditor:o.default},props:{formInfo:{type:Object,default:function(){return{}}},fieldInfo:{type:Object,default:function(){return{}}},dictionaryData:{type:Object,default:function(){return{}}},changeInfo:{type:Object,default:function(){return{}}},label:{type:String,default:""},checkStatus:{type:Object,default:function(){return{}}}},data:function(){return{selectList:[],updateStatus:!1,typeList:["MULTISELECT","CHECKBOX","MEMBERS","MEMBER"],precision:0}},watch:{"formInfo.source_type":function(){var e=this;this.updateStatus&&(this.formInfo.default_value=this.typeList.some((function(t){return t===e.formInfo.type}))?[]:""),this.formInfo.source_type!==this.changeInfo.source_type&&(this.updateStatus=!0,this.formInfo.default_value=this.typeList.some((function(t){return t===e.formInfo.type}))?[]:""),"API"!==this.formInfo.source_type&&"RPC"!==this.formInfo.source_type||(this.formInfo.default_value="")},"formInfo.type":function(){var e=this;this.updateStatus&&(this.formInfo.default_value=this.typeList.some((function(t){return t===e.formInfo.type}))?[]:""),this.formInfo.type!==this.changeInfo.type&&(this.updateStatus=!0,this.formInfo.default_value=this.typeList.some((function(t){return t===e.formInfo.type}))?[]:""),"API"!==this.formInfo.source_type&&"RPC"!==this.formInfo.source_type||(this.formInfo.default_value="")},"formInfo.default_value":function(){"CUSTOM-FORM"===this.formInfo.type&&(this.checkStatus.customFormStatus=!1)}},mounted:function(){this.changeInfo.id&&"DATADICT"===this.changeInfo.source_type&&this.getDictionList(this.changeInfo.source_uri),""!==this.formInfo.default_value&&this.getSelectList(this.formInfo.default_value)},methods:{getSelectList:function(e){this.selectList=[],e&&("CUSTOM"===this.formInfo.source_type?this.selectList=this.fieldInfo.list.filter((function(e){return e.key&&e.name})):"DATADICT"===this.formInfo.source_type?this.dictionaryData.check&&this.getDictionList(this.dictionaryData.check):"API"!==this.formInfo.source_type&&"RPC"!==this.formInfo.source_type||this.getApiList())},getDictionList:function(e){var t=this,n={key:e};this.$store.dispatch("datadict/get_data_by_key",n).then((function(e){t.selectList=e.data})).catch((function(e){(0,c.errorHandler)(e,t)}))},downCustomFormTempalte:function(){var e=document.createElement("a"),t=+new Date;e.download="bk_itsm_custom_form_template_"+t+".json",e.href="data:text/plain,"+(0,i.default)(s.CUSTOM_FORM_TEMPLATE,null,4),e.click()},getApiList:function(){}}}},z1yn:function(e,t,n){"use strict";n.r(t);var i=n("8aPs"),a=n("wegR");for(var r in a)["default"].indexOf(r)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(r);var o=n("KHd+"),s=Object(o.a)(a.default,i.a,i.b,!1,null,null,null);t.default=s.exports},zCbU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=o(n("u8Ap")),a=o(n("db1v")),r=n("CeR/");function o(e){return e&&e.__esModule?e:{default:e}}t.default={name:"COMPLEX-MEMBERS",components:{SelectTree:a.default,memberSelect:i.default},props:{item:{type:Object,default:function(){return{}}},fields:{type:Array,default:function(){return[]}},isCurrent:{type:Boolean,default:!1},checkValue:{type:Object,default:function(){return{}}},disabled:{type:Boolean,default:!1}},data:function(){return{isLoading:!1,formData:{levelOne:"",levelSecond:[]},secondLevelList:[],organizationList:[]}},computed:{firstLevelList:function(){var e=this.$store.state.common.configurInfo.processor_type,t=["OPEN","STARTER","BY_ASSIGNOR","EMPTY","VARIABLE","CMDB","ORGANIZATION"];return e.filter((function(e){return!t.some((function(t){return t===e.typeName}))}))}},mounted:function(){this.formData.levelOne="PERSON",this.getSecondLevelList(this.formData.levelOne)},methods:{getSecondLevelList:function(e){this.formData.levelSecond=[],this.secondLevelList=[],"ORGANIZATION"===e?(this.formData.levelSecond="",this.getOrganization()):"PERSON"===e?this.secondLevelList=[]:"GENERAL"===e?(this.formData.levelSecond="",this.secondListFn(e)):this.secondListFn(e)},secondListFn:function(e){var t=this;e&&(this.isLoading=!0,this.$store.dispatch("deployCommon/getSecondUser",{role_type:e,project_key:this.$store.state.project.id}).then((function(n){var i=n.data,a=[];"GENERAL"===e?i.forEach((function(e){a.push({id:String(e.id),name:e.name+"("+e.count+")",disabled:0===e.count})})):i.forEach((function(e){a.push({id:String(e.id),name:e.name})})),t.secondLevelList=a})).catch((function(e){(0,r.errorHandler)(e,t)})).finally((function(){t.isLoading=!1})))},getOrganization:function(){var e=this;this.$store.dispatch("cdeploy/getTreeInfo").then((function(t){e.organizationList=t.data})).catch((function(t){(0,r.errorHandler)(t,e)}))}}}},zGLV:function(e,t,n){},zO7g:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var i=function(){var e=this,t=e._self._c;return t("bk-form-item",[e.isEdit?t("bk-input",{ref:"input",staticStyle:{width:"450px"},attrs:{behavior:"simplicity",maxlength:64,placeholder:e.$t("m.systemConfig['请输入描述']"),type:"textarea"},on:{blur:function(t){return t.target!==t.currentTarget?null:e.change.apply(null,arguments)}},model:{value:e.desc,callback:function(t){e.desc=t},expression:"desc"}}):t("div",{staticStyle:{"font-size":"12px",color:"#63656e",width:"450px","word-wrap":"break-word","line-height":"16px"}},[e.value?e._e():t("span",[e._v(e._s(e.$t("m['当前节点未设置节点描述']")))]),e._v("\n    "+e._s(e.desc)+"\n    "),t("i",{staticClass:"bk-itsm-icon icon-edit-bold edit-icon",staticStyle:{"font-size":"16px"}}),e._v(" "),t("span",{staticStyle:{color:"#3a84ff"},on:{click:e.edit}},[e._v(e._s(e.$t("m['点击修改']")))])])],1)},a=[];i._withStripped=!0},zcr8:function(e,t,n){},zfNu:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=s(n("GQeE")),a=s(n("gDS+")),r=s(n("QbLZ")),o=s(n("5hmv"));function s(e){return e&&e.__esModule?e:{default:e}}t.default={name:"FILE",components:{customUpload:o.default},props:{item:{type:Object,required:!0,default:function(){}},idInfo:{type:Object,required:!1,default:function(){return null}},isCurrent:{type:Boolean,default:!1},isFilePreview:{type:Boolean,default:!1},isBuild:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},data:function(){return{datas:[],uploadFileList:[],tempFileList:[],historyList:[],url:this.isFilePreview?"":window.SITE_URL+"api/misc/upload_file/",tempObj:{}}},mounted:function(){this.item.val=[],this.choiceToList()},methods:{choiceToList:function(){for(var e in this.item.choice)this.tempFileList.push((0,r.default)({},this.item.choice[e],{key:e}));if(this.item.value){var t=JSON.parse(this.item.value);for(var n in t)this.historyList.push((0,r.default)({},t[n],{key:n}));this.datas=this.historyList.concat([]),this.item.val="";var i=[];this.datas.forEach((function(e){var t={};t[e.key]={path:e.path,name:e.name},i.push((0,a.default)(t))})),this.item.val=i.join(",")}},downloadFile:function(e){var t=e.key;this.isBuild?window.open(window.SITE_URL+"api/ticket/fields/"+this.item.id+"/download_file/?unique_key="+t+"&file_type=version&flow_id="+this.item.version_id):this.isCurrent?window.open(window.SITE_URL+"api/ticket/fields/"+this.item.id+"/download_file/?unique_key="+t+"&file_type=template"):window.open(window.SITE_URL+"api/workflow/fields/"+this.item.id+"/download_file/?unique_key="+t+"&file_type=template")},uploadErr:function(){},uploadSuccess:function(e){var t=this;this.datas=e,this.uploadFileList=e,this.item.value="",this.item.val=this.item.value,e.forEach((function(e){if(!e.errorMsg&&e.responseData.data)for(var n in e.responseData.data.succeed_files)t.$set(t.tempObj,n,e.responseData.data.succeed_files[n])})),this.historyList.length&&(this.datas=this.datas.concat(this.historyList),this.historyList.forEach((function(e){t.tempObj[e.key]={path:e.path,name:e.name}}))),this.item.value=(0,a.default)(this.tempObj),this.item.val=this.item.value},uploadProgress:function(){this.$store.commit("changeFileStatus",!0)},uploadDone:function(){this.$store.commit("changeFileStatus",!1)},deleteFile:function(e){if(this.datas.splice(this.datas.indexOf(e),1),this.historyList.length&&this.historyList.some((function(t){return t.key===e.key})))for(var t in this.historyList=this.historyList.filter((function(t){return t.key!==e.key})),this.tempObj)t===e.key&&delete this.tempObj[t];else for(var n in this.tempObj)for(var r in e.responseData.data.succeed_files)n===r&&delete this.tempObj[n];var o=this.uploadFileList.indexOf(e);-1!==o&&this.$refs.upload.deleteFile(o,e),(0,i.default)(this.tempObj).length?this.item.val=(0,a.default)(this.tempObj):this.item.val=""}}}},zi6X:function(e,t,n){},zmPZ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=u(n("14Xm")),a=u(n("D3Ub")),r=u(n("gDS+")),o=u(n("u8Ap")),s=u(n("3eLr")),c=n("CeR/"),l=n("ygAv");function u(e){return e&&e.__esModule?e:{default:e}}t.default={name:"dealPerson",components:{bkTree:s.default,memberSelect:o.default},props:{value:{type:Object,default:function(){return{type:"",value:[]}}},specifyIdList:{type:Array,default:function(){return[]}},excludeRoleTypeList:{type:Array,default:function(){return[]}},showRoleTypeList:{type:Array,default:function(){return[]}},nodeInfo:{type:Object,default:function(){return{}}},formType:{type:String,default:""},shortcut:{type:Boolean,default:!1},requiredMsg:{type:String,default:""},showOverbook:{type:Boolean,default:!1}},data:function(){return{showError:!1,initLoaing:!1,isLoading:!1,organizationLoading:!1,formData:{levelOne:"",levelSecond:[]},allUserlist:[],firstLevelList:[],secondLevelList:[],organizationList:[],frontMemberField:[],secondLevelRange:{},noSecondTypeList:["EMPTY","OPEN","STARTER","BY_ASSIGNOR","STARTER_LEADER"],organizationTip:{show:!1,count:""}}},computed:{targetSpecifyIdList:function(){var e=this,t=this.specifyIdList.find((function(t){return t.type===e.formData.levelOne}));return t?t.list:[]}},watch:{value:{handler:function(e,t){(0,r.default)(e)!==(0,r.default)(t)&&this.initData()},deep:!0},showRoleTypeList:{handler:function(){this.initData()},deep:!0},excludeRoleTypeList:{handler:function(){this.initData()},deep:!0}},created:function(){this.setDeaultSecondLeve(this.value.type)},mounted:function(){var e=this;return(0,a.default)(i.default.mark((function t(){return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.initData();case 1:case"end":return t.stop()}}),t,e)})))()},methods:{toggleInfo:function(e){!this.nodeInfo.is_builtin&&this.showOverbook&&this.getOrganizationNumber(e.id)},initData:function(){var e=this;return(0,a.default)(i.default.mark((function t(){var n,a;return i.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.initLoaing=!0,t.next=3,e.getRoleGroup();case 3:n=e.value.type,e.firstLevelList.find((function(e){return e.id===n}))&&(a="ORGANIZATION"===n||"ASSIGN_LEADER"===n?e.value.value:e.value.value?e.value.value.split(",").filter((function(e){return""!==e})):[],e.formData={levelOne:n,levelSecond:a}),n&&e.getSecondLevelList(n),e.initLoaing=!1;case 7:case"end":return t.stop()}}),t,e)})))()},getRoleGroup:function(){var e=this;if(!this.allUserlist.length)return this.$store.dispatch("deployCommon/getUser",{is_processor:!0,project_key:this.$store.state.project.id}).then((function(t){e.allUserlist=t.data,e.getFirstLevelList(t.data)})).catch((function(t){(0,c.errorHandler)(t,e)}));this.getFirstLevelList(this.allUserlist)},getFirstLevelList:function(e){var t=this;this.firstLevelList=e.filter((function(e){return t.excludeRoleTypeList.length?!t.excludeRoleTypeList.includes(e.type):!t.showRoleTypeList.length||t.showRoleTypeList.includes(e.type)})).map((function(e){return{id:e.type,name:e.name}}))},setDeaultSecondLeve:function(e){switch(e){case"ORGANIZATION":case"ASSIGN_LEADER":this.formData.levelSecond="";break;default:this.formData.levelSecond=[]}this.secondLevelList=[]},getSecondLevelList:function(e){this.noSecondTypeList.includes(e)||("ORGANIZATION"===e?this.getOrganization():"ASSIGN_LEADER"===e?this.getPreStates():"VARIABLE"===e?this.getFrontNodesList():this.secondListFn(e))},getOrganizationNumber:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){var a;return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.showOverbook){n.next=5;break}return n.next=3,t.$store.dispatch("common/getOrganizationNumber",e);case 3:(a=n.sent).data.count>100&&(t.organizationTip.count=a.data.count,t.organizationTip.show=!0);case 5:case"end":return n.stop()}}),n,t)})))()},cancelSelect:function(){this.formData.levelOne="PERSON",this.formData.levelSecond=[]},onFirstLevelChange:function(e){var t=this;return(0,a.default)(i.default.mark((function n(){return i.default.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t.$set(t.formData,"levelSecond",[]),t.setDeaultSecondLeve(e),t.getSecondLevelList(e);case 3:case"end":return n.stop()}}),n,t)})))()},secondListFn:function(e){var t=this;if(e){var n={role_type:e,project_key:this.$store.state.project.id||this.$route.query.project.id};this.shortcut&&(n.scope="shortcut"),this.isLoading=!0,this.$store.dispatch("deployCommon/getSecondUser",n).then((function(n){var i=[];i=n.data.map((function(n){if("GENERAL"===e){var i=t.shortcut?"":"("+n.count+")";return{id:String(n.id),name:n.name+i,disabled:0===n.count}}return"API"===e?{id:n.role_key,name:n.name}:{id:String(n.id),name:n.name}})),t.targetSpecifyIdList.length&&"GENERAL"!==e&&(i=i.filter((function(e){return t.targetSpecifyIdList.some((function(t){return String(t)===e.id}))}))),t.secondLevelList=i})).catch((function(e){(0,c.errorHandler)(e,t)})).finally((function(){t.isLoading=!1}))}},getOrganization:function(){var e=this;this.organizationLoading=!0,this.$store.dispatch("cdeploy/getTreeInfo").then((function(t){e.organizationList=t.data,e.organizationList.forEach((function(t){e.$set(t,"route",[])}))})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.organizationLoading=!1}))},getFrontNodesList:function(){var e=this;this.isLoading=!0;var t={workflow:this.nodeInfo.workflow,state:this.nodeInfo.id,exclude_self:!0};return this.$store.dispatch("apiRemote/get_related_fields",t).then((function(t){e.secondLevelList=t.data.filter((function(e){return"MEMBERS"===e.type&&"REQUIRE"===e.validate_type||"MEMBER"===e.type&&"REQUIRE"===e.validate_type})).map((function(e){return{id:e.key,name:e.name}}))})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.isLoading=!1}))},getPreStates:function(){var e=this;this.isLoading=!0,this.$store.dispatch("deployCommon/getPreStates",{id:this.nodeInfo.id}).then((function(t){e.secondLevelList=t.data.filter((function(e){return!["ROUTER-P","COVERAGE"].includes(e.type)})).map((function(e){return{id:e.id,name:e.name}}))})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.isLoading=!1}))},verifyValue:function(){var e=!1;return e=this.formData.levelOne&&!this.noSecondTypeList.includes(this.formData.levelOne)?(0,l.isEmpty)(this.formData.levelOne)||(0,l.isEmpty)(this.formData.levelSecond):(0,l.isEmpty)(this.formData.levelOne),this.showError=e,!e},getValue:function(){var e=this.formData.levelSecond;return Array.isArray(this.formData.levelSecond)&&(e=e.join(",")),{value:e||"",type:this.formData.levelOne}}}}},zsCw:function(e,t,n){}}]);