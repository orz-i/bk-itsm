(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"+cdg":function(t,e,s){"use strict";s.r(e);var n=s("q3MV"),a=s.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);e.default=a.a},"365z":function(t,e,s){"use strict";s.r(e);var n=s("AxH8"),a=s.n(n);for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);e.default=a.a},"65S8":function(t,e,s){},AxH8:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=r(s("Ah+g")),a=r(s("X7Jf")),i=r(s("PaSM")),o=s("CeR/");function r(t){return t&&t.__esModule?t:{default:t}}e.default={name:"SystemLogs",components:{searchInfo:n.default,logsInfo:a.default},mixins:[i.default],data:function(){return{isDataLoading:!1,secondClick:!1,dataList:[],pagination:{current:1,count:10,limit:10},checkList:[],moreSearch:[{name:this.$t('m.systemConfig["接口地址"]'),placeholder:this.$t('m.systemConfig["请输入接口地址"]'),typeKey:"name__contains",type:"input",value:"",list:[]},{name:this.$t('m.systemConfig["请求方法"]'),type:"select",typeKey:"method",value:"",list:[{key:"GET",name:"GET"},{key:"POST",name:"POST"},{key:"PUT",name:"PUT"},{key:"DELETE",name:"DELETE"},{key:"PATCH",name:"PATCH"}]},{name:this.$t('m.systemConfig["状态码"]'),type:"select",typeKey:"status",value:"",list:[{key:"20X",name:"20X"},{key:"30X",name:"30X"},{key:"40X",name:"40X"},{key:"50X",name:"50X"}]},{name:this.$t('m.systemConfig["接口ID"]'),type:"input",typeKey:"api_instance_id",value:"",list:[]},{name:this.$t('m.systemConfig["单据ID"]'),type:"input",typeKey:"ticket_id",value:"",list:[]},{name:this.$t('m.systemConfig["请求时间"]'),type:"datetime",value:"",list:[]}],customSettings:{isShow:!1,title:this.$t('m.systemConfig["日志详情"]'),width:700,logsObject:{}}}},computed:{sliderStatus:function(){return this.$store.state.common.slideStatus}},mounted:function(){this.getList()},methods:{getList:function(t){var e=this;void 0!==t&&(this.pagination.current=t),this.checkList=[];var s={page:this.pagination.current,page_size:this.pagination.limit};this.moreSearch.forEach((function(t){if("datetime"===t.type&&t.value&&t.value[0]){var e=new Date(t.value[0]),n=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds(),a=new Date(t.value[1]),i=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();s.date_created__gte=n,s.date_created__lte=i}else t.value&&t.typeKey&&(s[t.typeKey]=Array.isArray(t.value)?t.value.join(","):t.value)})),this.isDataLoading=!0,this.$store.dispatch("systemLog/list",s).then((function(t){e.dataList=t.data.items,e.pagination.current=t.data.page,e.pagination.count=t.data.count})).catch((function(t){(0,o.errorHandler)(t,e)})).finally((function(){e.isDataLoading=!1}))},handlePageLimitChange:function(){this.pagination.limit=arguments[0],this.getList()},handlePageChange:function(t){this.pagination.current=t,this.getList()},handleSelectAll:function(t){this.checkList=t},handleSelect:function(t){this.checkList=t},seeLogs:function(t){this.customSettings.logsObject=t,this.customSettings.isShow=!0},exportLog:function(t){window.open(window.SITE_URL+"api/tracker/records/"+t.id+"/exports/")},exportLogs:function(){var t=this.checkList.map((function(t){return t.id})).join(",");window.open(window.SITE_URL+"api/tracker/records/batch_exports/?logs="+t)},searchContent:function(){this.getList(1)},searchMore:function(){this.$refs.searchInfo.searchMore()},clearSearch:function(){this.moreSearch.forEach((function(t){t.value=""})),this.getList(1)}}}},CjBi:function(t,e,s){"use strict";s("65S8")},KBnj:function(t,e,s){"use strict";s.d(e,"a",(function(){return n})),s.d(e,"b",(function(){return a}));var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bk-itsm-service"},[e("div",{staticClass:"is-title",class:{"bk-title-left":!t.sliderStatus}},[e("p",{staticClass:"bk-come-back"},[t._v("\n      "+t._s(t.$t('m.navigation["接口日志"]'))+"\n    ")])]),t._v(" "),e("div",{staticClass:"itsm-page-content"},[e("div",{staticClass:"bk-only-btn"},[e("div",{staticClass:"bk-more-search"},[e("bk-button",{attrs:{theme:"primary",title:t.$t("m.systemConfig['批量导出']"),disabled:0===t.checkList.length},on:{click:t.exportLogs}},[t._v("\n          "+t._s(t.$t("m.systemConfig['批量导出']"))+"\n        ")]),t._v(" "),e("div",{staticClass:"bk-search-name"},[e("div",{staticClass:"bk-search-content"},[e("bk-input",{attrs:{placeholder:t.moreSearch[0].placeholder||t.$t("m.deployPage['请输入流程名']"),clearable:!0,"right-icon":"bk-icon icon-search"},on:{enter:t.searchContent,clear:t.clearSearch},model:{value:t.moreSearch[0].value,callback:function(e){t.$set(t.moreSearch[0],"value",e)},expression:"moreSearch[0].value"}})],1),t._v(" "),e("bk-button",{staticClass:"ml10 filter-btn",attrs:{title:t.$t("m.deployPage['更多筛选条件']"),icon:" bk-itsm-icon icon-search-more"},on:{click:t.searchMore}})],1)],1),t._v(" "),e("search-info",{ref:"searchInfo",attrs:{"more-search":t.moreSearch}})],1),t._v(" "),e("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],attrs:{data:t.dataList,size:"small",pagination:t.pagination},on:{"page-change":t.handlePageChange,"page-limit-change":t.handlePageLimitChange,"select-all":t.handleSelectAll,select:t.handleSelect}},[e("bk-table-column",{attrs:{type:"selection",width:"60",align:"center"}}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['接口地址']"),width:"350"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{staticClass:"bk-lable-primary",attrs:{title:s.row.url},on:{click:function(e){return t.seeLogs(s.row)}}},[t._v("\n            "+t._s(s.row.url||"--")+"\n          ")])]}}])}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['请求方法']")},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{attrs:{title:s.row.method}},[t._v(t._s(s.row.method||"--"))])]}}])}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['状态']")},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{attrs:{title:s.row.status_code}},[t._v(t._s(s.row.status_code))])]}}])}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['请求时间']")},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{attrs:{title:s.row.date_created}},[t._v(t._s(s.row.date_created||"--"))])]}}])}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['耗时']")},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{attrs:{title:s.row.duration}},[t._v(t._s(s.row.duration||"--"))])]}}])}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['接口ID']")},scopedSlots:t._u([{key:"default",fn:function(s){return[e("span",{attrs:{title:s.row.api_instance_id}},[t._v(t._s(s.row.api_instance_id))])]}}])}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.systemConfig['操作']"),width:"150"},scopedSlots:t._u([{key:"default",fn:function(s){return[e("bk-button",{attrs:{theme:"primary",text:""},on:{click:function(e){return t.exportLog(s.row)}}},[t._v("\n            "+t._s(t.$t('m.systemConfig["导出"]'))+"\n          ")])]}}])})],1)],1),t._v(" "),e("div",{staticClass:"bk-logs"},[e("bk-sideslider",{attrs:{"is-show":t.customSettings.isShow,title:t.customSettings.title,"quick-close":!0,width:t.customSettings.width},on:{"update:isShow":function(e){return t.$set(t.customSettings,"isShow",e)},"update:is-show":function(e){return t.$set(t.customSettings,"isShow",e)}}},[t.customSettings.isShow?e("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},[e("logs-info",{attrs:{"logs-object":t.customSettings.logsObject}})],1):t._e()])],1)])},a=[];n._withStripped=!0},KqpY:function(t,e,s){"use strict";s.d(e,"a",(function(){return n})),s.d(e,"b",(function(){return a}));var n=function(){var t=this,e=t._self._c;return e("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],staticClass:"bk-logs-info"},[e("div",{staticClass:"bk-logs-basic"},[e("h3",{staticClass:"bk-basic-h3"},[t._v(t._s(t.$t('m.systemConfig["基本信息"]')))]),t._v(" "),e("ul",t._l(t.basicList,(function(s,n){return e("li",{key:n},[e("span",[t._v(t._s(s.name)+"：")]),t._v(" "),e("span",{staticClass:"bk-basic-value"},[t._v(t._s(s.value||"--"))])])})),0)]),t._v(" "),e("div",{staticClass:"bk-logs-basic"},[e("h3",{staticClass:"bk-basic-h3"},[t._v(t._s(t.$t('m.systemConfig["请求参数"]')))]),t._v(" "),e("div",{staticClass:"bk-basic-form"},[e("div",{staticClass:"bk-form-content",attrs:{id:"#editorRequest"}},[e("ace",{attrs:{value:t.requestResponse.request,width:t.requestResponse.width,height:t.requestResponse.height,"read-only":t.requestResponse.readOnly,lang:t.requestResponse.lang,"full-screen":t.requestResponse.fullScreen,theme:"monokai"}})],1)])]),t._v(" "),e("div",{staticClass:"bk-logs-basic"},[e("h3",{staticClass:"bk-basic-h3"},[t._v(t._s(t.$t('m.systemConfig["返回结果"]')))]),t._v(" "),e("div",{staticClass:"bk-basic-form"},[e("div",{staticClass:"bk-form-content",attrs:{id:"#editorBack"}},[e("ace",{attrs:{value:t.requestResponse.response,width:t.requestResponse.width,height:t.requestResponse.height,"read-only":t.requestResponse.readOnly,lang:t.requestResponse.lang,"full-screen":t.requestResponse.fullScreen,theme:"monokai"}})],1)])])])},a=[];n._withStripped=!0},Qgr7:function(t,e,s){},Uxn3:function(t,e,s){"use strict";s("Qgr7")},X7Jf:function(t,e,s){"use strict";s.r(e);var n=s("KqpY"),a=s("+cdg");for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);s("Uxn3");var o=s("KHd+"),r=Object(o.a)(a.default,n.a,n.b,!1,null,"91b50fb6",null);e.default=r.exports},bLBV:function(t,e,s){"use strict";s.r(e);var n=s("KBnj"),a=s("365z");for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);s("CjBi");var o=s("KHd+"),r=Object(o.a)(a.default,n.a,n.b,!1,null,"b513be96",null);e.default=r.exports},q3MV:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(s("gDS+")),a=s("CeR/"),i=o(s("zP2a"));function o(t){return t&&t.__esModule?t:{default:t}}e.default={name:"logsInfo",components:{ace:i.default},props:{logsObject:{type:Object,default:function(){return{}}}},data:function(){return{basicList:[{name:this.$t('m.systemConfig["接口地址"]'),value:"",key:"url"},{name:this.$t('m.systemConfig["请求方法"]'),value:"",key:"method"},{name:this.$t('m.systemConfig["状态"]'),value:"",key:"status_code"},{name:this.$t('m.systemConfig["请求时间"]'),value:"",key:"date_created"},{name:this.$t('m.systemConfig["耗时"]'),value:"",key:"duration"},{name:this.$t('m.systemConfig["接口ID"]'),value:"",key:"api_instance_id"},{name:this.$t('m.systemConfig["单据ID"]'),value:"",key:"ticket_id"},{name:this.$t('m.systemConfig["节点ID"]'),value:"",key:"state_id"}],requestResponse:{response:"",request:"",width:"100%",height:300,readOnly:!0,fullScreen:!0,lang:"json"},isDataLoading:!1}},mounted:function(){this.initData()},methods:{initData:function(){var t=this;this.isDataLoading=!0,this.$store.dispatch("systemLog/retrive",this.logsObject.id).then((function(e){for(var s=0;s<t.basicList.length;s++){var a=t.basicList[s];a.value=e.data[a.key]}t.requestResponse.request=e.data.request_message,t.requestResponse.response=(0,n.default)(e.data.response_message,null,4)})).catch((function(e){(0,a.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}))}}}},zP2a:function(t,e,s){"use strict";t.exports={template:'<div :style="{height: calcSize(height), width: calcSize(width)}"></div>',props:{value:{type:String,default:""},width:{type:[Number,String],default:500},height:{type:[Number,String],default:300},lang:{type:String,default:"text"},theme:{type:String,default:"monokai"},readOnly:{type:Boolean,default:!1},fullScreen:{type:Boolean,default:!1},hasError:{type:Boolean,default:!1},fontSize:{type:Number,default:14}},data:function(){return{$editor:null}},watch:{value:function(t){this.$editor&&this.$editor.setValue&&this.$editor.setValue(t,1)},fullScreen:function(){this.$el.classList.toggle("ace-full-screen"),this.$editor.resize()}},methods:{calcSize:function(t){var e=t.toString();return e.match(/^\d*$/)?t+"px":e.match(/^[0-9]?%$/)?e:"100%"}},mounted:function(){var t=this;this.$editor=this.$ace.edit(this.$el);var e=this.$editor,s=this.lang,n=void 0===s?"javascript":s,a=this.theme,i=void 0===a?"monokai":a,o=this.readOnly,r=this.fontSize,l=e.getSession();this.$editor.setFontSize(r),this.$emit("init",e),l.setMode("ace/mode/"+n),e.setTheme("ace/theme/"+i),e.setTheme("ace/theme/textmate"),l.setUseWrapMode(!0),e.setValue(this.value,1),e.setReadOnly(o),e.setShowPrintMargin(!1),e.on("change",(function(s,n){var a=e.getValue();t.$emit("update:hasError",!a),t.$emit("input",a,s,n)})),e.on("blur",(function(s,n){var a=e.getValue();t.$emit("update:hasError",!a),t.$emit("blur",a,s,n)})),l.on("changeAnnotation",(function(e,s){var n=s.$annotations;n&&n.length&&t.$emit("change-annotation",n)}))}}}}]);