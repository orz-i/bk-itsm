(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{"+cUO":function(t,e,s){"use strict";s.r(e);var a=s("Llq7"),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e.default=n.a},"/f1G":function(t,e,s){t.exports={default:s("nhzr"),__esModule:!0}},FQ3n:function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return n}));var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"bk-itsm-service"},[e("div",{staticClass:"is-title",class:{"bk-title-left":!t.sliderStatus}},[e("p",{staticClass:"bk-come-back"},[t._v("\n      "+t._s(t.$t('m["全局配置"]'))+"\n    ")])]),t._v(" "),e("div",{staticClass:"itsm-page-content"},[e("div",{staticClass:"bk-system-file"},[e("div",{staticClass:"bk-file-left"},[e("p",{staticClass:"bk-left-title"},[t._v(t._s(t.$t('m.home["附件存储"]')))]),t._v(" "),e("div",{staticClass:"bk-left-content"},[e("p",{staticClass:"bk-left-message"},[t.moduleInfo.systemPath.formerValue?e("span",[t._v(t._s(t.$t('m.home["当前存放附件文件的目录为"]'))+"：")]):e("span",[t._v("\n              "+t._s(t.$t('m.home["（您尚未设置附件存放的目录，请填写）"]'))+"\n            ")])]),t._v(" "),e("bk-input",{attrs:{disabled:!t.moduleInfo.systemPath.changing||t.isAllStatusGetting,placeholder:t.$t("m.home['请填写路径']")},model:{value:t.moduleInfo.systemPath.nowValue,callback:function(e){t.$set(t.moduleInfo.systemPath,"nowValue","string"==typeof e?e.trim():e)},expression:"moduleInfo.systemPath.nowValue"}}),t._v(" "),e("div",{staticClass:"bk-left-btn"},[t.moduleInfo.systemPath.changing?t.moduleInfo.systemPath.formerValue&&t.moduleInfo.systemPath.changing?[e("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:t.$t("m.home['保存']"),disabled:!t.moduleInfo.systemPath.nowValue},on:{click:function(e){return t.allSwitchChange("off","systemPath")}}},[t._v("\n                "+t._s(t.$t("m.home['保存']"))+"\n              ")]),t._v(" "),e("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:t.$t("m.home['取消']")},on:{click:t.cancelPath}},[t._v("\n                "+t._s(t.$t("m.home['取消']"))+"\n              ")])]:e("bk-button",{staticClass:"mr10",attrs:{theme:"primary",disabled:!t.moduleInfo.systemPath.nowValue||t.isAllStatusGetting,title:t.$t("m.home['提交']")},on:{click:function(e){return t.allSwitchChange("off","systemPath")}}},[t._v("\n              "+t._s(t.$t("m.home['提交']"))+"\n            ")]):e("span",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["global_settings_manage"])},expression:"{ active: !hasPermission(['global_settings_manage']) }"}],class:["bk-change-place",{"btn-permission-disable":!t.hasPermission(["global_settings_manage"])}],on:{click:t.handleChangeSystemPath}},[t._v("\n              "+t._s(t.$t('m.home["更改位置"]'))+"\n            ")])],2)],1)]),t._v(" "),e("div",{staticClass:"bk-file-right"},[e("p",{staticClass:"bk-right-title"},[t._v(t._s(t.$t('m.home["附件存储"]')))]),t._v(" "),e("ul",{staticClass:"bk-number-ul"},[e("li",[t._v("\n            "+t._s(t.$t('m.home["请配置合法的系统路径，并保证每台AppServer都能访问该目录（如nfs）"]'))+"\n          ")]),t._v(" "),e("li",[t._v("\n            "+t._s(t.$t('m.home["若需更换目录，请务必将原目录文件拷贝到新目录"]'))+"\n          ")]),t._v(" "),e("li",[t._v("\n            "+t._s(t.$t('m.home["蓝鲸企业版默认提供了NFS服务，可以直接配置目录为："]'))+"\n            "),e("span",{staticClass:"bk-red"},[t._v("/data/app/code/USERRES/")])]),t._v(" "),e("li",[t._v("\n            "+t._s(t.$t('m.home["企业版"]'))+"\n            "),e("span",{staticClass:"bk-red"},[t._v("2.2.x")]),t._v("\n            "+t._s(t.$t('m.home["需要先升级SaaS部署脚本（"]'))+"\n            "),e("span",{staticClass:"bk-red"},[t._v("2.4")]),t._v("\n            "+t._s(t.$t('m.home["以后的版本不需要），请下载"]'))+"\n            "),e("span",{staticClass:"bk-red"},[e("a",{attrs:{target:"blank",href:t.downUrl}},[t._v(t._s(t.$t('m.home["升级压缩包"]')))])]),t._v("\n            "+t._s(t.$t('m.home["后按照"]'))+"\n            "),e("span",{staticClass:"bk-red"},[t._v("readme")]),t._v("\n            "+t._s(t.$t('m.home["进行操作"]'))+"\n          ")])])])]),t._v(" "),e("div",{staticClass:"bk-system-file"},[e("div",{staticClass:"bk-file-left"},[e("p",{staticClass:"bk-left-title"},[t._v(t._s(t.$t('m.home["清除缓存"]')))]),t._v(" "),e("div",{staticClass:"bk-left-content"},[e("p",{staticClass:"bk-left-message"},[t._v("\n            "+t._s(t.$t('m.home["缓存内容"]'))+"：\n          ")]),t._v(" "),e("p",{staticClass:"bk-left-message"},[t._v("\n            1."+t._s(t.$t('m.home["业务列表缓存"]'))+"\n          ")]),t._v(" "),e("p",{staticClass:"bk-left-message"},[t._v("\n            2."+t._s(t.$t('m.home["业务角色及人员列表缓存"]'))+"\n          ")]),t._v(" "),e("div",{staticClass:"bk-left-btn"},[e("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["global_settings_manage"])},expression:"{ active: !hasPermission(['global_settings_manage']) }"}],class:["mr10",{"btn-permission-disable":!t.hasPermission(["global_settings_manage"])}],attrs:{theme:"primary",title:t.$t("m.home['一键清除']")},on:{click:t.handleClear}},[t._v("\n              "+t._s(t.$t('m.home["一键清除"]'))+"\n            ")]),t._v(" "),e("span",{staticClass:"bk-clear-info"},[t._v("\n              "+t._s(t.$t('m.home["上次清除时间："]'))+t._s(t.clearStorageTime)+"\n            ")])],1)])]),t._v(" "),e("div",{staticClass:"bk-file-right"},[e("p",{staticClass:"bk-right-title"},[t._v(t._s(t.$t('m.home["缓存清除"]')))]),t._v(" "),e("ul",{staticClass:"bk-number-ul"},[e("li",[t._v("\n            "+t._s(t.$t('m.home["如需即时更新来自CMDB的最新数据，可以通过手动清除缓存获取最新数据。"]'))+"\n          ")])])])]),t._v(" "),e("div",{staticClass:"bk-system-file"},[e("div",{staticClass:"bk-file-left"},[e("p",{staticClass:"bk-left-title"},[t._v(t._s(t.$t('m.home["功能开关"]')))]),t._v(" "),e("div",{staticClass:"bk-left-content"},t._l(t.moduleInfo,(function(s,a){return e("div",{key:a,staticClass:"bk-left-btn"},[t.onceSlaSwitcher(s)?[e("span",{staticClass:"bk-clear-info"},[t._v("\n                "+t._s(s.title)+"\n              ")]),t._v(" "),e("bk-switcher",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!t.hasPermission(["global_settings_manage"])},expression:"{ active: !hasPermission(['global_settings_manage']) }"}],class:{"text-permission-disable":!t.hasPermission(["global_settings_manage"])},attrs:{disabled:t.isAllStatusGetting||!t.hasPermission(["global_settings_manage"]),size:"small","on-text":t.$t("m.home['打开']"),"off-text":t.$t("m.home['关闭']")},on:{change:function(e){return t.allSwitchChange(e,a)}},model:{value:s.open,callback:function(e){t.$set(s,"open",e)},expression:"item.open"}})]:t._e()],2)})),0)]),t._v(" "),e("div",{staticClass:"bk-file-right"},[e("p",{staticClass:"bk-right-title"},[t._v(t._s(t.$t('m.home["功能开关"]')))]),t._v(" "),e("ul",{staticClass:"bk-number-ul"},[e("li",[t._v("\n            "+t._s(t.$t('m.home["“功能开关”可以自定义启停以下ITSM功能模块，关闭后，该模块对应的所有的功能将被隐藏。"]'))+"\n          ")]),t._v(" "),t.moduleInfo.sla.open?e("li",[t._v("\n            "+t._s(t.$t('m.home["“SLA功能开关” 关闭后，该按钮开关和模块对应的所有的功能将被隐藏。"]'))+"\n          ")]):t._e()])])])]),t._v(" "),e("bk-sideslider",{attrs:{"is-show":t.versionLogData.show,title:t.versionLogData.title,width:t.versionLogData.width},on:{"update:isShow":function(e){return t.$set(t.versionLogData,"show",e)},"update:is-show":function(e){return t.$set(t.versionLogData,"show",e)}}},[t.versionLogData.show?e("div",{staticClass:"p20",attrs:{slot:"content"},slot:"content"},[e("version-log",{attrs:{"version-log-data":t.versionLogData}})],1):t._e()])],1)},n=[];a._withStripped=!0},"JFS+":function(t,e,s){"use strict";s.d(e,"a",(function(){return a})),s.d(e,"b",(function(){return n}));var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"versionLog"},[e("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:t.isDataLoading},expression:"{ isLoading: isDataLoading }"}],attrs:{data:t.versionData,size:"small"}},[e("bk-table-column",{attrs:{label:t.$t("m.home['旧版本']"),prop:"version_from"}}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.home['新版本']"),prop:"version_to"}}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.home['升级人']"),prop:"operator"}}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.home['时间']"),prop:"create_at"}}),t._v(" "),e("bk-table-column",{attrs:{label:t.$t("m.home['备注']"),prop:"note"}})],1),t._v(" "),e("div",{staticStyle:{"margin-top":"20px"}},[e("bk-button",{staticClass:"mr10",attrs:{theme:"default",title:t.$t("m.home['取消']")},on:{click:function(e){t.versionLogData.show=!1}}},[t._v("\n      "+t._s(t.$t('m.home["取消"]'))+"\n    ")])],1)],1)},n=[];a._withStripped=!0},Llq7:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=u(s("/f1G")),n=u(s("GQeE")),i=u(s("14Xm")),o=u(s("D3Ub")),r=s("CeR/"),l=u(s("v2W3")),m=u(s("0hVY"));function u(t){return t&&t.__esModule?t:{default:t}}e.default={name:"attachmentStorage",components:{versionLog:l.default},mixins:[m.default],data:function(){return{clearStorageTime:localStorage.getItem("clearStorageTime")||this.$t('m.home["暂无"]'),placeholder:this.$t('m.home["请填写路径"]'),issending:!1,downUrl:window.STATIC_URL+"help/itsm_nfs.tar.gz",rowVersionList:[],versionList:[],formerVersion:"",updatedVersion:"",versionLogData:{title:this.$t('m.home["升级记录"]'),show:!1,width:700},switchKeyMap:{SYS_FILE_PATH:"systemPath",FLOW_PREVIEW:"preview",WIKI_SWITCH:"wiki",CHILD_TICKET_SWITCH:"inherit",SLA_SWITCH:"sla",TRIGGER_SWITCH:"trigger",TASK_SWITCH:"task",FIRST_STATE_SWITCH:"basic",TABLE_FIELDS_SWITCH:"module",SMS_COMMENT_SWITCH:"smsComment"},moduleInfo:{basic:{id:"",title:this.$t('m.home["提单信息展示开关："]'),open:!1,isAvailable:!0},module:{id:"",title:this.$t('m.home["基础信息展示开关："]'),open:!1,isAvailable:!0},systemPath:{id:"",formerValue:"",nowValue:"",changing:!1},preview:{id:"",title:this.$t('m.home["流程预览功能开关："]'),open:!1,isAvailable:!0},sla:{id:"",title:this.$t('m.home["SLA功能开关："]'),open:!1,isAvailable:!0},inherit:{id:"",title:this.$t('m.home["母子单功能开关："]'),open:!1,isAvailable:!0},wiki:{id:"",title:this.$t('m.home["知识库功能开关："]'),open:!1,isAvailable:!1},task:{id:"",title:this.$t('m.home["任务功能开关："]'),open:!1,isAvailable:!0},trigger:{id:"",title:this.$t('m.home["触发器功能开关："]'),open:!1,isAvailable:!0},smsComment:{id:"",title:this.$t('m.home["短信评论开关："]'),open:!1,isAvailable:!0}},isAllStatusGetting:!1}},computed:{sliderStatus:function(){return this.$store.state.common.slideStatus}},watch:{},created:function(){var t=this;return(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getEnableStatusAndStorage();case 2:case"end":return e.stop()}}),e,t)})))()},mounted:function(){var t=this;return(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.getVersionList();case 2:case"end":return e.stop()}}),e,t)})))()},methods:{onceSlaSwitcher:function(t){var e=t.isAvailable,s=t.open;return"SLA功能开关："===t.title?s:e},getEnableStatusAndStorage:function(){var t=this;return(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.isAllStatusGetting=!0,e.next=3,t.$store.dispatch("attachmentStorage/getEnableStatus").then((function(e){var s={};e.data.forEach((function(e){"SYS_FILE_PATH"===e.key?(s.SYS_FILE_PATH=e.value,t.moduleInfo.systemPath.nowValue=e.value,t.moduleInfo.systemPath.formerValue=e.value,t.moduleInfo.systemPath.id=e.id||""):"SERVICE_SWITCH"!==e.key&&t.switchKeyMap[e.key]&&(s[e.key]="on"===e.value,t.moduleInfo[t.switchKeyMap[e.key]].open=s[e.key],t.moduleInfo[t.switchKeyMap[e.key]].id=e.id||"")})),t.$store.commit("changeOpenFunction",s)})).catch((function(e){(0,r.errorHandler)(e,t)})).finally((function(){t.isAllStatusGetting=!1}));case 3:case"end":return e.stop()}}),e,t)})))()},cancelPath:function(){this.moduleInfo.systemPath.changing=!1,this.moduleInfo.systemPath.nowValue=this.moduleInfo.systemPath.formerValue},allSwitchChange:function(t,e){var s=this;return(0,o.default)(i.default.mark((function o(){var l,m;return i.default.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(s.hasPermission(["global_settings_manage"])){i.next=3;break}return s.applyForPermission(["global_settings_manage"],[],{}),i.abrupt("return");case 3:if(!s.isAllStatusGetting){i.next=5;break}return i.abrupt("return");case 5:return l=s.moduleInfo[e].id,m={type:"FUNCTION",key:(0,n.default)(s.switchKeyMap)[(0,a.default)(s.switchKeyMap).indexOf(e)],value:t?"on":"off"},"systemPath"===e&&(m.value=s.moduleInfo.systemPath.nowValue,m.type="PATH"),s.isAllStatusGetting=!0,i.next=11,s.$store.dispatch("attachmentStorage/putEnableStatus",{params:m,id:l}).then((function(){s.$bkMessage({message:s.$t('m.home["更新成功"]'),theme:"success"}),s.getEnableStatusAndStorage()})).catch((function(t){(0,r.errorHandler)(t,s),s.getEnableStatusAndStorage(),s.moduleInfo.systemPath.nowValue=s.moduleInfo.systemPath.formerValue})).finally((function(){s.moduleInfo.systemPath.changing=!1,s.isAllStatusGetting=!1}));case 11:case"end":return i.stop()}}),o,s)})))()},handleClear:function(){var t=this;this.hasPermission(["global_settings_manage"])?!0!==this.issending&&(this.issending=!0,this.$store.dispatch("attachmentStorage/clearStorage",{}).then((function(){t.$bkMessage({message:t.$t('m.home["清除缓存成功"]'),theme:"success"}),t.clearStorageTime=(new Date).toLocaleString("zh",{hour12:!1}),window.localStorage.setItem("clearStorageTime",t.clearStorageTime)})).catch((function(e){(0,r.errorHandler)(e,t)})).finally((function(){setTimeout((function(){t.issending=!1}),1e4)}))):this.applyForPermission(["global_settings_manage"],[],{})},seeLog:function(){this.versionLogData.show=!0},getVersionList:function(){var t=this;return(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("version/version_logs").then((function(e){t.rowVersionList=e.data.data,t.updatedVersion=t.rowVersionList[0].version,t.rowVersionList.forEach((function(e){var s={name:"V"+e.version};t.versionList.push(s)}))})).catch((function(e){(0,r.errorHandler)(e,t)})).finally((function(){}));case 2:case"end":return e.stop()}}),e,t)})))()},onKeyUpdate:function(){var t=this;return(0,o.default)(i.default.mark((function e(){var s;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s={version_from:t.formerVersion.substr(1,t.formerVersion.length-1),version_to:t.updatedVersion},e.next=3,t.$store.dispatch("version/oneKeymigrate",s).then((function(){t.$bkMessage({message:t.$t('m.home["提交成功，后台执行升级中"]'),theme:"success"})})).catch((function(e){(0,r.errorHandler)(e,t)})).finally((function(){t.formerVersion=""}));case 3:case"end":return e.stop()}}),e,t)})))()},handleChangeSystemPath:function(){this.hasPermission(["global_settings_manage"])?this.moduleInfo.systemPath.changing=!0:this.applyForPermission(["global_settings_manage"],[],{})}}}},Zdbm:function(t,e,s){},azRp:function(t,e,s){"use strict";s("Zdbm")},fW1p:function(t,e,s){var a=s("Y7ZC"),n=s("E8gZ")(!1);a(a.S,"Object",{values:function(t){return n(t)}})},nhzr:function(t,e,s){s("fW1p"),t.exports=s("WEpk").Object.values},o9QT:function(t,e,s){"use strict";s.r(e);var a=s("wYBN"),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(i);e.default=n.a},v2W3:function(t,e,s){"use strict";s.r(e);var a=s("JFS+"),n=s("o9QT");for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);var o=s("KHd+"),r=Object(o.a)(n.default,a.a,a.b,!1,null,"57bb8230",null);e.default=r.exports},wYBN:function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=s("CeR/");e.default={name:"versionLog",props:{versionLogData:{type:Object,default:function(){return{}}}},data:function(){return{versionData:[],isDataLoading:!1}},mounted:function(){this.getHistory()},methods:{getHistory:function(){var t=this;this.isDataLoading=!0,this.$store.dispatch("version/updateHistory").then((function(e){t.versionData=e.data.data,t.versionData.forEach((function(t){t.version_from&&(t.version_from="V"+t.version_from),t.version_to&&(t.version_to="V"+t.version_to)}))})).catch((function(e){(0,a.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}))}}}},xdxv:function(t,e,s){"use strict";s.r(e);var a=s("FQ3n"),n=s("+cUO");for(var i in n)["default"].indexOf(i)<0&&function(t){s.d(e,t,(function(){return n[t]}))}(i);s("azRp");var o=s("KHd+"),r=Object(o.a)(n.default,a.a,a.b,!1,null,"a86202d4",null);e.default=r.exports}}]);