(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{"/h46":function(e,t,i){i("cHUd")("Map")},"0HLa":function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"bk-itsm-service"},[t("div",{staticClass:"is-title",class:{"bk-title-left":!e.sliderStatus}},[t("p",{staticClass:"bk-come-back"},[e._v("\n      "+e._s(e.$t('m.flowManager["流程版本"]'))+"\n    ")])]),e._v(" "),t("div",{staticClass:"itsm-page-content"},[e.versionStatus?t("div",{staticClass:"bk-itsm-version"},[t("i",{staticClass:"bk-icon icon-info-circle"}),e._v(" "),t("span",[e._v(e._s(e.$t('m.flowManager["流程版本：由流程模板部署后即可生成"]')))]),e._v(" "),t("i",{staticClass:"bk-icon icon-close",on:{click:e.closeVersion}})]):e._e(),e._v(" "),t("div",{staticClass:"bk-only-btn"},[t("div",{staticClass:"bk-more-search"},[t("bk-button",{staticClass:"mr10",attrs:{theme:"primary",title:e.$t("m.flowManager['批量删除']"),disabled:!e.checkList.length},on:{click:function(t){return e.openConfirmDialog({},"batchDelete")}}},[e._v("\n          "+e._s(e.$t("m.flowManager['批量删除']"))+"\n        ")]),e._v(" "),t("div",{staticClass:"bk-search-name"},[t("div",{staticClass:"bk-search-content"},[t("bk-input",{attrs:{clearable:!0,"right-icon":"bk-icon icon-search"},on:{enter:e.searchContent,clear:e.clearSearch},model:{value:e.moreSearch[0].value,callback:function(t){e.$set(e.moreSearch[0],"value",t)},expression:"moreSearch[0].value"}})],1),e._v(" "),t("bk-button",{staticClass:"ml10 filter-btn",attrs:{title:e.$t("m.deployPage['更多筛选条件']"),icon:" bk-itsm-icon icon-search-more"},on:{click:e.searchMore}})],1)],1),e._v(" "),t("search-info",{ref:"searchInfo",attrs:{"more-search":e.moreSearch}})],1),e._v(" "),t("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.isDataLoading},expression:"{ isLoading: isDataLoading }"}],ref:"versionTable",attrs:{data:e.dataList,size:"small",pagination:e.pagination},on:{"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange,"select-all":e.handleSelectAll,select:e.handleSelect}},[t("bk-table-column",{attrs:{type:"selection",width:"60",align:"center",selectable:e.disabledFn},scopedSlots:e._u([{key:"default",fn:function(i){return[e.hasPermission(["flow_version_manage"],i.row.auth_actions)?[t("bk-checkbox",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.top",value:{content:e.$t("m.flowManager['流程已绑定服务，不能进行删除操作']"),disabled:!i.row.service_cnt},expression:"{\n                content: $t(`m.flowManager['流程已绑定服务，不能进行删除操作']`),\n                disabled: !props.row.service_cnt\n              }",modifiers:{top:!0}}],attrs:{"true-value":e.trueStatus,"false-value":e.falseStatus,disabled:!!i.row.service_cnt},on:{change:function(t){return e.changeCheck(i.row)}},model:{value:i.row.checkStatus,callback:function(t){e.$set(i.row,"checkStatus",t)},expression:"props.row.checkStatus"}})]:[t("div",{staticStyle:{height:"100%",display:"flex","justify-content":"center","align-items":"center"}},[t("span",{directives:[{name:"cursor",rawName:"v-cursor"}],staticClass:"checkbox-permission-disable",on:{click:function(t){return e.checkfowManagePermisson(i.row)}}})])]]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.common['ID']"),"min-width":"60"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{attrs:{title:i.row.id}},[e._v(e._s(i.row.id||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.flowManager['流程名']"),width:"200"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{attrs:{title:i.row.name}},[e._v(e._s(i.row.name||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.flowManager['版本号']"),"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{attrs:{title:i.row.version_number}},[e._v(e._s(i.row.version_number||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.flowManager['发布人']")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{attrs:{title:i.row.updated_by}},[e._v(e._s(i.row.updated_by||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.flowManager['发布时间']"),"min-width":"150"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{attrs:{title:i.row.update_at}},[e._v(e._s(i.row.update_at||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.flowManager['关联服务数']"),width:"90"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("span",{attrs:{title:i.row.service_cnt}},[e._v(e._s(i.row.service_cnt||"--"))])]}}])}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m.flowManager['操作']"),width:"150"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["flow_version_manage"],i.row.auth_actions)},expression:"{ active: !hasPermission(['flow_version_manage'], props.row.auth_actions) }"}],class:[{"btn-permission-disable":!e.hasPermission(["flow_version_manage"],i.row.auth_actions)}],attrs:{text:"",theme:"primary",title:e.$t("m.flowManager['预览']")},on:{click:function(t){return e.onFlowPreview(i.row)}}},[e._v("\n            "+e._s(e.$t('m.flowManager["预览"]'))+"\n          ")]),e._v(" "),t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["flow_version_restore"],i.row.auth_actions)},expression:"{ active: !hasPermission(['flow_version_restore'], props.row.auth_actions) }"}],class:[{"btn-permission-disable":!e.hasPermission(["flow_version_restore"],i.row.auth_actions)}],attrs:{text:"",theme:"primary",title:e.$t("m.flowManager['还原']")},on:{click:function(t){return e.openConfirmDialog(i.row,"restore")}}},[e._v("\n            "+e._s(e.$t('m.flowManager["还原"]'))+"\n          ")]),e._v(" "),t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["flow_version_manage"],i.row.auth_actions)},expression:"{ active: !hasPermission(['flow_version_manage'], props.row.auth_actions) }"}],class:[{"btn-permission-disable":!e.hasPermission(["flow_version_manage"],i.row.auth_actions)}],attrs:{text:"",theme:"primary",title:e.$t("m.flowManager['删除']"),disabled:e.hasPermission(["flow_version_manage"],i.row.auth_actions)&&!!i.row.service_cnt},on:{click:function(t){return e.openConfirmDialog(i.row,"delete")}}},[e._v("\n            "+e._s(e.$t('m.flowManager["删除"]'))+"\n          ")])]}}])})],1)],1),e._v(" "),t("bk-dialog",{attrs:{width:"760",position:e.processInfo.position,draggable:e.processInfo.draggable,title:e.processInfo.title},model:{value:e.processInfo.isShow,callback:function(t){e.$set(e.processInfo,"isShow",t)},expression:"processInfo.isShow"}},[t("div",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.processInfo.loading},expression:"{ isLoading: processInfo.loading }"}],staticStyle:{width:"100%",height:"347px"}},[e.processInfo.loading?e._e():t("preview",{attrs:{"add-list":e.addList,"line-list":e.lineList,"preview-info":e.previewInfo,"normal-color":e.normalColor}})],1),e._v(" "),t("div",{attrs:{slot:"footer"},slot:"footer"},[t("bk-button",{attrs:{theme:"default"},on:{click:function(t){e.processInfo.isShow=!1}}},[e._v("\n        "+e._s(e.$t('m.deployPage["关闭"]'))+"\n      ")])],1)])],1)},s=[];n._withStripped=!0},"3q/D":function(e,t,i){"use strict";i("Ct2Y")},Ct2Y:function(e,t,i){},DCPb:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=l(i("ODRq")),s=l(i("vDqi")),a=l(i("Ah+g")),o=l(i("i8o3")),r=l(i("0hVY")),c=i("CeR/");function l(e){return e&&e.__esModule?e:{default:e}}t.default={name:"FlowVersion",components:{searchInfo:a.default,preview:o.default},mixins:[r.default],data:function(){return{secondClick:!1,versionStatus:!0,isDataLoading:!1,normalColor:!0,trueStatus:!0,falseStatus:!1,dataList:[],pagination:{current:1,count:10,limit:10},checkList:[],moreSearch:[{name:this.$t('m.flowManager["流程名"]'),type:"input",typeKey:"name__contains",value:"",list:[]},{name:this.$t('m.flowManager["版本号"]'),type:"input",typeKey:"version_number__contains",value:"",list:[]},{name:this.$t('m.flowManager["发布人"]'),type:"member",typeKey:"updated_by__contains",multiSelect:!0,value:[],list:[]}],deleteInfo:{type:"",info:{}},processInfo:{isShow:!1,title:this.$t('m.flowManager["流程预览"]'),position:{top:150},draggable:!0,loading:!0,version:"version",addList:[]},previewInfo:{canClick:!1,narrowSize:.8},addList:[],lineList:[]}},computed:{sliderStatus:function(){return this.$store.state.common.slideStatus}},mounted:function(){this.getList()},methods:{getList:function(e){var t=this;void 0!==e&&(this.pagination.current=e),this.checkList=[];var i={page:this.pagination.current,page_size:this.pagination.limit};this.moreSearch.forEach((function(e){(Array.isArray(e.value)?e.value.length:e.value)&&(i[e.typeKey]=Array.isArray(e.value)?e.value.join(","):e.value)})),this.isDataLoading=!0,this.$store.dispatch("workflowVersion/list",i).then((function(e){t.dataList=e.data.items,t.dataList.forEach((function(e){t.$set(e,"checkStatus",!1)})),t.pagination.current=e.data.page,t.pagination.count=e.data.count})).catch((function(e){(0,c.errorHandler)(e,t)})).finally((function(){t.isDataLoading=!1}))},handlePageLimitChange:function(){this.pagination.limit=arguments[0],this.getList()},handlePageChange:function(e){this.pagination.current=e,this.getList()},handleSelectAll:function(e){var t=this;this.dataList.forEach((function(i){!i.service_cnt&&t.hasPermission(["flow_version_manage"],i.auth_actions)&&(i.checkStatus=!!e.length)})),this.checkList=e.filter((function(e){return t.hasPermission(["flow_version_manage"],e.auth_actions)}))},handleSelect:function(e){this.checkList=e},disabledFn:function(e){return!e.service_cnt},changeCheck:function(e){this.$refs.versionTable.toggleRowSelection(e,e.checkStatus),e.checkStatus?this.checkList.some((function(t){return t.id===e.id}))||this.checkList.push(e):this.checkList=this.checkList.filter((function(t){return t.id!==e.id}))},searchContent:function(){this.getList(1)},searchMore:function(){this.$refs.searchInfo.searchMore()},clearSearch:function(){this.moreSearch.forEach((function(e){e.value=e.multiSelect?[]:""})),this.getList(1)},changePageSize:function(){this.customPaging.page_size<5?this.customPaging.page_size=5:this.customPaging.page_size>100&&(this.customPaging.page_size=100),this.getList(1)},pageChange:function(e){this.customPaging.page=e,this.getList()},openConfirmDialog:function(e,t){var i=this;if(("delete"!==t||this.checkfowManagePermisson(e))&&("restore"!==t||this.checkfowRestorePermisson(e))){var s=new n.default([["delete",this.$t('m.flowManager["流程版本删除确认"]')],["restore",this.$t('m.flowManager["流程版本还原确认"]')],["export",this.$t('m.flowManager["流程版本导出确认"]')],["batchDelete",this.$t('m.flowManager["流程版本批量删除确认"]')]]),a=new n.default([["delete",this.$t('m.flowManager["删除之后服务将无法关联这些流程版本"]')],["restore",this.$t('m.flowManager["还原后请移步到流程设计处编辑"]')],["export",this.$t('m.flowManager["确认后将导出当前版本的流程数据为JSON格式的文件"]')],["batchDelete",this.$t('m.flowManager["删除之后服务将无法关联这些流程版本"]')]]);e.service_cnt&&"delete"===t||(this.deleteInfo.info=e,this.deleteInfo.type=t,this.$bkInfo({type:"warning",title:s.get(t),subTitle:a.get(t),confirmFn:function(){i.submitFn()}}))}},submitFn:function(){"delete"===this.deleteInfo.type?this.deleteSubmit():"restore"===this.deleteInfo.type?this.restoreSubmit():"export"===this.deleteInfo.type?this.exportSubmit():"batchDelete"===this.deleteInfo.type&&this.batchDeleteSubmit()},batchDeleteSubmit:function(){var e=this;if(!this.secondClick){this.secondClick=!0;var t=this.checkList.map((function(e){return e.id})).join(",");this.$store.dispatch("workflowVersion/batchDelete",{id:t}).then((function(){e.$bkMessage({message:e.$t('m.flowManager["批量删除成功"]'),theme:"success"}),e.checkList=[],e.getList()})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.secondClick=!1}))}},deleteSubmit:function(){var e=this;this.secondClick||(this.secondClick=!0,this.$store.dispatch("workflowVersion/delete",this.deleteInfo.info.id).then((function(){e.$bkMessage({message:e.$t('m.flowManager["删除成功"]'),theme:"success"}),e.getList(1)})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))},restoreSubmit:function(){var e=this;this.secondClick||(this.secondClick=!0,this.$store.dispatch("workflowVersion/restore",this.deleteInfo.info.id).then((function(){e.$bkMessage({message:e.$t('m.flowManager["成功还原该流程，请前往【流程设计】查看"]'),theme:"success"})})).catch((function(t){(0,c.errorHandler)(t,e)})).finally((function(){e.secondClick=!1})))},onFlowPreview:function(e){var t=this;if(this.checkfowManagePermisson(e)){var i=e.id;i&&(this.processInfo.isShow=!this.processInfo.isShow,this.processInfo.loading=!0,s.default.all([this.$store.dispatch("deployCommon/getNodeVersion",{id:i}),this.$store.dispatch("deployCommon/getLineVersion",{id:i})]).then(s.default.spread((function(e,i){t.addList=e.data;for(var n=0;n<t.addList.length;n++)t.addList[n].indexInfo=n;t.lineList=i.data.items}))).finally((function(){t.processInfo.loading=!1})))}},closeVersion:function(){this.versionStatus=!1},checkfowManagePermisson:function(e){if(!this.hasPermission(["flow_version_manage"],e.auth_actions)){var t=this.$store.state.project.projectInfo,i={project:[{id:t.key,name:t.name}],flow_version:[{id:e.id,name:e.name}]};return this.applyForPermission(["flow_version_manage"],e.auth_actions,i),!1}return!0},checkfowRestorePermisson:function(e){if(!this.hasPermission(["flow_version_restore"],e.auth_actions)){var t=this.$store.state.project.projectInfo,i={project:[{id:t.key,name:t.name}],flow_version:[{id:e.id,name:e.name}],workflow:[{id:e.workflow_id,name:e.name}]};return this.applyForPermission(["flow_version_restore"],e.auth_actions,i),!1}return!0}}}},IWSG:function(e,t,i){"use strict";i.r(t);var n=i("DCPb"),s=i.n(n);for(var a in n)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return n[e]}))}(a);t.default=s.a},ODRq:function(e,t,i){e.exports={default:i("UDep"),__esModule:!0}},UDep:function(e,t,i){i("wgeU"),i("FlQf"),i("bBy9"),i("g33z"),i("XLbu"),i("/h46"),i("dVTT"),e.exports=i("WEpk").Map},XLbu:function(e,t,i){var n=i("Y7ZC");n(n.P+n.R,"Map",{toJSON:i("8iia")("Map")})},dVTT:function(e,t,i){i("aPfg")("Map")},g33z:function(e,t,i){"use strict";var n=i("Wu5q"),s=i("n3ko");e.exports=i("raTm")("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=n.getEntry(s(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(s(this,"Map"),0===e?0:e,t)}},n,!0)},szot:function(e,t,i){"use strict";i.r(t);var n=i("0HLa"),s=i("IWSG");for(var a in s)["default"].indexOf(a)<0&&function(e){i.d(t,e,(function(){return s[e]}))}(a);i("3q/D");var o=i("KHd+"),r=Object(o.a)(s.default,n.a,n.b,!1,null,"63f20256",null);t.default=r.exports}}]);