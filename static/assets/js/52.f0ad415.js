(window.webpackJsonp=window.webpackJsonp||[]).push([[52],{"0o76":function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return r}));var o=function(){var e=this,t=e._self._c;return t("div",{staticClass:"project-list-page"},[t("i",{staticClass:"bk-icon icon-close-line-2 back-icon",on:{click:e.handleGoBack}}),e._v(" "),t("div",{staticClass:"action-wrap"},[t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["project_create"])},expression:"{ active: !hasPermission(['project_create']) }"}],class:[{"btn-permission-disable":!e.hasPermission(["project_create"])}],attrs:{theme:"primary"},on:{click:e.onCreateProject}},[e._v("\n      "+e._s(e.$t('m["新建"]'))+"\n    ")]),e._v(" "),t("bk-input",{staticStyle:{width:"530px"},attrs:{"right-icon":"bk-icon icon-search",placeholder:e.$t("m['请输入项目名称']")},on:{enter:e.onSearchProject,clear:e.onSearchProject},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}})],1),e._v(" "),t("div",{staticClass:"project-table"},[t("bk-table",{directives:[{name:"bkloading",rawName:"v-bkloading",value:{isLoading:e.listLoading},expression:"{ isLoading: listLoading }"}],attrs:{data:e.list,pagination:e.pagination},on:{"sort-change":e.handleSortChange,"page-change":e.handlePageChange,"page-limit-change":e.handlePageLimitChange}},[t("bk-table-column",{attrs:{prop:"name","render-header":e.$renderHeader,"show-overflow-tooltip":!0,label:e.$t("m['项目名称']")},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticClass:"name-wrap"},[t("span",{staticClass:"prefix-icon",style:{background:i.row.color||"#90a1ff"}},[e._v("\n              "+e._s(i.row.name[0].toUpperCase())+"\n            ")]),e._v(" "),t("span",{staticClass:"text"},[e._v(e._s(i.row.name))])])]}}])}),e._v(" "),t("bk-table-column",{attrs:{"render-header":e.$renderHeader,"show-overflow-tooltip":!0,prop:"key",label:e.$t("m['项目代号']")}}),e._v(" "),t("bk-table-column",{attrs:{"render-header":e.$renderHeader,"show-overflow-tooltip":!0,prop:"desc",label:e.$t("m['项目说明']")},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n          "+e._s(t.row.desc||"--")+"\n        ")]}}])}),e._v(" "),t("bk-table-column",{attrs:{"show-overflow-tooltip":!0,prop:"creator",label:e.$t("m['创建人']")}}),e._v(" "),t("bk-table-column",{attrs:{"show-overflow-tooltip":!0,sortable:!0,prop:"create_at",label:e.$t("m['创建时间']")}}),e._v(" "),t("bk-table-column",{attrs:{label:e.$t("m['操作']"),fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["project_edit"],i.row.auth_actions)},expression:"{ active: !hasPermission(['project_edit'], props.row.auth_actions) }"}],class:{"btn-permission-disable":!e.hasPermission(["project_edit"],i.row.auth_actions)},attrs:{text:"",theme:"primary"},on:{click:function(t){return e.onEditProject(i)}}},[e._v("\n            "+e._s(e.$t("m['编辑']"))+"\n          ")]),e._v(" "),t("div",{directives:[{name:"bk-tooltips",rawName:"v-bk-tooltips.right",value:e.$t("m['该项目不允许删除']"),expression:"$t(`m['该项目不允许删除']`)",modifiers:{right:!0}}],style:{display:"inline-block"}},[t("bk-button",{directives:[{name:"cursor",rawName:"v-cursor",value:{active:!e.hasPermission(["project_edit"],i.row.auth_actions)},expression:"{ active: !hasPermission(['project_edit'], props.row.auth_actions) }"}],class:{"btn-permission-disable":!e.hasPermission(["project_edit"],i.row.auth_actions)},attrs:{text:"",theme:"primary",disabled:!0},on:{click:function(t){return e.onDeleteProject(i.row)}}},[e._v("\n              "+e._s(e.$t("m['删除']"))+"\n            ")])],1)]}}])}),e._v(" "),t("div",{staticClass:"empty",attrs:{slot:"empty"},slot:"empty"},[t("empty",{attrs:{"is-error":e.listError,"is-search":e.searchToggle},on:{onRefresh:function(t){return e.getProjectList()},onClearSearch:function(t){return e.onClearSearch()}}})],1)],1)],1),e._v(" "),t("edit-project-dialog",{attrs:{title:e.editDialogTitle,"is-show":e.isEditDialogShow,project:e.projectForm},on:{confirm:e.onProjectDialogConfirm,cancel:e.onProjectDialogCancel}}),e._v(" "),t("bk-dialog",{attrs:{"header-position":"center","render-directive":"if",title:e.$t("m['确认删除项目？']"),width:400,"auto-close":!1,"mask-close":!1,loading:e.deleteProjectPending},on:{confirm:e.onDeleteProjectConfirm,cancel:function(t){e.editingProject=null}},model:{value:e.isDeleteDialogShow,callback:function(t){e.isDeleteDialogShow=t},expression:"isDeleteDialogShow"}},[e.editingProject?t("div",{staticClass:"delete-tips"},[e._v("\n      "+e._s(e.$t("m['确认删除']"))+e._s(e.$t("m['“']"))+e._s(e.editingProject.name)+e._s(e.$t("m['”']"))+e._s(e.$t("m['，']"))+e._s(e.$t("m['一旦删除将不可回复，请谨慎操作。']"))+"\n    ")]):e._e()])],1)},r=[];o._withStripped=!0},"1Zff":function(e,t,i){},DUFC:function(e,t,i){"use strict";i("1Zff")},R9aT:function(e,t,i){"use strict";i.r(t);var o=i("r/Ix"),r=i.n(o);for(var n in o)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return o[e]}))}(n);t.default=r.a},g7fZ:function(e,t,i){"use strict";i.r(t);var o=i("0o76"),r=i("R9aT");for(var n in r)["default"].indexOf(n)<0&&function(e){i.d(t,e,(function(){return r[e]}))}(n);i("DUFC");var a=i("KHd+"),s=Object(a.a)(r.default,o.a,o.b,!1,null,"7a5a597d",null);t.default=s.exports},"r/Ix":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=u(i("P2sY")),r=u(i("14Xm")),n=u(i("D3Ub")),a=u(i("EstQ")),s=i("CeR/"),c=u(i("0hVY")),l=u(i("Ez9R")),d=u(i("hztf"));function u(e){return e&&e.__esModule?e:{default:e}}t.default={name:"ProjectList",components:{EditProjectDialog:l.default,Empty:d.default},mixins:[c.default],data:function(){return{keyword:"",list:[],listLoading:!1,ordering:void 0,editingProject:null,isEditDialogShow:!1,isDeleteDialogShow:!1,editProjectPending:!1,deleteProjectPending:!1,projectForm:{name:"",key:"",desc:"",color:""},pagination:{current:1,count:0,limit:10},listError:!1,searchToggle:!1}},computed:{editDialogTitle:function(){return this.editingProject?a.default.t('m["编辑项目"]'):a.default.t('m["新建项目"]')}},created:function(){this.getProjectList()},beforeRouteEnter:function(e,t,i){t.name&&(window.previousRouter=t.fullPath),i()},beforeRouteLeave:function(e,t,i){window.previousRouter=null,i()},methods:{getProjectList:function(){var e=this;return(0,n.default)(r.default.mark((function t(){var i,o,n,a,c;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.listLoading=!0,e.listError=!1,t.prev=2,i=e.pagination,o=i.current,n=i.limit,a={page_size:n,page:o,ordering:e.ordering},""!==e.keyword?(a.name__icontains=e.keyword,e.searchToggle=!0):e.searchToggle=!1,t.next=8,e.$store.dispatch("project/getProjectList",a);case 8:c=t.sent,e.pagination.count=c.data.count,e.list=c.data.items,t.next=17;break;case 13:t.prev=13,t.t0=t.catch(2),e.listError=!0,(0,s.errorHandler)(t.t0,e);case 17:return t.prev=17,e.listLoading=!1,t.finish(17);case 20:case"end":return t.stop()}}),t,e,[[2,13,17,20]])})))()},getNameColor:function(e){return["#90a1ff","#bb90ff","#ffd990"][e]},onSearchProject:function(){this.pagination.current=1,this.getProjectList()},onClearSearch:function(){this.keyword="",this.searchToggle=!1,this.getProjectList()},onCreateProject:function(){this.hasPermission(["project_create"])?(this.isEditDialogShow=!0,this.projectForm={name:"",key:"",desc:"",color:this.getNameColor(this.pagination.count%3)},this.editingProject=null):this.applyForPermission(["project_create"],[],{})},onEditProject:function(e){if(this.editingProject=e.row,!this.hasPermission(["project_edit"],this.editingProject.auth_actions)){var t={project:[{id:this.editingProject.key,name:this.editingProject.name}]};return this.applyForPermission(["project_edit"],this.editingProject.auth_actions,t),!1}this.projectForm=(0,o.default)({},e.row),this.projectForm.color||(this.projectForm.color=this.getNameColor(e.$index%3)),this.isEditDialogShow=!0},onProjectDialogConfirm:function(){this.isEditDialogShow=!1,this.getProjectList()},onProjectDialogCancel:function(){this.isEditDialogShow=!1},onDeleteProject:function(e){if(!this.hasPermission(["project_edit"],e.auth_actions)){var t={project:[{id:e.key,name:e.name}]};return this.applyForPermission(["project_edit"],e.auth_actions,t),!1}this.editingProject=e,this.isDeleteDialogShow=!0},onDeleteProjectConfirm:function(){var e=this;return(0,n.default)(r.default.mark((function t(){return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.deleteProjectPending=!0,t.prev=1,t.next=4,e.$store.dispatch("project/deleteProject",e.editingProject.key);case 4:e.editingProject=null,e.isDeleteDialogShow=!1,1===e.list.length&&(e.pagination.current=1===e.pagination.current?1:e.pagination.current-1),e.getProjectList(),t.next=13;break;case 10:t.prev=10,t.t0=t.catch(1),(0,s.errorHandler)(t.t0,e);case 13:return t.prev=13,e.deleteProjectPending=!1,t.finish(13);case 16:case"end":return t.stop()}}),t,e,[[1,10,13,16]])})))()},handleSortChange:function(e){"ascending"===e.order||"descending"===e.order?this.ordering=e.prop:this.ordering=void 0,this.getProjectList()},handlePageChange:function(e){this.pagination.current=e,this.getProjectList()},handlePageLimitChange:function(e){this.pagination.limit=e,this.pagination.current=1,this.getProjectList()},handleGoBack:function(){window.previousRouter?this.$router.push(window.previousRouter):this.$router.push({name:"Home"})}}}}}]);